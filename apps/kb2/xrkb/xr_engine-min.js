!function(b,a){b.widget("mobile.simpledialog2",b.mobile.widget,{options:{version:"1.0.1-2012061300",mode:"blank",themeDialog:"b",themeInput:!1,themeButtonDefault:!1,themeHeader:"a",fullScreen:!1,fullScreenForce:!1,dialogAllow:!1,dialogForce:!1,headerText:!1,headerClose:!1,buttonPrompt:!1,buttonInput:!1,buttonInputDefault:!1,buttonPassword:!1,blankContent:!1,blankContentAdopt:!1,resizeListener:!0,safeNuke:!0,forceInput:!0,showModal:!0,animate:!0,transition:"pop",clickEvent:"click",zindex:"500",width:"280px",left:!1,top:!1,callbackOpen:!1,callbackOpenArgs:[],callbackClose:!1,callbackCloseArgs:[]},_eventHandler:function(f,d){var g=f.data.widget;f.data.widget.options;if(!f.isPropagationStopped()){switch(d.method){case"close":g.close();break;case"html":g.updateBlank(d.source)}}},_create:function(){var e=this,g=b.extend(this.options,this.element.jqmData("options")),d=new Date,f=b("<div class='ui-simpledialog-container ui-overlay-shadow ui-corner-all ui-simpledialog-hidden "+(g.animate===!0?g.transition:"")+" ui-body-"+g.themeDialog+"'></div>");g.themeButtonDefault===!1&&(g.themeButtonDefault=g.themeDialog),g.themeInput===!1&&(g.themeInput=g.themeDialog),b.mobile.sdCurrentDialog=e,"undefined"!=typeof b.mobile.sdLastInput&&delete b.mobile.sdLastInput,e.internalID=d.getTime(),e.displayAnchor=b.mobile.activePage.children(".ui-content").first(),0===e.displayAnchor.length&&(e.displayAnchor=b.mobile.activePage),e.displayAnchor=$("body"),e.dialogPage=b("<div data-role='dialog' data-theme='"+g.themeDialog+"'><div data-role='header'></div><div data-role='content'></div></div>"),e.sdAllContent=e.dialogPage.find("[data-role=content]"),f.appendTo(e.sdAllContent),e.sdIntContent=e.sdAllContent.find(".ui-simpledialog-container"),e.sdIntContent.css("width",g.width),(g.headerText!==!1||g.headerClose!==!1)&&(e.sdHeader=b('<div style="margin-bottom: 4px;" class="ui-header ui-bar-'+g.themeHeader+'"></div>'),g.headerClose===!0&&b("<a class='ui-btn-left' rel='close' href='#'>Close</a>").appendTo(e.sdHeader).buttonMarkup({theme:g.themeHeader,icon:"delete",iconpos:"notext",corners:!0,shadow:!0}),b('<h1 class="ui-title">'+(g.headerText!==!1?g.headerText:"")+"</h1>").appendTo(e.sdHeader),e.sdHeader.appendTo(e.sdIntContent)),"blank"===g.mode?(g.blankContent===!0&&(g.blankContentAdopt===!0?g.blankContent=e.element.children():g.blankContent=e.element.html()),b(g.blankContent).appendTo(e.sdIntContent)):"button"===g.mode&&e._makeButtons().appendTo(e.sdIntContent),e.sdIntContent.appendTo(e.displayAnchor.parent()),e.dialogPage.appendTo(b.mobile.pageContainer).page().css("minHeight","0px").css("zIndex",g.zindex),g.animate===!0&&e.dialogPage.addClass(g.transition),e.screen=b("<div>",{"class":"ui-simpledialog-screen ui-simpledialog-hidden"}).css("z-index",g.zindex-1).appendTo(e.displayAnchor.parent()).bind(g.clickEvent,function(h){g.forceInput||e.close(),h.preventDefault()}),g.showModal&&e.screen.addClass("ui-simpledialog-screen-modal"),b(document).bind("simpledialog."+e.internalID,{widget:e},function(h,j){e._eventHandler(h,j)})},_makeButtons:function(){var f=this,h=f.options,e=b("<div></div>"),g=b("<div class='ui-simpledialog-controls'><input class='ui-simpledialog-input ui-input-text ui-shadow-inset ui-corner-all ui-body-"+h.themeInput+"' type='"+(h.buttonPassword===!0?"password":"text")+"' value='"+(h.buttonInputDefault!==!1?h.buttonInputDefault.replace('"',"&#34;").replace("'","&#39;"):"")+"' name='pickin' /></div>"),d=b("<div>",{"class":"ui-simpledialog-controls"});return h.buttonPrompt!==!1&&(f.buttonPromptText=b("<p class='ui-simpledialog-subtitle'>"+h.buttonPrompt+"</p>").appendTo(e)),h.buttonInput!==!1&&(b.mobile.sdLastInput="",g.appendTo(e),g.find("input").bind("change",function(){b.mobile.sdLastInput=g.find("input").first().val(),f.thisInput=g.find("input").first().val()})),d.appendTo(e),f.butObj=[],b.each(h.buttons,function(j,k){k=b.isFunction(k)?{click:k}:k,k=b.extend({text:j,id:j+f.internalID,theme:h.themeButtonDefault,icon:"check",iconpos:"left",corners:"true",shadow:"true",args:[],close:!0},k),f.butObj.push(b("<a href='#'>"+j+"</a>").appendTo(d).attr("id",k.id).buttonMarkup({theme:k.theme,icon:k.icon,iconpos:k.iconpos,corners:k.corners,shadow:k.shadow}).unbind("vclick click").bind(h.clickEvent,function(){h.buttonInput&&f.sdIntContent.find("input [name=pickin]").trigger("change");var l=k.click.apply(f,b.merge(arguments,k.args));l!==!1&&k.close===!0&&f.close()}))}),e},_getCoords:function(g){var l=b(window).width(),f=b(window).scrollTop(),k=b(window).height(),e=g.sdIntContent.innerWidth(),j=g.sdIntContent.outerHeight(),h={high:b(window).height(),width:b.mobile.activePage.width(),fullTop:b(window).scrollTop(),fullLeft:b(window).scrollLeft(),winTop:f+(g.options.top!==!1?g.options.top:k/2-j/2),winLeft:g.options.left!==!1?g.options.left:l/2-e/2};return h.winTop<45&&(h.winTop=45),h},_orientChange:function(g){var f=g.data.widget,h=g.data.widget.options,d=g.data.widget._getCoords(g.data.widget);return g.stopPropagation(),f.isDialog===!0?!0:void (h.fullScreen===!0&&(d.width<400||h.fullScreenForce===!0)?f.sdIntContent.css({border:"none",position:"absolute",top:d.fullTop,left:d.fullLeft,height:d.high,width:d.width,maxWidth:d.width}).removeClass("ui-simpledialog-hidden"):f.sdIntContent.css({position:"absolute",top:d.winTop,left:d.winLeft}).removeClass("ui-simpledialog-hidden"))},repos:function(){var d={data:{widget:this},stopPropagation:function(){return !0}};this._orientChange(d)},open:function(){var e=this,f=this.options,d=this._getCoords(this);e.sdAllContent.find(".ui-btn-active").removeClass("ui-btn-active"),e.sdIntContent.delegate("[rel=close]",f.clickEvent,function(g){g.preventDefault(),e.close()}),f.dialogAllow===!0&&d.width<400||f.dialogForce?(e.isDialog=!0,"blank"===f.mode&&e.sdIntContent.find("select").each(function(){b(this).jqmData("nativeMenu",!0)}),e.displayAnchor.parent().unbind("pagehide.remove"),e.sdAllContent.append(e.sdIntContent),e.sdAllContent.trigger("create"),f.headerText!==!1&&(e.sdHeader.find("h1").appendTo(e.dialogPage.find("[data-role=header]")),e.sdIntContent.find(".ui-header").empty().removeClass()),f.headerClose===!0?e.dialogPage.find(".ui-header a").bind("click",function(){setTimeout("$.mobile.sdCurrentDialog.destroy();",1000)}):e.dialogPage.find(".ui-header a").remove(),e.sdIntContent.removeClass().css({top:"auto",width:"auto",left:"auto",marginLeft:"auto",marginRight:"auto",zIndex:f.zindex}),b.mobile.changePage(e.dialogPage,{transition:f.animate===!0?f.transition:"none"})):(e.isDialog=!1,e.selects=[],f.fullScreen===!1&&(f.showModal===!0&&f.animate===!0?e.screen.fadeIn("slow"):e.screen.removeClass("ui-simpledialog-hidden")),e.sdIntContent.addClass("ui-overlay-shadow in").css("zIndex",f.zindex).trigger("create"),f.fullScreen===!0&&(d.width<400||f.fullScreenForce===!0)?e.sdIntContent.removeClass("ui-simpledialog-container").css({border:"none",position:"absolute",top:d.fullTop,left:d.fullLeft,height:d.high,width:d.width,maxWidth:d.width}).removeClass("ui-simpledialog-hidden"):e.sdIntContent.css({position:"absolute",top:d.winTop,left:d.winLeft}).removeClass("ui-simpledialog-hidden"),b(document).bind("orientationchange.simpledialog",{widget:e},function(g){e._orientChange(g)}),f.resizeListener===!0&&b(window).bind("resize.simpledialog",{widget:e},function(g){e._orientChange(g)})),b.isFunction(f.callbackOpen)&&f.callbackOpen.apply(e,f.callbackOpenArgs)},close:function(){var e,f=this,d=this.options;return b.isFunction(f.options.callbackClose)&&(e=f.options.callbackClose.apply(f,f.options.callbackCloseArgs),e===!1)?!1:(f.isDialog?(b(f.dialogPage).dialog("close"),f.sdIntContent.addClass("ui-simpledialog-hidden"),f.sdIntContent.appendTo(f.displayAnchor.parent()),1!=b.mobile.activePage.jqmData("page").options.domCache&&b.mobile.activePage.is(":jqmData(external-page='true')")&&b.mobile.activePage.bind("pagehide.remove",function(){b(this).remove()})):(f.options.showModal===!0&&f.options.animate===!0?f.screen.fadeOut("slow"):f.screen.addClass("ui-simpledialog-hidden"),f.sdIntContent.addClass("ui-simpledialog-hidden").removeClass("in"),b(document).unbind("orientationchange.simpledialog"),f.options.resizeListener===!0&&b(window).unbind("resize.simpledialog")),"blank"===d.mode&&d.blankContent!==!1&&d.blankContentAdopt===!0&&(f.element.append(d.blankContent),d.blankContent=!0),void (f.isDialog===!0||f.options.animate===!0?setTimeout(function(g){return function(){g.destroy()}}(f),1000):f.destroy()))},destroy:function(){var d=this,e=d.element;"blank"===d.options.mode&&b.mobile.sdCurrentDialog.sdIntContent.find("select").each(function(){0==b(this).data("nativeMenu")&&(b(this).data("selectmenu").menuPage.remove(),b(this).data("selectmenu").screen.remove(),b(this).data("selectmenu").listbox.remove())}),b(d.sdIntContent).remove(),b(d.dialogPage).remove(),b(d.screen).remove(),b(document).unbind("simpledialog."+d.internalID),delete b.mobile.sdCurrentDialog,b.Widget.prototype.destroy.call(d),d.options.safeNuke===!0&&0===b(e).parents().length&&0===b(e).contents().length&&e.remove()},updateBlank:function(e){var f=this,d=this.options;f.sdIntContent.empty(),(d.headerText!==!1||d.headerClose!==!1)&&(f.sdHeader=b('<div class="ui-header ui-bar-'+d.themeHeader+'"></div>'),d.headerClose===!0&&b("<a class='ui-btn-left' rel='close' href='#'>Close</a>").appendTo(f.sdHeader).buttonMarkup({theme:d.themeHeader,icon:"delete",iconpos:"notext",corners:!0,shadow:!0}),b('<h1 class="ui-title">'+(d.headerText!==!1?d.headerText:"")+"</h1>").appendTo(f.sdHeader),f.sdHeader.appendTo(f.sdIntContent)),b(e).appendTo(f.sdIntContent),f.sdIntContent.trigger("create"),b(document).trigger("orientationchange.simpledialog")},_init:function(){this.open()}})}(jQuery);(function(b){var a={_getcursorindex:function(){var d=this;var f=this[0];if(typeof f.selectionStart=="undefined"&&document.selection){d.xrui_number("focus");var e=document.selection.createRange();e.moveStart("character",-d.val().length);return e.text.length}return f.selectionStart?f.selectionStart:0},_replaceSel:function(e){var d=this.val();var f=this[0];if(typeof f.selectionStart=="number"){return d.substr(0,f.selectionStart)+e+d.substr(f.selectionEnd)}else{return null}},_numberformat:function(h,n,f){var j=b(this);var m="";var d="-0123456789";var o=j.val();if(n>0){d+=f}var k=(window.event)?h.keyCode:h.which;if(k==0&&h.keyCode>0){k=h.keyCode}switch(k){case 8:case 9:case 13:return(true);case 35:return h.charCode==0;case 36:return(!h.shiftKey);case 37:if(h.charCode==0){return true}return !h.shiftKey;case 39:if(h.charCode==0){return true}return !h.shiftKey&&(h.charCode==0);case 46:if(h.charCode==0){return true}break}m=String.fromCharCode(k);if(d.indexOf(m)==-1){return false}var g=j.numeric("_replaceSel",m);if(g!==null){var l=g.replace(f,".");if(g=="-"){}else{if(l.substr(l.length-1,1)=="."){if(isNaN(l+"0")){return false}}else{if(isNaN(l)){return false}else{if(n>0){}}}}}else{if(m=="-"&&(j.numeric("_getcursorindex")!=0||o.indexOf("-")!=-1)){return false}else{if(n>0){var e=o.indexOf(f);if(e!=-1){if(m==f){return false}if(j[0].selectionStart>e&&o.length-e>n){return false}}}}}return true},init:function(d){this.each(function(){var e={decs:0,decSeparator:".",changeCB:null,returnKeyCB:null,readonly:false};b.extend(e,d);var f=b(this);f.bind("keydown",function(j){var k=b(this);if(e.readonly&&((j.ctrlKey&&(j.which!=17)&&(j.which!=67))||j.shifyKey||(j.which<16)||((j.which>17)&&(j.which<35))||((j.which>40)&&(j.which<48)))){j.preventDefault();return false}if(((j.which==110)||(j.which==46))&&(typeof this.selectionStart=="number")&&(e.decSeparator!=".")){var h=this.selectionStart;var g=k.val();g=g.substring(0,h)+e.decSeparator+g.substring(this.selectionEnd);if(!k.numeric("_numberformat",{keyCode:e.decSeparator.charCodeAt(0),which:e.decSeparator.charCodeAt(0)},e.decs,e.decSeparator)){j.preventDefault();return false}k.val(g);this.selectionStart=h+1;this.selectionEnd=this.selectionStart;j.preventDefault()}return true}).bind("keypress",function(g,h){if(e.readonly){return false}if(g.keyCode==13){if(b.isFunction(e.returnKeyCB)){e.processingReturnKey=true;e.returnKeyCB(this);e.processingReturnKey=false}return false}else{return f.numeric("_numberformat",g,e.decs,e.decSeparator)}}).change(function(h){if(e.processingReturnKey){return}var g=b(this).val();if((g.length>0)&&e.decs){b(this).val(parseFloat(g).toFixed(e.decs))}if(b.isFunction(e.changeCB)){e.changeCB(this)}});if(isIE&&isMobile){f.addClass("numeric-noborder")}f.addClass("numeric").data("numeric",e)});return this},option:function(f,e){var d=this;this.each(function(){var h=b(this);var g=h.data("numeric");if(arguments.length==1){d=g[f]}else{g[f]=e}});return d},set:function(d){return this.each(function(){var f=b(this);var e=f.data("numeric");if(isMobile){if(f.is(":focus")){return}}if(typeof d=="number"){d=d.toFixed(e.decs).toString();if(e.decSeparator!="."){d=d.replace(".",e.decSeparator)}}f.val(d)})},get:function(){if(this.length===0){return""}var f=b(this.get(0));var e=f.data("numeric");var d=f.val();if(b.trim(d).length===0){return""}if(e.decSeparator!="."){d=d.replace(e.decSeparator,".")}if(isNaN(d)){return d}else{if(e.decs===0){return parseInt(d,10)}}return parseFloat(d)}};b.fn.numeric=function(d){if(a[d]){return a[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){return a.init.apply(this,arguments)}else{b.error("Method "+d+" does not exist on jQuery.numeric")}}}})(jQuery);(function(d){var a=(d.browser.msie?"paste":"input")+".mask";var b=(window.orientation!=undefined);d.mask={definitions:{"9":"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}};d.fn.extend({caret:function(g,e){if(this.length==0){return}if(typeof g=="number"){e=(typeof e=="number")?e:g;return this.each(function(){if(this.setSelectionRange){this.focus();this.setSelectionRange(g,e)}else{if(this.createTextRange){var h=this.createTextRange();h.collapse(true);h.moveEnd("character",e);h.moveStart("character",g);h.select()}}})}else{if(this[0].setSelectionRange){g=this[0].selectionStart;e=this[0].selectionEnd}else{if(document.selection&&document.selection.createRange){var f=document.selection.createRange();g=0-f.duplicate().moveStart("character",-100000);e=g+f.text.length}}return{begin:g,end:e}}},unmask:function(){return this.trigger("unmask")},mask:function(g,l){if(!g&&this.length>0){var h=d(this[0]);var k=h.data("tests");return d.map(h.data("buffer"),function(o,n){return k[n]?o:null}).join("")}l=d.extend({placeholder:"_",completed:null},l);var f=d.mask.definitions;var k=[];var m=g.length;var j=null;var e=g.length;d.each(g.split(""),function(n,o){if(o=="?"){e--;m=n}else{if(f[o]){k.push(new RegExp(f[o]));if(j==null){j=k.length-1}}else{k.push(null)}}});return this.each(function(){var x=d(this);var r=d.map(g.split(""),function(B,A){if(B!="?"){return f[B]?l.placeholder:B}});var v=false;var z=x.val();x.data("buffer",r).data("tests",k);function w(A){while(++A<=e&&!k[A]){}return A}function q(C){while(!k[C]&&--C>=0){}for(var B=C;B<e;B++){if(k[B]){r[B]=l.placeholder;var A=w(B);if(A<e&&k[B].test(r[A])){r[B]=r[A]}else{break}}}u();x.caret(Math.max(j,C))}function n(E){for(var C=E,D=l.placeholder;C<e;C++){if(k[C]){var A=w(C);var B=r[C];r[C]=D;if(A<e&&k[A].test(B)){D=B}else{break}}}}function t(B){var C=d(this).caret();var A=B.keyCode;v=(A<16||(A>16&&A<32)||(A>32&&A<41));if((C.begin-C.end)!=0&&(!v||A==8||A==46)){o(C.begin,C.end)}if(A==8||A==46||(b&&A==127)){if(A==8){if(C.begin<=0){return}}q(C.begin-(A==8?1:0));return false}else{if(A==27){x.val(z);x.caret(0,p());return false}}}function y(D){if(v){v=false;return(D.keyCode==8)?false:null}D=D||window.event;var A=D.charCode||D.keyCode||D.which;var F=d(this).caret();if(D.ctrlKey||D.altKey||D.metaKey){return true}else{if((A>=32&&A<=125)||A>186){var C=w(F.begin-1);if(C<e){var E=String.fromCharCode(A);if(k[C].test(E)){n(C);r[C]=E;u();var B=w(C);d(this).caret(B);if(l.completed&&B==e){l.completed.call(x)}}}}}return false}function o(C,A){for(var B=C;B<A&&B<e;B++){if(k[B]){r[B]=l.placeholder}}}function u(){return x.val(r.join("")).val()}function p(B){var F=x.val();var E=-1;for(var A=0,D=0;A<e;A++){if(k[A]){r[A]=l.placeholder;while(D++<F.length){var C=F.charAt(D-1);if(k[A].test(C)){r[A]=C;E=A;break}}if(D>F.length){break}}else{if(r[A]==F[D]&&A!=m){D++;E=A}}}if(!B&&E+1<m){x.val("");o(0,e)}else{if(B||E+1>=m){u();if(!B){x.val(x.val().substring(0,E+1))}}}return(m?A:j)}if(!x.attr("readonly")){x.one("unmask",function(){x.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){z=x.val();var A=p();u();setTimeout(function(){if(A==g.length){x.caret(0,A)}else{x.caret(A)}},0)}).bind("blur.mask",function(){p();if(x.val()!=z){x.change()}}).bind("keydown.mask",t).bind("keypress.mask",y).bind(a,function(){setTimeout(function(){x.caret(p(true))},0)})}p()})}})})(jQuery);
/*! 
 *       XpertRule(R) Browser Deployment
 * Copyright (c) 2017 XpertRule Software Limited
 *             www.xpertrule.com
 *
 *              Version: 11.5.0
 */
var XRdialog={$parent:null,definition:null,formRules:null,aID:0,tiedObj:undefined,aObjectList:[],doneConstraints:false,pressedOK:false,firstPopulate:true,debugTime:null,resizeFn:null,dialogDisplayed:false,validateDefList:[],editing:false,imgSizeChangeCB2:null,renderingParent:false,htmlModeCtrlList:[],lastID:1000,imgLoadTriggered:false,create:function(b,d,e,f){var a=$.extend(true,{},this);a.$parent=b;a.definition=d;a.formRules=f;a.aID=e.aID;a.tiedObj=e.tiedObj;a.firstPopulate=true;if(e.editing){a.editing=true}if($.isFunction(e.imgSizeChangeCB)){a.imgSizeChangeCB2=e.imgSizeChangeCB}if(isSmartTv()){smartTv.startDialog(a)}return a},imgSizeChangeCB:function(b,a){this.$parent.parent().find("img").off("load");if($.isFunction(this.imgSizeChangeCB2)){this.imgSizeChangeCB2(b,a)}},_jqMwindowResize:function(a){this.callPluginMethod(null,"resize");if(appSettings.hasOwnProperty("maxwidth")&&(appSettings.maxwidth>0)){if($(window).width()>=appSettings.maxwidth){$(".type-interior.ui-page").each(function(){var d=$(this);var b=((d.find(".ui-content").length==1)&&(d.find(".ui-content").get(0).id=="xrkb_dlg_xrui"));if(!b){d.addClass("jqmwide").css("width",appSettings.maxwidth+"px").css("min-height","0px")}})}else{$(".ui-page").removeClass("jqmwide").css("width","")}}},isParentedDialog:function(){if(this.definition.pid){var a=_dgo(this.definition.pid);if(a&&(a.aType==TYPE_DIALOG)){return true}}return false},getControlList:function(){var a=this.definition.controls;if(this.isParentedDialog()){a=_dgo(this.definition.pid).aDefinition.controls}return a},_renderWysiwyg:function(b){var d=b.$parent;var e=d.parent();var f=e.parent();e.show();f.find(".xrkb-htmldlg-body").hide();if(this.isParentedDialog()){this.renderingParent=true}if(b.definition.righttoleft){$("#xruipage,.xrkb-dlg-surface .ui-page").addClass("xr_rtl")}else{$("#xruipage,.xrkb-dlg-surface .ui-page").removeClass("xr_rtl")}var a=b.getControlList();if(a){b.renderCtrls(a,b.$body)}this.renderingParent=false;this._buildTiedObjectList(b.getControlList());for(var g=0;g<this.aObjectList.length;g++){tied=dictionary.GetObject(this.aObjectList[g]);if(tied&&((tied.aType==TYPE_LIST)||(tied.aType==TYPE_NUMERIC)||(tied.aType==TYPE_DATE)||(tied.aType==TYPE_BOOLEAN)||(tied.aType==TYPE_TEXT))&&tied.isFull()&&tied.promptFor&&!tied.flatProps.isdynamic){replayStack.Add(b.aID,REPLAY_SETFULL,tied.aID,tied.GetValue())}}this._jqMwindowResize(true)},_renderHtml:function(b){var g=function(j){j.find("xr").each(function(){var u=$(this);try{var t=u.attr("type");var x="xrui_"+t;if($.isFunction(jQuery.fn[x])){var n=jQuery.fn[x]("designtime");for(var l in n){var w,q,k;if($.isPlainObject(n[l])){k=n[l].atype}else{k=n[l]}switch(k){case"tied":if(b.tiedObj){w=b.tiedObj.aID}break;case"int":w=0;break;case"str":w="";break;case"bool":w=false;break;case"enum":w=n[l].vals;break;case"css":w={name:"",dowysiwyg:true};break;default:w=null}if($.isPlainObject(n[l])&&(n[l].hasOwnProperty("adefault"))){switch(k){case"css":w.name=n[l].adefault;break;default:w=n[l].adefault}}q=u.attr(l);if(q!==undefined){switch(k){case"tied":var m=_dgobn(q);if(!m){throw"unknown object ["+q+"]"}else{w=m.aID}break;case"int":w=parseInt(q,10);if(isNaN(w)){throw"invalid number ["+q+"] for attribute ["+l+"]"}break;case"str":w=q;break;case"bool":w=q.toLowerCase()=="true";break;case"enum":if($.inArray(q,n[l].vals)==-1){throw"Invalid enum value ["+q+"] for attribute ["+l+"]"}w=q;break;case"css":w.name=q;break}}n[l]=w}var v=u.attr("swatch");if(v!==undefined){if(!n.hasOwnProperty("cssclassname")){n.cssclassname={}}n.cssclassname.name=v;n.cssclassname.dowysiwyg=true}n.aID=++b.lastID;n.aType=t;n.aName=n.aType+n.aID;b._renderCtrl(n,u);u.addClass("ui-page ui-field-contain");b.htmlModeCtrlList.push(n)}else{throw"unknown control type ["+t+"]"}}catch(r){u.text(r.message)}})};var a=b.aID+(b.tiedObj?"_"+b.tiedObj.aID:"");var d=b.$parent;var e=d.parent();var h=e.parent();if(h.find(".xrkb-htmldlg-body[aID="+a+"]:visible").length==1){return}e.hide();h.find(".xrkb-htmldlg-body").hide();var f=$("<div></div>");f.addClass("xrkb-htmldlg-body").attr("aID",a).attr("idx",h.find(".xrkb-htmldlg-body").length).html(this.definition.htmlPage).appendTo(h);g(f);htmlDialogCallBacks.onRender(this.aID)},render:function(){var a=this;$(".ui-page").removeClass("jqmwide");a.$body=a.$dialog=a.$parent;$(window).scrollTop(0);if(this.definition){if(this.definition.hasOwnProperty("dialogMode")&&(this.definition.dialogMode=="html")&&!this.editing){a._renderHtml(a)}else{a._renderWysiwyg(a)}}},renderCtrls:function(a,b,d){for(var e=0;e<a.length;e++){this._renderCtrl(a[e],b,d)}this.callPluginMethod(a,"rendered",false)},_renderCtrl:function(h,a,d){var f=$("<div></div>",{id:(this.editing?"_xrkb_":"")+h.aName});h.$div=f;h.dialog=this;if(d){h.tab=d}else{delete h.tab}var b=h.aType;switch(b){case"numeric":b="number";break;case"logical":b="listbox";break}h.pluginname="xrui_"+b;f.attr("data-role","fieldcontain").appendTo(a).data("xrui",h);if(this.renderingParent&&this.editing){f.addClass("xrui-parent-ctrl")}if($.isFunction(f[h.pluginname])){f[h.pluginname]({definition:h,changeCB:this._change,tiedDlgObj:this.tiedObj});var g=null;try{g=f[h.pluginname]("gettied")}catch(j){}if(g){h._tiedobj=g}}},renderHelp:function(a,b){return},_getLetter:function(a){var b=new Array("a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z");if(a>=b.length){a=0}return b[a]},_populateDialogProps:function(){var self=this;var $header;if(isEditor){$header=$("#mobheader,.xrui-run-header")}else{$header=$("#mobheader")}if(this.definition.hascaption){var s=this.definition.caption;if(s==""){if(this.tiedObj){s=this.tiedObj.aName}else{s=_dgo(this.aID).aName}}s=this.expandEmbedded(s);if(s.indexOf("<")<0){s="<h1 class='ui-title' tabindex='0' role='heading' aria-level='1'>"+s+"</h1>"}$header.html(s).show();if(this.editing){var h=$header.height();$header.find("img").on("load",function(){if(($header.height()!=h)&&$.isFunction(self.imgSizeChangeCB)){self.imgSizeChangeCB(self.definition,$(this))}})}if(this.definition.bkgndimage&&(this.definition.bkgndimage.length>0)){s=eval(this.definition.bkgndimage);if(s&&(s!="")&&!customStartup){document.body.background=s}}}for(var i=0;i<25;i++){$header.removeClass("ui-bar-"+this._getLetter(i));$("#xruipage,.xrkb-dlg-surface .ui-page").removeClass("ui-body-"+this._getLetter(i));$(".xrkb-dlg-surface").removeClass("ui-overlay-"+this._getLetter(i))}var cl=this.definition.cssclassname.name;if(cl!=""){$header.addClass("ui-bar-"+cl).attr("data-theme",cl);$("#xruipage,.xrkb-dlg-surface .ui-page").addClass("ui-body-"+cl);$(".xrkb-dlg-surface").addClass("ui-overlay-"+cl)}else{$header.addClass("ui-bar-c");$("#xruipage,.xrkb-dlg-surface .ui-page").addClass("ui-body-c");$(".xrkb-dlg-surface").addClass("ui-overlay-c")}if(this.definition.righttoleft){$("#xruipage,.xrkb-dlg-surface .ui-page").addClass("xr_rtl")}else{$("#xruipage,.xrkb-dlg-surface .ui-page").removeClass("xr_rtl")}if(this.aID){$("#xruipage").attr("dialog-name",_dgo(this.aID).aName)}},_populateWysiwyg:function(b,d){this.dialogDisplayed=true;if(this.definition){if(!this.editing){RepopulateDefinitionFromDictionary(this.aID,this.definition)}var a=this.getControlList();if(this.isParentedDialog()){this.renderingParent=true}if(a){this._buildTiedObjectList(a)}if(!this.editing){this.doneConstraints=false;if(this.aObjectList.length>0){this.doneConstraints=Constrain(this.aObjectList)}if(this.definition.rules){this.definition.rules(false)}this.runFormRules();this.validate(true)}this._populateDialogProps();if(a){this.populateCtrls(a)}this.renderingParent=false;if(!d&&replayStack.LastOperationWasValidatedOK()){this.ok(true);return}else{if(this.timeoutTimer){window.clearTimeout(this.timeoutTimer);this.timeoutTimer=false}if(!this.editing&&(this.definition.timeout>0)){this.timeoutTimer=window.setTimeout(function(){b.ok()},b.definition.timeout*1000)}}if(this.firstPopulate){$(":jqmData(role=page)").trigger("create")}this.callPluginMethod(null,"postJQMcreate")}this.firstPopulate=false},_populateHtml:function(a,b){if(!b&&replayStack.LastOperationWasValidatedOK()){this.ok(true);return}else{this._buildTiedObjectList(this.htmlModeCtrlList);var e;this.populateCtrls(this.htmlModeCtrlList);for(e=0;e<this.htmlModeCtrlList.length;e++){var d=this.htmlModeCtrlList[e].$div;d.trigger("create")}htmlDialogCallBacks.onPopulate(this.aID)}},populate:function(b){var a=this;if(this.definition){this.aObjectList=[];if(this.definition.hasOwnProperty("dialogMode")&&(this.definition.dialogMode=="html")&&!this.editing){a._populateHtml(a,b)}else{a._populateWysiwyg(a,b)}}},populateCtrls:function(a){for(var b=0;b<a.length;b++){this._populateCtrl(a[b])}},_populateCtrl:function(b){var a=b.$div;if($.isFunction(a[b.pluginname])){try{a[b.pluginname]("populate")}catch(d){if(!IsjQueryMissingMethodException(d)){throw d}}}},callPluginMethod:function(a,b,e){if(!a){a=this.definition.controls;if(this.definition.pid){var f=_dgo(this.definition.pid);if(f&&(f.aType==TYPE_DIALOG)){a=f.aDefinition.controls}}}for(var g=0;g<a.length;g++){this._callPluginMethodOnCtrl(a[g],b,e)}},_callPluginMethodOnCtrl:function(f,a,d){if(f.hasOwnProperty("pluginname")){var b=f.$div;if($.isFunction(b[f.pluginname])){try{b[f.pluginname](a)}catch(g){if(!IsjQueryMissingMethodException(g)){throw g}}if(d!==false){var h=null;try{h=b[f.pluginname]("getSubCtrlLists")}catch(g){}if(h){for(var j=0;j<h.length;j++){this.callPluginMethod(h[j].controls,a,d)}}}}}},_validateWysiwyg:function(a,b,d){if(a.length>0){var g;var e=[];for(g=0;g<this.aObjectList.length;g++){e.push({id:this.aObjectList[g],v:false,t:""})}this.each(function(j){j.valArrIdx=-1;var h=j.$div;var m=j._tiedobj;var l=false;var n=-1;if(m){for(n=0;n<e.length;n++){if(e[n].id==m.aID){break}}if(n==e.length){n=-1}if(n>=0){j.valArrIdx=n;if($.isFunction(h[j.pluginname])){try{if(h[j.pluginname]("isvalid")){e[n].v=true}}catch(k){if(!IsjQueryMissingMethodException(k)){throw k}}try{aValue=h[j.pluginname]("isInteractiveValid");if(typeof aValue=="string"){e[n].v=false;e[n].t=aValue}}catch(k){if(!IsjQueryMissingMethodException(k)){throw k}}}}}},a);var f=function(v){var y=function(B){var E=true;var F;var D,C;for(F=0;F<B.length;F++){D=B[F];C=dictionary.GetObject(D.tieditem);if(C&&C.isFull()&&(C.aType==TYPE_LIST||C.aType==TYPE_BOOLEAN)){if(!C.IsValueValid(C.GetValue())){return false}}}return true};var t=true;var z,o;var p;for(z=0;z<v.length;z++){var l=v[z];var q=true;var u="";if(l.valArrIdx>=0){q=e[l.valArrIdx].v;u=e[l.valArrIdx].t}if(l.validation){var n=l.validation;if(n!=""){p=dictionary.GetObject(l.tieditem);if(p&&p.isFull()){if($.isFunction(window[n])){var w=window[n]();if((w!=true)&&(w!=undefined)){q=false;u=w}}}}}for(o=0;o<b.length;o++){if(!b[o].aValue&&b[o].ctrl==l){q=false;break}}if(!d||(u!="")||(q&&(l.invalid===true))){l.invalid=!q;if(l.$div){l.$div.find(".xrui-floating-error").remove()}if(l.invalid){if(u!=""){var k=l.$div.find(".ui-controlgroup-controls");var A=$("<span></span>").addClass("xrui-floating-error").html(u).appendTo(k);if(A.position()){var h=A.position().left;A.css("left","0px");var r=A.outerWidth();var m=k.position().left+k.outerWidth();if(h+r>m){h=m-r-10}A.css("left",h+"px")}}}}if(!q){t=false}delete l.valArrIdx;var j=null;try{if(l.pluginname&&$.isFunction(l.$div[l.pluginname])){j=l.$div[l.pluginname]("getSubCtrlLists")}}catch(x){if(!IsjQueryMissingMethodException(x)){throw x}}if(j){for(o=0;o<j.length;o++){j[o].invalid=!f(j[o].controls);j[o].invalidsel=!y(j[o].controls);if(j[o].invalid){t=false}if(!d||(j[o].liveInvalid&&!j[o].invalid)){j[o].liveInvalid=j[o].invalid}}}}return t};return f(a)}return true},_validateHtml:function(b){var a=this;return a._validateWysiwyg(a.htmlModeCtrlList,[],b)},validate:function(d){var a=this;if(this.definition){if(this.definition.hasOwnProperty("dialogMode")&&this.definition.dialogMode=="html"){return a._validateHtml(d)}else{var b=[];if(this.definition.rules){b=this.definition.rules(true)}return a._validateWysiwyg(a.definition.controls,b,d)}}return true},focus:function(){var a=this;if(this.definition){if(this.definition.hasOwnProperty("dialogMode")&&this.definition.dialogMode=="html"){}else{if(this.definition.controls){this.focusCtrls(this.definition.controls)}}}if(this.definition.scrolltop){$(window).scrollTop(this.definition.scrolltop)}},focusCtrls:function(a){for(var b=0;b<a.length;b++){if(this._focusCtrl(a[b])){return true}}return false},_focusCtrl:function(b){var a=b.$div;if($.isFunction(a[b.pluginname])){var f=false;try{f=a[b.pluginname]("focus")}catch(d){if(!IsjQueryMissingMethodException(d)){throw d}}if(!f){var g=null;try{g=a[b.pluginname]("getSubCtrlLists")}catch(d){}if(g){for(var h=0;h<g.length;h++){if(this.focusCtrls(g[h].controls)){f=true;break}}}}return f}return false},_setCtrl:function(b){var a=b.$div;if(a){if($.isFunction(a[b.pluginname])){try{a[b.pluginname]("setselection")}catch(d){if(!IsjQueryMissingMethodException(d)){throw d}}}}},fireEvent:function(a){if(this.definition&&this.definition.controls){return this.fireEvents(this.definition.controls,a)}return false},fireEvents:function(a,b){var d;for(d=0;d<a.length;d++){if(this._fireEvent(a[d],b)){return true}}return false},_fireEvent:function(d,b){var a=d.$div;if(d.pluginname&&$.isFunction(a[d.pluginname])){var g=null;try{g=a[d.pluginname]("getSubCtrlLists")}catch(f){}if(g){for(var h=0;h<g.length;h++){if(this.fireEvents(g[h].controls,b)){return true}}}try{return a[d.pluginname]("event",b)}catch(f){if(!IsjQueryMissingMethodException(f)){throw f}return false}}return false},expandEmbedded:function(aText,doEscaping){if(this.editing){return xrkb_dlg.handleLabelForPopulate(aText)}if((aText=="")||(aText==undefined)){return""}if(aText=="''"){return""}if(aText.substr(0,1)=="'"){try{aText=eval(aText)}catch(e){}}if(!appSettings.enginePath){aText=LabelDecode(aText,this.tiedObj,doEscaping)}return aText},fontToStyleObj:function(b){var a={};if(b){a["font-family"]=b.name;a["font-size"]=b.size+"px";if(b.isBold){a["font-weight"]="bold"}if(b.isItalic){a["font-style"]="italic"}}return a},ok:function(b,d){var a=this;this.dialogDisplayed=false;if(a.timeoutTimer){window.clearTimeout(a.timeoutTimer);a.timeoutTimer=null}this.pressedOK=true;if(this.definition&&this.definition.hasOwnProperty("oncanexit")&&this.definition.oncanexit&&!b){replayStack.Add(this.aID,REPLAY_CANEXIT,this.definition.oncanexit,function(e){if(e==0){if(a.definition.timeout>0){if(a.timeoutTimer){window.clearTimeout(a.timeoutTimer);a.timeoutTimer=null}a.timeoutTimer=window.setTimeout(function(){a.ok()},a.definition.timeout*1000)}a.dialogDisplayed=true}});Go();this.pressedOK=false;return}if(!this.validate()){this.populate(true);this.pressedOK=false;return}if(this.definition.hasOwnProperty("dialogMode")&&(this.definition.dialogMode=="wysiwyg")&&!d){if(this.fireEvent({atype:"ok"})){this.pressedOK=false;return}}replayStack.Add(this.aID,REPLAY_OK);_hb.nx(Go);this.pressedOK=false},back:function(){replayStack.CheckBookmark(true)},exit:function(a){var d=this.aID;if(a&&appSettings.showCloseConfirm){var b=getTranslation("close_confirmation_text","Close Application?");if(b.length>0){ShowModal(b,appSettings.title,{showCancelBtn:true},function(){replayStack.Add(d,REPLAY_EXIT);Go()});return}}replayStack.Add(d,REPLAY_EXIT);Go()},restart:function(a){replayStack.Initialize();Go()},macro:function(e,a,b){var d=null;if(a){d="ok"}if(b!==undefined){e={id:e,param:b}}replayStack.Add(this.aID,REPLAY_MACRO,e,d,this.definition.oncanexit);Go()},change:function(f,b,a){if(f){if(!this.validate()){this.populate();return}}var g,d;for(g=0;g<b.length;g++){d=b[g];if(typeof d=="object"){d=d.hasOwnProperty("tieditem")?d.tieditem:null}if(d){var e=_dgo(d);if(e&&e.isMultiSel){replayStack.Add(this.aID,REPLAY_CHANGEEVENT,d,[])}}}for(g=0;g<b.length;g++){d=b[g];if(typeof d=="object"){this._setCtrl(b[g]);d=d.hasOwnProperty("tieditem")?d.tieditem:null}if(d){replayStack.Add(this.aID,REPLAY_FORMTREESET,d)}}if(f){if(a){replayStack.Add(this.aID,REPLAY_FORMTREESET,a)}}Go()},subdialogadd:function(b,a){if(a==undefined){a=this.aID}replayStack.Add(this.aID,REPLAY_SUBDIALOGEVENT,REPLAY_SUBDIALOGADD,-b,{parentDlg:a});Go()},subdialogedit:function(d,b,a){if(b==undefined){b=this.aID}replayStack.Add(this.aID,REPLAY_SUBDIALOGEVENT,REPLAY_SUBDIALOGEDIT,-d,{aIndex:a,parentDlg:b});Go()},subdialogdelete:function(d,b,a){if(b==undefined){b=this.aID}replayStack.Add(this.aID,REPLAY_SUBDIALOGEVENT,REPLAY_SUBDIALOGDEL,-d,{aIndex:a,parentDlg:b});Go()},_change:function(f,b){var d=f.$div;if(f.isPrev){return}if($.isFunction(d[f.pluginname])){try{d[f.pluginname]("setselection")}catch(g){if(!IsjQueryMissingMethodException(g)){throw g}}var a=function(j){if(j.tab){var e=j.tab;var h=j.tab.tab;if(e.onchange){replayStack.Add(this.aID,REPLAY_MACRO,e.onchange,{exitOnEmpty:true})}a(h)}};a(f);if(b){if(!delayedGoTimer){delayedGoTimer=setTimeout(function(){Go()},300)}}else{f.dialog.definition.scrolltop=$(window).scrollTop();Go()}}},_changeOLd:function(b,f){var a=b.$div;if(b.isPrev){return}if($.isFunction(a[b.pluginname])){try{a[b.pluginname]("setselection")}catch(d){if(!IsjQueryMissingMethodException(d)){throw d}}b.dialog.definition.scrolltop=$(window).scrollTop();Go()}},progressOnCR:function(a){var b=Dialog_FindNearestButton(a.aID,this.definition.controls);if(b&&(b!==true)){$("button",b.$div).click()}},each:function(h,g,l){if(!g){g=this.getControlList()}var b={callbackParentAfterChildren:true,noVisabilityCheck:false};b=$.extend(true,b,l);for(var k=0;k<g.length;k++){var a=g[k];if(!b.callbackParentAfterChildren){h(a)}var f=null;try{if(a.$div){if($.isFunction(a.$div[a.pluginname])){f=a.$div[a.pluginname]("getSubCtrlLists")}}}catch(j){if(!IsjQueryMissingMethodException(j)){throw j}}if(f){for(var d=0;d<f.length;d++){if(b.noVisabilityCheck||!f[d].hasOwnProperty("isvisible")||f[d].isvisible){this.each(h,f[d].controls,b)}}}if(b.callbackParentAfterChildren){h(a)}}},findCtrlParent:function(b){var a=function(d){for(var l=0;l<d.length;l++){var g=d[l];if(g.aID==b.aID){return{ctrlArr:d,ctrlIdx:l}}var j=null;try{if($.isFunction(g.$div[g.pluginname])){j=g.$div[g.pluginname]("getSubCtrlLists")}}catch(h){}if(j){for(var k=0;k<j.length;k++){if(j[k].isvisible){var f=a(j[k].controls);if(f){return f}}}}}return false};return a(this.definition.controls)},_addobject:function(a,b){if(b&&($.inArray(b,a)==-1)){a.push(b)}},_buildTiedObjectList:function(d,a){var e=this;if(!$.isFunction(a)){e.aObjectList=[]}if(d==undefined){d=this.definition.controls}function b(g){if($.isFunction(g.$div[g.pluginname])){try{var k=g.$div[g.pluginname]("gettied");if($.isFunction(a)){a(k,g)}else{if(k&&k.aID&&($.inArray(k.aID,e.aObjectList)==-1)){e.aObjectList.push(k.aID)}}}catch(h){if(!IsjQueryMissingMethodException(h)){throw h}}var j=null;try{j=g.$div[g.pluginname]("getSubCtrlLists")}catch(h){}if(j){for(var m=0;m<j.length;m++){for(var l=0;l<j[m].controls.length;l++){b(j[m].controls[l])}}}}}for(var f=0;f<d.length;f++){b(d[f])}},getUsage:function(){var a=[];this._buildTiedObjectList(undefined,function(f,d){var e=f?f.aID:0;var b=false;for(var g=0;(g<a.length)&&!b;g++){if(a[g].id==e){b=true}}if(!b){a.push({id:e,ctrl:d})}});return a},findControl:function(a,b){if(!b){b=this.definition.controls}var k;if(typeof a=="string"){for(k=0;k<b.length;k++){if(b[k].aName==a){return b[k]}}}else{for(k=0;k<b.length;k++){if(b[k].aID==a){return b[k]}}}for(k=0;k<b.length;k++){var h=null;try{var f=b[k];h=f.$div[f.pluginname]("getSubCtrlLists")}catch(g){}if(h){for(var j=0;j<h.length;j++){var d=this.findControl(a,h[j].controls);if(d){return d}}}}return null},isValueValid:function(b,a){if(b&&!b.isMultiSel&&b.flatProps.isenabled&&b.flatProps.isvisible){if(!b.flatProps.allowblank){if(a==PSEUDO_VALUE_EMPTY){return false}else{if(!a){return false}}return b.flatProps.allowinvalid||b.IsValueValid(a)}}return true},populateLabel:function(b,d,a){if(d.substr(0,6).toLowerCase()=="<html>"){d=d.substr(6);if(d.substr(d.length-7).toLowerCase()=="</html>"){d=d.substr(0,d.length-7)}b.html(d)}else{if(a){b.html(d)}else{b.text(d)}}},runFormRules:function(){if(!this.formRules){return}var d,q,k,u,t,l,n,m,b,p,f,e,w,x;for(d=0;d<this.formRules.items.length;d++){t=this.formRules.items[d];p=true;for(q=0;(q<t.conditions.length)&&p;q++){f=null;b=null;l=t.conditions[q];if(l.ctrl===null){}else{if(typeof l.ctrl=="string"){b=this.findControl(l.ctrl);if(b){f=b._tiedobj}}else{f=_dgo(l.ctrl)}}if(f){w=false;e=f.GetValue();var j,h;if(f.aType==TYPE_LIST){j=l.vals;h=j.length==0}else{j=l.val;h=(j===null)||(j===undefined)||isNaN(j)||((typeof j=="string")&&(j.length==0))}if(l.att){var g=_dgo(l.att);if(g){j=g.val()}}if(!f.isFull()){w=h}else{if(h){w=false}else{switch(f.aType){case TYPE_LIST:if(f.isMultiSel){if(!$.isArray(j)){j=[]}switch(l.comp){case"eq":if(!f.isMultiSel&&e.length!=j){break}p=true;for(k=0;(k<j.length)&&p;k++){if($.inArray(j[k],e)==-1){p=false}}w=p;break;case"sub":p=e.length>0;for(k=0;(k<e.length)&&p;k++){if($.inArray(e[k],j)==-1){p=false}}w=p;break;case"sup":p=true;for(k=0;(k<j.length)&&p;k++){if($.inArray(j[k],e)==-1){p=false}}w=p;break;case"ovr":p=false;for(k=0;(k<j.length)&&!p;k++){if($.inArray(j[k],e)>=0){p=true}}w=p;break}}else{if(!$.isArray(j)||(j.length==0)){w=true}for(x=0;(x<j.length)&&!w;x++){if(j[x]==e){w=true}}}break;case TYPE_BOOLEAN:if(j){w=(e==1)}else{w=(e==2)}break;case TYPE_NUMERIC:case TYPE_DATE:switch(l.comp){case"eq":w=(e==j);break;case"ne":w=(e!=j);break;case"lt":w=(e<j);break;case"le":w=(e<=j);break;case"gt":w=(e>j);break;case"ge":w=(e>=j);break}break;case TYPE_TEXT:w=(e==j);break}}}if(!w){p=false}}}n=(p?t.actions:t.elses);for(u=0;u<n.length;u++){m=n[u];b=this.findControl(m.ctrl);if(b){f=b._tiedobj;if(f){f=f.flatProps}switch(b.aType){case"panels":if(m.hasOwnProperty("panelIdx")&&(m.panelIdx>=0)&&(m.panelIdx<b.tabsheets.length)){switch(m.op){case"vis":b.tabsheets[m.panelIdx].isvisible=true;break;case"hid":b.tabsheets[m.panelIdx].isvisible=false;break}}break;default:switch(m.op){case"vis":if(f){f.isvisible=true}else{b.visible=true}break;case"hid":if(f){f.isvisible=false}else{b.visible=false}break;case"en":if(f){f.isenabled=true}else{b.enabled=true}break;case"dis":if(f){f.isenabled=false}else{b.enabled=false}break;case"oblig":if(f){f.allowblank=false}break;case"alowbl":if(f){f.allowblank=true}break}}}}}},designtime:function(){return{hascaption:"bool",caption:"str",cssclassname:{atype:"css",displayname:"swatch"},description:"str",onenter:{atype:"tied",accepted:[TYPE_PROCEDURE]},onshow:{atype:"tied",accepted:[TYPE_PROCEDURE]},onupdate:{atype:"tied",accepted:[TYPE_PROCEDURE]},oncanexit:{atype:"tied",accepted:[TYPE_PROCEDURE]},onexit:{atype:"tied",accepted:[TYPE_PROCEDURE]},righttoleft:"bool",timeout:"int"}},updateTiedObjects:function(a){if(a.aID!=this.aID){return}this._buildTiedObjectList();this.populate()},free:function(){if(this.timeoutTimer){window.clearTimeout(this.timeoutTimer);this.timeoutTimer=false}this.each(function(a){try{a.$div[a.pluginname]("destroy")}catch(b){}})}};function resizeFn(){if(currentDlg==undefined||!currentDlg){return}currentDlg._jqMwindowResize.apply(currentDlg,[false])}$(window).bind("throttledresize",resizeFn);ObjectExtend=function(d,a){function b(){}b.prototype=a.prototype;d.prototype=new b();d.prototype.constructor=d;d.baseConstructor=a;d.superClass=a.prototype};var NODEJS=false;if(typeof module!=="undefined"&&module.exports){NODEJS=true}var isIE,isChrome;if(!NODEJS){isIE=document.all;isChrome=navigator.userAgent.toLowerCase().indexOf("chrome")>-1}else{isIE=isChrome=false}var isChromeDesktop=false;(function(){if(!NODEJS){var a=navigator.userAgent.toLowerCase();isChromeDesktop=((a.indexOf("chrome")>=0)||(a.indexOf("firefox")>=0))&&(a.indexOf("mobile")==-1)}})();var STRING_END_MESSAGE;var TYPE_LIST=1;var TYPE_NUMERIC=2;var TYPE_DATE=3;var TYPE_BOOLEAN=4;var TYPE_PROCEDURE=5;var TYPE_REPORT=6;var TYPE_DIALOG=7;var TYPE_VARIABLE=8;var TYPE_CTABLE=9;var TYPE_TEXT=10;var TYPE_HIERARCHY=11;var TYPE_TXTPROCESSOR=12;var TYPE_CATEGORY=13;var TYPE_MLIST=99;var TYPE_VARIABLE_NUM_ARRAY=100;var TYPE_VARIABLE_STR_ARRAY=101;var TYPE_WIZZARD=102;var NODETYPE_LEAF=1;var NODETYPE_SPLIT=2;var NODETYPE_INLINE=3;var NODETYPE_LABEL=4;var NODETYPE_PROC=5;var NODETYPE_PAGE=6;var NODETYPE_LEAFJUMP=7;var NODETYPE_LEAFPROC=8;var NODETYPE_SEQUENCE=9;var NODETYPE_BRANCH=10;var CASE_ALL=0;var CASE_VALUES=1;var CASE_VALUE=2;var CASE_ATTCOMP=3;var CASE_SET_VALUES=4;var CASE_SET_VALUE=5;var CASE_DESCRIPTION=6;var CASE_DUMMY=99;var VARTYPE_NUM=1;var VARTYPE_STR=2;var REPLAY_SET=1;var REPLAY_OK=2;var REPLAY_MACRO=3;var REPLAY_CHANGEEVENT=4;var REPLAY_EXIT=5;var REPLAY_CANEXIT=6;var REPLAY_UI=7;var REPLAY_JSONSET=8;var REPLAY_SYSTEMSET=9;var REPLAY_UI_STOP=10;var REPLAY_OK_WITHVALIDATION=11;var REPLAY_RESTARTPOS=12;var REPLAY_SUBDIALOGEVENT=13;var REPLAY_SETDIALOGPROP=14;var REPLAY_CAPTUREDATT=15;var REPLAY_FORMTREESTART=16;var REPLAY_FORMTREESET=17;var REPLAY_OBJRETURN=18;var REPLAY_ADHOC=19;var REPLAY_CRITICALDONE=20;var REPLAY_GROUPSET=21;var REPLAY_SETFULL=22;var REPLAY_SETPROP=23;var REPLAY_SUBDIALOGADD=1;var REPLAY_SUBDIALOGEDIT=2;var REPLAY_SUBDIALOGDEL=3;var REPLAYPOP_HANDLED=1;var REPLAYPOP_CURRENT=2;var REPLAYPOP_STOP=3;var PASSBACK_PAUSE=1;var PASSBACK_ERROR=2;var PASSBACK_END=3;var PASSBACK_DEBUG=4;var PASSBACK_WAIT=5;var PASSBACK_PAUSETREEPAGE=6;var PASSBACK_LOOP=7;var PASSBACK_LOADIFRAME=8;var PASSBACK_DIALOG=9;var PASSBACK_PAUSECMD=10;var CONTROL_LABEL=1;var CONTROL_BUTTON=2;var CONTROL_LISTBOX=3;var CONTROL_NUMERIC=4;var CONTROL_IMAGE=5;var CONTROL_ARRAYEDIT=6;var CONTROL_CHECKBOX=7;var CONTROL_RADIOBTN=8;var CONTROL_ARRAYLIST=9;var CONTROL_HOTSPOT=10;var CONTROL_GRID=11;var CONTROL_DATE=12;var CONTROL_TABSHEET=13;var CONTROL_IFRAME=14;var CONTROL_SUBDIALOG=15;var CONTROL_TEXTEDIT=16;var CONTROL_COLUMNS=17;var CONTROL_JQMBREAK=18;var CONTROL_FILEUPLOAD=19;var CONTROL_FRAME=20;var EVENT_UPDATE=1;var EVENT_CAPTURE=2;var EVENT_LEAVE=3;var EVENT_HIERARCHYENTER=4;var EVENT_HIERARCHYEXIT=5;var EVENT_POSTRULES=6;var TREE_PROP_FLAT=1;var TREE_PROP_VALUE=2;var PSEUDO_VALUE_EMPTY="__XR__EMPTY__";var DEFAULT_PREVIOUSANSWERSTEXT="Previous Answers";var ADHOC_DIALOG_PSEUDOID=-9999;var EMPTY_LEAF=-999999;var BACK_TIMEOUT_MS=350;var OK_TEXT="Continue";if(isIE){OK_TEXT="   "+OK_TEXT+"   "}var TY_AV=0;var TY_SV=1;var TY_MV=2;var TY_NT=3;var TY_IA=4;var TY_AT=5;var SETOP_ADD=1;var SETOP_DEL=2;var VALID_UNKNOWN=0;var VALID_TRUE=1;var VALID_FALSE=2;var VALID_NEWFALSE=3;var VALID_NEWTRUE=4;var COMP_EQ=0;var COMP_NE=1;var COMP_LT=2;var COMP_LE=3;var COMP_GT=4;var COMP_GE=5;var PROP_NONE=0;var PROP_FLAT=1;var PROP_VALUE=2;var ALTLIST_SELECTION="<span class='selected_marker'>(selected)</span>";var CL_NONE="na";var LOR_NONE=0;var LOR_ATT=1;var LOR_TASK=2;var xrkb_engine_version={major:11,minor:1,build:2};var uidiv=null;var activeDialogStack=[];var dialog_offset_x=0;var dialog_offset_y=0;var popupReportObject=null;var popupReportText="";var capturedAtts=[];var capturingAtts=true;var lineOfReasoning=[];var baseDialogs=[];var tickTime=0;var XRdocVars=[];var autoRun=true;var wrapperOptions={};var customStartup=false;var performedGo=false;var isMobile=false;var appEmbedded=false;var currentDlg=null;var modalDlg=null;var jsAjax=false;var jsAjaxSessionID=0;var delayedGoTimer=null;var msgFlashDiv=null;var msgFlashDivTimer=null;var isEditor=false;var xrkb_func_args=[];var lastErr=null;function isSmartTv(){if(NODEJS){return false}return window.hasOwnProperty("smartTv")}function getVersionAsString(){return JSON.stringify(xrkb_engine_version)}function ConvertForDisplay(e,d,b){if((e===null)||(e===undefined)){return""}var a=typeof e;if(a=="number"){e=e.toString()}else{if((a=="object")&&(e instanceof Date)){e=Cmd_DateToStr(e)}else{if(a!="string"){e=""+e}else{if(e=="__(none)"){e=""}}}}if(e===""){return e}if(b){return e}e=e.replace(/&/g,"&amp;");e=e.replace(/</g,"&lt;");e=e.replace(/>/g,"&gt;");e=e.replace(/"/g,"&quot;");e=e.replace(/\x0d|\x0a/g,"<br>");if(d){e=e.replace(/\s/g,"&nbsp;")}return e}function IsAlreadyCapturedDlg(b){for(var a=0;a<capturedAtts.length;a++){if((typeof capturedAtts[a]=="object")&&capturedAtts[a].hasOwnProperty("instID")&&(capturedAtts[a].instID==b)){return true}}return false}function AppendCapturedAtt(b){if(!capturingAtts){return}for(var a=0;a<capturedAtts.length;a++){if(capturedAtts[a]==b){break}}if(a>=capturedAtts.length){capturedAtts[capturedAtts.length]=b}lineOfReasoning.push({atype:LOR_ATT,id:b})}function CreateElement2(a,f,e,d){var b=document.createElement(a);b.id=f;if(e!==undefined){b.innerHTML=e}if(!d){d=document.body}d.appendChild(b);return b}function getTranslation(a,b){if(typeof(lang)=="undefined"){return b}if(!lang.hasOwnProperty(a)){return b}return lang[a]}function GetTickCount(){var a=new Date();return a.getTime()}function inferenceIssue(b,a,d){this.aState=b;this.aValue=(a!==undefined?a:"");if((b!=PASSBACK_DEBUG)&&!d){d=""}this.aExtra=d}inferenceIssue.prototype.toString=function(){return"Inference Issue : "+this.aState+" : "+this.aValue+" : "+this.aExtra};function IsjQueryMissingMethodException(a){if(typeof a=="object"&&a.message&&a.message.indexOf("does not exist")!=-1){return true}if(typeof a=="string"&&a.indexOf("does not exist")!=-1){return true}return false}function softError(a){if(stk_isValid()){console.log("Warning from "+stk_toString())}console.log((!stk_isValid()?"Warning: ":"")+a)}function hardError(a){throw new inferenceIssue(PASSBACK_ERROR,a)}var htmlDialogCallBacks={list:[],add:function(a,d,b){if(!$.isFunction(d)){throw"Must pass a function"}this.list.push({id:a,callback:d,type:b})},reset:function(){this.list.splice(0,this.list.length)},find:function(a,b){for(var d=0;d<this.list.length;d++){if((this.list[d].id==a)&&(this.list[d].type==b)){return this.list[d]}}return null},onRender:function(a){var b=this.find(a,"onrender");if(!b){return}setTimeout(function(){b.callback()},1)},onPopulate:function(a){var b=this.find(a,"onpopulate");if(!b){return}b.callback()}};function URLparam(b,a){this.aName=b;this.aValue=a}function URLparams(){this.aParams=[];this.site="";this.postIdent=0;this.postData=null}URLparams.prototype.Add=function(d,a){var b=new URLparam(d,a);this.aParams[this.aParams.length]=b};URLparams.prototype.Clear=function(){this.aParams=[]};URLparams.prototype.Get=function(b){for(var a=0;a<this.aParams.length;a++){if(this.aParams[a].aName==b){return this.aParams[a].aValue}}return""};URLparams.prototype.toString=function(d){var a="";for(var b=0;b<this.aParams.length;b++){if((a.length>0)||d){a+="&"}a+=escape(this.aParams[b].aName)+"="+escape(this.aParams[b].aValue)}return a};URLparams.prototype.Setup=function(){this.Clear();var d=document.location.href;var b=d.split("?");var f,e;this.site=b[0];if(b.length==2){b=b[1].split("&");for(var g=0;g<b.length;g++){f=b[g].split("=");if(f.length==2){e=decodeURIComponent(f[0]);aVal=decodeURIComponent(f[1]);if(e.toLowerCase()=="bm"){replayStack.UnSerialize(aVal)}else{if(e.toLowerCase()=="autorun"){if(aVal.toLowerCase()=="false"){autoRun=false}}else{if(e.toLowerCase()=="post"){this.postIdent=parseInt(aVal,10);autoRun=false}else{this.Add(e,aVal)}}}}}}};URLparams.prototype.Populate=function(){for(var b=0;b<this.aParams.length;b++){Cmd_SetValueAsStr(this.aParams[b].aName,this.aParams[b].aValue)}if(this.postData){for(var a in this.postData){Cmd_SetValueAsStr(a,this.postData[a])}}};function CachedCookie(d,b,a){this.aName=d;this.aValue=b;this.aExpireHours=a}function CookieCache(){this.cookies=[]}CookieCache.prototype.Clear=function(){this.cookies=[]};CookieCache.prototype.Add=function(e,b,a){var d=this.Get(e);if(d){d.aValue=b;d.aExpireHours=a}else{d=new CachedCookie(e,b,a);this.cookies[this.cookies.length]=d}};CookieCache.prototype.Get=function(b){for(var a=0;a<this.cookies.length;a++){if(this.cookies[a].aName==b){return this.cookies[a]}}return null};CookieCache.prototype.Write=function(){var b;for(var d=0;d<this.cookies.length;d++){b="";if(this.cookies[d].aExpireHours){var a=new Date();a.setHours(a.getHours()+this.cookies[d].aExpireHours);b=";expires="+a.toUTCString()}document.cookie=this.cookies[d].aName+"="+escape(this.cookies[d].aValue)+b}};var urlParams=new URLparams();var cookieCache=new CookieCache();var authorUsrID=0;function EncodeForDoubleQuotes(b){var a="";for(var d=0;d<b.length;d++){if((b.charAt(d)=='"')||(b.charAt(d)=="\\")){a+="\\"+b.charAt(d)}else{if(b.charCodeAt(d)==13){a+="\\n"}else{if(b.charCodeAt(d)==10){a+="\\r"}else{if(b.charCodeAt(d)==9){a+="\\t"}else{if(b.charCodeAt(d)>=32){a+=b.charAt(d)}}}}}}return a}function ElementToStr(b){if(typeof(b)=="undefined"){return""}else{if(typeof(b)=="boolean"){return b?"true":"false"}else{if(typeof(b)=="number"){return b+""}else{if($.isArray(b)){return ArrayToStr(b)}else{if($.isFunction(b)){hardError("ElementToStr : Cannot encode a function!");return}else{if(typeof(b)=="string"){var a="'";for(var d=0;d<b.length;d++){if((b.charAt(d)=="'")||(b.charAt(d)==",")||(b.charAt(d)=="\\")){a+="\\"}a+=b.charAt(d)}a+="'";return a}else{hardError("ElementToStr : Unsupported type ["+typeof(b)+"]");return}}}}}}}function ArrayToStr(b){var d="";for(var e=0;e<b.length;e++){d+=(d.length>0?",":"")+ElementToStr(b[e])}return"["+d+"]"}function HasSessionID(){if(wrapperOptions.nodejs){return false}var d=false;var a=document.cookie.split(";");for(var b=0;(b<a.length)&&!d;b++){var e=a[b];while(e.charAt(0)==" "){e=e.substring(1,e.length)}if(e.indexOf("saas_session")===0){d=true}}return d}function InferenceEnd(){if(currentDlg){currentDlg.free();currentDlg=null}if(HasSessionID()){document.getElementById("xrback").src="end.php"}if((typeof xrBootstrap!="undefined")&&$.isPlainObject(xrBootstrap)){if(xrBootstrap.endCBpage){document.getElementById("xrback").src=xrBootstrap.endCBpage}}}function StartTick(){var a=new Date();tickTime=a.getTime()}function TestTick(){if(wrapperOptions.nodejs){working=false;return true}if(document.cookie==""){working=false;return true}var d=document.cookie.split("=");if(d[0]!="saas_session"){working=false;return true}var a=new Date();if(a.getTime()-tickTime>=60000){StartTick();if(HasSessionID()){working=false;var b="../../../watchdog.php";loadXMLDoc(b,"postData","GET",0);return false}else{alert("Server Timed out!!! - Start Again")}}else{return true}}function SetUserID(a){authorUsrID=a}function RipToChar(a,f){var d=0;var b=false;var e=0;while(d<a.length){if(a.charAt(d)=="'"){if(b){if(a.charAt(d-1)!="\\"){b=false}}else{b=!b}}else{if((a.charAt(d)=="[")&&!b){e++}else{if((a.charAt(d)=="]")&&!b){e--}else{if((a.charAt(d)==f)&&(e==0)&&!b){return{head:a.substr(0,d),tail:a.substr(d+1)}}}}}d++}return{head:a,tail:""}}function setCookie(d,b,e,a){cookieCache.Add(b,e,a)}function getCookie(d,b){var e=cookieCache.Get(b);if(e){return e.aValue}if(document.cookie.length>0){var f=document.cookie.indexOf(b+"=");if(f!=-1){f=f+b.length+1;var a=document.cookie.indexOf(";",f);if(a==-1){a=document.cookie.length}return unescape(document.cookie.substring(f,a))}return""}return""}function SimpleObjectToString(b){var a="";for(var d in b){a+=d+": "+b[d]+"\n"}a+="["+b.toString()+"]";return a}function RoundDP(b,e){if(e>0){var a=1;for(var d=0;d<e;d++){a*=10}return Math.round(b*a)/a}return b}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F"};function escapeHtml(a){return String(a).replace(/[&<>"'\/]/g,function(b){return entityMap[b]})}var xrEmbedTst=/{.*?}/g;function LabelDecode(t,b,n){t=ResourceDecode(t);if(t.indexOf("{")<0){return t}var j,h,r,e;var u="";var l=0;var a=false;while(j=xrEmbedTst.exec(t)){u+=t.substring(l,j.index);l=j.index+j[0].length;var q=j[0].substr(1,j[0].length-2);if(q.toLowerCase()=="__project"){q=appSettings.description?appSettings.description:"";if(q.length==0){q=appSettings.title}u+=q}else{if((q.substr(0,2)=="__")&&(q.substr(0,3)!="___")){h=q.indexOf("|");if(h>=0){r=q.substr(h+1);q=q.substr(0,h);e=_dgo(parseInt(r,10));if(e){q=e.aName+"."+q.substr(2)}}else{if(b){q=b.aName+"."+q.substr(2)}}}var f=true;var d,g;var k=q.indexOf(":");if(k>=0){var m=q.substr(k+1).toLowerCase();q=q.substr(0,k);if(m=="noescape"){f=false}else{k=m.indexOf(":");if(k>0){d=parseInt(m.substr(0,k),10);g=parseInt(m.substr(k+1),10)}else{g=parseInt(m,10)}}}var p=Cmd_GetValue(q,undefined,g);if(f&&n){p=escapeHtml(p)}u+=p}a=true}u+=t.substr(l);if((t.indexOf("{")>=0)&&a){u=LabelDecode(u,b,n)}return u}var xrResEmbedTst=/{{.*?}}/g;function ResourceDecode(d){if(d.indexOf("{")<0){return d}var b;var a="";var e=0;while(b=xrResEmbedTst.exec(d)){a+=d.substring(e,b.index);e=b.index+b[0].length;if(isEditor&&xrkb_resources){a+=xrkb_resources.getResourceURL(b[0].substr(2,b[0].length-4))}else{a+=xrkb_include_folder+"assets/"+b[0].substr(2,b[0].length-4)}}a+=d.substr(e);return a}function Handle2(a){if(typeof a!="string"){return a}else{if(a.substr(0,1)!="~"){return a}else{return Handle(a.substr(1,a.length-1))}}}function IsEqual(b,a){if(b.length!=a.length){return false}for(var d=0;d<b.length;d++){if($.inArray(b[d],a)==-1){return false}}return true}function IsIn(a,b){return $.inArray(a,b)>-1}function SubSet(b,a){if((b.length==0)&&(a.length>0)){return false}for(var d=0;d<b.length;d++){if($.inArray(b[d],a)==-1){return false}}return true}function SuperSet(b,a){for(var d=0;d<a.length;d++){if($.inArray(a[d],b)==-1){return false}}return true}function Intersect(b,a){for(var d=0;d<b.length;d++){if($.inArray(b[d],a)>=0){return true}}return false}var _0x7f92=["\x6C\x65\x6E\x67\x74\x68","","\x75\x6E\x64\x65\x66\x69\x6E\x65\x64","\x65\x78\x70\x6F\x72\x74\x73","\x6E\x6F\x64\x65\x6B\x65\x79","\x68\x61\x73\x4F\x77\x6E\x50\x72\x6F\x70\x65\x72\x74\x79","\x74\x6F\x55\x70\x70\x65\x72\x43\x61\x73\x65","\x68\x6F\x73\x74","\x58\x59\x5A\x5A\x59","\x63\x68\x61\x72\x43\x6F\x64\x65\x41\x74","\x73\x75\x62\x73\x74\x72","\x66\x72\x6F\x6D\x43\x68\x61\x72\x43\x6F\x64\x65","\x62\x6F\x62"];function Handle(l){if(l[_0x7f92[0]]==0){return _0x7f92[1]}var k;if(typeof module!==_0x7f92[2]&&module[_0x7f92[3]]){if(!appSettings[_0x7f92[5]](_0x7f92[4])){return l}k=appSettings[_0x7f92[4]]}else{k=location[_0x7f92[7]][_0x7f92[6]]()}if(k[_0x7f92[0]]==0){k=_0x7f92[8]}var h=56295;var f;for(f=0;f<k[_0x7f92[0]];f++){h=h^k[_0x7f92[9]](f)}h=(h&65535);var e;for(f=0;f<5;f++){e=((h&1)<<15);h=((h>>1)|e)}var d=_0x7f92[1];for(var b=0,a=0;b<l[_0x7f92[0]];b+=3,a++){var j=k[_0x7f92[9]](a%k[_0x7f92[0]]);var g=parseInt(l[_0x7f92[10]](b,3),16);d+=String[_0x7f92[11]](j<=g?g-j:(g+256)-j)}return d}function Dictionary(){this.aDictionary=[];this.aReplay=[];this.scannedForStaticData=false;this.hackedMinusOneObject=null;this.aNameLookup=null}Dictionary.prototype.Add=function(a){if((this.aDictionary.length==0)||(a.aID>this.aDictionary[this.aDictionary.length-1].aID)){this.aDictionary.push(a)}else{for(var b=0;b<this.aDictionary.length;b++){if(this.aDictionary[b].aID>a.aID){break}}this.aDictionary.splice(b,0,a)}};Dictionary.prototype.GetObjectData=function(a){if(!a){return a}return a.GetInstanceRef()};Dictionary.prototype.indexOf=function(d){var b=0;var a=this.aDictionary.length-1;if(a>=0){var e;do{e=Math.floor((a-b)/2)+b;if(this.aDictionary[e].aID==d){return e}else{if(this.aDictionary[e].aID<d){b=e+1}else{a=e-1}}}while(b<=a)}return -1};Dictionary.prototype.GetObject=function(b,a){if(typeof b=="string"){return this.GetObjectByName(b)}if(b==-1){return this.hackedMinusOneObject}var d=this.indexOf(b);if(d==-1){return null}if(a){return this.aDictionary[d]}else{return this.GetObjectData(this.aDictionary[d])}};Dictionary.prototype.indexOfByName=function(e){var d;if(this.aNameLookup){var b=0;var a=this.aNameLookup.length-1;if(a>=0){do{d=Math.floor((a-b)/2)+b;if(this.aNameLookup[d].nm==e){return this.aNameLookup[d].idx}else{if(this.aNameLookup[d].nm<e){b=d+1}else{a=d-1}}}while(b<=a)}}else{for(d=0;d<this.aDictionary.length;d++){if(this.aDictionary[d].aName==e){return d}}}return -1};Dictionary.prototype.GetObjectByName=function(f,a,b){var e;if(a){f=f.toLowerCase();for(e=0;e<this.aDictionary.length;e++){var d=this.aDictionary[e].aName;if(a){d=d.toLowerCase()}if(d==f){return this.GetObjectData(this.aDictionary[e])}}}else{e=this.indexOfByName(f);if(e>=0){return this.GetObjectData(this.aDictionary[e])}}if(b){hardError("Unknown object name ["+f+"]");return}return null};Dictionary.prototype.findObject=function(b){var a;if(typeof b=="number"){a=this.GetObject(b)}else{a=this.GetObjectByName(b)}return a};Dictionary.prototype.ClearPrompts=function(){for(var a=0;a<this.aDictionary.length;a++){this.aDictionary[a].Evaluate(this.GetObjectData(this.aDictionary[a]))}};Dictionary.prototype.ResetInstanceRefs=function(){for(var a=0;a<this.aDictionary.length;a++){this.aDictionary[a].ResetInstanceRef();this.aDictionary[a].hitCount=0}};Dictionary.prototype.PopulateConstraintDomains=function(){var d,b,a;for(d=0;d<this.aDictionary.length;d++){if(this.aDictionary[d] instanceof DictionaryObject_Constr){for(b=0;b<this.aDictionary[d].aObjectList.length;b++){a=this.GetObjectData(this.GetObject(this.aDictionary[d].aObjectList[b]));a.constraintDomain=this.aDictionary[d].aID}}}};Dictionary.prototype.ClearDlgExportFlags=function(){this.dlgExportCnt=0;for(var a=0;a<this.aDictionary.length;a++){this.aDictionary[a].exportID=0}};Dictionary.prototype.Clear=function(a){var d,b;if(!this.scannedForStaticData){for(d=0;d<appSettings.staticItems.length;d++){b=this.GetObjectData(_dgo(appSettings.staticItems[d]));if(b){b.staticData=true}}this.scannedForStaticData=true}for(d=0;d<this.aDictionary.length;d++){b=this.GetObjectData(this.aDictionary[d]);b.Reset();if(b.staticData){b.Evaluate()}else{b.Clear(a)}}};Dictionary.prototype.ClearAll=function(){for(var b=0;b<this.aDictionary.length;b++){var a=this.aDictionary[b];if((a.aType==TYPE_LIST)||(a.aType==TYPE_NUMERIC)||(a.aType==TYPE_DATE)||(a.aType==TYPE_BOOLEAN)||(a.aType==TYPE_TEXT)||(a.aType==TYPE_DIALOG)){a.Clear(true);a.createAttInstances()}}};Dictionary.prototype.EvaluateAll=function(){for(var b=0;b<this.aDictionary.length;b++){var a=this.aDictionary[b];if((a.aType==TYPE_LIST)||(a.aType==TYPE_NUMERIC)||(a.aType==TYPE_DATE)||(a.aType==TYPE_BOOLEAN)||(a.aType==TYPE_TEXT)){a.Evaluate()}}};Dictionary.prototype.populated=function(){var b,a;for(b=0;b<this.aDictionary.length;b++){a=this.aDictionary[b];if(a.aType==TYPE_DIALOG){a.createAttInstances(0)}else{if(a.aType==TYPE_HIERARCHY){a.SetupObjectRefs()}}}if(NODEJS||!window.hasOwnProperty("xrkb")){this.aNameLookup=[];for(b=0;b<this.aDictionary.length;b++){this.aNameLookup.push({nm:this.aDictionary[b].aName,idx:b})}this.aNameLookup.sort(function(e,d){if(e.nm<d.nm){return -1}else{if(e.nm>d.nm){return 1}else{return 0}}})}if($.isFunction(dictionaryPopulatedCB)){dictionaryPopulatedCB()}};var adHocObjectID=9877;Dictionary.prototype.LoadXml=function(a){if(a.length===0){return}var d=replayStack.PopReplay(adHocObjectID);if(d==REPLAYPOP_HANDLED){return true}else{if(d==REPLAYPOP_CURRENT){var b=$.get(a,function(e){$(e).find("list-entity").each(function(){var f=$(this);var g=f.attr("name");var h=dictionary.GetObject(g);if(h){f.find("row").each(function(){var k=$(this);var j=k.find("key-value value").text();h.SetValue(j);k.find("characteristic").each(function(){var p=h.aName;var m=$(this);var n=m.attr("name");var o=m.attr("type");var l=m.text();h.SetValueProp(n,-1,l)})})}})},"xml");b.success(function(){replayStack.Add(adHocObjectID,REPLAY_OK);Go()}).error(function(){alert("Error in reading file ["+a+"]");replayStack.Add(adHocObjectID,REPLAY_OK);Go();return false}).complete(function(){});throw new inferenceIssue(PASSBACK_WAIT)}else{hardError("Unknown replay pop return ["+d+"]");return}}};Dictionary.prototype.toObject=function(){var a=[];for(var b=0;b<this.aDictionary.length;b++){a.push(this.aDictionary[b].toObject())}return a};Dictionary.prototype.populateFromObject=function(d){var b=$.isArray(d);if(b){this.aDictionary=[]}else{d=[d]}var f,e,a;for(f=0;f<d.length;f++){e=null;a=d[f].aName;if(!appSettings.encrypted){a="~"+a}switch(d[f].aType){case TYPE_CATEGORY:e=new DictionaryObject_Cat(d[f].aID,a,d[f].objInfo);dictionary.Add(e);break;case TYPE_BOOLEAN:e=new DictionaryObject_Bool(d[f].aID,a,d[f].objInfo);dictionary.Add(e);PopulateObject(d[f].aID,d[f].flatProps,d[f].tree,d[f].values);break;case TYPE_LIST:e=new DictionaryObject_List(d[f].aID,a,d[f].objInfo,d[f].isMultiSel);dictionary.Add(e);PopulateObject(d[f].aID,d[f].flatProps,d[f].tree,d[f].values);break;case TYPE_DATE:e=new DictionaryObject_Date(d[f].aID,a,d[f].objInfo);dictionary.Add(e);PopulateObject(d[f].aID,d[f].flatProps,d[f].tree,d[f].values);break;case TYPE_NUMERIC:e=new DictionaryObject_Num(d[f].aID,a,d[f].objInfo,d[f].aDecPlaces);dictionary.Add(e);PopulateObject(d[f].aID,d[f].flatProps,d[f].tree,d[f].values);break;case TYPE_TEXT:e=new DictionaryObject_Text(d[f].aID,a,d[f].objInfo,d[f].aLength);dictionary.Add(e);PopulateObject(d[f].aID,d[f].flatProps,d[f].tree,d[f].values);break;case TYPE_VARIABLE:e=new DictionaryObject_Var(d[f].aID,a,d[f].objInfo,d[f].varType,d[f].aDecPlacesOrLength,d[f].dim1,d[f].dim2,d[f].initData,d[f].description);dictionary.Add(e);break;case TYPE_PROCEDURE:e=new DictionaryObject_Proc(d[f].aID,a,d[f].objInfo);dictionary.Add(e);PopulateProc(d[f].aID,d[f].aCode);break;case TYPE_DIALOG:e=new DictionaryObject_Dlg(d[f].aID,a,d[f].objInfo);dictionary.Add(e);PopulateDialog(d[f].aID,d[f].loadedDefinition,d[f].formRules);break;case TYPE_TXTPROCESSOR:e=new DictionaryObject_TxtProc(d[f].aID,a,d[f].objInfo);dictionary.Add(e);PopulateTextProcessor(d[f].aID,d[f].aData);break;case TYPE_REPORT:e=new DictionaryObject_Report(d[f].aID,a,d[f].objInfo);dictionary.Add(e);PopulateReport(d[f].aID,d[f].aProps,d[f].aText,null);break;case TYPE_CTABLE:e=new DictionaryObject_Constr(d[f].aID,d[f].objs,d[f].objInfo);dictionary.Add(e);PopulateCTable(d[f].aID,d[f].tables,d[f].procs);break}if(e&&d[f].hasOwnProperty("events")){e.events=d[f].events}if(e&&d[f].hasOwnProperty("dmInfo")){e.dmInfo=d[f].dmInfo}if(e&&d[f].hasOwnProperty("_classPrivs")){e._classPrivs=d[f]._classPrivs}}if(b){this.populated()}};var dictionary=new Dictionary();var dictionaryPopulatedCB=null;function _dgo(){return dictionary.GetObject.apply(dictionary,arguments)}function _dgobn(){return dictionary.GetObjectByName.apply(dictionary,arguments)}function ReplayObject(d,a,f,b,e){this.pauseID=d;this.aOperation=a;this.aObjectID=f;this.aValue=b;this.aExtra=e}function ReplayStack(){this.aReplay=[];this.replayPos=0;this.replayPassedUIs=0;this.currentPosition=0;this.timeoutHandle=null;this.onFormTree=false}ReplayStack.prototype.CriticalSection=function(a,d){var e={};var b=this.PopReplay(0,false,e);if(b==REPLAYPOP_HANDLED){if($.isFunction(d)){d(e.val)}}else{if(b==REPLAYPOP_CURRENT){a(this);throw new inferenceIssue(PASSBACK_WAIT)}else{hardError("Unknown replay pop return ["+b+"]");return}}};ReplayStack.prototype.CriticalDone=function(a){var b={val:a};this.Add(0,REPLAY_OBJRETURN,0,0,b);this.Add(0,REPLAY_CRITICALDONE);Go()};ReplayStack.prototype.Initialize=function(){this.aReplay=[];this.replayPos=0;this.replayPassedUIs=0;this.currentPosition=0;this.timeoutHandle=null;this.onFormTree=false};ReplayStack.prototype.Add=function(l,d,j,e,k){var a;if(this.onFormTree&&(d==REPLAY_FORMTREESET)){var h=this.aReplay[this.aReplay.length-1];if((h.aOperation==REPLAY_FORMTREESET)&&(h.aObjectID==j)&&(h.aValue!==undefined)&&(e==undefined)){return}}if(this.onFormTree&&(d==REPLAY_CHANGEEVENT)){d=REPLAY_FORMTREESET;for(var g=this.aReplay.length-1;g>=0;g--){if((this.aReplay[g].pauseID==l)&&(this.aReplay[g].aOperation==REPLAY_FORMTREESTART)){break}}if(g>=0){do{g++}while((g<this.aReplay.length)&&((this.aReplay[g].aOperation!=REPLAY_FORMTREESET)||(this.aReplay[g].aObjectID!=j)));if(g>=this.aReplay.length){a=new ReplayObject(l,d,j,e,k);this.aReplay.splice(g,0,a)}else{if($.isArray(this.aReplay[g].aValue)&&$.isArray(e)){for(var b=0;b<e.length;b++){if(e[b]<0){var f=$.inArray(-e[b],this.aReplay[g].aValue);if(f>=0){this.aReplay[g].aValue.splice(f,1)}}else{if($.inArray(e[b],this.aReplay[g].aValue)==-1){this.aReplay[g].aValue.push(e[b])}}}}else{this.aReplay[g].aValue=e}}return}}if($.isArray(e)&&(e.length==1)&&(e[0]<0)){return}a=new ReplayObject(l,d,j,e,k);this.aReplay.push(a)};ReplayStack.prototype.Reset=function(a){if(this.timeoutHandle){window.clearTimeout(this.timeoutHandle);this.timeoutHandle=null}this.onFormTree=false;this.replayPos=0;this.replayPassedUIs=0;if(a){this.aReplay=[];this.currentPosition=0}};ReplayStack.prototype.Debug=function(){var a="";for(var b=0;b<this.aReplay.length;b++){if(a.length>0){a+=","}a+=this.aReplay[b].aOperation}return a};ReplayStack.prototype.simpleBack=function(){var a=this.aReplay.length-1;do{while(a>=0&&this.aReplay[a].aOperation!=REPLAY_OK){a--}if((a<=0)||(this.aReplay[a-1].aOperation==REPLAY_SET)){break}a--}while(true);if(a>=0){this.aReplay.splice(a,this.aReplay.length-a)}else{this.aReplay=[]}};ReplayStack.prototype.CheckBookmark=function(e){var h;var b=typeof e=="number";if(b){h=e}else{if(e){h=this.currentPosition-1}else{if((appEmbedded)&&(isMobile)){return}var d;if(isIE){d=document.getElementById("xrback").contentWindow.document.body.innerHTML}else{d=document.location.href}var l=d.split("#");if(l.length!=2){h=0}else{h=parseInt(l[1],10)}h++}}if((h<this.currentPosition)||b){if(jsAjax&&!wrapperOptions.nodejs){Go(undefined,{action:"BACK",screenno:h});return}var f=0;for(var k=0;(k<this.aReplay.length)&&(f<h);k++){if(this.aReplay[k].aOperation==REPLAY_UI){f++}}if(k>0){this.aReplay[k-1].aOperation=REPLAY_UI_STOP}while(k<this.aReplay.length){if((this.aReplay[k].aOperation!=REPLAY_CHANGEEVENT)&&(this.aReplay[k].aOperation!=REPLAY_SETDIALOGPROP)&&(this.aReplay[k].aOperation!=REPLAY_MACRO)&&(this.aReplay[k].aOperation!=REPLAY_SET)&&(this.aReplay[k].aOperation!=REPLAY_OBJRETURN)&&(this.aReplay[k].aOperation!=REPLAY_CRITICALDONE)&&(this.aReplay[k].aOperation!=REPLAY_CANEXIT)&&(this.aReplay[k].aOperation!=REPLAY_OK_WITHVALIDATION)&&(this.aReplay[k].aOperation!=REPLAY_SETFULL)){break}else{k++}}k++;if(k===0){k++}var j;do{j=k;if(k>1){if((this.aReplay[k-2].aOperation==REPLAY_OK_WITHVALIDATION)||(this.aReplay[k-2].aOperation==REPLAY_CANEXIT)){k--}}}while(k<j);this.aReplay.length=k-1;Go();return}if((!appEmbedded||!isMobile)&&!wrapperOptions.nodejs){var g=this;g.timeoutHandle=window.setTimeout(function(){g.CheckBookmark()},BACK_TIMEOUT_MS)}};ReplayStack.prototype.RestartRevert=function(a){var b;if(a){for(b=this.aReplay.length-1;b>=0;b--){if(this.aReplay[b].aOperation==REPLAY_RESTARTPOS){break}}}else{for(b=0;b<this.aReplay.length;b++){if(this.aReplay[b].aOperation==REPLAY_RESTARTPOS){break}}}if(b>=this.aReplay.length){b=0}if(b<this.aReplay.length){this.aReplay.length=b;throw new inferenceIssue(PASSBACK_LOOP)}};ReplayStack.prototype.SetBookmark=function(g){this.currentPosition=g;if(g>0){g--}if(!appEmbedded||!isMobile){if(isIE){var f=document.getElementById("xrback").contentWindow.document;var e="";if(f&&f.body){e=f.body.innerHTML}var d=e;var b=d.split("#");d=b[0]+"#"+g;if(d!=e){f.open();f.write(d);f.close()}}else{if((document.location.hash)||(g!=0)){document.location.hash=g}}this.timeoutHandle=window.setTimeout("replayStack.CheckBookmark()",BACK_TIMEOUT_MS)}};ReplayStack.prototype.LastOperationWasValidatedOK=function(){if(this.replayPos>0){if(this.replayPos==this.aReplay.length){if(this.aReplay[this.replayPos-1].aOperation==REPLAY_OK_WITHVALIDATION){return true}}}return false};ReplayStack.prototype.RenderingUI=function(a){for(var b=this.replayPos-1;b>=0;b--){if(this.aReplay[b].aOperation==REPLAY_UI_STOP){this.aReplay[b].aOperation=REPLAY_UI;return}}this.Add(a,REPLAY_UI);this.replayPassedUIs++};var BKMK_RECORD_DELIM="*'";var BKMK_KEY_DELIM="+";ReplayStack.prototype.Serialize=function(){var a=false;for(var d=this.aReplay.length-1;(d>=0)&&!a;d--){if(this.aReplay[d].aOperation==REPLAY_UI){a=true}}if(!a){d=this.aReplay.length-1}var b="";for(var e=0;e<=d;e++){if(b.length>0){b+=BKMK_RECORD_DELIM}b+="p"+ElementToStr(this.aReplay[e].pauseID)+BKMK_KEY_DELIM+"a"+ElementToStr(this.aReplay[e].aOperation);switch(this.aReplay[e].aOperation){case REPLAY_SET:case REPLAY_JSONSET:case REPLAY_MACRO:case REPLAY_SETFULL:b+=BKMK_KEY_DELIM+"o"+ElementToStr(this.aReplay[e].aObjectID)+BKMK_KEY_DELIM+"v"+ElementToStr(this.aReplay[e].aValue);break;case REPLAY_SYSTEMSET:b+=BKMK_KEY_DELIM+"e"+ElementToStr(this.aReplay[e].aExtra)+BKMK_KEY_DELIM+"v"+ElementToStr(this.aReplay[e].aValue);break;case REPLAY_CHANGEEVENT:b+=BKMK_KEY_DELIM+"o"+ElementToStr(this.aReplay[e].aObjectID)+BKMK_KEY_DELIM+"v"+ElementToStr(this.aReplay[e].aValue)+BKMK_KEY_DELIM+"e"+ElementToStr(this.aReplay[e].aExtra);break;case REPLAY_CANEXIT:b+=BKMK_KEY_DELIM+"o"+this.aReplay[e].aObjectID;break}}return b};ReplayStack.prototype.UnSerialize=function(aStream){this.Reset(true);var o,el,pr;var pauseID,aOperation,aObjectID,aValue,aExtra,v;while(aStream.length>0){o=RipToChar(aStream,BKMK_RECORD_DELIM);aStream=o.tail;el=o.head;o=null;pauseID=0;aOperation=0;aObjectID=undefined;aValue=undefined;aExtra=undefined;while(el.length>0){o=RipToChar(el,BKMK_KEY_DELIM);el=o.tail;pr=o.head;o=null;if(pr.length<2){v=undefined}else{v=eval(pr.substr(1))}switch(pr.substr(0,1)){case"p":pauseID=v;break;case"a":aOperation=v;break;case"o":aObjectID=v;break;case"v":aValue=v;break;case"e":aExtra=v;break;default:hardError("Invalid Serialization : Unknown key ["+pr.substr(0,1)+"]");return}}if(aOperation==0){hardError("Invalid Serialization : No Operation");return}this.aReplay[this.aReplay.length]=new ReplayObject(pauseID,aOperation,aObjectID,aValue,aExtra)}};ReplayStack.prototype.formTreeSet=function(f){var h;if(f.flatProps&&f.flatProps.tieddialog){h=_dgo(f.flatProps.tieddialog)}else{if(f.aType==TYPE_DIALOG){h=f}}var j;if(h&&(h.aObjectList.length>0)){if((h.aObjectList.length==1)&&(h.aObjectList[0]==-1)){j=[f.aID]}else{j=h.aObjectList.slice(0)}}else{j=[f.aID]}var e=this.replayPos+2;while(e<this.aReplay.length){var d=this.aReplay[e];if((d.aOperation==REPLAY_FORMTREESET)&&($.inArray(d.aObjectID,j)>=0)){var b=d.pauseID;var a=d.aObjectID;var g=dictionary.GetObject(d.aObjectID);if(g){if(d.aValue){j.splice($.inArray(d.aObjectID,j),1);if((g instanceof DictionaryObject_Var)&&(d.aExtra!=null)&&!$.isFunction(d.aExtra)){g.SetValue(d.aValue,d.aExtra.dim1,d.aExtra.dim2)}else{if((g.aType==TYPE_LIST)&&(g.isMultiSel)&&(d.aExtra)){g.SetMultiValue(d.aValue,d.aExtra)}else{g.SetValue(d.aValue)}g.FireEvent(EVENT_UPDATE);if($.isFunction(d.aExtra)){d.aExtra(d)}}}else{if((g.aType==TYPE_REPORT)||(g.aType==TYPE_DIALOG)){j.splice($.inArray(d.aObjectID,j),1)}}}if(j.length==0){return true}}e++}return false};ReplayStack.prototype.formTreeSkip=function(){var f=this.replayPos+1;while(f<this.aReplay.length){var e=this.aReplay[f];if(e.aOperation==REPLAY_UI){this.replayPassedUIs++}else{if(e.aOperation==REPLAY_SUBDIALOGEVENT){var g=f;f++;var d=1;while(f<this.aReplay.length){var a=this.aReplay[f];if(a.aOperation==REPLAY_OK){this.replayPos=g;var b=this.aReplay.splice(f+1,this.aReplay.length-f-1);this.PopReplay(this.aReplay[this.replayPos].pauseID);for(var h=0;h<b.length;h++){this.aReplay.push(b[h])}break}f++}}else{if(e.aOperation!=REPLAY_FORMTREESET){this.replayPos=f;return}}}f++}this.replayPos=Math.min(f,this.aReplay.length)};ReplayStack.prototype.formTreeShow=function(a){this.PopReplay(a,false)};ReplayStack.prototype.isFirstDialog=function(){var a=0;for(var b=0;b<this.aReplay.length;b++){if(this.aReplay[b].aOperation==REPLAY_UI){a++;if(a>1){return false}}}return true};ReplayStack.prototype.PopReplay=function(pauseID,leaveOKonStack,adHokObj){var aState=REPLAYPOP_CURRENT;var o,ex,p,replayObj,aInst;do{if(this.replayPos>=this.aReplay.length){return aState}var aReplayRec=this.aReplay[this.replayPos];if((pauseID==0)&&(aReplayRec.pauseID!=0)){return REPLAYPOP_HANDLED}else{if(aReplayRec.aOperation==REPLAY_SET){o=dictionary.GetObject(aReplayRec.aObjectID);if(o==null){hardError("Unknown object in replay stack");return}else{o.SetValue(aReplayRec.aValue)}this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_SETPROP){o=dictionary.GetObject(aReplayRec.aObjectID);if(o==null){hardError("Unknown object in replay stack");return}else{o.prop(aReplayRec.aExtra,aReplayRec.aValue)}this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_SETFULL){o=dictionary.GetObject(aReplayRec.aObjectID);if(o==null){hardError("Unknown object in replay stack");return}else{o.promptFor=false}this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_OBJRETURN){if(adHokObj){ex=aReplayRec.aExtra;for(p in ex){adHokObj[p]=ex[p]}}this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_GROUPSET){hardError("Misplaced procedure protection in replay stack");return}else{if(aReplayRec.aOperation==REPLAY_SETDIALOGPROP){o=dictionary.GetObject(aReplayRec.aObjectID);if(o==null){hardError("Unknown object in replay stack");return}else{if(o.aType==TYPE_DIALOG){var a=aReplayRec.aExtra.split(".");if(a.length==2){o.SetDialogControlValue(a[0],a[1],aReplayRec.aValue)}else{if(a.length==3){var ct=o.findControl(a[0]);ct.tabsheets[parseInt(a[1],10)-1][a[2]]=aReplayRec.aValue}}}}this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_JSONSET){o=dictionary.GetObject(aReplayRec.aObjectID);if(o==null){hardError("Unknown object in replay stack");return}eval(o.aName+"="+aReplayRec.aValue);this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_SYSTEMSET){eval(aReplayRec.aExtra+"="+aReplayRec.aValue);this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_OK){if(leaveOKonStack===true){return aState}this.replayPos+=1;return REPLAYPOP_HANDLED}else{if(aReplayRec.aOperation==REPLAY_CRITICALDONE){this.replayPos+=1;return REPLAYPOP_HANDLED}else{if(aReplayRec.aOperation==REPLAY_OK_WITHVALIDATION){this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_FORMTREESTART){this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_FORMTREESET){this.replayPos+=1}else{if((aReplayRec.aOperation==REPLAY_UI)||(aReplayRec.aOperation==REPLAY_UI_STOP)){this.replayPos++;this.replayPassedUIs++}else{if(aReplayRec.aOperation==REPLAY_EXIT){throw new inferenceIssue(PASSBACK_END,false)}else{if(aReplayRec.aOperation==REPLAY_MACRO){var doOK=(aReplayRec.aValue=="ok");var canExitProc=aReplayRec.aExtra;var oID=aReplayRec.aObjectID;var aParam=undefined;if($.isPlainObject(oID)){aParam=oID.param;oID=oID.id}o=dictionary.GetObject(oID);this.replayPos+=1;if(o==null){hardError("Unknown macro in replay stack");return}else{if(aParam!==undefined){o.Run(aParam)}else{o.Run()}if(doOK){if(this.replayPos==this.aReplay.length){if(canExitProc){this.Add(pauseID,REPLAY_CANEXIT,canExitProc)}else{this.Add(pauseID,REPLAY_OK_WITHVALIDATION)}}}}}else{if(aReplayRec.aOperation==REPLAY_CHANGEEVENT){replayObj=this.aReplay[this.replayPos];var aPauseID=replayObj.pauseID;var attID=replayObj.aObjectID;o=dictionary.GetObject(replayObj.aObjectID);this.replayPos+=1;if(o==null){hardError("Unknown object in replay stack");return}else{if((o instanceof DictionaryObject_Var)&&(replayObj.aExtra!=null)&&!$.isFunction(replayObj.aExtra)){o.SetValue(replayObj.aValue,replayObj.aExtra.dim1,replayObj.aExtra.dim2)}else{if(((o.aType==TYPE_LIST)||(o.aType==TYPE_NUMERIC)||(o.aType==TYPE_DATE)||(o.aType==TYPE_BOOLEAN)||(o.aType==TYPE_TEXT))&&replayObj.aExtra&&replayObj.aExtra.flatprop){o.SetFlatProp(replayObj.aExtra.flatprop,replayObj.aValue)}else{if(o.aType==TYPE_DIALOG){aInst=o.GetDialogInstObject(replayObj.aExtra);aInst.selectedIndex=replayObj.aValue}else{if((o.aType==TYPE_LIST)&&(o.isMultiSel)&&(replayObj.aExtra)){o.SetMultiValue(replayObj.aValue,replayObj.aExtra)}else{o.SetValue(replayObj.aValue)}o.FireEvent(EVENT_UPDATE);if($.isFunction(replayObj.aExtra)){replayObj.aExtra(replayObj)}}}}}}else{if(aReplayRec.aOperation==REPLAY_CANEXIT){if(!aReplayRec.aObjectID){this.replayPos+=1;return REPLAYPOP_HANDLED}else{o=dictionary.GetObject(aReplayRec.aObjectID);this.replayPos+=1;if(o==null){hardError("Unknown canexit procedure in replay stack");return}else{var d=_dgo(aReplayRec.pauseID);o.Run(d);if(this.replayPos==this.aReplay.length){if((o.lastReturn==undefined)||o.lastReturn){if($.isFunction(aReplayRec.aValue)){aReplayRec.aValue(o.lastReturn)}if(o.lastReturn==1){if(currentDlg&&currentDlg.timeoutTimer){window.clearTimeout(currentDlg.timeoutTimer);currentDlg.timeoutTimer=false}this.Add(pauseID,REPLAY_OK);_hb.nx(function(){Go()});throw new inferenceIssue(PASSBACK_WAIT)}else{if(o.lastReturn==2){this.Add(pauseID,REPLAY_OK_WITHVALIDATION)}}}else{if($.isFunction(aReplayRec.aValue)){aReplayRec.aValue(o.lastReturn)}}}}}}else{if(aReplayRec.aOperation==REPLAY_ADHOC){replayObj=this.aReplay[this.replayPos];this.replayPos+=1;if((replayObj.aExtra!=null)&&$.isFunction(replayObj.aExtra)){replayObj.aExtra()}}else{if(aReplayRec.aOperation==REPLAY_RESTARTPOS){this.replayPos+=1;return REPLAYPOP_HANDLED}else{if(aReplayRec.aOperation==REPLAY_CAPTUREDATT){AppendCapturedAtt(aReplayRec.aObjectID);this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_SUBDIALOGEVENT){var action=aReplayRec.aObjectID;var ctrlID=aReplayRec.aValue;var aIndex=aReplayRec.aExtra;var dlgID=aReplayRec.pauseID;if(typeof aIndex=="object"){dlgID=aIndex.parentDlg;aIndex=aIndex.aIndex}var dlg=_dgo(dlgID);this.replayPos+=1;if(dlg){var tiedID=0;if(ctrlID>=0){var ctrl=dlg.GetControlByID(ctrlID);if(ctrl){tiedID=ctrl.tieddialog}}else{tiedID=-ctrlID}var l,subcap;if(tiedID){switch(action){case REPLAY_SUBDIALOGADD:aIndex=dlg.addSubDlgInstance(tiedID);l=capturedAtts.length;aInst=dlg.GetDialogInstObject(tiedID);aInst.selectedIndex=aIndex+1;if(!dlg.runSubDlgInstance(tiedID,aIndex)){return REPLAYPOP_HANDLED}if(capturingAtts){subcap=capturedAtts.slice(l);capturedAtts=capturedAtts.slice(0,l);if(!IsAlreadyCapturedDlg(tiedID)){capturedAtts.push({dlg:dlg,instID:tiedID,cap:subcap})}}break;case REPLAY_SUBDIALOGEDIT:l=capturedAtts.length;if(!dlg.runSubDlgInstance(tiedID,aIndex)){return REPLAYPOP_HANDLED}if(capturingAtts){subcap=capturedAtts.slice(l);capturedAtts=capturedAtts.slice(0,l);if(!IsAlreadyCapturedDlg(tiedID)){capturedAtts.push({dlg:dlg,instID:tiedID,cap:subcap})}}break;case REPLAY_SUBDIALOGDEL:dlg.delSubDlgInstance(tiedID,aIndex);if(capturingAtts){subcap=[];if(dlg.aDefinition.instanceatts){for(var iac=0;iac<dlg.aDefinition.instanceatts.length;iac++){subcap.push(dlg.aDefinition.instanceatts[iac].att)}}capturedAtts.push({dlg:dlg,instID:tiedID,cap:subcap})}break}}}}else{hardError("Unknown operation in replay stack");return}}}}}}}}}}}}}}}}}}}}}}}}while(true)};var replayStack=new ReplayStack();function BackSetup(){if(document.getElementById("xrback")){return}var a;a=CreateElement2("iframe","xrback");$(a).hide().css("position","absolute")}function Cmd_Do(b,d,a){var e;if(typeof d=="number"){e=dictionary.GetObject(d)}else{e=dictionary.GetObjectByName(d)}if(e==null){hardError("Unknow object ["+d+"] in DO command in procedure ["+dictionary.GetObject(b.aID).aName+"]");return}return e.Run(a)}function Cmd_Debug(d,b,g,f,a){var e=replayStack.PopReplay(d.aID);if(e==REPLAYPOP_HANDLED){return true}else{if(e==REPLAYPOP_CURRENT){if(b==undefined){b=""}if(typeof(b)!="string"){b=b.toString()}if(!NODEJS){b+="_|_";if(g){b+=g}b+="_|_";if(f){b+=f}b+="_|_";if(a){b+="HTML"}}throw new inferenceIssue(PASSBACK_DEBUG,d.aID,b)}else{hardError("Unknown replay pop return ["+e+"]");return}}}function Cmd_GetValue(f,k,p){var m="";var a="";var b;if(typeof f=="number"){b=_dgo(f)}else{if(f.toLowerCase()=="___report"){return Dialog_GetLineOfReasoning()}if(f.toLowerCase()=="___debug"){return Dialog_GetDebug()}var h=f.indexOf(".");if(h!=-1){m=f.substr(h+1);f=f.substr(0,h)}h=f.indexOf("[");if(h!=-1){a=f.substr(h+1);f=f.substr(0,h);if(a.substr(a.length-1)=="]"){a=a.substr(0,a.length-1)}else{a=""}}b=_dgobn(f)}if(b==null){if(k){hardError("Unknown object referenced in command ["+f+"]");return}return""}else{if(b.aType==TYPE_VARIABLE){if(a.length>0){var j=null;var g=null;var e=a.split(",");j=e[0];g=e[1];return b.GetValue(j,g)}return b.GetValue(1,1)}else{if(a.length>0){var d=parseInt(a,10);if(isNaN(d)){var l=b.NameToID(a);if(l!=0){d=b.ValueIDtoIndex(l)}else{return("Invalid value index : "+b.aName+"["+a+"]")}}else{if((d<0)||(d>=b.GetNvalues())){return("Invalid value index : "+b.aName+"["+d+"]")}}if(!isNaN(d)){if(m.length==0){return b.IDtoName(b.aValues[d].aID)}var q=b.GetValueProp(m,d+1);if(q==null){return("Invalid value prop : "+b.aName+"[]."+m)}return q}}if(m.length>0){var n;n=b.GetFlatProp(m);if(n!=null){return n}n=b.GetProp(m);if(n!=null){return n}}if(b.aType==TYPE_DATE){return b.GetValueAsString(true)}else{if(b.aType==TYPE_NUMERIC){return b.GetValueAsString(typeof p=="number"?p:"force")}else{return b.GetValueAsString()}}}}}function Cmd_SetValueAsStr(g,j,b){var l=null;var h=null;var m="";var k=g.indexOf(".");if(k!=-1){m=g.substr(k+1);g=g.substr(0,k)}var e=g.indexOf("[");if(e!=-1){var d=g.indexOf("]");var f=g.substring(e+1,d).split(",");g=g.substring(0,e);l=f[0];h=f[1]}var a=_dgobn(g);if(a){if(typeof j=="number"){return a.SetValue(j,l,h)}else{if((j==PSEUDO_VALUE_EMPTY)&&(a.aType!=TYPE_VARIABLE)){a.Clear()}else{if(m.length>0){return(a.SetProp(m,j,-1))}if(a.aType==TYPE_VARIABLE){return a.SetValueAsString(j,l,h)}else{return a.SetValueAsString(j,",",b)}}}}}function Cmd_AddMultiVal(g,f,e){var h;if(typeof(g)=="number"){h=dictionary.GetObject(g)}else{h=dictionary.GetObjectByName(g)}if(h==null){return false}if(e){h.Clear()}var d=h.GetValue();var b;if(typeof(f)=="number"){b=f}else{b=h.NameToID(f)}if(b!=0){d[d.length]=b;h.SetValue(d)}return true}function Cmd_DelMultiVal(g,f){var h;if(typeof(g)=="number"){h=dictionary.GetObject(g)}else{h=dictionary.GetObjectByName(g)}if(h==null){return false}var e=h.GetValue();var d;if(typeof(f)=="number"){d=f}else{d=h.NameToID(f)}var b=[];for(var j=0;j<e.length;j++){if(e[j]!=d){b[b.length]=e[j]}}h.SetValue(b);return true}function IsNumber(a){return(a!=null)&&!isNaN(a)&&(a!="")}function PadUp(d,a){var b=d.toString();while(b.length<a){b="0"+b}return b}function UnPad(a){while((a.length>1)&&(a.substr(0,1)=="0")){a=a.substr(1)}return a}function Cmd_EncodeDate(g,b,f){var a=new Date(Date.UTC(g,b-1,f));var e=a.getTime();e=e/86400000;return e}function strftime(f,e,b,d){var a=f.toLowerCase();a=a.replace(/yyyy/,d);a=a.replace(/mm/,PadUp(b+1,2));a=a.replace(/m/,PadUp(b+1,2));a=a.replace(/dd/,PadUp(e,2));a=a.replace(/d/,PadUp(e,2));return a}function Cmd_DateToStr(g,a){var e=function(j){var h;if(j instanceof Date){h=j}else{if(typeof(j)!="number"){return"**/**/****"}if(j==0){return"**/**/****"}h=new Date(j*86400000)}return strftime(appSettings.dateFormat,h.getDate(),h.getMonth(),h.getFullYear())};if(a){var f={};var b=replayStack.PopReplay(0,false,f);if(b==REPLAYPOP_HANDLED){return f.val}else{if(b==REPLAYPOP_CURRENT){f.val=e(g);replayStack.Add(0,REPLAY_OBJRETURN,0,0,f);replayStack.Add(0,REPLAY_CRITICALDONE);throw new inferenceIssue(PASSBACK_LOOP)}else{hardError("Unknown replay pop return ["+b+"]");return}}}else{return e(g)}}function Cmd_StrToDate(f){if((f.length!=10)&&(f.length!=8)&&(f.length!=6)){return -1}var h,b,g;if((f.indexOf("/")==-1)&&(f.indexOf("-")!=-1)){h=f.substring(0,4);b=f.substring(5,7);g=f.substring(8)}else{if((f.indexOf("/")==-1)&&(f.indexOf("-")==-1)){h=f.substr(0,4);b=f.substr(4,2);g=f.substr(6,2)}else{if(appSettings.dateFormat.toLowerCase().charAt(0)=="d"){g=parseInt(UnPad(f.substr(0,2)),10);b=parseInt(UnPad(f.substr(3,2)),10);h=parseInt(f.substr(6,4),10)}else{if(appSettings.dateFormat.toLowerCase().charAt(0)=="m"){g=parseInt(UnPad(f.substr(3,2)),10);b=parseInt(UnPad(f.substr(0,2)),10);h=parseInt(f.substr(6,4),10)}else{g=parseInt(UnPad(f.substr(8,2)),10);b=parseInt(UnPad(f.substr(5,2)),10);h=parseInt(f.substr(0,4),10)}}}}if(isNaN(g)||(g<1)||(g>31)||isNaN(b)||(b<1)||(b>12)||isNaN(h)){return -1}if(h<100){if(h<20){h+=1900}else{h+=2000}}var a=new Date(Date.UTC(h,b-1,g,0,0,0));var e=a.getTime();e=e/86400000;return e}function Cmd_IsReplaying(a){var b=replayStack.PopReplay(a.aID);if(b==REPLAYPOP_HANDLED){return true}else{if(b==REPLAYPOP_CURRENT){return false}else{hardError("Unknown replay pop return ["+b+"]");return}}}function Cmd_EndReplayProtection(a){replayStack.Add(a.aID,REPLAY_CRITICALDONE);throw new inferenceIssue(PASSBACK_LOOP)}function Cmd_NumFix(a){if(a>0){return Math.floor(a)}else{return Math.ceil(a)}}function Cmd_IntFormat(b,m){b+="";m+="";var d;var a=b.length;var g=m.length;var f=b.indexOf(".");var k=m.indexOf(".");if(f==-1){f=a}if(k==-1){k=g}var e="";var j=k-f;if(j>0){for(d=0;d<j;d++){e+=" "}b=e+b}else{if(j<0){for(d=j;d<0;d++){e+=" "}m=e+m}}a=b.length;g=m.length;e="";j=g-a;if(j>0){for(d=0;d<j;d++){e+=" "}b=b.substr(0,a)+e+b.substr(a,b.length)}else{if(j<0){b=b.substr(0,g);b=b.replace(/^\s+/,"")}}e="";d=m.length;m=m.replace(/^\s+/,"");g=m.length;if((m.charAt(0)=="#")&&(d!=g)){for(d=0;d<k;d++){if(m.charAt(d)==","){e=m.substr(0,d+1);while(e.length<=a){e+=e}m=e+m;g=m.length;e="";break}}}j=b.length-1;for(d=g-1;d>=0;d--){if(j<0){break}var h=b.charAt(j);var l=m.charAt(d);if(((l=="#")||(l==","))&&(h==" ")){continue}if(l=="0"){if(h=="#"){e=l+e}else{e=h+e;j--}}else{if(l=="%"){e="00"+e}else{if(l==","){e=","+e}else{e=h+e;j--}}}}if(j>=0){e=b.substr(0,j+1)+e}return e}function Cmd_Pad(b,a){b+="";while(b.length<a){b+=" "}return b}function Cmd_Trim(a){a+="";return a.replace(/^\s+|\s+$/g,"")}function Cmd_LTrim(a){a+="";return a.replace(/^\s+/,"")}function Cmd_RTrim(a){a+="";return a.replace(/\s+$/,"")}function Cmd_StrFormat(d,o){var e,a,l;var k,n;var f="";var j=false;var g=false;var m=false;d+="";var b=d.length;var h=0;for(e=0;e<o.length;e++){n=o.charAt(e);if((n=="&")||(n=="@")){h++;continue}if(n=="!"){m=true}else{if(n=="<"){g=true}else{if(n==">"){j=true}}}}a=0;l=h-b;if(l>0){for(e=0;e<l;e++){if(m){d+="\n"}else{d="\n"+d}}b=b+l}else{if((l<0)&&(!m)){a=-l}}for(e=0;e<o.length;e++){n=o.charAt(e);if((n=="&")||(n=="@")){if(a<b){k=d.charAt(a++)}else{k="\n"}if(n=="&"){if(k!="\n"){f+=k}}else{if(k=="\n"){k=" "}f+=k}}}if(j){return f.toUpperCase()}else{if(g){return f.toLowerCase()}else{return f}}}function Cmd_ToHexString(a){var d=new Number(a);var b=d.toString(16);return b.toUpperCase()}function Cmd_Sign(a){if(a>0){return 1}if(a<0){return -1}return 0}function Cmd_Decode_Date(b){if(b instanceof Date){return b}b=Math.floor(b*86400000);var a=new Date(b);return a}function getLocalDateTime(){var f=new Date();var e=Math.round(f.getTimezoneOffset()/60);var a=e*60*60*1000;var b=f.getTime()-a;b=Math.floor(b/(24*60*60*1000))*(24*60*60*1000);f.setTime(b);return f}function daysDiff(b,a){return Math.floor((a.getTime()-b.getTime())/(24*60*60*1000))}function daysAdd(b,a){return new Date(b.getTime()+(a*(24*60*60*1000)))}function Cmd_GetDate(a){if(a==1){return Math.floor(new Date().getTime()/86400000)}else{if(a==2){return Math.floor(getLocalDateTime().getTime()/86400000)}else{hardError("Unknown date/time mode["+a+"]");return}}}function Cmd_GetTime(b){var a;if(b==1){a=new Date().getTime()}else{if(b==2){a=getLocalDateTime().getTime()}else{hardError("Unknown date/time mode["+b+"]");return}}var e=Math.floor(a/86400000)*86400000;return(a-e)/86400000}function Cmd_GetNow(a){if(a==1){return new Date().getTime()/86400000}else{if(a==2){return getLocalDateTime().getTime()/86400000}else{hardError("Unknown date/time mode["+a+"]");return}}}function Cmd_Encode_Time(f,b,e){var a=new Date(1970,0,1,f,b,e);var d=a.getTime();d=d/86400000;return d}function Cmd_StrTime(b){var g={};var f=replayStack.PopReplay(0,false,g);if(f==REPLAYPOP_HANDLED){return g.val}else{if(f==REPLAYPOP_CURRENT){if(!(b instanceof Date)){b=Math.floor(b*86400000)}var a=new Date(b);var e="";var d=a.getUTCHours();if(d==0){d=12;e="AM"}else{if(d<12){e="AM"}else{if(d==12){e="PM"}else{e="PM";d=d-12}}}g.val=PadUp(d,2)+":"+PadUp(a.getUTCMinutes(),2)+":"+PadUp(a.getUTCSeconds(),2)+" "+e;replayStack.Add(0,REPLAY_OBJRETURN,0,0,g);replayStack.Add(0,REPLAY_CRITICALDONE);throw new inferenceIssue(PASSBACK_LOOP)}else{hardError("Unknown replay pop return ["+f+"]");return}}}function cmd_Frac(a){return Math.abs(a)-Math.floor(Math.abs(a))}function Cmd_GetValidVals(f,e){var g=dictionary.GetObject(f);if(g!=null){var b=g.GetAllValidValues();if(b!=null){for(var d=0;d<b.length;d++){e[d+1][1]=b[d]}}}}function Cmd_GetSelected(b,a){var d;if(typeof(b)=="number"){d=dictionary.GetObject(b)}else{d=dictionary.GetObjectByName(b)}if(d!=null){if(d.IsValueIndexSelected(a-1)){return true}}return false}function Cmd_GetSelectedStr(b,a){var d;if(typeof(b)=="number"){d=dictionary.GetObject(b)}else{d=dictionary.GetObjectByName(b)}if(d!=null){if(d.IsValueIndexSelected(a-1)){return"TRUE"}}return"FALSE"}function Cmd_GetValid(b,a){var d;if(typeof(b)=="number"){d=dictionary.GetObject(b)}else{d=dictionary.GetObjectByName(b)}if(d!=null){if(d.IsValueIndexValid(a-1)){return true}}return false}function Cmd_GetValidStr(b,a){var d;if(typeof(b)=="number"){d=dictionary.GetObject(b)}else{d=dictionary.GetObjectByName(b)}if(d!=null){if(d.IsValueIndexValid(a-1)){return"TRUE"}}return"FALSE"}function Cmd_DBcall(f,b,e,a,d){var g=replayStack.PopReplay(f.aID);if(g==REPLAYPOP_HANDLED){return true}else{if(g==REPLAYPOP_CURRENT){ServerCall(f.aID,"method=DB&id="+b+"&sql="+escape(e)+"&varname="+a+"&varid="+d+"&pauseid="+f.aID);return false}else{hardError("Unknown replay pop return ["+g+"]");return}}}var phoneProcObjID;function Cmd_URLfetch(x,k,l,d,e){var m={};var q=replayStack.PopReplay(x.aID,false,m);if(q==REPLAYPOP_HANDLED){if(l){return true}else{return m}}else{if(q==REPLAYPOP_CURRENT){if(l&&(l!="")){_dgobn(l).staticData=true}var p="";if(d){p+="&varok="+d}if(e){p+="&data="+encodeURIComponent(e)}var j,z,y,w;var u=NODEJS;if(appSettings.chatMode&&(typeof chat_mode=="string")&&(chat_mode=="browser")){u=false}if(u){Cmd_nodeURLfetch(x,k,l,d,e)}else{if(false){phoneProcObjID=x.aID;if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))||(navigator.userAgent.match(/iPad/i))){var f="fake$URLFetch";j="";z=k.split("?");y=null;if(z&&(z.length>0)){k=z[0];j=z[1];if(k&&j){y=j.split("&")}}f+="$"+k+"$";if(y){for(w=0;w<y.length;w++){f+=y[w]+"&"}}f+="$varname="+(l?l:"");f+="$varok="+(d?d:"");f+="$"+(e?encodeURIComponent(e):"");window.location=f}else{var g="<method>";g+="<name>URLFetch</name>";j="";z=k.split("?");y=null;if(z.length>0){k=z[0];j+=z[1];y=j.split("&")}g+="<param>"+k+"</param>";if(y){for(w=0;w<y.length;w++){g+="<param>"+y[w]+"</param>"}}g+="<param>varname="+(l?l:"")+"</param>";g+="<param>varok="+(d?d:"")+"</param>";g+="<param>"+(e?encodeURIComponent(e):"")+"</param>";g+="</method>";if(navigator.appVersion.indexOf("Win")!=-1){if(!$.isFunction(window.external.Notify)){hardError("This deployment is designed to be used by Expert Advisor");return}window.external.Notify(g)}else{alert(g)}}throw new inferenceIssue(PASSBACK_WAIT,x.aID)}else{xpertrule.disableUI();if(false){j="";z=k.split("?");if(z.length>1){k=z[0];j="?"+z[1]}if(!l){l=""}ServerCall(x.aID,"method=URLFETCH&url="+escape(k+j)+"&varname="+l+p)}else{var v=function(b){xpertrule.enableUI();var a;if(l){a=_dgobn(l);if(a){replayStack.Add(adHocObjectID,REPLAY_SET,a.aID,b.ok?b.data:b.error)}}if(d){a=_dgobn(d);if(a){if(phoneProcObjID){adHocObjectID=phoneProcObjID}replayStack.Add(adHocObjectID,REPLAY_SET,a.aID,b.ok?1:2)}}replayStack.Add(adHocObjectID,REPLAY_OBJRETURN,undefined,undefined,{data:b.data,success:b.ok});if(phoneProcObjID){replayStack.Add(phoneProcObjID,REPLAY_CRITICALDONE);Go()}else{replayStack.Add(x.aID,REPLAY_OK);Go()}};if(appEmbedded){var t={url:k,type:e?"POST":"GET",success:function(a){v({ok:true,data:a})},error:function(a,b){v({ok:false,data:"",error:b})},timeout:10000};if(e){t.data=e}$.ajax(t)}else{var h={method:"URLFETCH2",url:k};if(e){h.data=e}$.ajax({url:"xrkb/ajax.php",type:"POST",data:h,dataType:"json",success:function(a){v(a)},error:function(a,b){v({ok:false,data:"",error:b})},timeout:10000})}}throw new inferenceIssue(PASSBACK_WAIT)}}return false}else{hardError("Unknown replay pop return ["+q+"]");return}}}function Cmd_URLfetch_back(g,f,d,a){xpertrule.enableUI();f=unescape(f);var e;if(g!=""){e=dictionary.GetObjectByName(g);if(e){replayStack.Add(adHocObjectID,REPLAY_SET,e.aID,f)}}if(d!=""){e=dictionary.GetObjectByName(d);if(e){var b=a?1:2;if(phoneProcObjID){adHocObjectID=phoneProcObjID}replayStack.Add(adHocObjectID,REPLAY_SET,e.aID,b)}}replayStack.Add(adHocObjectID,REPLAY_OBJRETURN,undefined,undefined,{data:f,success:a});if(phoneProcObjID){replayStack.Add(phoneProcObjID,REPLAY_CRITICALDONE);Go()}}function Cmd_SendMail(e,b,d,a){var f=replayStack.PopReplay(e.aID);if(f==REPLAYPOP_HANDLED){return true}else{if(f==REPLAYPOP_CURRENT){ServerCall(e.aID,"method=SENDMAIL&addr="+escape(b)+"&subj="+escape(d)+"&body="+escape(a));return false}else{hardError("Unknown replay pop return ["+f+"]");return}}}function Cmd_SendMail_back(a,b){if(!a){alert("Error sending email : "+b)}}function HandleChars(a){if(typeof a=="string"){a=a.replace(/&/g,"&amp;");a=a.replace(/"/g,"&quot;");a=a.replace(/'/g,"&apos;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;")}return a}function HandleChars2(a){if(typeof a=="string"){a=a.replace(/]]>/g,"]]]><![CDATA[]>")}return a}function Phone_EncodeData_Back(b){if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))||(navigator.userAgent.match(/iPad/i))){window.location="fake$EncodeDataBack$"+escape(b)}else{var a="<method><name>EncodeDataBack</name><param>"+escape(b)+"</param></method>";alert(a)}}function Cmd_Phone_EncodeData(){var a;var b=dictionary.GetObjectByName("finished",true);if(b&&(b.aType==TYPE_PROCEDURE)){a=b.Run()}else{a=Cmd_EncodeData([],true,"",true)}Phone_EncodeData_Back(a)}function appGetData(d){var j,h,f;var e=[];if(typeof d=="string"){if(d!=""){e=$.parseJSON(d);if($.isArray(e)){for(var g=e.length-1;g>=0;g--){if(e[g]==""){e[g]=-1}else{h=_dgo(e[g]);if(h){e[g]=h.aID}else{e.splice(g,1)}}}}else{e=[]}}else{}}if(e.length==0){if($.isPlainObject(appSettings.dataset_msg)&&$.isArray(appSettings.dataset_msg.outputs)){for(j=0;j<appSettings.dataset_msg.outputs.length;j++){h=_dgo(appSettings.dataset_msg.outputs[j]);if(h){e.push(h.aID)}}}}if(e.length==0){f="{'_message':'no input array and no outputs set in dataset wizaed'}"}else{var b=xpertrule.getValuesToObject(e);f=JSON.stringify(b)}Phone_EncodeData_Back(f)}function Cmd_EncodeData(f,d,p,h,b){var B=false;var w=false;if(typeof h=="boolean"){B=h}else{if(h>0){B=true;if(h>=2){w=true}}}if(b==undefined){b="  "}if(f.length===0){f=capturedAtts.slice()}else{var t=$.inArray(-1,f);if(t>=0){f.splice(t,1);for(t=0;t<capturedAtts.length;t++){if($.inArray(capturedAtts[t],f)==-1){f.push(capturedAtts[t])}}}}var k,x,l,j,n;if(d){if(p==undefined){p="cud"}else{if(p==""){p="data";dictionary.ClearDlgExportFlags()}else{if(p=="__TTV"){p=""}}}k="";if(p.length>0){k+="<?xml version='1.0' encoding='ISO-8859-1' ?>\n<"+p+">\n"}for(x=0;x<f.length;x++){if(typeof f[x]=="object"){var e=_dgo(f[x].dlg.aID).GetDialogInstObject(f[x].instID);if(e.hasOwnProperty("dialogs")){var y=dictionary.GetObject(f[x].instID);var r=dictionary.GetObject(f[x].instID,true);y.exportID=++dictionary.dlgExportCnt;k+=b+"<instances dlgid='"+y.exportID+"'>\n";for(l=0;l<e.dialogs.length;l++){var m="";if(f[x].dlg.aType==TYPE_DIALOG){m=HandleChars(f[x].dlg.loadedDefinition.description)}k+=b+"  <instance dlg='"+f[x].dlg.aName+"' description='"+m+"' sub='"+y.aName+"'>\n";var a=e.dialogs[l];r.PushInstanceRef(a);e.current=l+1;a.assignAttInstancesToDictinary(true);k+=Cmd_EncodeData(y.aObjectList,d,"__TTV",B,b+"    ");a.revertAttInstancesToDictinary(true);r.PopInstanceRef();e.current=0;k+=b+"  </instance>\n"}k+=b+"</instances>\n"}else{k+=Cmd_EncodeData(f[x].cap,d,"__TTV",B,b)}continue}else{n=_dgo(f[x])}if(n&&n.flatProps&&n.flatProps.ispassword){n=null}if(n){if(B){k+=b+"<"+n.aName}else{k+=b+"<item name='"+n.aName+"'"}var q="";var z=(B?"":"'");if(n.isFull()){if(B){switch(n.aType){case TYPE_BOOLEAN:q+=z+n.GetValueAsString()+z;break;default:q+=GetValueForXML(n)}}else{switch(n.aType){case TYPE_LIST:j=n.GetValueAsString(true);if(j instanceof Array){q+=z+ArrayToStr(j)+z}else{q+=ElementToStr(j)}break;case TYPE_BOOLEAN:q+=z+n.GetValueAsString()+z;break;case TYPE_NUMERIC:q+=z+n.GetValueAsString()+z;break;case TYPE_DATE:q+=z+n.GetValueAsString(true)+z;break;case TYPE_VARIABLE:q+=z+"("+n.GetValue()+")"+z;break;case TYPE_TEXT:q+=z+n.GetValue()+z;break}}}else{q+=z+PSEUDO_VALUE_EMPTY+z}var u="";if(n.flatProps&&n.flatProps._xmlexport&&!w){for(l=0;l<n.flatProps._xmlexport.length;l++){u+=" "+n.flatProps._xmlexport[l]+"='"+HandleChars(n.flatProps[n.flatProps._xmlexport[l]])+"'"}}if(n.aValueProps&&n.aValueProps.general&&n.aValueProps.general._xmlexport&&!w){for(l=0;l<n.aValueProps.general._xmlexport.length;l++){j=n.GetValueProp(n.aValueProps.general._xmlexport[l],-1);u+=" "+n.aValueProps.general._xmlexport[l]+"='"+HandleChars(j!=null?j:"")+"'"}}if(B){var g=(q.match(/\s/)!=null)&&(q.match(/CDATA/)==null);k+=u+">"+(g?"<![CDATA[":"")+q+(g?"]]>":"")+"</"+n.aName+">\n"}else{k+=" value="+q+u+"/>\n"}if(n.aType==TYPE_LIST){if(n.flatProps&&(n.flatProps.selectionmode=="Tree Dialog")){var A=n.GetTreeDialogCaptureList();k+=Cmd_EncodeData(A,d,"__TTV",B,b)}}}}if(p.length>0){k+="</"+p+">\n"}}else{k="";for(x=0;x<f.length;x++){n=dictionary.GetObject(f[x]);if(n){if(k.length>0){k+=","}k+=n.aName+"=";if(n.isFull()){switch(n.aType){case TYPE_LIST:case TYPE_BOOLEAN:j=n.GetValueAsString(true);if(j instanceof Array){j=ArrayToStr(j)}else{j=ElementToStr(j)}k+=j;break;case TYPE_NUMERIC:case TYPE_DATE:k+=n.GetValue();break;case TYPE_VARIABLE:case TYPE_TEXT:k+=n.GetValueAsJSON();break}}}}}return k}function XMLtoStr(a){if(window.ActiveXObject){return a.get(0).xml}return new XMLSerializer().serializeToString(a.get(0))}function Cmd_EncodeData_Extend(e,d,h,k,l){l=$.trim(l);if(l.substr(0,5).toLowerCase()=="<?xml"){if(l.substr(l.length-7,7)=="</data>"){l=l.substr(0,l.length-7)}else{l=""}}else{l=""}var n=Cmd_EncodeData(e,d,h,k,undefined);var a,b;if(l.length>0){var j=n.match(/<data>[\s\S]*<\/data>/im);if(j){j=j[0].substr(6,j[0].length-13);do{a=j.indexOf("<");if(a>=0){b=j.indexOf(">");if(b>=0){var m=j.substr(a+1,b-a-1);var g=m;if(g.indexOf(" ")>=0){g=g.substr(0,g.indexOf(" "))}j=j.substr(b+1);if(m.substr(m.length-1,1)!="/"){a=j.indexOf("</"+g+">");if(a>=0){var f=j.substr(0,a);j=j.substr(a+g.length+3);a=l.indexOf("<"+(g=="instances"?m+">":g));if(a>=0){b=l.indexOf("</"+g+">");if(b>=0){l=l.substr(0,a)+"<"+m+">"+f+"</"+g+">"+l.substr(b+g.length+3)}}else{a=0;l+="<"+m+">"+f+"</"+g+">\n"}}}}}}while(a>=0)}n=l+"</data>"}return n}function RipString(b,g){var e=b[0];var d="";var f=false;for(var h=0;h<e.length;h++){if(e.charAt(h)=="\\"){h++;if(g&&((e.charAt(h)=="'")||(e.charAt(h)=="\\"))){d+="\\"}d+=e.charAt(h)}else{if(e.charAt(h)=="'"){d+=e.charAt(h);if(!f){f=true}else{b[0]=e.substr(h+1);b[1]=d;return}}else{d+=e.charAt(h)}}}b[0]="";b[1]="''"}function RipNumber(b){var e=b[0];var d="";for(var f=0;f<e.length;f++){if(((e.charCodeAt(f)>=48)&&(e.charCodeAt(f)<=57))||(e.charAt(f)==".")||(e.charAt(f)=="-")){d+=e.charAt(f)}else{b[0]=e.substr(f);b[1]=d;return}}b[0]="";b[1]=d}function RipArray(d){var f=d[0];var e="";var g=0;for(var h=0;h<f.length;h++){if(f.charAt(h)=="'"){var b=[f.substr(h),""];RipString(b,true);e+=b[1];f=b[0];h=-1}else{if(f.charAt(h)=="["){g++;e+=f.charAt(h)}else{if(f.charAt(h)=="]"){g--;e+=f.charAt(h);if(g<=0){d[0]=f.substr(h+1);d[1]=e;return}}else{e+=f.charAt(h)}}}}d[0]="";d[1]=e}function DecodeDataFromNode(u,z,h,b){if(z.nodeType!=1){return}var d=z.nodeName;var w,y,A;if(d=="instances"){w=z.childNodes;for(y=0;y<w.length;y++){A=w[y];if(A.nodeType==1){DecodeDataFromNode(u,A,h,b)}}}else{if(d=="instance"){var e=z.attributes.getNamedItem("dlg");if(!e){hardError("@DecodeData input message : dlg attribute missing from instance tag");return}e=e.value;var r=z.attributes.getNamedItem("sub");if(!r){hardError("@DecodeData input message : sub attribute missing from instance tag");return}r=r.value;var C=dictionary.GetObjectByName(e);if(!C){hardError("@DecodeData input message : Unknown object name ["+e+"]");return}var g=dictionary.GetObjectByName(r);if(!g){hardError("@DecodeData input message : Unknown object name ["+r+"]");return}var a=((C.aType==TYPE_LIST)&&C.flatProps&&(C.flatProps.selectionmode=="Tree Dialog"));if((C.aType!=TYPE_DIALOG)&&!a){hardError("@DecodeData input message : Dialog expected ["+e+"]");return}var m=C.addSubDlgInstance(g.aID);if(m==-1){hardError("@DecodeData input message : Unknown sub-dialog name ["+C.aName+"."+g.aName+"]");return}var l=C.GetDialogInstObject(g.aID).dialogs;var q=l[m];C=dictionary.GetObject(q.aID,true);C.PushInstanceRef(q);q.assignAttInstancesToDictinary();w=z.childNodes;for(y=0;y<w.length;y++){A=w[y];if(A.nodeType==1){if(A.nodeName=="instance"||A.nodeName=="instances"){DecodeDataFromNode(q,A,h,b)}else{var t=dictionary.GetObjectByName(A.nodeName,true);if(!t){hardError("@DecodeData input message : Unknown dialog attribute name ["+A.nodeName+"]");return}if(t.aID==q.aID){SetValueFromXML(t,A)}else{var f=q.GetDialogInstObject(t.aID);if(!f){hardError("@DecodeData input message : Dialog does not contain instance of ["+A.nodeName+"]");return}SetValueFromXML(t,A)}}}}q.revertAttInstancesToDictinary();C.PopInstanceRef()}else{var k=dictionary.GetObjectByName(d,true);if(!k){throw new inferenceIssue(PASSBACK_ERROR,"@DecodeData input message : Unknown object name ["+d+"]",d)}var p=true;if(b){if(b!=k.aID){p=false}}if(p){if(!h&&k.flatProps){for(var B=0;B<z.attributes.length;B++){y=z.attributes.item(B);w=y.name;if(k.flatProps[w]!==undefined){var j=y.value;switch(typeof k.flatProps[w]){case ("number"):k.flatProps[w]=parseFloat(j);break;case ("string"):k.flatProps[w]=j;break;case ("boolean"):k.flatProps[w]=(j.toLowerCase()=="true");break}replayProtection.set(k,true)}}}var x=z.attributes.getNamedItem("dim");if(x){x="["+x.value+"]"}SetValueFromXML(k,z,x)}}}}function Cmd_DecodeDataXML(l,p,b,f){if(l.length===0){return}var r,j=null;try{r=$.parseXML(l)}catch(m){j="XML parser exception";if(m.hasOwnProperty("message")){j+=" : "+m.message}else{if(typeof m=="string"){j+=" : "+m}}}if(!j&&(!r||!r.documentElement||r.documentElement.nodeName=="parsererror")){j=(!r||!r.documentElement?"No Parser":r.documentElement.textContent)}if(j){if(p!=0){if(p==-1){return j}dictionary.GetObject(p).SetValue(j);return}else{hardError("@DecodeDataXML input message : Parse Error\n\n"+j);return}}var d="";var h=r.documentElement.childNodes;for(var k=0;k<h.length;k++){var g=h[k];if(g.nodeType==1){try{DecodeDataFromNode(null,g,f,b)}catch(m){if(p!=0){var q="";q=m.aValue;var o=q.split(":",2);if(o.length>=2){q=o[1]}o=q.split("[",2);if(o.length>=2){q=$.trim(o[0])}g.setAttribute("error",q);q=g.xml?g.xml:(new XMLSerializer()).serializeToString(g);d+=q+"\n"}}}}if(p!=0){if(d.length>0){d="<?xml version='1.0' encoding='ISO-8859-1' ?>\n<errors>\n"+d+"</errors>"}if(p==-1){return d}dictionary.GetObject(p).SetValue(d)}}function Cmd_DecodeData(aStr,xmlFlag,errObjID,singleObjID){if(xmlFlag){return Cmd_DecodeDataXML(aStr,errObjID,singleObjID)}var i=0;var s="";var o=null;var v=null;var a=[];var errStr="";if(aStr==undefined){return}while(aStr.length>0){i=aStr.indexOf("=");if(i==-1){hardError("= expected in DecodeData string ["+aStr+"]");return}s=aStr.substr(0,i);o=dictionary.GetObjectByName(s);if(!o){if(errStr.length>0){errStr+=" , "}errStr+=s}s=aStr.substr(i+1);a=[s,""];var ty="";if((s.charAt(0)==",")||(s.length==0)){ty="blank"}else{if(s.charAt(0)=="'"){RipString(a);s=a[0];v=a[1];if((v.charAt(v.length-1)!="'")||(v.length<2)){hardError("Unterminated string in DecodeData ["+aStr.substr(i+1)+"]");return}v=v.substr(1,v.length-2);ty="string"}else{if(s.charAt(0)=="["){RipArray(a);s=a[0];v=a[1];ty="array"}else{if(isNaN(Number(a[0]))){i=a[0].indexOf(",");if(i==-1){s="";v=a[0]}else{s=a[0].substr(i);v=a[0].substr(0,i)}ty="string"}else{RipNumber(a);s=a[0];v=a[1];if(!IsNumber(v)){hardError("Not a number ["+s+"]");return}if(v.indexOf(".")==-1){v=parseInt(v,10)}else{v=parseFloat(v)}if((o.aType==TYPE_LIST)||(o.aType==TYPE_BOOLEAN)||(o.aType==TYPE_TEXT)){ty="string"}else{ty="number"}}}}}if(o){if((singleObjID==0)||(singleObjID==o.aID)){if(ty==="blank"){o.Clear()}else{if((o.aType==TYPE_LIST)||(o.aType==TYPE_BOOLEAN)){if(ty==="string"){if(v===""){v=PSEUDO_VALUE_EMPTY}o.SetValueAsString(v,",",true)}else{o.SetValue(eval(v))}}else{if((o.aType==TYPE_NUMERIC)||(o.aType==TYPE_DATE)||(o.aType==TYPE_TEXT)){o.SetValue(v)}else{if(o.aType==TYPE_VARIABLE){o.SetValueAsJSON(v)}}}}}}if(s.charAt(0)==","){aStr=s.substr(1)}else{aStr=""}}if(errStr.length>0){if(errObjID!=0){if(errObjID==-1){return errStr}dictionary.GetObject(errObjID).SetValue(errStr)}else{hardError("Unknown object(s) in DecodeData string ["+errStr+"]");return}}}function Cmd_RunMode(){if(appEmbedded){return 7}else{if(appSettings.chatMode){if(typeof chat_mode=="string"&&(chat_mode=="browser")){return 10}else{return 11}}else{if(NODEJS){if(appSettings.f9){return 9}else{return 8}}else{if((document.location.protocol=="http:")||(document.location.protocol=="https:")){if(appSettings.f9){return 5}else{return 6}}else{return 5}}}}}function IntToHex(e,a,d){var b=Cmd_ToHexString(e);if(d){while(b.length<a){b+="0"}}else{while(b.length<a){b="0"+b}}return b}function Cmd_RGB(e,d,a){return IntToHex(e,2)+IntToHex(d,2)+IntToHex(a,2)}function addslashes(a){a=a.replace(/\'/g,"\\'");a=a.replace(/\"/g,'\\"');a=a.replace(/\\/g,"\\\\");a=a.replace(/\0/g,"\\0");return a}function stripslashes(a){a=a.replace(/\\'/g,"'");a=a.replace(/\\"/g,'"');a=a.replace(/\\\\/g,"\\");a=a.replace(/\\0/g,"\0");return a}function Cmd_XMLfetch(b,a,e){var d=replayStack.PopReplay(b.aID);if(d==REPLAYPOP_HANDLED){return true}else{if(d==REPLAYPOP_CURRENT){ServerCall(b.aID,"method=XMLFETCH&url="+escape(a)+"&varok="+e);return false}else{hardError("Unknown replay pop return ["+d+"]");return}}}function Cmd_XMLdb(b,a,e,g,f){var d=replayStack.PopReplay(b.aID);if(d==REPLAYPOP_HANDLED){return true}else{if(d==REPLAYPOP_CURRENT){ServerCall(b.aID,"method=XMLDB&file="+escape(a)+"&assign="+escape(g)+"&query="+escape(e)+"&varok="+f);return false}else{hardError("Unknown replay pop return ["+d+"]");return}}}function Cmd_XMLfetch_back(d,b){var a=dictionary.GetObjectByName(d);if(a){replayStack.Add(adHocObjectID,REPLAY_SET,a.aID,b)}}function Cmd_XRdoc(k,b,g,j){var a=replayStack.PopReplay(k.aID);if(a==REPLAYPOP_HANDLED){a=replayStack.PopReplay(k.aID);if(a==REPLAYPOP_HANDLED){return true}else{if(a==REPLAYPOP_CURRENT){var d="";var f="";var l;for(l=0;l<XRdocVars.length;l++){var n=XRdocVars[l];try{var m=Cmd_GetValue($.trim(n),true);n=n.replace(/\./g,"__");n=n.replace(/\[/g,"___");n=n.replace(/\]/g,"____");n=n.replace(/\ /g,"_____");d=d+"&"+n+"="+escape(m)}catch(h){if(f!=""){f+=","}f+=n}}if(f!=""){f="&errParam="+f}if(typeof j!="string"){j="DOCX"}else{j=j.toUpperCase()}if((j!="PDF")&&(j!="DOCX")){hardError("Unsupported return document type ["+j+"]");return}ServerCall(k.aID,"method=DOC&fname="+escape(b)+"&retURL="+escape(g)+d+f+"&doctype="+j);return false}else{hardError("Unknown replay pop return ["+a+"]");return}}}else{if(a==REPLAYPOP_CURRENT){ServerCall(k.aID,"method=DOCVARS&fname="+escape(b));return false}else{hardError("Unknown replay pop return ["+a+"]");return}}}function Cmd_XRdoc_vars_back(a){replayStack.Add(adHocObjectID,REPLAY_SYSTEMSET,0,a,"XRdocVars")}function Cmd_XRdoc_back(d,e){var f=dictionary.GetObjectByName(d);if(f){var b=e.split(",");replayStack.Add(adHocObjectID,REPLAY_SET,f.aID,b)}}function Cmd_XRdocpdf(g,j,f,d,b,e){var a=replayStack.PopReplay(g.aID);if(a==REPLAYPOP_HANDLED){return true}else{if(a==REPLAYPOP_CURRENT){b=dictionary.GetObject(b);var k="{";for(var h=1;h<=b.dim1;h++){if(b.GetValue(h,1)!=""){if(h>1){k+=","}k+="'"+b.GetValue(h,1)+"':'"+EncodeForDoubleQuotes(b.GetValue(h,2))+"'"}else{h=b.dim1}}k+="}";ServerCall(g.aID,"method=DOCPDF&uid="+escape(j)+"&pwd="+escape(f)+"&fname="+escape(d)+"&retURL="+escape(e)+"&vars="+escape(k));return false}else{hardError("Unknown replay pop return ["+a+"]");return}}}function Cmd_XRdocpdf_back(a,b){var d=dictionary.GetObjectByName(a);if(d){replayStack.Add(adHocObjectID,REPLAY_SET,d.aID,b)}}function Cmd_Ajax_Err(a){alert(a)}function Cmd_ExtCssFile(b,a){var d=replayStack.PopReplay(b.aID);if(d==REPLAYPOP_HANDLED){return true}else{if(d==REPLAYPOP_CURRENT){Set_ExtCssFile(a);replayStack.Add(b.aID,REPLAY_CRITICALDONE);replayStack.replayPos=replayStack.aReplay.length;return true}else{hardError("Unknown replay pop return ["+d+"]");return}}}function Cmd_ExtJSFile(b,a){var d=replayStack.PopReplay(b.aID);if(d==REPLAYPOP_HANDLED){return true}else{if(d==REPLAYPOP_CURRENT){Set_ExtJSFile(a);replayStack.Add(b.aID,REPLAY_CRITICALDONE);replayStack.replayPos=replayStack.aReplay.length;return true}else{hardError("Unknown replay pop return ["+d+"]");return}}}function Cmd_XMLpost(b,f,a){var d=replayStack.PopReplay(b.aID);if(d==REPLAYPOP_HANDLED){return true}else{if(d==REPLAYPOP_CURRENT){var e=Cmd_EncodeData("",true,"xpertrule");ServerCall(b.aID,"method=XMLPOST&url="+escape(f)+"&dataXML="+escape(e)+"&varok="+a);return false}else{hardError("Unknown replay pop return ["+d+"]");return}}}function Cmd_FireEvent(b,a){if((b!=null)&&a&&(a!="")){if(a=="onupdate"){return b.FireEvent(EVENT_UPDATE)}if(a=="oncapture"){return b.FireEvent(EVENT_CAPTURE)}if(a=="onleave"){return b.FireEvent(EVENT_LEAVE)}}return false}function Cmd_InStr(d,a,e){var b=d.indexOf(a,e)-e+1;if(b<0){b=0}return b}var currentConditionalObj=null;function ConditionalStart(a){var b=replayStack.PopReplay(a.aID);if(b==REPLAYPOP_HANDLED){return false}else{if(b==REPLAYPOP_CURRENT){currentConditionalObj=a;return true}else{hardError("Unknown replay pop return ["+b+"]");return}}}function ConditionalEnd(a){currentConditionalObj=null;replayStack.Add(a.aID,REPLAY_CRITICALDONE);throw new inferenceIssue(PASSBACK_LOOP)}function GetValue(a){if(typeof(a)=="string"){a=dictionary.GetObjectByName(a)}if((a==undefined)||(a==null)){return null}if(a.aType==TYPE_LIST){return a.GetValueAsString()}else{return a.GetValue()}}function SetValue(b,g,f){if(typeof(b)=="string"){b=_dgobn(b)}if(!b){return false}if((typeof(g)=="string")&&((b.aType==TYPE_LIST)||(b.aType==TYPE_BOOLEAN))){var d=g;g=b.NameToID(d);if(g===0){var h="Unknown value ["+d+"] for attribute ["+b.aName+"]";if(f){softError(h)}else{hardError(h);return}}}b.SetValue(g);var a=0;if(currentConditionalObj){a=currentConditionalObj.aID}replayStack.Add(a,REPLAY_SET,b.aID,g);return true}function XR_Continue(){if(!currentConditionalObj){alert("Error : Continue called while not in non-blocking @Pause!")}else{replayStack.Add(currentConditionalObj.aID,REPLAY_OK);currentConditionalObj=null;Go()}}function XR_DlgAction(a){replayStack.Add(currentConditionalObj.aID,a);Go()}function Cmd_Pause(b,h){var d=replayStack.PopReplay(b.aID);if(d==REPLAYPOP_HANDLED){return false}else{if(d==REPLAYPOP_CURRENT){var j=false;var f=true;if(wrapperOptions){if(wrapperOptions.pauseCallback){j=true;currentConditionalObj=b;var a=wrapperOptions.pauseCallback(xpertrule,h);if(a===false){f=false}}}if(f){try{currentConditionalObj=b;window.external.pause(h);j=true}catch(g){}}if(!j){throw new inferenceIssue(PASSBACK_PAUSECMD,h,b.aID)}else{if(f){currentConditionalObj=null;replayStack.Add(b.aID,REPLAY_CRITICALDONE);throw new inferenceIssue(PASSBACK_LOOP)}else{throw new inferenceIssue(PASSBACK_WAIT)}}}else{hardError("Unknown replay pop return ["+d+"]");return}}}function Cmd_checkNumber(b){var e="";var d="-0123456789.";var a="";for(i=0;i<b.length;i++){e=b.charAt(i);if(d.indexOf(e)==-1){return(i+1)}if((e=="-")&&(a.indexOf("-")!=-1)){return(i+1)}if((e==".")&&(a.indexOf(".")!=-1)){return(i+1)}a+=(e)}return(0)}function Cmd_RestartPos(a){var b=replayStack.PopReplay(a.aID);if(b==REPLAYPOP_HANDLED){return true}else{if(b==REPLAYPOP_CURRENT){replayStack.Add(a.aID,REPLAY_RESTARTPOS);replayStack.replayPos=replayStack.aReplay.length}else{hardError("Unknown replay pop return ["+b+"]");return}}}function Cmd_Restart(b,a){currentDlg=0;replayStack.RestartRevert(a);return false}function GetIndent(a){var d="  ";var b="";for(var e=0;e<a;e++){b+=d}return b}function EscapeForXML(b){var a=ConvertForDisplay(b,false);var d=a.match(/[\s]/)!==null;if(d){a=b}return(d?"<![CDATA[":"")+a+(d?"]]>":"")}function GetValueForXML(g,e){var d="";switch(g.aType){case TYPE_DATE:d=g.GetValueAsString("YYYYMMDD");break;case TYPE_LIST:d=g.GetValueAsString(g.isMultiSel?"|":undefined);break;case TYPE_BOOLEAN:d=g.GetValueAsString(true);break;case TYPE_VARIABLE:d=g.GetValueAsJSON();break;case TYPE_NUMERIC:d=g.GetValueAsString(undefined,false);break;default:d=g.GetValueAsString()}d=EscapeForXML(d);if(e){var f;var b="";if(g.flatProps&&g.flatProps._xmlexport){for(f=0;f<g.flatProps._xmlexport.length;f++){b+=" "+g.flatProps._xmlexport[f]+"='"+HandleChars(g.flatProps[g.flatProps._xmlexport[f]])+"'"}}if(g.aValueProps&&g.aValueProps.general&&g.aValueProps.general._xmlexport){for(f=0;f<g.aValueProps.general._xmlexport.length;f++){var a=g.GetValueProp(g.aValueProps.general._xmlexport[f],-1);b+=" "+g.aValueProps.general._xmlexport[f]+"='"+HandleChars(a!==null?a:"")+"'"}}d="<"+g.aName+b+">"+d+"</"+g.aName+">"}return d}function BuildDialogMsg(j,d){var h;var g=GetIndent(d);var b=g+"<"+j.aName+">\n";var k=GetIndent(d+1);if(j.aDefinition.instanceatts){for(h=0;h<j.aDefinition.instanceatts.length;h++){var a=dictionary.GetObject(j.aDefinition.instanceatts[h].att);var f=j.GetDialogInstObject(j.aDefinition.instanceatts[h].att);if(a.aType==TYPE_DIALOG){for(var e=0;e<f.dialogs.length;e++){b+=BuildDialogMsg(f.dialogs[e],d+1)}}else{b+=k+GetValueForXML(f,true)+"\n"}}}b+=g+"</"+j.aName+">\n";return b}function Cmd_DialogInstanceData(f,b){if(!$.isArray(b)){if(b){b=[b]}else{b=[]}}if(b.length===0){b=baseDialogs}var e="<?xml version='1.0'?>\n";var a=0;e+="<data>\n";a++;var d;for(var h=0;h<b.length;h++){var g=dictionary.GetObject(b[h]);if(!g){hardError("Unknown dialog ID for @EncodeDialogXML ["+b[h]+"]");return}if(g.aType!=TYPE_DIALOG){e+=GetIndent(a)+"<"+g.aName+">"+GetValueForXML(g)+"</"+g.aName+">\n"}else{e+=BuildDialogMsg(g,a)}}e+="</data>\n";return e}function decodeDateFromYYYYMMDDstring(b,e){var f=parseInt(b.substr(e?8:6,2),10);var a=parseInt(b.substr(e?5:4,2),10);var g=parseInt(b.substr(0,4),10);if(isNaN(f)||(f<1)||(f>31)||isNaN(a)||(a<1)||(a>12)||isNaN(g)){return null}return new Date(Date.UTC(g,a-1,f,0,0,0))}function SetValueFromXML(g,d,f){if(d.childNodes.length>0){var b=d.childNodes[0].nodeValue;switch(g.aType){case TYPE_DATE:var a=decodeDateFromYYYYMMDDstring(b,true);if(a===null){softError("Invalid date ["+b+"]")}else{var e=a.getTime();g.SetValue(e/86400000)}break;case TYPE_VARIABLE:g.SetValueAsJSON(b);break;case TYPE_LIST:if(g.isMultiSel){g.SetValueAsString(b,"|");break}default:Cmd_SetValueAsStr(g.aName+(f?f:""),b,true)}}else{if(!f){Cmd_SetValueAsStr(g.aName,PSEUDO_VALUE_EMPTY)}}}function ExtractDialogMsg(h,b){if(b.nodeType!=1){return}var k=b.nodeName;var j=dictionary.GetObjectByName(k,true);if(!j){hardError("@DecodeDialogXML input message : Unknown object name ["+k+"]");return}if((j.aType!=TYPE_DIALOG)&&(!h)){SetValueFromXML(j,b);return}if(j.aType!=TYPE_DIALOG){hardError("@DecodeDialogXML input message : Dialog expected ["+k+"]");return}if(h!==null){var l=h.addSubDlgInstance(j.aID);if(l==-1){hardError("@DecodeDialogXML input message : Unknown sub-dialog name ["+h.aName+"."+k+"]");return}dlgArr=h.GetDialogInstObject(j.aID).dialogs;j=dlgArr[l];h.PushInstanceRef(j)}else{j.clearSubDlgInstances()}j.assignAttInstancesToDictinary();var d=b.childNodes;for(var g=0;g<d.length;g++){var e=d[g];if(e.nodeType==1){var a=dictionary.GetObjectByName(e.nodeName,true);if(!a){softError("@DecodeDialogXML input message : Unknown dialog attribute name ["+e.nodeName+"]");continue}if(a.aType==TYPE_DIALOG){ExtractDialogMsg(j,e)}else{var f=j.GetDialogInstObject(a.aID);if(!f){softError("@DecodeDialogXML input message : Dialog does not contain instance of ["+e.nodeName+"]");continue}SetValueFromXML(a,e)}}}j.revertAttInstancesToDictinary();if(h!==null){h.PopInstanceRef()}}function Cmd_SetDialogInstanceData(b,k){var f,d=null;try{f=$.parseXML(k)}catch(g){d="XML parser exception";if(typeof g=="string"){d+=" : "+g}}if(!d&&(!f||!f.documentElement||f.documentElement.nodeName=="parsererror")){d=(!f||!f.documentElement?"No Parser":f.documentElement.textContent)}if(d){hardError("@DecodeDialogXML input message : Parse Error\n\n"+d);return}if(f.documentElement.nodeName=="data"){var j=f.documentElement.childNodes;for(var a=0;a<j.length;a++){var h=j[a];if(h.nodeType==1){ExtractDialogMsg(null,h)}}}else{ExtractDialogMsg(null,f.documentElement)}}function Cmd_PopupURL(b,e,d){var a=replayStack.PopReplay(0);if(a==REPLAYPOP_HANDLED){return true}else{if(a==REPLAYPOP_CURRENT){var f=window.open(b,"_blank",d);if(!f){hardError("Popup failed to open (maybe a popup blocker?)");return}if(e){f.document.title=e}if(window.focus){f.focus()}}else{hardError("Unknown replay pop return ["+a+"]");return}}}function Cmd_Redirect(a){window.location=a}var currentPhoneResultID=0;var currentPhoneResultType="string";var android_msg="";var MAX_ANDROID_LENGTH=2000;function Cmd_Phone(f,j,k,g){if(!appEmbedded&&(navigator.appVersion.indexOf("Win")!=-1)){if(!window.external){return}if(!$.isFunction(window.external.Notify)){return}}var h={};var a=replayStack.PopReplay(f.aID,false,h);if(a==REPLAYPOP_HANDLED){if(k==-1){return h.result}else{return true}}else{if(a==REPLAYPOP_CURRENT){adHocObjectID=f.aID;currentPhoneResultID=k;currentPhoneResultType="string";var b;if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))||(navigator.userAgent.match(/iPad/i))){var e="fake$"+j+"";for(b=0;b<g.length;b++){e+="$"+escape(g[b])}window.location=e}else{var d="<method>";d+="<name>"+j+"</name>";for(b=0;b<g.length;b++){d+="<param><![CDATA["+HandleChars2(g[b])+"]]></param>"}d+="</method>";if(navigator.appVersion.indexOf("Win")!=-1){if(!$.isFunction(window.external.Notify)){hardError("This deployment is designed to be used by Expert Advisor");return}window.external.Notify(d)}else{if(d.length<MAX_ANDROID_LENGTH){alert(d)}else{android_msg=d;Cmd_Phone_more()}}}throw new inferenceIssue(PASSBACK_WAIT,f.aID)}else{hardError("Unknown replay pop return ["+a+"]");return}}}function Cmd_Phone_more(){var a;if(android_msg.length<MAX_ANDROID_LENGTH){a="0"+android_msg;android_msg=""}else{a="1"+android_msg.substr(0,MAX_ANDROID_LENGTH);android_msg=android_msg.substr(MAX_ANDROID_LENGTH)}alert(a)}function Cmd_Phone_back(b){if(currentPhoneResultID!==0){b=b.replace(/\+/g," ");var a=unescape(b)+"";if(currentPhoneResultType=="boolean"){a=(a.toLowerCase()=="true")}if(currentPhoneResultID==-1){replayStack.Add(adHocObjectID,REPLAY_OBJRETURN,0,0,{result:a})}else{replayStack.Add(adHocObjectID,REPLAY_SET,currentPhoneResultID,a)}}replayStack.Add(adHocObjectID,REPLAY_CRITICALDONE);Go()}function Cmd_PhoneFeature(e,h,a){var g="PhoneFeature";if(navigator.appVersion.indexOf("Win")!=-1){if(!window.external||!$.isFunction(window.external.Notify)){dictionary.GetObject(a).SetValueAsBool(false);return}}var f=replayStack.PopReplay(e.aID);var j={};f=replayStack.PopReplay(e.aID,false,j);if(f==REPLAYPOP_HANDLED){if(a==-1){return j.result}else{return true}}else{if(f==REPLAYPOP_CURRENT){adHocObjectID=e.aID;currentPhoneResultID=a;currentPhoneResultType="boolean";if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))||(navigator.userAgent.match(/iPad/i))){var d="fake$"+g+"$"+h;window.location=d}else{var b="<method><name>"+g+"</name><param>"+h+"</param></method>";if(navigator.appVersion.indexOf("Win")!=-1){if(!$.isFunction(window.external.Notify)){hardError("This deployment is designed to be used by Expert Advisor");return}window.external.Notify(b)}else{alert(b)}}throw new inferenceIssue(PASSBACK_WAIT,e.aID)}else{hardError("Unknown replay pop return ["+f+"]");return}}}function Cmd_GetDeviceMetric(a){switch(a.toUpperCase()){case ("SCREEN_HEIGHT"):return $(window).height();case ("SCREEN_WIDTH"):return $(window).width()}return 0}function Cmd_Regex(g,f,h,e){var a=new RegExp(f,h);if(typeof e=="number"){var d=0;var b=dictionary.GetObject(e);var j,k;do{j=a.exec(g);if(j){k=j[0]}else{k=""}b.SetValue(k,++d,1);if(!a.global){j=false}}while(j)}else{return a.test(g)}}function Cmd_Split(d,f,h,e){var b=d.split(f);var g=dictionary.GetObject(h);g.SetValue(b);if(e){g=dictionary.GetObject(e);if(g){g.SetValue(b.length)}}return(b.length)}function Cmd_GetFlatNProp(b,a){return b.GetFlatProp(a)}function Cmd_GetFlatSProp(b,a){return b.GetFlatProp(a)}function Cmd_GetValNProp(b,a){return b.GetValueProp(a)}function Cmd_GetValSProp(b,a){return b.GetValueProp(a)}function Cmd_SetFlatNProp(d,a,b){return d.SetFlatProp(a,b)}function Cmd_SetFlatSProp(d,a,b){return d.SetFlatProp(a,b)}function Cmd_Rollup(k,f,e){var g=dictionary.GetObject(k);if(!g){return 0}var l=parseInt(e);var b,h;var a=function(o,q){var n=0;for(var u=0;u<o.length;u++){var p=o[u];if(p.selected()){if(q){var t=p.item;var m=t.GetValue();if(m&&((t.aType==TYPE_LIST)||(t.aType==TYPE_BOOLEAN))){if($.isArray(m)){for(var r=0;r<m.length;r++){b=t.ValueIDtoIndex(m[r]);h=0;if(t.aValues[b].hasOwnProperty(f)){h=t.aValues[b][f]}if((l==0)&&t.aValues[b].hasOwnProperty(e)){h*=t.aValues[b][e]}n+=h}}else{b=t.ValueIDtoIndex(m);h=0;if(t.aValues[b].hasOwnProperty(f)){h=t.aValues[b][f]}if((l==0)&&t.aValues[b].hasOwnProperty(e)){h*=t.aValues[b][e]}n+=h}}}if(p.children){n+=a(p.children,true)}}}return n};if(g.aType==TYPE_HIERARCHY){return a(g.tree,true)}else{var j=hierarchy.current();if(!j){return 0}var d=j.findNodeByObjId(k);if(!d){return 0}return a(d,false)}}function GetUncaptured(e){function f(h){var g,o,j,r,l;var p=[];var k=null;switch(h.aType){case NODETYPE_INLINE:g=dictionary.GetObject(h.aAttribute);if(g){k=g.GetValue();if(!k){p.push(g)}r=f(h.aSubTree);if($.isArray(r)){for(l in r){p.push(r[l])}}}break;case NODETYPE_SPLIT:g=dictionary.GetObject(h.aAttribute);if(g){p=[];if(!h.aProp){k=g.GetValue()}else{switch(h.aProp.aType){case TREE_PROP_FLAT:k=g.GetFlatProp(h.aProp.aName);break;case TREE_PROP_VALUE:k=g.GetProp(h.aProp.aID);break}if(typeof k=="boolean"){k=k?1:2}}var q=false;if(k){for(o=0;o<h.aBranches.length;o++){if(h.aBranches[o].aAttribute){var m=dictionary.GetObject(h.aBranches[o].aAttribute);if(!m){break}var n=m.GetValue();if(!n){break}if((g.aType==TYPE_LIST)||(g.aType==TYPE_BOOLEAN)){j=g.NameToID(m.GetValueAsString());if(j){h.aBranches[o].aValues=[j]}}else{h.aBranches[o].aThreshold=n}}if((g.aType==TYPE_LIST)&&g.isMultiSel){if(o>0){q=true}else{switch(h.aBranches[o].aComparitor){case"SUB":for(j=0;j<k.length;j++){if(!IsValueInBranch(h.aBranches[o],k[j])){break}}q=(j==k.length);break;case"SUP":for(j=0;j<h.aBranches[o].aValues.length;j++){if(!g.IsValueSelected(h.aBranches[o].aValues[j])){break}}q=(j==h.aBranches[o].aValues.length);break;case"INT":for(j=0;j<k.length;j++){if(IsValueInBranch(h.aBranches[o],k[j])){q=true;break}}break;case"=":if(k.length==h.aBranches[o].aValues.length){for(j=0;j<k.length;j++){if(!IsValueInBranch(h.aBranches[o],k[j])){break}}q=(j==k.length)}break;default:hardError("Unknown tree multi-sel list comparitor ["+h.aBranches[o].aComparitor+"] for attribute ["+g.aName+"] on tree ["+this.aName+"]");return}}}else{if((g.aType==TYPE_LIST)||(g.aType==TYPE_BOOLEAN)||(g.aType==TYPE_TEXT)){q=IsValueInBranch(h.aBranches[o],k);if(h.aBranches[o].aComparitor=="<>"){q=!q}}else{if((g.aType==TYPE_NUMERIC)||(g.aType==TYPE_DATE)){if(h.aProp){q=IsValueInBranch(h.aBranches[o],k)}else{switch(h.aBranches[o].aComparitor){case"<":if(k<h.aBranches[o].aThreshold){q=true}break;case">=":if(k>=h.aBranches[o].aThreshold){q=true}break;case"<=":if(k<=h.aBranches[o].aThreshold){q=true}break;case">":if(k>h.aBranches[o].aThreshold){q=true}break;case"=":if(k==h.aBranches[o].aThreshold){q=true}break;case"<>":if(k!=h.aBranches[o].aThreshold){q=true}break;default:hardError("Unknown tree numeric comparitor ["+h.aBranches[o].aComparitor+"] for attribute ["+g.aName+"] on tree ["+this.aName+"]");return}}}else{hardError("Unknown tree split type for attribute ["+g.aName+"] on tree ["+this.aName+"]");return}}}if(q){r=f(h.aBranches[o].aSubTree);if($.isArray(r)){for(l in r){p.push(r[l])}}break}}}else{p.push(g)}if(!q){for(o=0;o<h.aBranches.length;o++){r=f(h.aBranches[o].aSubTree);if($.isArray(r)){for(l in r){p.push(r[l])}}}}}break;default:if(h.aSubTree){r=f(h.aSubTree);if($.isArray(r)){for(l in r){p.push(r[l])}}}}return p}var b=[];if(e.aTree){var d=f(e.aTree);if($.isArray(d)){for(var a in d){if($.inArray(d[a].aName,d)==-1){b.push(d[a].aName)}}}}return b}var req=null;var adHocObjectID=0;function loadXMLDoc(b,f,h,g){if(adHocObjectID){return}adHocObjectID=g;var a=false;if(window.XMLHttpRequest){req=new XMLHttpRequest();req.onreadystatechange=processReqChange;try{req.open(h,b,true);req.setRequestHeader("Content-Type","application/x-www-form-urlencoded");if(h=="POST"){}req.send(f);a=true}catch(d){req=null;a=false}}if(!a){if(window.ActiveXObject){req=new ActiveXObject("Microsoft.XMLHTTP");if(req){document.onmousedown=DisableClick;req.onreadystatechange=processReqChange;req.open(h,b,true);req.setRequestHeader("Content-Type","application/x-www-form-urlencoded");if(h=="POST"){req.setRequestHeader("Content-length",f.length);req.setRequestHeader("Connection","close")}req.send(f)}}}}function processReqChange(){if(!req){return}if(req.readyState==4){if(req.status==200){if(req.responseText.length>0){eval(req.responseText)}ServerCalled();if(window.ActiveXObject){document.onmousedown=null}return true}else{if((req.status==0)&&(req.responseText)){if(req.responseText.length>0){eval(req.responseText)}if(window.ActiveXObject){document.onmousedown=null}return true}else{alert("Error retrieving data from server! ["+req.status+"]");return false}}}}function DemandLoad(g,e,h){var d="objects/id_"+g+".js";if(true){var a=document.getElementsByTagName("head")[0];var b=document.createElement("script");b.type="text/javascript";b.src=d;a.appendChild(b)}else{loadXMLDoc(d,"","GET")}if(!h){throw new inferenceIssue(PASSBACK_WAIT,g)}}function PopulateObject(e,d,b,a){if(typeof d=="boolean"){throw"This is a legacy knowledge base from a version which is un-importable"}var f=dictionary.GetObject(e,true);if(f==null){alert("AJAX callback unknown object ID ["+e+"]")}else{f.Populate(d,b,a)}}function PopulateBayes(b,a){var d=dictionary.GetObject(b);if(d==null){alert("AJAX callback unknown object ID ["+b+"]")}else{d.PopulateBayes(a)}}function PopulateProc(b,a){var d=dictionary.GetObject(b);if(d==null){alert("AJAX callback unknown object ID ["+b+"]")}else{if(!a){a=d.aName+"()"}d.Populate(a)}}function PopulateTextProcessor(b,a){var d=dictionary.GetObject(b);if(d==null){alert("AJAX callback unknown object ID ["+b+"]")}else{if(a){d.Populate(a)}else{d.Populate(d.aName+"()")}}}function PopulateReport(e,b,d,a){var f=dictionary.GetObject(e);if(f==null){alert("AJAX callback unknown object ID ["+e+"]")}else{if(!d){d=f.aName+"()"}f.Populate(b,d,a)}}function PopulateHierarchy(b,a){var d=dictionary.GetObject(b);if(d==null){alert("AJAX callback unknown object ID ["+b+"]")}else{d.Populate(a)}}function PopulateDialog(b,a,e){var d=dictionary.GetObject(b);if(d==null){alert("AJAX callback unknown object ID ["+b+"]")}else{d.Populate(a,e)}}function PopulateCTable(d,b,a){var e=dictionary.GetObject(d);if(e==null){alert("AJAX callback unknown object ID ["+d+"]")}else{e.Populate(b,a)}}function ServerCall(objectID,postData){$.ajax({async:true,data:postData,dataType:"html",success:function(r){if(r.length>0){eval(r)}if(objectID){replayStack.Add(objectID,REPLAY_OK)}Go()},timeout:30000,type:"POST",url:"ajax.php"})}function ServerCalled(a){if(!a){if(adHocObjectID==0){return}a=adHocObjectID;adHocObjectID=0}if(a){replayStack.Add(a,REPLAY_OK)}Go()}function DictionaryObject(d,e,a,b){this.aID=d;this.aName=(e.substring(0,1)=="~"?e.substring(1):Handle(e));this.aType=a;this.objInfo=b;this.flatProps=null;this.props=null;this.aText=this.aName;this.aTree=null;this.aExamples=null;this.aPolicyRules=null;this.loaded=false;this.loadedFlatProps=null;this.staticData=false;this.promptFor=true;this.isDataFull=false;this.instancePtr=null;this.encounteredOnHierarchy=false;this.hasSequenceNode=false;this.hitCount=0;this.bayesian=null;this.treeDialog=[];this.treeDialogHidden=[];this.treeDialogInitialStates=[];this.constraintDomain=0;this._hintprops=["aType","aName","val([newValue])","clear();","run();","isEmpty()","props","prop(controlPropName[, newValue])","nValues","value([valueIndex])","inst(valuePropName[, valueIndex[, newValue]])","clearInstances();","addInstance(newValueName[, newValueProperties]);","addInstances(newValueArray);","delInstance(valueIndex);","parentObj();"]}DictionaryObject.prototype.PushInstanceRef=function(a){if(this.instancePtr==null){this.instancePtr=[a]}else{this.instancePtr.unshift(a)}};DictionaryObject.prototype.GetInstanceRef=function(){if(this.instancePtr!=null){return this.instancePtr[0]}return this};DictionaryObject.prototype.ResetInstanceRef=function(){this.instancePtr=null;if(this.flatProps&&this.flatProps.instanceatts){for(var b=0;b<this.flatProps.instanceatts.length;b++){var a=dictionary.GetObject(this.flatProps.instanceatts[b].att,true);if(a){if((a.aType==TYPE_DIALOG)||(a.flatProps&&a.flatProps.instanceatts)){this.flatProps.instanceatts[b].data={current:0,dialogs:[]}}}}}};DictionaryObject.prototype.PopInstanceRef=function(){if(this.instancePtr==null){return null}var a=this.instancePtr.shift();if(this.instancePtr.length==0){this.instancePtr=null}return a};var lastInst=0;DictionaryObject.prototype.createAttInstances=function(){if(this.flatProps&&this.flatProps.instanceatts){for(var d=0;d<this.flatProps.instanceatts.length;d++){var b=dictionary.GetObject(this.flatProps.instanceatts[d].att);if(b){var a=null;if(b.aType==TYPE_DIALOG){a={current:0,dialogs:[]}}else{if(b.flatProps&&b.flatProps.instanceatts){a={current:0,dialogs:[]}}else{if(this.isSubDialog){a=$.extend(true,{},b);a.aasInstanceNo=lastInst++;a.Clear(true);a.ResetInstanceRef()}else{a=null}}}this.flatProps.instanceatts[d].data=a}}}};DictionaryObject.prototype.GetDialogInstObject=function(a){if(this.flatProps&&this.flatProps.instanceatts){for(var b=0;b<this.flatProps.instanceatts.length;b++){if(this.flatProps.instanceatts[b].att==a){if(this.flatProps.instanceatts[b].data!=null){return this.flatProps.instanceatts[b].data}else{return dictionary.GetObject(a)}}}}return null};DictionaryObject.prototype.assignAttInstancesToDictinary=function(){if(this.flatProps&&this.flatProps.instanceatts&&this.isSubDialog){for(var d=0;d<this.flatProps.instanceatts.length;d++){var a=this.flatProps.instanceatts[d].data;if(a){var b=dictionary.GetObject(this.flatProps.instanceatts[d].att,true);if(b){b.PushInstanceRef(a)}}}}};DictionaryObject.prototype.revertAttInstancesToDictinary=function(){if(this.flatProps&&this.flatProps.instanceatts){for(var b=0;b<this.flatProps.instanceatts.length;b++){var a=dictionary.GetObject(this.flatProps.instanceatts[b].att,true);if(a){a.PopInstanceRef()}}}};DictionaryObject.prototype.addSubDlgInstance=function(d){var a=this.GetDialogInstObject(d);if(!aIns){return -1}var e=dictionary.GetObject(d,true);var b=$.extend(true,{},e);b.isSubDialog=true;b.createAttInstances();a.dialogs[a.dialogs.length]=b;return a.dialogs.length-1};DictionaryObject.prototype.runSubDlgInstance=function(e,d){var b=this.GetDialogInstObject(e);if(!b){return null}if((d<0)||(d>=b.dialogs.length)){hardError("Sub dialog instance index out of bounds ["+d+"] for "+this.aName+".?");return}var a=b.dialogs[d];b.current=d+1;var f=dictionary.GetObject(e,true);f.PushInstanceRef(a);if(a.Run()){f.PopInstanceRef();b.current=0;return true}return false};DictionaryObject.prototype.delSubDlgInstance=function(d,b){var a=this.GetDialogInstObject(d);if(!a){return null}if((b<0)||(b>=a.dialogs.length)){hardError("Sub dialog instance index out of bounds ["+b+"] for "+this.aName+".?");return}a.dialogs=a.dialogs.slice(0,b).concat(a.dialogs.slice(b+1));if(this.flatProps&&this.flatProps.instanceatts){for(var e=0;e<this.flatProps.instanceatts.length;e++){if(this.flatProps.instanceatts[e].att==d){this.flatProps.instanceatts[e].data=a}}}};DictionaryObject.prototype.Evaluate=function(){this.promptFor=true};DictionaryObject.prototype.SetPromptFor=function(a){this.promptFor=a};DictionaryObject.prototype.Reset=function(){if(this.loadedFlatProps){this.flatProps=$.extend(true,{},this.loadedFlatProps)}this.props=this.flatProps};DictionaryObject.prototype.GetDescription=function(d){var a=this.flatProps?this.flatProps:(this.props?this.props:null);if(a&&(typeof a.description=="string")){if(a.description.length>0){var b=a.description;b=LabelDecode(b,this,false);return b}}else{if(this.description&&(this.description.length>0)){return this.description}else{if(this.aDefinition&&this.aDefinition.description&&(this.aDefinition.description.length>0)){return this.aDefinition.description}}}if(d){return this.aName}return""};DictionaryObject.prototype.Clear=function(){this.isDataFull=false;this.Evaluate()};DictionaryObject.prototype.clear=function(){this.Clear();return this};DictionaryObject.prototype.evaluate=function(){this.Evaluate();return this};DictionaryObject.prototype.isFull=function(){return this.isDataFull};DictionaryObject.prototype.TypeAsStr=function(){switch(this.aType){case TYPE_LIST:return"List";case TYPE_NUMERIC:return"Numeric";case TYPE_BOOLEAN:return"Boolean";case TYPE_DATE:return"Date";case TYPE_PROCEDURE:return"Procedure";case TYPE_REPORT:return"Report";case TYPE_DIALOG:return"Dialog";case TYPE_VARIABLE:return"Variable";case TYPE_TEXT:return"Text";default:return"Unknown"}};DictionaryObject.prototype.toString=function(){this.Load();return"Name: "+this.aName+"\nId: "+this.aID+"\nType: "+this.TypeAsStr(this)};DictionaryObject.prototype.Populate=function(h,g){this.loaded=true;if(h&&h.hasOwnProperty("pid")&&h.pid){var f=dictionary.GetObject(h.pid);var d;if(f){d=$.extend(true,{},f.loadedFlatProps)}else{d={}}for(var j in h){d[j]=h[j]}h=d}for(var j in h){if(j.substr(0,1)=="~"){var b=Handle2(j);h[b]=h[j];delete h[j];if(typeof h[b]=="string"){h[b]=Handle2(h[b])}}}this.flatProps=h;this.props=this.flatProps;if(h){this.loadedFlatProps=$.extend(true,{},h)}var a=false;if(g){if(g.version){if(g.version==1){this.aExamples=g.examples;this.aTree=g.tree;this.aPolicyRules=g.policyRules}a=true}}if(!a){if(g){if(g.cases){this.aExamples=g}if(g.dOutcome){this.aPolicyRules=g}}if(!this.aExamples&&!this.aPolicyRules){this.aTree=g}}if(this.aTree){function e(l){if(l.aType==NODETYPE_SEQUENCE){return true}if($.isArray(l.aBranches)){for(var k=0;k<l.aBranches.length;k++){if(l.aBranches[k].aSubTree){if(e(l.aBranches[k].aSubTree)){return true}}}}return false}this.hasSequenceNode=e(this.aTree)}else{this.hasSequenceNode=false}};DictionaryObject.prototype.toObject=function(){var a={aID:this.aID,aName:this.aName,aType:this.aType,objInfo:this.objInfo};if((this.aType==TYPE_LIST)||(this.aType==TYPE_NUMERIC)||(this.aType==TYPE_DATE)||(this.aType==TYPE_BOOLEAN)||(this.aType==TYPE_TEXT)){a.flatProps=this.flatProps;a.tree={version:1,examples:this.aExamples,policyRules:this.aPolicyRules,tree:this.aTree}}if(this.hasOwnProperty("aValues")){a.aValues=this.aValues.slice(0);for(var b=0;b<a.aValues.length;b++){a.aValues[b]=$.extend(true,{},a.aValues[b]);delete a.aValues[b].id;delete a.aValues[b].aText;delete a.aValues[b].valid;delete a.aValues[b].evalid}}if(this.hasOwnProperty("aValues")&&this.hasOwnProperty("aValueProps")){a.values={values:this.aValues,props:this.aValueProps}}if(isEditor){if(this.aTree){xrkb_tree.eachNode(this,true,function(d){if($.isPlainObject(d.draw)){delete d.draw}})}}if(this.hasOwnProperty("events")){a.events=this.events}if(this.hasOwnProperty("_classPrivs")){a._classPrivs=this._classPrivs}return a};DictionaryObject.prototype.PopulateBayes=function(a){this.bayesian=a};DictionaryObject.prototype.Load=function(){this.Populate(null);return true};DictionaryObject.prototype.GetValue=function(){return null};DictionaryObject.prototype.SetValue=function(){replayProtection.set(this);this.Load();this.promptFor=false;this.isDataFull=true};DictionaryObject.prototype.GetFlatProp=function(b){this.Load();var a=b.toLowerCase();if(a=="isempty"){return this.IsEmpty()}if(a=="treedialog"){return this.TreeDialogAsXML()}if(this.flatProps){if(this.flatProps.hasOwnProperty(b)){return this.flatProps[b]}if(this.flatProps.hasOwnProperty(a)){return this.flatProps[a]}}return null};DictionaryObject.prototype.SetFlatProp=function(a,b){if(this.GetFlatProp(a)!=null){a=a.toLowerCase();if(a=="isempty"){hardError("Cannot assign to read only property : "+this.aName+"."+a);return}if(typeof(b)=="string"){if(typeof this.flatProps[a]=="boolean"){b=(b.toLowerCase()=="true")}else{if(typeof this.flatProps[a]=="number"){b=parseFloat(b)}}}this.flatProps[a]=b;return true}return false};DictionaryObject.prototype.GetProp=function(d,a){this.Load();if(typeof d=="string"){var b=this.GetFlatProp(d);if(b){return b}if((this.aType==TYPE_LIST)||(this.aType==TYPE_BOOLEAN)){if(a==null){a=-1}return this.GetValueProp(d,a)}}else{if(a==null){a=-1}return this.GetValueProp(d,a)}return null};DictionaryObject.prototype.SetProp=function(b,d,a){if(this.SetFlatProp(b,d)){return true}if(this.aType==TYPE_LIST){if(a==null){a=-1}return this.SetValuePropIndex(b,a,d)}return false};DictionaryObject.prototype.SetValueAsString=function(){};DictionaryObject.prototype.GetValueAsString=function(){return""};DictionaryObject.prototype.GetValueProp=function(){return null};DictionaryObject.prototype.findValueProp=function(a){if(this.aValueProps){for(var b=0;b<this.aValueProps.list.length;b++){if(this.aValueProps.list[b].aID==a){return this.aValueProps.list[b]}}}return null};DictionaryObject.prototype.getDisplayOrder=function(){var a=[];var d=0;var e,b;do{b=10000;for(e=0;e<this.aValueProps.list.length;e++){if((this.aValueProps.list[e].display>d)&&(this.aValueProps.list[e].display<b)){b=this.aValueProps.list[e].display}}if(b<10000){for(e=0;e<this.aValueProps.list.length;e++){if(this.aValueProps.list[e].display==b){a.push(e)}}d=b}}while(b!=10000);for(e=0;e<this.aValueProps.list.length;e++){if(this.aValueProps.list[e].display==-1){a.push(e)}}if(a.length==0){a.push(0)}return a};DictionaryObject.prototype.IsEmpty=function(a){if(this.isDataFull){return false}else{if(a&&this.flatProps&&this.flatProps.defaultmode=="UseDefault"){return false}}return true};DictionaryObject.prototype.isEmpty=function(a){return this.IsEmpty(a)};DictionaryObject.prototype.IsEmptyAsString=function(){if(this.IsEmpty()){return"True"}return"False"};function IsValueInBranch(a,b){if(a.aValues){for(var d=0;d<a.aValues.length;d++){if(a.aValues[d]==b){return true}}}return false}function DoTreeReport(d,e,a){var b=replayStack.PopReplay(d);if(b==REPLAYPOP_HANDLED){return true}else{if(b==REPLAYPOP_CURRENT){throw new inferenceIssue(PASSBACK_PAUSETREEPAGE,a,d)}else{if(b==REPLAYPOP_STOP){return false}}}hardError("Unknown replay pop return ["+b+"]");return}function IDtoNode(a,b){if(a.aID==b){return a}else{switch(a.aType){case NODETYPE_INLINE:case NODETYPE_PAGE:case NODETYPE_LABEL:return IDtoNode(a.aSubTree,b);case NODETYPE_PROC:if($.isPlainObject(a.aSubTree)){return IDtoNode(a.aSubTree,b)}if(!$.isArray(a.aBranches)){return null}case NODETYPE_SPLIT:case NODETYPE_SEQUENCE:for(var e=0;e<a.aBranches.length;e++){var d=IDtoNode(a.aBranches[e].aSubTree,b);if(d){return d}}}}return null}DictionaryObject.prototype.AssignViaSelectionRule=function(d,e){this.Load();if(!this.flatProps){return false}if(!this.flatProps.selectionrule){return false}if(!this.flatProps.selectionrule.mode){return false}var b=true;for(var j=0;(j<this.flatProps.selectionrule.rules.length)&&b;j++){var g=dictionary.GetObject(this.flatProps.selectionrule.rules[j].att);if(g&&g.IsEmpty()){replayStack.formTreeSet(g)}if(g){if(g.IsEmpty()){if(e){d.ExtendTreeDialog(g);return true}else{if(!g.Run()){return false}}}if(e){if($.inArray(g.aID,d.treeDialogInitialStates)>-1){d.ExtendTreeDialog(g)}}switch(g.aType){case TYPE_LIST:var a=g.GetValue();if($.isArray(a)){b=false}else{var f=false;for(var h=0;h<this.flatProps.selectionrule.rules[j].val.length;h++){if(this.flatProps.selectionrule.rules[j].val[h]==a){f=true;break}}if(!f){b=false}}break;case TYPE_BOOLEAN:if(g.GetValueAsBool()!=this.flatProps.selectionrule.rules[j].val){b=false}break}}}if(this.flatProps.selectionrule.mode!="include"){b=!b}if(!b){if((this.aType==TYPE_BOOLEAN)&&!this.flatProps.selectionrule.failvalueid){this.SetValueAsBool(false)}else{if(this.flatProps.selectionrule.failvalueid){this.SetValue(this.flatProps.selectionrule.failvalueid)}}return true}return false};DictionaryObject.prototype.InitTreeDialog=function(){this.treeDialog.splice(0,this.treeDialog.length);this.treeDialogHidden.splice(0,this.treeDialogHidden.length)};DictionaryObject.prototype.ExtendTreeDialog=function(b,a){var d;if(b==undefined){d=undefined}else{d=$.extend(true,{},b)}if(a){this.treeDialogHidden.push(d)}else{this.treeDialog.push(d)}};DictionaryObject.prototype.RenderTreeDialog=function(a){if(this.flatProps.grouppreviousanswers!=""){replayStack.formTreeShow(this.aID);treeDialogs.Render(this,this.treeDialog);throw new inferenceIssue(PASSBACK_WAIT)}else{var b=replayStack.PopReplay(this.aID);if(b==REPLAYPOP_HANDLED){return true}else{if(b==REPLAYPOP_CURRENT){treeDialogs.Render(this,this.treeDialog);throw new inferenceIssue(PASSBACK_WAIT)}else{if(b==REPLAYPOP_STOP){return false}else{hardError("Unknown replay pop return ["+b+"]");return}}}}};DictionaryObject.prototype.GoTree=function(aTree,aParams,aNode,asDialog,passedIncompleteObj,onlyBuild,moreSequences,passedSeq){if(asDialog===undefined){asDialog=false}if(moreSequences===undefined){moreSequences=false}if(passedSeq===undefined){passedSeq=false}var c,cc,aAttribute,assignedViaSelRule,o,aBranch,res;switch(aNode.aType){case NODETYPE_LEAF:var setLeaf=false;if(!passedIncompleteObj.value&&!onlyBuild){if(aTree.isFull()){aTree.flatProps.previousvalue=aTree.val()}if(aTree.dmInfo&&$.isPlainObject(aNode.stats)){switch(aTree.aType){case TYPE_LIST:var domFq=0;var fq=0;for(c=0;c<aNode.stats.values.length;c++){fq+=aNode.stats.values[c].freq}for(c=0;c<aNode.stats.values.length;c++){aTree.aValues[aTree.ValueIDtoIndex(aNode.stats.values[c].aID)].prob=(fq==0?0:aNode.stats.values[c].freq/fq);if(aNode.stats.values[c].aID==aTree.aValues[0].aID){domFq=aNode.stats.values[c].freq}}var selValIdx;var domProb=(fq==0?0:domFq/fq);if(aTree.dmInfo.settings.hasOwnProperty("autoThreshold")){if(domProb>=aTree.dmInfo.settings.autoThreshold){selValIdx=0}else{selValIdx=1}}else{selValIdx=0}aTree.SetValue(aTree.aValues[selValIdx].aID);aTree.flatProps.prob=aTree.aValues[selValIdx].prob;break;case TYPE_NUMERIC:case TYPE_DATE:aTree.SetValue(aNode.stats.avg);aTree.flatProps.stddev=aNode.stats.stddev;break}if(aParams&&aParams.isFuzzy){aNode.fuzzyMv=aParams.fuzzyMv}}else{if(aNode.aStats){for(c=0;c<aNode.aStats.vals.length;c++){aTree.aValues[aTree.ValueIDtoIndex(aNode.aStats.vals[c].vid)].prob=aNode.aStats.vals[c].prob}}if(aNode.aOutcome!=EMPTY_LEAF){if(aTree.isMultiSel){var vals=asDialog?aTree.GetValue():[];if($.isArray(aNode.aOutcome)){for(c=0;c<aNode.aOutcome.length;c++){if($.inArray(aNode.aOutcome[c],vals)==-1){vals.push(aNode.aOutcome[c])}}}else{if($.inArray(aNode.aOutcome,vals)<0){vals.push(aNode.aOutcome)}}aTree.SetMultiValue(vals,SETOP_ADD)}else{aTree.SetValue(aNode.aOutcome)}setLeaf=true}else{if(aTree.isMultiSel){if(!asDialog&&!passedSeq){aTree.Clear()}aTree.SetPromptFor(false)}else{if(aTree.isFull()){aTree.SetPromptFor(false)}}}}aTree.flatProps.leafid=aNode.aID}if(asDialog){if((aTree.aID==this.aID)&&(!moreSequences||setLeaf)){if(this.flatProps.grouppreviousanswers==""){this.ExtendTreeDialog(undefined);if(!onlyBuild){this.RenderTreeDialog(aAttribute)}}if(!onlyBuild){for(c=0;c<this.treeDialogInitialStates.length;c++){var captured=false;for(cc=0;cc<this.treeDialog.length&&!captured;cc++){if(this.treeDialog[cc]&&(this.treeDialogInitialStates[c]==this.treeDialog[cc].aID)){captured=true}}for(cc=0;cc<this.treeDialogHidden.length&&!captured;cc++){if(this.treeDialogHidden[cc]&&(this.treeDialogInitialStates[c]==this.treeDialogHidden[cc].aID)){captured=true}}if(!captured){o=dictionary.GetObject(this.treeDialogInitialStates[c]);if(!o.IsEmpty()){o.Clear()}}}}}}break;case NODETYPE_LEAFPROC:eval(aNode.aFunction+"()");if(!this.isFull()){hardError("Leaf expression does not assign an outcome ["+this.aName+"]");return}break;case NODETYPE_LEAFJUMP:var n=IDtoNode(aTree.aTree,aNode.aJump);if(!n){hardError("Unknown Label jump on tree ["+this.aName+"]");return}if(!this.GoTree(aTree,aParams,n,asDialog,passedIncompleteObj,onlyBuild,moreSequences,passedSeq)){return false}break;case NODETYPE_INLINE:aAttribute=_dgo(aNode.aAttribute);if(aAttribute==null){hardError("Unknown Attribute ["+aNode.aAttribute+"] on tree ["+this.aName+"]");return}else{if(asDialog){if(aAttribute.aType==TYPE_DIALOG){if(!aAttribute.Load()){return false}this.ExtendTreeDialog(aAttribute);for(c=0;c<aAttribute.aObjectList.length;c++){o=_dgo(aAttribute.aObjectList[c]);if(o){if(!onlyBuild){replayStack.formTreeSet(o)}}}if(!replayStack.formTreeSet(aAttribute)&&(this.flatProps.grouppreviousanswers!="")&&!onlyBuild){this.RenderTreeDialog(aAttribute);return false}}else{if(aAttribute.aType==TYPE_REPORT){this.ExtendTreeDialog(aAttribute);if(!replayStack.formTreeSet(aAttribute)&&(this.flatProps.grouppreviousanswers!="")){if(!onlyBuild){this.RenderTreeDialog(aAttribute)}return false}}else{assignedViaSelRule=false;var calledTree=false;if(((aAttribute.aType==TYPE_LIST)||(aAttribute.aType==TYPE_BOOLEAN)||(aAttribute.aType==TYPE_NUMERIC)||(aAttribute.aType==TYPE_DATE)||(aAttribute.aType==TYPE_TEXT))&&aAttribute.aTree){if(!onlyBuild){aAttribute.Clear()}if(!this.GoTree(aAttribute,aParams,aAttribute.aTree,asDialog,{value:false},onlyBuild,false,false)){return false}calledTree=true}else{assignedViaSelRule=aAttribute.AssignViaSelectionRule(this,asDialog);if(((aAttribute.flatProps==null)||(aAttribute.flatProps.showontreedialog!==false))&&!assignedViaSelRule){this.ExtendTreeDialog(aAttribute)}if(aAttribute.flatProps&&!aAttribute.flatProps.showontreedialog){this.ExtendTreeDialog(aAttribute,true)}}if(!aAttribute.isFull()&&!replayStack.formTreeSet(aAttribute)&&!onlyBuild&&!assignedViaSelRule){aAttribute.FireEvent(EVENT_CAPTURE)}if(!aAttribute.isFull()&&!assignedViaSelRule&&!calledTree){if(!replayStack.formTreeSet(aAttribute)&&(this.flatProps.grouppreviousanswers!="")){if(!onlyBuild){this.RenderTreeDialog(aAttribute)}return false}if(!aAttribute.isFull()&&aAttribute.flatProps&&!aAttribute.flatProps.allowblank){passedIncompleteObj.value=true}}else{if(!onlyBuild){aAttribute.FireEvent(EVENT_LEAVE)}}}}}else{if(aParams&&aParams.exitOnEmpty){if($.isFunction(aAttribute.isFull)&&!aAttribute.isFull()&&!aAttribute.aTree&&!aAttribute.aExamples){if(!onlyBuild){aTree.Clear()}return true}}if($.isFunction(aAttribute.Run)){aAttribute.Run(aAttribute.aType==TYPE_PROCEDURE?undefined:aParams)}if(aParams&&aParams.exitOnEmpty){if($.isFunction(aAttribute.isFull)&&!aAttribute.isFull()){if(!onlyBuild){aTree.Clear()}return true}}}if(!this.GoTree(aTree,aParams,aNode.aSubTree,asDialog,passedIncompleteObj,onlyBuild,moreSequences,passedSeq)){return false}}break;case NODETYPE_PAGE:if(!DoTreeReport(this.aID,aNode.aID,aNode.aFunction)){return false}if(!this.GoTree(aTree,aParams,aNode.aSubTree,asDialog,passedIncompleteObj,onlyBuild,moreSequences,passedSeq)){return false}break;case NODETYPE_LABEL:if(!this.GoTree(aTree,aParams,aNode.aSubTree,asDialog,passedIncompleteObj,onlyBuild,moreSequences,passedSeq)){return false}break;case NODETYPE_PROC:try{var called=false;if(wrapperOptions.nodejs&&!isEditor){if($.isFunction(global[aNode.aFunction])){global[aNode.aFunction].apply(this);called=true}}else{if($.isFunction(window[aNode.aFunction])){window[aNode.aFunction].apply(this);called=true}}if(!called){res=eval("(function(){var cmdObj=_dgo("+aTree.aID+");\n"+aNode.aFunction+"\n})()")}}catch(e){if(!(e instanceof inferenceIssue)){hardError("An error was encountered!\n\nObject: "+this.aName+"\nLocation: Tree Procedure"+(lastErr?"\nLine "+lastErr.ln+"\nCommand: "+lastErr.cmd:"")+"\n\n"+e);return}else{throw e}}if($.isPlainObject(aNode.aSubTree)){if(!this.GoTree(aTree,aParams,aNode.aSubTree,asDialog,passedIncompleteObj,onlyBuild,moreSequences,passedSeq)){return false}break}if(!$.isArray(aNode.aBranches)){hardError("Invalid command node on tree ["+this.aName+"]")}if(typeof res!="number"){hardError("Branching command node does not return a value on tree ["+this.aName+"]")}case NODETYPE_SPLIT:aAttribute=aNode.aType==NODETYPE_PROC?{aType:TYPE_NUMERIC,aName:"Tree Proc"}:_dgo(aNode.aAttribute);if(aAttribute!=null){if(asDialog){var extended=false;assignedViaSelRule=false;if(((aAttribute.aType==TYPE_LIST)||(aAttribute.aType==TYPE_BOOLEAN))&&aAttribute.aTree){aAttribute.Clear();if(!this.GoTree(aAttribute,aParams,aAttribute.aTree,asDialog,{value:false},onlyBuild,false,false)){return false}}else{assignedViaSelRule=aAttribute.AssignViaSelectionRule(this,asDialog);if(((aAttribute.flatProps==null)||(aAttribute.flatProps.showontreedialog!==false))&&!assignedViaSelRule){if(aAttribute.flatProps.showontreedialog===false){aAttribute.flatProps.showontreedialog=true;aAttribute.loadedFlatProps.showontreedialog=true}extended=true;this.ExtendTreeDialog(aAttribute)}}if(!aAttribute.isFull()&&!replayStack.formTreeSet(aAttribute)&&!onlyBuild){aAttribute.FireEvent(EVENT_CAPTURE)}if(!aAttribute.isFull()){if(!replayStack.formTreeSet(aAttribute)){if(onlyBuild){return false}if(!this.RenderTreeDialog(aAttribute)){return false}if((this.flatProps.grouppreviousanswers=="")||!aAttribute.isFull()){return false}if(!extended){this.ExtendTreeDialog(aAttribute)}}else{if(extended&&(aAttribute.flatProps.showontreedialog===false)){alert("remove")}if(onlyBuild){return false}}}if(aAttribute.flatProps&&!aAttribute.flatProps.showontreedialog){this.ExtendTreeDialog(aAttribute,true)}if(!onlyBuild){aAttribute.FireEvent(EVENT_LEAVE)}}else{if(!$.isPlainObject(aNode.aProp)||(aNode.aProp.aName!="isempty")){if(aParams&&aParams.exitOnEmpty){if($.isFunction(aAttribute.isFull)&&!aAttribute.isFull()&&!aAttribute.aTree&&!aAttribute.aExamples){if(!onlyBuild){aTree.Clear()}return true}}if($.isFunction(aAttribute.isFull)&&!aAttribute.isFull()){for(c=0;c<aNode.aBranches.length;c++){if(aNode.aBranches[c].includeNulls){return this.GoTree(aTree,aParams,aNode.aBranches[c].aSubTree,asDialog,passedIncompleteObj,onlyBuild,moreSequences,passedSeq)}}}if($.isFunction(aAttribute.Run)&&!aAttribute.Run(aParams)){return false}if(aParams&&aParams.exitOnEmpty){if($.isFunction(aAttribute.isFull)&&!aAttribute.isFull()){if(!onlyBuild){aTree.Clear()}return true}}}}var attType=aAttribute.aType;if((attType==TYPE_LIST)&&aAttribute.isMultiSel){attType=TYPE_MLIST}var aValue=null;if(aNode.aProp){switch(aNode.aProp.aType){case TREE_PROP_FLAT:aValue=aAttribute.GetFlatProp(aNode.aProp.aName);break;case TREE_PROP_VALUE:var pr=aAttribute.findValueProp(aNode.aProp.aID);aValue=aAttribute.GetProp(aNode.aProp.aID);if(pr){switch(pr.aType){case"int":case"float":case"date":attType=TYPE_NUMERIC;break;case"bool":attType=TYPE_BOOLEAN;break}}break;default:hardError("Unknwon split property type ["+aNode.aProp.aType+"] on tree ["+this.aName+"]");return}if(typeof aValue=="boolean"){aValue=aValue?1:2}}else{aValue=aNode.aType==NODETYPE_PROC?res:aAttribute.GetValue()}if(aValue==null){hardError("Attribute ["+aAttribute.aName+"] has no value for split on tree ["+this.aName+"]");return}var aAttribute2;if((aNode.aBranches.length==2)&&aNode.aBranches[0].aAttribute){var aAttribute2=_dgo(aNode.aBranches[0].aAttribute);if(aAttribute2==null){hardError("Unknown object in object split on tree ["+this.aName+"]");return}if(!aAttribute2.Run()){return false}}var found=false;for(c=0;c<aNode.aBranches.length;c++){aBranch=aNode.aBranches[c];if(aBranch.aAttribute){aAttribute2=_dgo(aBranch.aAttribute);var aValue2;if(aBranch.aProp){switch(aBranch.aProp.aType){case TREE_PROP_FLAT:aValue2=aAttribute2.GetFlatProp(aBranch.aProp.aName);break;case TREE_PROP_VALUE:aValue2=aAttribute2.GetProp(aBranch.aProp.aID);break;default:hardError("Unknwon split property type ["+aBranch.aProp.aType+"] on tree ["+this.aName+"]");return}if(typeof aValue2=="boolean"){aValue2=aValue2?1:2}}else{aValue2=aAttribute2.GetValue()}if(aValue2==null){hardError("Attribute ["+aAttribute2.aName+"] has no value for (object) split on tree ["+this.aName+"]");return}aBranch=$.extend(false,{},aBranch);if((attType==TYPE_LIST)||(attType==TYPE_BOOLEAN)){cc=aAttribute.NameToID(aAttribute2.GetValueAsString());if(cc!==0){aBranch.aValues=[cc]}}else{aBranch.aThreshold=aValue2}}if(attType==TYPE_MLIST){if(c>0){found=true}else{switch(aBranch.aComparitor){case"SUB":for(cc=0;cc<aValue.length;cc++){if(!IsValueInBranch(aBranch,aValue[cc])){break}}found=(cc==aValue.length);break;case"SUP":for(cc=0;cc<aBranch.aValues.length;cc++){if(!aAttribute.IsValueSelected(aBranch.aValues[cc])){break}}found=(cc==aBranch.aValues.length);break;case"INT":for(cc=0;cc<aValue.length;cc++){if(IsValueInBranch(aBranch,aValue[cc])){found=true;break}}break;case"=":if(aValue.length==aBranch.aValues.length){for(cc=0;cc<aValue.length;cc++){if(!IsValueInBranch(aBranch,aValue[cc])){break}}found=(cc==aValue.length)}break;default:hardError("Unknown tree multi-sel list comparitor ["+aNode.aBranches[c].aComparitor+"] for attribute ["+aAttribute.aName+"] on tree ["+this.aName+"]");return}}}else{if((attType==TYPE_LIST)||(attType==TYPE_BOOLEAN)||(attType==TYPE_TEXT)){if(aBranch.hasOwnProperty("allValues")&&aBranch.allValues){found=true}else{found=IsValueInBranch(aBranch,aValue);if(aBranch.aComparitor=="<>"){found=!found}}}else{if((attType==TYPE_NUMERIC)||(attType==TYPE_DATE)){var oldMv;if(aParams&&aParams.isFuzzy){var aOtherBranch=aNode.aBranches[c==0?1:0];if(!aBranch.hasOwnProperty("avg")||!aOtherBranch.hasOwnProperty("avg")){hardError("Missing average value for split ["+aAttribute.aName+"] on fuzzy tree ["+this.aName+"]")}var a;if(!aBranch.hasOwnProperty("avg2")){var a=aBranch.avg;if(a<aBranch.aThreshold){aBranch.avg2=aBranch.aThreshold-((aBranch.aThreshold-a)/2)}else{aBranch.avg2=aBranch.aThreshold+((a-aBranch.aThreshold)/2)}}if(!aOtherBranch.hasOwnProperty("avg2")){var a=aOtherBranch.avg;if(a<aOtherBranch.aThreshold){aOtherBranch.avg2=aOtherBranch.aThreshold-((aOtherBranch.aThreshold-a)/2)}else{aOtherBranch.avg2=aOtherBranch.aThreshold+((a-aOtherBranch.aThreshold)/2)}}var mv;if(aBranch.aComparitor=="<"){if(aValue<aBranch.aThreshold){mv=1-((0.5/(aBranch.aThreshold-aBranch.avg2))*(aValue-aBranch.avg2))}else{mv=0.5-((0.5/(aOtherBranch.avg2-aBranch.aThreshold))*(aValue-aBranch.aThreshold))}}else{if(aValue<aBranch.aThreshold){mv=0+((0.5/(aBranch.aThreshold-aOtherBranch.avg2))*(aValue-aOtherBranch.avg2))}else{mv=0.5+((0.5/(aBranch.avg2-aBranch.aThreshold))*(aValue-aBranch.aThreshold))}}if(mv<0){mv=0}else{if(mv>1){mv=1}}oldMv=aParams.fuzzyMv;if(mv<aParams.fuzzyMv){aParams.fuzzyMv=mv}}else{if(aBranch.hasOwnProperty("allValues")&&aBranch.allValues){found=true}else{if(aBranch.hasOwnProperty("aValues")&&aBranch.aValues){found=(aValue==aBranch.aValues[0])}else{switch(aBranch.aComparitor){case"<":if(aValue<aBranch.aThreshold){found=true}break;case">=":if(aValue>=aBranch.aThreshold){found=true}break;case"<=":if(aValue<=aBranch.aThreshold){found=true}break;case">":if(aValue>aBranch.aThreshold){found=true}break;case"=":if(aValue==aBranch.aThreshold){found=true}break;case"<>":if(aValue!=aBranch.aThreshold){found=true}break;case"RNG":if((aValue>=aBranch.aThreshold)&&(aValue<=(aBranch.hasOwnProperty("aThreshold2")?aBranch.aThreshold2:aBranch.aThreshold))){found=true}break;case"RNG2":if((aValue>aBranch.aThreshold)&&(aValue<=(aBranch.hasOwnProperty("aThreshold2")?aBranch.aThreshold2:aBranch.aThreshold))){found=true}break;case"RNG3":if((aValue>=aBranch.aThreshold)&&(aValue<(aBranch.hasOwnProperty("aThreshold2")?aBranch.aThreshold2:aBranch.aThreshold))){found=true}break;case"RNG4":if((aValue>aBranch.aThreshold)&&(aValue<(aBranch.hasOwnProperty("aThreshold2")?aBranch.aThreshold2:aBranch.aThreshold))){found=true}break;case"NRNG":if((aValue<aBranch.aThreshold)||(aValue>(aBranch.hasOwnProperty("aThreshold2")?aBranch.aThreshold2:aBranch.aThreshold))){found=true}break;case"NRNG2":if((aValue<=aBranch.aThreshold)||(aValue>(aBranch.hasOwnProperty("aThreshold2")?aBranch.aThreshold2:aBranch.aThreshold))){found=true}break;case"NRNG3":if((aValue<aBranch.aThreshold)||(aValue>=(aBranch.hasOwnProperty("aThreshold2")?aBranch.aThreshold2:aBranch.aThreshold))){found=true}break;case"NRNG4":if((aValue<=aBranch.aThreshold)||(aValue>=(aBranch.hasOwnProperty("aThreshold2")?aBranch.aThreshold2:aBranch.aThreshold))){found=true}break;default:hardError("Unknown tree numeric comparitor ["+aBranch.aComparitor+"] for attribute ["+aAttribute.aName+"] on tree ["+this.aName+"]");return}}}}}else{hardError("Unknown tree split type for attribute ["+aAttribute.aName+"] on tree ["+this.aName+"]");return}}}if(found||(aParams&&aParams.isFuzzy)){if(!this.GoTree(aTree,aParams,aBranch.aSubTree,asDialog,passedIncompleteObj,onlyBuild,moreSequences,passedSeq)){return false}if(!aParams||!aParams.isFuzzy){break}else{aParams.fuzzyMv=oldMv}}}if(!found&&(!aParams||!aParams.isFuzzy)){hardError("Uncovered value ["+aValue+"] for attribute ["+aAttribute.aName+"] on tree ["+this.aName+"]");return}}else{hardError("Unknown Attribute ["+aNode.aAttribute+"] on tree ["+this.aName+"]");return}break;case NODETYPE_SEQUENCE:o=$.extend(true,{},passedIncompleteObj);for(c=0;c<aNode.aBranches.length;c++){if(!this.GoTree(aTree,aParams,aNode.aBranches[c].aSubTree,asDialog,o,onlyBuild,moreSequences||(c<aNode.aBranches.length-1),true)){return false}if(aTree.isFull()&&!aTree.isMultiSel&&!onlyBuild){break}}passedIncompleteObj.value=o.value;break;default:hardError("Unknown Node Type ["+aNode.aType+"] on tree ["+this.aName+"]");return}return true};DictionaryObject.prototype.GetTreeDialogCaptureList=function(){var a=this.treeDialog.slice();this.treeDialog=[];this.GoTree(this,null,this.aTree,true,{value:false},true,false,false);var f=[];for(var e=0;e<this.treeDialog.length;e++){if(this.treeDialog[e]!=undefined){if(this.treeDialog[e].aType==TYPE_DIALOG){for(var d=0;d<this.treeDialog[e].aDefinition.instanceatts.length;d++){var b=this.treeDialog[e].aDefinition.instanceatts[d].att;f.push({dlg:this.treeDialog[e],instID:b,cap:[b]})}}else{if($.inArray(this.treeDialog[e].aID,f)==-1){f.push(this.treeDialog[e].aID)}}}}this.treeDialog=a;return f};DictionaryObject.prototype.DoCell=function(aCell,multiValArr,aParams){function isValueInCell(aCell,vID){for(var c=0;c<aCell.values.length;c++){if(aCell.values[c]==vID){return true}}return false}var o,c,cc;switch(aCell.aType){case CASE_ALL:case CASE_DUMMY:case CASE_DESCRIPTION:return true;case CASE_VALUE:o=dictionary.GetObject(aCell.aID);if(!o){return false}if(!o.isFull()){if(aParams.exitOnEmpty){return false}if(!o.Run()){return false}}switch(aCell.aComparitor){case"<":return(o.GetValue()<aCell.value);case"<=":return(o.GetValue()<=aCell.value);case"=":return(o.GetValue()==aCell.value);case"<>":return(o.GetValue()!=aCell.value);case">":return(o.GetValue()>aCell.value);case">=":return(o.GetValue()>=aCell.value);case"RNG":return((o.GetValue()>=aCell.value)&&(o.GetValue()<=aCell.value2));case"RNG2":return((o.GetValue()>aCell.value)&&(o.GetValue()<=aCell.value2));case"RNG3":return((o.GetValue()>=aCell.value)&&(o.GetValue()<aCell.value2));case"RNG4":return((o.GetValue()>aCell.value)&&(o.GetValue()<aCell.value2));default:hardError("Unknown comparitor in cell ["+aCell.aComparitor+"] in cases ["+this.aName+"]");return}case CASE_VALUES:o=_dgo(aCell.aID);if(!o){return false}if(!o.isFull()){if(!o.Run(aParams)){return false}}var vID=o.GetValue();if(o.isMultiSel){var found=false;switch(aCell.aComparitor){case"SUB":case"NSUB":for(cc=0;cc<vID.length;cc++){if(!isValueInCell(aCell,vID[cc])){break}}found=(cc==vID.length);break;case"SUP":case"NSUP":for(cc=0;cc<aCell.values.length;cc++){if(!o.IsValueSelected(aCell.values[cc])){break}}found=(cc==aCell.values.length);break;case"INT":case"NINT":for(cc=0;cc<vID.length;cc++){if(isValueInCell(aCell,vID[cc])){found=true;break}}break;case"=":case"<>":if(vID.length==aCell.values.length){for(cc=0;cc<vID.length;cc++){if(!isValueInCell(aCell,vID[cc])){break}}found=(cc==vID.length)}break}switch(aCell.aComparitor){case"NSUB":case"NSUP":case"NINT":case"<>":found=!found;break}return found}else{for(cc=0;cc<aCell.values.length;cc++){if(vID==aCell.values[cc]){return(aCell.aComparitor=="=")||!aCell.hasOwnProperty("aComparitor")}}return aCell.aComparitor=="<>"}case CASE_ATTCOMP:o=dictionary.GetObject(aCell.aID);if(!o){return false}if(!o.isFull()){if(aParams.exitOnEmpty){return false}if(!o.Run()){return false}}var o2=dictionary.GetObject(aCell.aObjectID);if(!o2){return false}if(!o2.isFull()){if(aParams.exitOnEmpty){return false}if(!o2.Run()){return false}}var v1,v2;if((o.aType==TYPE_LIST)||(o.aType==TYPE_BOOLEAN)){v1=o.GetValueAsString()}else{v1=o.GetValue()}if((o2.aType==TYPE_LIST)||(o2.aType==TYPE_BOOLEAN)){v2=o2.GetValueAsString()}else{v2=o2.GetValue()}switch(aCell.aComparitor){case"<":return(v1<v2);case"<=":return(v1<=v2);case"=":return(v1==v2);case"<>":return(v1!=v2);case">":return(v1>v2);case">=":return(v1>=v2);case"RNG":case"RNG2":case"RNG3":case"RNG4":var o3=dictionary.GetObject(aCell.aObjectID2);if(!o3){return false}if(!o3.isFull()){if(aParams.exitOnEmpty){return false}if(!o3.Run()){return false}}var v3=o3.GetValue();return((v1>=v2)&&(v1<=v3));default:hardError("Unknown comparitor in cell ["+aCell.aComparitor+"] in cases ["+this.aName+"]");return}case CASE_SET_VALUES:if(multiValArr){for(c=0;c<aCell.values.length;c++){multiValArr[multiValArr.length]=aCell.values[c]}}else{if(aCell.values.length==0){this.Clear()}else{if(aCell.values.length==1){this.SetValue(aCell.values[0])}else{if(!this.isMultiSel){hardError("Cannot assign multi-values to outcome in cases ["+this.aName+"]");return}else{this.SetValue(aCell.values)}}}}if(aCell.cmds){eval(aCell.cmds)}break;case CASE_SET_VALUE:this.SetValue(aCell.value);if(aCell.cmds){eval(aCell.cmds)}break;default:hardError("Unknown Cell Type ["+aCell.aType+"] in cases ["+this.aName+"]");return}return true};DictionaryObject.prototype.GoExamples=function(b,d){var g=null;var l=0;var f=0;var j=-1;var e=[];var k;for(var a=0;a<b.cases.length;a++){g=b.cases[a];var h=false;for(k=0;k<g.length;k++){if((g[k].aType==CASE_DESCRIPTION)&&(g[k].disabled)){h=true}}if(h){continue}l=0;for(k=0;k<g.length;k++){if((g[k].aType==CASE_ALL)||(g[k].aType==CASE_DUMMY)){l++}else{if((g[k].aType==CASE_VALUES)||(g[k].aType==CASE_VALUE)||(g[k].aType==CASE_ATTCOMP)){if(!this.DoCell(g[k],undefined,d)){break}}else{if((this.isMultiSel)&&(g[k].aType==CASE_SET_VALUES)){this.DoCell(g[k],e,d)}}}}if((k==g.length)&&(!this.isMultiSel)){if((l<f)||(j==-1)){j=a;f=l}}}if(this.isMultiSel){this.SetValue(e)}else{if(j==-1){if(d.exitOnEmpty){return true}hardError("No matching cases in ["+this.aName+"]");return}g=b.cases[j];for(k=0;k<g.length;k++){if((g[k].aType==CASE_SET_VALUES)||(g[k].aType==CASE_SET_VALUE)){this.DoCell(g[k],undefined,d);break}}}return true};DictionaryObject.prototype.GoLookup=function(b){var l,j,g;var k=this.GetValue();var e=false;for(var a=0;(a<b.cases.length)&&!e;a++){g=b.cases[a];for(l=0;l<g.length;l++){if((g[l].aType==CASE_SET_VALUE)||(g[l].aType==CASE_SET_VALUES)){var f=false;if(g[l].aType==CASE_SET_VALUE){f=(g[l].value==k)}else{for(var h=0;h<g[l].values.length;h++){if(g[l].values[h]==k){f=true;break}}}if(f){e=true;for(j=0;j<g.length;j++){var d=_dgo(g[j].aID);if((g[j].aType==CASE_ALL)||(g[j].aType==CASE_DUMMY)){d.Clear()}else{if(g[j].aType==CASE_VALUES){if(d.isMultiSel){d.SetValue(g[j].values)}else{if(g[j].values.length!=1){hardError("Multiple values found in cell column ["+d.aName+"] row ["+a+"] in lookup table ["+this.aName+"]");return}d.val(g[j].values[0])}}else{if(g[j].aType==CASE_VALUE){d.val(g[j].value)}}}}}break}}}if(!e){hardError("Uncovered value ["+this.val()+"] in lookup table ["+this.aName+"]");return}return true};DictionaryObject.prototype.GoRule=function(e){var k;if(e.aObjectID){var d=dictionary.GetObject(e.aObjectID);if(!d.RunNoDynamicChk()){return false}var g=d.GetValue();var b=null;if(e.att){b=dictionary.GetObject(e.att);if(!b.RunNoDynamicChk()){return false}}var j=false;if((d.aType==TYPE_LIST)||(d.aType==TYPE_BOOLEAN)){if(b){j=(d.GetValueAsString()==b.GetValueAsString())}else{for(k=0;(k<e.values.length)&&!j;k++){if(e.values[k]==g){j=true}}}if((!j&&(e.aComparitor=="="))||(j&&(e.aComparitor=="<>"))){return false}}else{if((d.aType==TYPE_NUMERIC)||(d.aType==TYPE_DATE)||(d.aType==TYPE_TEXT)){var h;if(b){h=b.GetValue()}else{h=e.value}switch(e.aComparitor){case"<":j=(g<h);break;case"<=":j=(g<=h);break;case"=":j=(g==h);break;case"<>":j=(g!=h);break;case">":j=(g>h);break;case">=":j=(g>=h);break;default:hardError("Unknown comparitor in policy rule ["+e.aComparitor+"] in object ["+this.aName+"]");return}if(!j){return false}}}}if(e.operator){if(e.operator=="or"){result=false}else{if(e.operator=="and"){result=true}else{hardError("Unknown sub-clause type in policy rule ["+e.operator+"] in object ["+this.aName+"]");return}}for(k=0;k<e.aRules.length;k++){var f=this.GoRule(e.aRules[k]);if((e.operator=="or")&&f){result=true;break}else{if((e.operator=="and")&&!f){result=false;break}}}if(!result){return false}}return true};DictionaryObject.prototype.GoPolicyRules=function(e){for(var f=0;f<e.atts.length;f++){var d=dictionary.GetObject(e.atts[f]);if(!d){hardError("Unknown object ["+e.atts[f]+"] on policy rule ["+this.aName+"]");return}d.Load();var b=false;if(d.flatProps){b=d.flatProps.isdynamic}if(b){d.promptFor=true}}if(this.GoRule(e)){this.SetValueAsBool(e.dOutcome)}else{this.SetValueAsBool(!e.dOutcome)}return true};DictionaryObject.prototype.FireEvent=function(aEventType,self){if(!self){self=this}var s="";if((this.aType==TYPE_LIST)||(this.aType==TYPE_NUMERIC)||(this.aType==TYPE_DATE)||(this.aType==TYPE_BOOLEAN)||(this.aType==TYPE_TEXT)){switch(aEventType){case EVENT_UPDATE:s="OnUpdate";break;case EVENT_CAPTURE:s="OnCapture";break;case EVENT_LEAVE:s="OnLeave";break;case EVENT_HIERARCHYENTER:s="OnHierarchyEnter";break;case EVENT_HIERARCHYEXIT:s="OnHierarchyExit";break;case EVENT_POSTRULES:s="OnPostRules";break}}if(s.length==0){return false}try{var executed=false;var o;if(this.events&&$.isPlainObject(this.events)&&this.events[s]&&(typeof this.events[s]=="string")&&(this.events[s].length>0)){eval("(function(){"+this.events[s]+"\n})();");executed=true}else{if(this.events&&$.isPlainObject(this.events)&&this.events[s]&&(typeof this.events[s]=="number")&&(this.events[s]!=0)){o=_dgo(this.events[s]);if(o){o.Run(this);executed=true}}else{s="obj"+this.aID+s;if(!wrapperOptions.nodejs){if($.isFunction(window[s])){window[s]();executed=true}}else{var fn;try{fn=eval(s)}catch(e){fn=null}if($.isFunction(fn)){fn();executed=true}}}}if(!executed){o=this.parentObj();if(o){return o.FireEvent(aEventType,self)}}}catch(e){if(!(e instanceof inferenceIssue)){hardError("An error was encountered!\n\nObject: "+this.aName+"\nEvent: "+s+(lastErr?"\nLine "+lastErr.ln+"\nCommand: "+lastErr.cmd:"")+"\n\n"+e);return}else{throw e}}return true};DictionaryObject.prototype.StoreInitialStates=function(){this.treeDialogInitialStates=[];if(this.flatProps&&this.flatProps.instanceatts){for(var b=0;b<this.flatProps.instanceatts.length;b++){var a=dictionary.GetObject(this.flatProps.instanceatts[b].att);if($.isFunction(a.IsEmpty)&&a.IsEmpty()){this.treeDialogInitialStates.push(a.aID)}}}};DictionaryObject.prototype._defuzzify=function(){var a=[];function b(h){if(h.aType==NODETYPE_LEAF){a.push({avg:h.stats.avg,mv:h.fuzzyMv})}if($.isArray(h.aBranches)){for(var g=0;g<h.aBranches.length;g++){b(h.aBranches[g].aSubTree)}}}b(this.aTree);var e=0;var d=0;for(var f=0;f<a.length;f++){e+=a[f].avg*a[f].mv;d+=a[f].mv}return d!=0?e/d:0};DictionaryObject.prototype.RunNoDynamicChk=function(e){if(!this.Load()){return false}var h=false;var k=false;if(e){if(e.hasOwnProperty("fromHierarchy")){k=e.fromHierarchy}if(e.hasOwnProperty("exitOnEmpty")){h=e.exitOnEmpty}}var j=true;if(k){this.FireEvent(EVENT_HIERARCHYENTER);if(!this.isKnowledgeSelectableHierarchy()){j=(this.isSelectedForHierarchy(true)&&(this.aType!=TYPE_BOOLEAN))}}var l=(this.flatProps.selectionmode=="Lookup");if(this.promptFor){this.FireEvent(EVENT_CAPTURE);if(j&&this.promptFor){var f=0;var g=(this.flatProps&&(this.flatProps.selectionmode=="Tree Dialog"));if(!g){if(this.promptFor&&this.flatProps&&this.flatProps.tieddialog&&(this.flatProps.selectionmode!="Decision")){f=this.flatProps.tieddialog}if(!f&&this.promptFor&&this.flatProps&&this.flatProps.tieddialog&&!this.aTree){f=this.flatProps.tieddialog}if(!f&&this.promptFor&&this.tieddialog){f=this.tieddialog}if(!f&&this.promptFor&&(this.aType==TYPE_VARIABLE)&&(appSettings.varTemplate)){f=appSettings.varTemplate}}if(f&&!this.aTree&&!this.aExamples){aObj=_dgo(f);if(!aObj.RunAsTied(this)){return false}}else{var d={exitOnEmpty:h,isFuzzy:$.isPlainObject(this.dmInfo)&&this.dmInfo.settings.isFuzzy};if(d.isFuzzy){d.fuzzyMv=1}if(this.aTree!=null){if(this.hasSequenceNode){this.clear()}if(g){this.assignAttInstancesToDictinary();AppendCapturedAtt(this.aID);var m=capturingAtts;capturingAtts=false;this.Clear();this.StoreInitialStates();if(this.flatProps.grouppreviousanswers==""){replayStack.PopReplay(this.aID,true)}else{if((replayStack.aReplay.length>0)&&(replayStack.replayPos==replayStack.aReplay.length)){if(replayStack.aReplay[replayStack.aReplay.length-1].aOperation!=REPLAY_FORMTREESTART){replayStack.Add(this.aID,REPLAY_FORMTREESTART)}}replayStack.onFormTree=true}this.InitTreeDialog();this.GoTree(this,null,this.aTree,true,{value:false},false,false,false);this.revertAttInstancesToDictinary();if(this.flatProps.grouppreviousanswers!=""){capturingAtts=false;replayStack.formTreeSkip()}replayStack.onFormTree=false;capturingAtts=m}else{if(!this.GoTree(this,d,this.aTree,false,{value:false},false,false,false)){return false}lineOfReasoning.push({atype:LOR_TASK,id:this.aID});if(d.isFuzzy){this.val(this._defuzzify())}this.FireEvent(EVENT_POSTRULES)}}else{if((this.aExamples!=null)&&!l){if(!this.GoExamples(this.aExamples,d)){return false}lineOfReasoning.push({atype:LOR_TASK,id:this.aID});this.FireEvent(EVENT_POSTRULES)}}if(this.aPolicyRules!=null){if(!this.GoPolicyRules(this.aPolicyRules)){return false}lineOfReasoning.push({atype:LOR_TASK,id:this.aID});this.FireEvent(EVENT_POSTRULES)}if(this.promptFor&&!g&&!h){if(f&&(this.aTree||this.aExamples)){aObj=_dgo(f);if(!aObj.RunAsTied(this)){return false}}else{this.hitCount++;switch(this.aType){case TYPE_LIST:case TYPE_NUMERIC:case TYPE_BOOLEAN:case TYPE_DATE:case TYPE_VARIABLE:case TYPE_TEXT:AppendCapturedAtt(this.aID);break}var a=replayStack.PopReplay(this.aID);if(a==REPLAYPOP_HANDLED){}else{if(a==REPLAYPOP_CURRENT){throw new inferenceIssue(PASSBACK_PAUSE,this.aID)}else{if(a==REPLAYPOP_STOP){return false}else{hardError("Unknown replay pop return ["+a+"]");return}}}}}}}this.FireEvent(EVENT_LEAVE)}if(l){if(this.GetValue()==0){hardError("Attempt to run lookup table on ["+this.aName+"] but no current value");return}if(!this.GoLookup(this.aExamples)){return false}}if(k){var b=this.isSelectedForHierarchy(false);if((this.aType==TYPE_BOOLEAN)&&!this.isFull()){this.val(b)}if(!b){return true}if($.isArray(e.hierChildren)){if(!e.hierObj.GoTree(e.hierChildren,e.hierParams)){return false}}this.FireEvent(EVENT_HIERARCHYEXIT)}return true};DictionaryObject.prototype.Run=function(b){if(!this.Load()){return false}var a=this.flatProps?this.flatProps.isdynamic:false;if(a){this.promptFor=true}return this.RunNoDynamicChk(b)};DictionaryObject.prototype.run=function(){return this.Run(arguments)};DictionaryObject.prototype.runBayes=function(){if(!this.bayesian){hardError("No bayesian probabilities for object ["+this.aName+"]");return}var b,h,a,f,d,e,g;for(h=0;h<this.bayesian.atts.length;h++){if(!this.bayesian.atts[h].item){this.bayesian.atts[h].item=dictionary.GetObject(this.bayesian.atts[h].id)}}for(h=0;h<this.aValues.length;h++){this.aValues[h].prob=this.bayesian.outcome.probs[h]}for(a=0;a<this.bayesian.atts.length;a++){b=this.bayesian.atts[a].item;if(!b.IsEmpty()){for(f=0;f<this.aValues.length;f++){d=this.bayesian.atts[a].outs[f];if((b.aType==TYPE_LIST)||(b.aType==TYPE_BOOLEAN)){g=b.GetValue();g=b.ValueIDtoIndex(g);if(d.vals[g].idx!=g+1){hardError("Mismatched index");return}this.aValues[f].prob*=d.vals[g].prob}else{g=b.GetValue();for(vc=0;vc<d.vals.length;vc++){if(d.vals[vc].hasOwnProperty("ge")&&(g<d.vals[vc].ge)){continue}if(d.vals[vc].hasOwnProperty("lt")&&(g>=d.vals[vc].lt)){continue}this.aValues[f].prob*=d.vals[vc].prob;break}}}}}e=0;for(h=0;h<this.aValues.length;h++){e+=this.aValues[h].prob}for(h=0;h<this.aValues.length;h++){this.aValues[h].prob/=e}};DictionaryObject.prototype.prop=function(d,b,a){if(this.aType==TYPE_DIALOG){if(a===undefined){return this.GetDialogControlValue(d,b)}else{return this.SetDialogControlValue(d,b,a)}}if(!this.flatProps){return null}d=d.toLowerCase();if(d=="decplaces"){if(b==undefined){return this.aDecPlaces}else{this.aDecPlaces=b;return}}if(this.flatProps.hasOwnProperty(d)==undefined){return null}if(b==undefined){if($.isPlainObject(this.flatProps[d])){return this.flatProps[d].val}else{return this.flatProps[d]}}if(!this.flatProps.hasOwnProperty(d)){hardError("Object Property ["+this.aName+"."+d+"] does not exist");return null}if($.isPlainObject(this.flatProps[d])){if(typeof this.flatProps[d].val!=typeof b){hardError("Attempt to set property ["+this.aName+"."+d+"] to incorrect type ["+(typeof b)+"]");return null}this.flatProps[d].val=b}else{if(typeof this.flatProps[d]!=typeof b){hardError("Attempt to set property ["+this.aName+"."+d+"] to incorrect type ["+(typeof b)+"]");return null}this.flatProps[d]=b}return this};DictionaryObject.prototype.parentObj=function(){if(this.flatProps&&this.flatProps.hasOwnProperty("pid")){return _dgo(this.flatProps.pid)}else{return null}};DictionaryObject.prototype.value=function(a){if(!$.isArray(this.aValues)){return null}if(a==undefined){return this.aValues}if((a<1)||(a>this.aValues.length)){hardError("Instance index out of bounds. "+this.aName+"["+a+"]");return}return this.aValues[a-1]};DictionaryObject.prototype.inst=function(e,b,d){if(!this.aValueProps){return null}if(!b){var a=this.GetValue();if(!a){hardError("Object ["+this.aName+"] does not have a value");return}if($.isArray(a)){hardError("Object ["+this.aName+"] is a multi-select");return}b=this.ValueIDtoIndex(a)}else{b--}if((b<0)||(b>=this.aValues.length)){hardError("Instance index out of bounds. "+this.aName+"."+e+"["+(b+1)+"]");return}e=e.toLowerCase();switch(e){case"selected":case"valid":case"visible":break;default:var f;for(f=0;f<this.aValueProps.list.length;f++){if(this.aValueProps.list[f].aName.toLowerCase()==e){break}}if(f>=this.aValueProps.list.length){hardError("Unknown instance property ["+this.aName+"."+e+"]");return}e=this.aValueProps.list[f].aName}if(d==undefined){return this.aValues[b][e]}if(typeof this.aValues[b][e]!=typeof d){hardError("Attempt to set instance property ["+e+"] of type ["+typeof this.aValues[b][e]+"] to incorrect type ["+(typeof d)+"]");return}this.aValues[b][e]=d;return this};DictionaryObject.prototype.instProp=function(b){var a=this.instProps();if(!a){return null}if(typeof b=="string"){for(var d=0;d<a.length;d++){if(a[d].realName==b){b=d;break}}if(d==a.length){b=-1}}else{b--}if((b<0)||(b>=a.length)){return}return a[b]};DictionaryObject.prototype.instProps=function(){if(!this.aValueProps){return null}return this.aValueProps.list};DictionaryObject.prototype.isSelectedForHierarchy=function(a){if(!this.flatProps){return true}if(!this.flatProps.hasOwnProperty("isselected")){return true}if(this.flatProps.isselected=="Knowledge"){if(this.isEmpty()){return a}if(this.aType==TYPE_BOOLEAN){return this.val()}else{if((this.aType==TYPE_LIST)&&(this.isMultiSel)){return this.val().length>0}}return true}return this.flatProps.isselected=="Yes"};DictionaryObject.prototype.isKnowledgeSelectableHierarchy=function(){if(!this.flatProps){return false}if(!this.flatProps.hasOwnProperty("isselected")){return false}return this.flatProps.isselected=="Knowledge"};DictionaryObject.prototype.GetValuesForHelper=function(){if((this.aType!=TYPE_LIST)&&(this.aType!=TYPE_BOOLEAN)){return null}if(!this.Load(this)){return null}var a=[];for(var b=0;b<this.aValues.length;b++){a[a.length]={id:this.aValues[b].aID,text:this.aValues[b].aName}}return a};DictionaryObject.prototype.TreeDialogAsXML=function(){var b=[];for(var d=0;d<this.treeDialog.length;d++){if(this.treeDialog[d]){b.push(this.treeDialog[d].aID)}}return Cmd_EncodeData(b,true,"",true)};DictionaryObject.prototype.GetBaseClassName=function(){this.Load();var a=this.parentObj();if(a){return a.aName}else{return""}};DictionaryObject.prototype.patchLookupTable=function(){if((this.aType==TYPE_LIST)||(this.aType==TYPE_NUMERIC)||(this.aType==TYPE_DATE)||(this.aType==TYPE_BOOLEAN)||(this.aType==TYPE_TEXT)){if(this.flatProps.selectionmode=="Lookup"){var h,g,f,d,a,e,b;if((this.aType==TYPE_LIST)||(this.aType==TYPE_BOOLEAN)){for(h=0;h<this.aValues.length;h++){a=this.IndextoValueID(h);d=false;for(g=0;(g<this.aExamples.cases.length)&&!d;g++){e=this.aExamples.cases[g];for(f=0;f<e.length;f++){if(e[f].aType==CASE_SET_VALUES){if($.inArray(a,e[f].values)>=0){d=true;break}}}}if(!d){b=[];for(g=0;g<this.aExamples.atts.length;g++){b.push({aID:$.isPlainObject(this.aExamples.atts[g])?this.aExamples.atts[g].id:this.aExamples.atts[g],aType:CASE_ALL})}b.push({aID:this.aID,aType:CASE_SET_VALUES,values:[a]});this.aExamples.cases.push(b)}}for(h=this.aExamples.cases.length-1;h>=0;h--){e=this.aExamples.cases[h];for(g=0;g<e.length;g++){if(e[g].aType==CASE_SET_VALUES){for(f=e[g].values.length-1;f>=0;f--){if(this.ValueIDtoIndex(e[g].values[f])==-1){e[g].values.splice(f,1)}}if(e[g].values.length==0){this.aExamples.cases.splice(h,1)}}}}}else{b=[];for(g=0;g<this.aExamples.atts.length;g++){b.push({aID:$.isPlainObject(this.aExamples.atts[g])?this.aExamples.atts[g].id:this.aExamples.atts[g],aType:CASE_ALL})}b.push({aID:this.aID,aType:CASE_SET_VALUES,values:[a]});this.aExamples.cases.push(b)}}}};DictionaryObject.prototype.getLeafInfo=function(m){var n=this;var a={attributes:[]};var j=this.dmInfo;function e(p){var f=[];for(var r=0;r<j.fields.length;r++){if(j.fields[r].name==p){if(j.fields[r].type=="text"){for(var q=0;q<j.fields[r].values.length;q++){if(!j.fields[r].values[q].otherwise){f.push(j.fields[r].values[q].name)}}}break}}return f}function b(p,f){if(p.aID==f){return true}switch(p.aType){case NODETYPE_INLINE:case NODETYPE_LABEL:return b(p.aSubTree,f);case NODETYPE_PROC:if($.isPlainObject(p.aSubTree)){return b(p.aSubTree,f)}if(!$.isArray(p.aBranches)){return false}case NODETYPE_SPLIT:case NODETYPE_SEQUENCE:for(var q=0;q<p.aBranches.length;q++){if(b(p.aBranches[q].aSubTree,f)){return true}}}return false}function h(f){if(j){for(var q=0;q<j.fields.length;q++){if(j.fields[q].name==f){if(j.fields[q].type=="text"){for(var p=0;p<j.fields[q].values.length;p++){if(j.fields[q].values[p].otherwise){return j.fields[q].values[p].name}}}break}}return"otherwise"}else{return null}}function o(q){if(q.aID==m){return q}if(q.aType==NODETYPE_SPLIT){for(var y=0;y<q.aBranches.length;y++){if(b(q.aBranches[y].aSubTree,m)){var C=q.aBranches[y];var p=_dgo(q.aAttribute);var r,w,A,D,u,z,t;for(r=0;r<a.attributes.length;r++){if(a.attributes[r].name==p.aName){break}}A=r<a.attributes.length;if(A){w=a.attributes[r]}else{w={name:p.aName}}if(j){for(r=0;r<j.fields.length;r++){if(j.fields[r].name==p.aName){D=j.fields[r];if(p.aType!=TYPE_LIST){if((D.hasOwnProperty("manual_min")&&(D.manual_min>D.min))||(D.hasOwnProperty("manual_max")&&(D.manual_max<D.max))){z=true}u=D.avg}break}}}switch(p.aType){case TYPE_LIST:w.type="text";var x=h(p.aName);w.values=[];for(r=0;r<C.aValues.length;r++){var B=p.IDtoName(C.aValues[r]);if(B==x){B=e(p.aName)}w.values.push(B)}break;case TYPE_NUMERIC:w.type="num";if(z){t=false;switch(C.aComparitor){case">=":t=(C.aThreshold<=u);break;case"<":t=(C.aThreshold>u);break}if(!w.hasOwnProperty("outliers")||w.outliers){w.outliers=t}}switch(C.aComparitor){case">=":w.ge=C.aThreshold;if(D.hasOwnProperty("manual_max")&&!w.hasOwnProperty("lt")){w.lt=D.manual_max}break;case"<":w.lt=C.aThreshold;if(D.hasOwnProperty("manual_min")&&!w.hasOwnProperty("ge")){w.ge=D.manual_min}break}if(C.includeNulls){w.include_nulls=true}break;case TYPE_DATE:w.type="datetime";switch(C.aComparitor){case">=":w.ge=Math.floor(C.aThreshold*86400);break;case"<":w.lt=Math.floor(C.aThreshold*86400);break}break}if(!A){a.attributes.push(w)}return o(C.aSubTree)}}}return null}var k=o(this.aTree);if(k){a.tree=this.aName;switch(this.aType){case TYPE_LIST:case TYPE_BOOLEAN:a.type="text";break;case TYPE_NUMERIC:a.type="num";break;case TYPE_DATE:a.type="date";break}var g;if(k.hasOwnProperty("stats")){a.stats=k.stats;if($.isArray(k.stats.values)){var l=k.stats.values;a.stats.values=[];for(g=0;g<l.length;g++){a.stats.values.push({name:this.IDtoName(l[g].aID),frequency:l[g].freq})}}}else{if(k.aOutcome!=EMPTY_LEAF){if(this.isMultiSel){a.value=[];if($.isArray(k.aOutcome)){for(g=0;g<k.aOutcome.length;g++){a.value.push(this.IDtoName(k.aOutcome[g]))}}else{a.value.push(this.IDtoName(aNode.aOutcome))}}else{if(this.aType==TYPE_LIST){a.value=this.IDtoName(k.aOutcome)}else{a.value=k.aOutcome}}}}for(g=0;g<a.attributes.length;g++){switch(a.attributes[g].type){case"text":break;case"num":case"datetime":var d={};if(a.attributes[g].hasOwnProperty("ge")){d.ge=a.attributes[g].ge;delete a.attributes[g].ge}if(a.attributes[g].hasOwnProperty("lt")){d.lt=a.attributes[g].lt;delete a.attributes[g].lt}if(a.attributes[g].hasOwnProperty("include_nulls")){d.include_nulls=a.attributes[g].include_nulls;delete a.attributes[g].include_nulls}a.attributes[g].values=[d];if(a.attributes[g].outliers){}if(a.attributes[g].outliers){for(cc=0;cc<j.fields.length;cc++){if(j.fields[cc].name==a.attributes[g].name){if(j.fields[cc].hasOwnProperty("manual_min")){d={lt:j.fields[cc].manual_min};a.attributes[g].values.push(d)}if(j.fields[cc].hasOwnProperty("manual_max")){d={ge:j.fields[cc].manual_max};a.attributes[g].values.push(d)}break}}}if(a.attributes[g].hasOwnProperty("outliers")){delete a.attributes[g].outliers}break}}a.path=[];for(g=0;g<a.attributes.length;g++){}if(this.flatProps.hasOwnProperty("previousvalue")){a.actual=this.flatProps.previousvalue}a.path=a.attributes;delete a.attributes}return a};function DictionaryObject_List(d,e,b,a){DictionaryObject_List.baseConstructor.call(this,d,e,TYPE_LIST,b);this.aValues=null;this.aValueProps=null;this.nValues=0;this.currentValueID=0;this.isMultiSel=a;this.loadedValues=null;this.dmInfo=null;this._hintprops.push("build(seperator, finalSeperator)")}ObjectExtend(DictionaryObject_List,DictionaryObject);DictionaryObject_List.prototype.Reset=function(){if(this.loadedValues){this.aValues=$.extend(true,[],this.loadedValues);this.nValues=this.aValues.length}DictionaryObject_List.superClass.Reset.call(this)};DictionaryObject_List.prototype.Clear=function(a){var b;if(this.aValues){for(b=0;b<this.aValues.length;b++){this.aValues[b].visible=true;this.aValues[b].valid=true;if(this.isMultiSel){this.aValues[b].selected=false}}}if(!this.isMultiSel){this.currentValueID=0}DictionaryObject_List.superClass.Clear.call(this);if(this.flatProps&&a){if(this.flatProps.defaultmode=="SetDefault"){this.SetValueAsString(this.flatProps._default)}}};DictionaryObject_List.prototype.Populate=function(e,d,j){var h,g,a;for(h=0;h<j.props.list.length;h++){j.props.list[h].aName=Handle2(j.props.list[h].aName);j.props.list[h].realName=Handle2(j.props.list[h].realName)}this.aValues=j.values;this.aValueProps=j.props;for(h=0;h<this.aValues.length;h++){a=this.aValues[h];a.idx=h;a.id=this.aValues[h].aID;a.selected=false;a.valid=true;for(var f in a){if(f.substr(0,1)=="~"){var b=Handle2(f);a[b]=a[f];delete a[f];if(typeof a[b]=="string"){a[b]=Handle2(a[b])}}}a.aText=this.GetValueDescr(h);a.evalid=VALID_UNKNOWN;a.visible=true}this.nValues=this.aValues.length;this.loadedValues=this.aValues.slice();DictionaryObject_List.superClass.Populate.call(this,e,d)};DictionaryObject_List.prototype.toObject=function(){var a=DictionaryObject_List.superClass.toObject.call(this);a.isMultiSel=this.isMultiSel;if(this.dmInfo){a.dmInfo=this.dmInfo}return a};DictionaryObject_List.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID,true);return false}return true};DictionaryObject_List.prototype.toString=function(){var a=DictionaryObject_List.superClass.toString.call(this);for(var b=0;b<this.aValues.length;b++){a+="\nid :"+this.aValues[b].aID+" , name :"+this.aValues[b].aName+" , text :"+this.aValues[b].aText}return a};DictionaryObject_List.prototype.GetValue=function(){if(!this.Load(this)){return null}if(this.isMultiSel){var b=[];for(var e=0;e<this.aValues.length;e++){if(this.aValues[e].selected){b.push(this.aValues[e].aID)}}if((b.length===0)&&(this.flatProps.defaultmode=="UseDefault")){var d=this.NameToID(this.flatProps._default);if(d!=0){b[b.length]=d}}return b}else{if(this.currentValueID===0){if(this.flatProps.defaultmode=="UseDefault"){return this.NameToID(this.flatProps._default)}return 0}}return this.currentValueID};DictionaryObject_List.prototype.GetValueProp=function(d,b){if(!this.Load(this)){return null}if(this.aValueProps==null){return null}if(b===undefined){b=-1}var a=null;if(this.isMultiSel&&$.isArray(b)){if(b.length>0){a=b}}else{if(b!=-1){a=this.aValues[b-1].aID}}if(a==null){a=this.GetValue()}if(this.isMultiSel&&$.isArray(a)){if(a.length===0){return null}}else{if((a==null)||(a==0)){return null}}var f=(typeof d=="string"?d.toLowerCase()=="value":false);var g;for(g=0;g<this.aValueProps.list.length;g++){if((this.aValueProps.list[g].aName==d)||(this.aValueProps.list[g].aID==d)||(f&&this.aValueProps.list[g].aID==-2)){break}}if(g<this.aValueProps.list.length){if(a instanceof Array){var e="";for(cc=0;cc<a.length;cc++){if(e.length>0){e+=", "}e+=this.IDtoName(a[cc],this.aValueProps.list[g].aName)}return e}return this.IDtoName(a,this.aValueProps.list[g].aName)}return null};DictionaryObject_List.prototype.GetValueAsString=function(e,b){var a=this.GetValue();if(this.isMultiSel){var d,f;if(e===true){d=[];for(f=0;f<this.aValues.length;f++){if(this.aValues[f].selected){d[d.length]=this.IDtoName(this.aValues[f].aID,b)}}}else{d="";for(f=0;f<a.length;f++){if(f>0){if(typeof e=="string"){d+=e}else{d+=", "}}d+=this.IDtoName(a[f],b)}}return d}else{if(a==0){return""}}return this.IDtoName(a,b)};DictionaryObject_List.prototype.SetValue=function(b){if(b==PSEUDO_VALUE_EMPTY){this.Clear()}else{if(this.isMultiSel){if(!$.isArray(b)){b=[b]}var e;for(e=0;e<b.length;e++){if(typeof b[e]=="string"){b[e]=this.NameToID(b[e])}}for(var d=0;d<this.aValues.length;d++){var a=false;for(e=0;(e<b.length)&&!a;e++){a=b[e]==this.aValues[d].aID}this.aValues[d].selected=a}}else{if(typeof b=="string"){return this.SetValueAsString(b)}else{this.currentValueID=b}}DictionaryObject_List.superClass.SetValue.call(this)}};DictionaryObject_List.prototype.SetMultiValue=function(d,b){if(!this.isMultiSel){return}for(var e=0;e<this.aValues.length;e++){var a;if($.isArray(d)){a=$.inArray(this.aValues[e].aID,d)>=0}else{a=this.aValues[e].aID==d}if(a){if(b==SETOP_ADD){this.aValues[e].selected=true}else{if(b==SETOP_DEL){this.aValues[e].selected=false}}}}DictionaryObject_List.superClass.SetValue.call(this)};DictionaryObject_List.prototype.SetValueAsString=function(a,e,f){if(!a||(a==PSEUDO_VALUE_EMPTY)){this.Clear()}else{var g="Unknown instance value ["+a+"] for object ["+this.aName+"]";var b;if(this.isMultiSel){if($.isArray(a)){b=a.slice(0)}else{if(typeof e!="string"){e=","}b=a.split(e)}for(var h=0;h<b.length;h++){var d=this.NameToID(b[h]);if(d==0){if(f){softError(g);return false}hardError(g);return}b[h]=d}}else{b=this.NameToID(a);if(b==0){if(f){softError(g);return false}hardError(g);return}}this.SetValue(b);DictionaryObject_List.superClass.SetValueAsString.call(this)}return true};DictionaryObject_List.prototype.ShowValue=function(a){if(a==0){for(var b=0;b<this.aValues.length;b++){this.aValues[b].visible=true}}else{this.aValues[this.ValueIDtoIndex(a)].visible=true}};DictionaryObject_List.prototype.HideValue=function(a){if(a==0){for(var b=0;b<this.aValues.length;b++){this.aValues[b].visible=false}}else{this.aValues[this.ValueIDtoIndex(a)].visible=false}};DictionaryObject_List.prototype.IDtoText=function(a){return this.GetValueDescr(this.ValueIDtoIndex(a))};DictionaryObject_List.prototype.IDtoName=function(b,a){this.Load(this);var d=this.ValueIDtoIndex(b);if(d==-1){return""}if(a===true){return this.GetValueDescr(d)}else{if(a){return this.aValues[d][a]}}return this.aValues[d].aName};DictionaryObject_List.prototype.NameToID=function(d,a){if(this.Load(this)){if(a){d=d.toLowerCase()}for(var b=0;b<this.aValues.length;b++){if((a&&(this.aValues[b].aName.toLowerCase()==d))||(this.aValues[b].aName==d)){return this.aValues[b].aID}}}return 0};DictionaryObject_List.prototype.ValueIDtoIndex=function(a){if(this.Load(this)){for(var b=0;b<this.aValues.length;b++){if(this.aValues[b].aID==a){return b}}}return -1};DictionaryObject_List.prototype.IndextoValueID=function(a){if(this.Load(this)){if((a>=0)&&(a<this.aValues.length)){return this.aValues[a].aID}}return -1};DictionaryObject_List.prototype.GetNvalues=function(){if(this.Load(this)){return this.aValues.length}return 0};DictionaryObject_List.prototype.GetValueDescr=function(b){if(!this.aValueProps){return""}if((b<0)||(b>=this.aValues.length)){softError("GetValueDescr index out of bounds "+this.aName+" ["+b+"]");return""}var a="";var d=this.aValueProps.general.descriptionprop;if(d&&this.aValues[b].hasOwnProperty(d)){a=this.aValues[b][d]}if(a===""){a=this.aValues[b].aName}return a};DictionaryObject_List.prototype.SetValueProp=function(b,a,d){if(!this.Load(this)){return false}if(this.aValueProps==null){return false}if(a==-1){a=this.GetValue()}if(this.isMultiSel){if(a.length===0){return false}}else{if(a==0){return false}}for(var f=0;f<this.aValueProps.list.length;f++){if((this.aValueProps.list[f].aName==b)||(this.aValueProps.list[f].aID==b)){break}}if(f<this.aValueProps.list.length){for(var e=0;e<this.aValues.length;e++){if(this.aValues[e].aID==a){this.aValues[e][this.aValueProps.list[f].aName]=d;return true}}}return false};DictionaryObject_List.prototype.SetValuePropIndex=function(a,b,d){if(!this.Load(this)){return false}b--;if(this.aValueProps==null){return false}if(b<0){b=this.ValueIDtoIndex(this.GetValue())}if(this.isMultiSel){if(b.length==0){return false}}else{if(b<0||b>=this.aValues.length){return false}}for(var e=0;e<this.aValueProps.list.length;e++){if((this.aValueProps.list[e].aID==a)||(this.aValueProps.list[e].aName==a)){break}}if(e<this.aValueProps.list.length){if(typeof(this.aValues[b][this.aValueProps.list[e].aName])=="boolean"){if(typeof(d)=="string"){this.aValues[b][this.aValueProps.list[e].aName]=(d.toUpperCase()=="TRUE")}else{this.aValues[b][this.aValueProps.list[e].aName]=(d==1)}}else{this.aValues[b][this.aValueProps.list[e].aName]=d;this.aValues[b].aText=this.GetValueDescr(b)}return true}return false};DictionaryObject_List.prototype.IsValueSelected=function(a){var b=this.GetValue();if(this.isMultiSel){if(typeof a!="number"){a=this.NameToID(a)}for(var d=0;d<b.length;d++){if(b[d]==a){return true}}return false}return b==a};DictionaryObject_List.prototype.IsValueIndexSelected=function(a){if(!this.Load(this)){return false}if((a>=0)&&(a<this.aValues.length)){if(!this.isMultiSel){return this.aValues[a].aID==this.GetValue()}return this.aValues[a].selected}return false};DictionaryObject_List.prototype.IsValueValid=function(a){return this.IsValueIndexValid(this.ValueIDtoIndex(a))};DictionaryObject_List.prototype.IsValueIndexValid=function(a){if(!this.Load(this)){return false}if((a>=0)&&(a<this.aValues.length)){return this.aValues[a].valid}return true};DictionaryObject_List.prototype.IsValueHidden=function(a){return this.IsValueIndexHidden(this.ValueIDtoIndex(a))};DictionaryObject_List.prototype.IsValueIndexHidden=function(a){if(this.flatProps.hasOwnProperty("hiddenvaluesprop")&&(this.flatProps.hiddenvaluesprop!="")&&(a>=0)&&(a<this.aValues.length)){return this.aValues[a][this.flatProps.hiddenvaluesprop]===true}return false};DictionaryObject_List.prototype.UnknownInvalids=function(){var a;for(a=0;a<this.aValues.length;a++){this.aValues[a].evalid=VALID_UNKNOWN}};DictionaryObject_List.prototype.ResolveInvalids=function(){for(var a=0;a<this.aValues.length;a++){this.aValues[a].valid=this.aValues[a].evalid!=VALID_FALSE}};DictionaryObject_List.prototype.GetValueValidity=function(a){return this.aValues[a].evalid};DictionaryObject_List.prototype.SetValueValidity=function(a,b){this.aValues[a].evalid=b};DictionaryObject_List.prototype.GetOldValueValidity=function(a){return this.aValues[a].ovalid};DictionaryObject_List.prototype.SaveValidity=function(){for(var a=0;a<this.aValues.length;a++){this.aValues[a].ovalid=this.aValues[a].evalid}};DictionaryObject_List.prototype.ClearInvalid=function(){for(var a=0;a<this.aValues.length;a++){this.aValues[a].valid=true}};DictionaryObject_List.prototype.Exclude=function(d){if(this.Load(this)){if(d==""){this.ClearInvalid()}else{var a=d.split(",");for(var b=0;b<a.length;b++){for(var e=0;e<this.aValues.length;e++){if(this.aValues[e].aName==a[b]){this.aValues[e].valid=false;break}}}}}};DictionaryObject_List.prototype.GetAllValidValues=function(){if(this.Load(this)){var b=[];for(var d=0;d<this.aValues.length;d++){if(this.aValues[d].valid){b[b.length]=this.aValues[d].aName}}return b}return null};DictionaryObject_List.prototype.GetAllInValidValues=function(){if(this.Load(this)){var b=[];for(var d=0;d<this.aValues.length;d++){if(!this.aValues[d].valid){b[b.length]=this.aValues[d].aID}}return(b)}return(null)};DictionaryObject_List.prototype.SetValueInValid=function(a){if(this.Load(this)){if(a){for(var d=0;d<a.length;d++){for(var b=0;b<this.aValues.length;b++){if(this.aValues[b].aID==a[d]){this.aValues[b].valid=false;break}}}}}};DictionaryObject_List.prototype.GetNvalid=function(){var a=0;if(this.Load(this)){for(var b=0;b<this.aValues.length;b++){if(this.aValues[b].valid){a++}}}return a};DictionaryObject_List.prototype.GetNselected=function(){var a=0;if(this.Load(this)){if(this.isMultiSel){for(var b=0;b<this.aValues.length;b++){if(this.aValues[b].selected){a++}}}else{if(this.currentValueID!==0){a++}}}return a};DictionaryObject_List.prototype.GetSelectedIndex=function(){var a;if(this.isMultiSel){for(a=0;a<this.aValues.length;a++){if(this.aValues[a].selected&&this.aValues[a].valid){return a+1}}}else{for(a=0;a<this.aValues.length;a++){if(this.aValues[a].aID==this.currentValueID){return a+1}}}return 0};DictionaryObject_List.prototype.AddInstance=function(k,g){this.Load(this);var h;if(this.NameToID(k)!=0){softError("AddInstance: Duplicate value name ["+k+"]");return}var f=0;var n;do{f++;n=(this.ValueIDtoIndex(f)!=-1)}while(n);var m={aID:f,id:f,aName:k,selected:false,valid:true,visible:true};for(h=0;h<this.aValueProps.list.length;h++){if(this.aValueProps.list[h].aID>0){switch(this.aValueProps.list[h].aType){case"str":m[this.aValueProps.list[h].aName]="";break;case"int":m[this.aValueProps.list[h].aName]=0;break;case"float":m[this.aValueProps.list[h].aName]=0;break;case"bool":m[this.aValueProps.list[h].aName]=false;break;case"date":m[this.aValueProps.list[h].aName]=0;break;case"enum":m[this.aValueProps.list[h].aName]="(none)";break}}}if($.isPlainObject(g)){for(var a in g){var d=g[a];if((a!="_name")&&(d!==null)){var l=a.toLowerCase();for(h=0;h<this.aValueProps.list.length;h++){if(this.aValueProps.list[h].aName.toLowerCase()==l){break}}if(h>=this.aValueProps.list.length){softError("addInstance: Unknown instance property ["+a+"] for object ["+this.aName+"]")}else{var j=true;switch(this.aValueProps.list[h].aType){case"enum":if(d!="(none)"){for(var e=0;e<this.aValueProps.list[h].enums.length;e++){if(this.aValueProps.list[h].enums[e].name==d){break}}if(e>=this.aValueProps.list[h].enums.length){softError("addInstance: Unknown list instance property value ["+d+"] for object ["+this.aName+"."+a+"]");j=false}}break;case"str":if(typeof d!="string"){d=""+d}break;case"int":if(typeof d!="number"){d=parseInt(d,10)}break;case"float":if(typeof d!="number"){d=parseFloat(d)}break;case"bool":if(typeof d=="string"){if(d.toLowerCase()=="true"){d=true}else{if(d.toLowerCase()=="false"){d=false}else{softError("addInstance: Invalid boolean instance property value (string) ["+d+"] for object ["+this.aName+"."+a+"]");j=false}}}else{if(typeof d!="boolean"){softError("addInstance: Invalid boolean instance property value ["+d+"] for object ["+this.aName+"."+a+"]");j=false}}break;case"date":if(typeof d!="string"){softError("addInstance: Invalid date instance property value ["+d+"] for object ["+this.aName+"."+a+"]. Should be YYYYMMDD string");j=false}else{var b=decodeDateFromYYYYMMDDstring(d,false);if(b===null){softError("addInstance: Invalid date instance property value ["+d+"] for object ["+this.aName+"."+a+"]. Should be YYYYMMDD string");j=false}else{d=b.getTime()/86400000}}break}if(j){m[this.aValueProps.list[h].aName]=d}}}}}this.aValues.push(m);this.nValues=this.aValues.length;this.aValues[this.nValues-1].aText=this.GetValueDescr(this.nValues-1);replayProtection.set(this,true);return this.nValues};DictionaryObject_List.prototype.DelInstance=function(a){if(this.Load(this)){var b=this.aValues[a-1].aID;this.aValues.splice(a-1,1);this.nValues=this.aValues.length;if(this.currentValueID==b){this.Clear()}replayProtection.set(this,true)}};DictionaryObject_List.prototype.ClearInstances=function(){if(this.Load(this)){this.aValues=[];this.nValues=this.aValues.length;this.Clear();replayProtection.set(this,true)}};DictionaryObject_List.prototype.addInstance=function(b,a){return this.AddInstance(b,a)};DictionaryObject_List.prototype.addInstances=function(a){if(!$.isArray(a)){throw"Array expected"}for(var b=0;b<a.length;b++){if(!a[b].hasOwnProperty("_name")){softError("addInstances: Value name property [_name] missing for instance ["+b+"] on object ["+this.aName+"]")}else{this.AddInstance(a[b]._name,a[b])}}};DictionaryObject_List.prototype.delInstance=function(a){this.DelInstance(a)};DictionaryObject_List.prototype.clearInstances=function(){this.ClearInstances()};DictionaryObject_List.prototype.encodeInstances=function(){var b=[];var h,g,f,a,e;for(h=0;h<this.aValues.length;h++){a=this.aValues[h];f={_name:a.aName};for(g=0;g<this.aValueProps.list.length;g++){if(this.aValueProps.list[g].aID>0){switch(this.aValueProps.list[g].aType){case"date":e=new Date(a[this.aValueProps.list[g].aName]*86400000);f[this.aValueProps.list[g].aName]=strftime("yyyymmdd",e.getDate(),e.getMonth(),e.getFullYear());break;default:f[this.aValueProps.list[g].aName]=a[this.aValueProps.list[g].aName]}}}b.push(f)}return b};DictionaryObject_List.prototype.build=function(d,f){if(!this.isMultiSel){return this.val()}if(d==undefined){d=", "}if(f==undefined){f=d}var b=[];var g;for(g=0;g<this.aValues.length;g++){if(this.aValues[g].selected){b.push(this.aValues[g].aID)}}var e="";for(g=0;g<b.length;g++){e+=(g>0?g<b.length-1?d:f:"")+this.IDtoName(b[g],false)}return e};DictionaryObject_List.prototype.val=function(b,a){if(b===undefined){return this.GetValueAsString(true,false)}else{if(typeof b=="number"||$.isArray(b)){this.SetValue(b);return this}else{this.SetValueAsString(b,undefined,a);return this}}};function DictionaryObject_Num(d,e,b,a){DictionaryObject_Num.baseConstructor.call(this,d,e,TYPE_NUMERIC,b);this.aDecPlaces=a;this.currentValue=0;this.valid=true;this.evalid=null;this.ovalid=null;this.dmInfo=null;this._hintprops=["aType","aName","aDecPlaces","val([newValue])","clear();","run();","isEmpty()","props","prop(controlPropName[, newValue])"]}ObjectExtend(DictionaryObject_Num,DictionaryObject);DictionaryObject_Num.prototype.Reset=function(){DictionaryObject_Num.superClass.Reset.call(this)};DictionaryObject_Num.prototype.Clear=function(a){this.currentValue=0;this.valid=true;DictionaryObject_Num.superClass.Clear.call(this);if(this.flatProps&&a){if(this.flatProps.defaultmode=="SetDefault"){this.SetValue(this.flatProps._default)}}};DictionaryObject_Num.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID,true);return false}else{return true}};DictionaryObject_Num.prototype.Populate=function(b,a){DictionaryObject_Num.superClass.Populate.call(this,b,a)};DictionaryObject_Num.prototype.toObject=function(){var a=DictionaryObject_Num.superClass.toObject.call(this);a.aDecPlaces=this.aDecPlaces;if(this.dmInfo){a.dmInfo=this.dmInfo}return a};DictionaryObject_Num.prototype.toString=function(){return DictionaryObject_Num.superClass.toString.call(this)+"\nDec Places: "+this.aDecPlaces};DictionaryObject_Num.prototype.GetValue=function(){if(!this.Load(this)){return null}if(!this.isDataFull){if(this.flatProps.defaultmode=="UseDefault"){return this.flatProps._default}return null}return this.currentValue};DictionaryObject_Num.prototype.SetValue=function(a){if((a==PSEUDO_VALUE_EMPTY)||(a===null)){this.Clear()}else{if(typeof a=="string"){if(a.length==0){this.Clear()}else{if(isNaN(a)){hardError("Trying to assign a non-numeric value ["+a+"] to a numeric object ["+this.aName+"]")}else{var b=parseFloat(a);if(isNaN(b)){hardError("Trying to assign a non-numeric value ["+a+"] to a numeric object ["+this.aName+"]")}a=b}}}else{if(a instanceof Date){a=a.getTime()/86400000}}if(!appSettings.hasOwnProperty("maxNumPrecis")||appSettings.maxNumPrecis){this.currentValue=a}else{this.currentValue=RoundDP(a,this.aDecPlaces)}DictionaryObject_Num.superClass.SetValue.call(this)}};DictionaryObject_Num.prototype.SetValueAsString=function(a){this.SetValue(parseFloat(a))};DictionaryObject_Num.prototype.GetValueAsString=function(a,d){if(d==undefined){d=true}var b=this.GetValue();if(typeof b=="number"){var e;if((appSettings.hasOwnProperty("maxNumPrecis")&&!appSettings.maxNumPrecis&&(a==undefined))||(a=="force")){e=b.toFixed(this.aDecPlaces)}else{if(typeof a=="number"){e=b.toFixed(a)}else{e=b.toString()}}if(appSettings.decSeparator&&(appSettings.decSeparator!=".")&&d){e=e.replace(".",appSettings.decSeparator)}return e}else{return""}};DictionaryObject_Num.prototype.val=function(a){if(a===undefined){return this.GetValue()}else{this.SetValue(a);return this}};DictionaryObject_Num.prototype.UnknownInvalids=function(){this.evalid=VALID_UNKNOWN};DictionaryObject_Num.prototype.ResolveInvalids=function(){this.valid=(this.evalid!=VALID_FALSE)};DictionaryObject_Num.prototype.GetValueValidity=function(a){return this.evalid};DictionaryObject_Num.prototype.SetValueValidity=function(a,b){this.evalid=b};DictionaryObject_Num.prototype.GetOldValueValidity=function(a){return this.ovalid};DictionaryObject_Num.prototype.SaveValidity=function(){this.ovalid=this.evalid};function DictionaryObject_Date(f,g,d){DictionaryObject_Date.baseConstructor.call(this,f,g,TYPE_DATE,d);var e=new Date();var a=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()));var b=a.getTime();this.currentValue=b/86400000;this.dmInfo=null;this._hintprops=["aType","aName","val([newValue])","clear();","run();","isEmpty()","props","prop(controlPropName[, newValue])"]}ObjectExtend(DictionaryObject_Date,DictionaryObject);DictionaryObject_Date.prototype.Reset=function(){DictionaryObject_Date.superClass.Reset.call(this)};DictionaryObject_Date.prototype.Clear=function(a){this.currentValue=0;DictionaryObject_Date.superClass.Clear.call(this);if(this.flatProps&&a){if(this.flatProps.defaultmode=="SetDefault"){this.SetValue(this.flatProps._default)}}};DictionaryObject_Date.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID,true);return false}return true};DictionaryObject_Date.prototype.Populate=function(b,a){DictionaryObject_Date.superClass.Populate.call(this,b,a)};DictionaryObject_Date.prototype.toObject=function(){var a=DictionaryObject_Date.superClass.toObject.call(this);if(this.dmInfo){a.dmInfo=this.dmInfo}return a};DictionaryObject_Date.prototype.toString=function(){return(DictionaryObject_Date.superClass.toString.call(this))};DictionaryObject_Date.prototype.GetValue=function(){if(!this.Load(this)){return null}if(!this.isDataFull){if(this.flatProps.defaultmode=="UseDefault"){return this.flatProps._default}}return this.currentValue};DictionaryObject_Date.prototype.SetValue=function(a){if(a==PSEUDO_VALUE_EMPTY){this.Clear()}else{if(typeof a=="string"){var b=Cmd_StrToDate(a);if(b==-1){this.Clear();return}a=b}this.currentValue=a;DictionaryObject_Date.superClass.SetValue.call(this)}};DictionaryObject_Date.prototype.GetValueAsString=function(d){var b=this.GetValue();if(d===true){return Cmd_DateToStr(b)}else{if(d=="YYYYMMDD"){var a=new Date(b*86400000);return strftime("yyyy-MM-dd",a.getDate(),a.getMonth(),a.getFullYear())}}return b.toString()};DictionaryObject_Date.prototype.SetValueAsString=function(a){this.SetValue(Cmd_StrToDate(a))};DictionaryObject_Date.prototype.val=function(a){if(a===undefined){if(!this.isFull()){return null}else{return new Date(this.GetValue()*86400000)}}else{if(a instanceof Date){this.SetValue(a.getTime()/86400000)}else{this.SetValue(a)}return this}};function DictionaryObject_Bool(b,d,a){DictionaryObject_Bool.baseConstructor.call(this,b,d,TYPE_BOOLEAN,a);this.aValues=null;this.aValueProps=null;this.nValues=2;this.currentValueID=0}ObjectExtend(DictionaryObject_Bool,DictionaryObject);DictionaryObject_Bool.prototype.Reset=function(){DictionaryObject_Bool.superClass.Reset.call(this)};DictionaryObject_Bool.prototype.Clear=function(a){if(!this.Load(this)){return}this.currentValueID=0;DictionaryObject_Bool.superClass.Clear.call(this);if(this.flatProps&&a){if(this.flatProps.defaultmode=="SetDefault"){this.SetValueAsBool(this.flatProps._default)}}};DictionaryObject_Bool.prototype.Populate=function(e,d,j){var h,g,a;for(h=0;h<j.props.list.length;h++){j.props.list[h].aName=Handle2(j.props.list[h].aName);j.props.list[h].realName=Handle2(j.props.list[h].realName)}this.aValues=j.values;this.aValueProps=j.props;for(h=0;h<this.aValues.length;h++){a=this.aValues[h];a.idx=h;a.valid=true;for(var f in a){if(f.substr(0,1)=="~"){var b=Handle2(f);a[b]=a[f];delete a[f];if(typeof a[b]=="string"){a[b]=Handle2(a[b])}}}a.aText=this.GetValueDescr(h);a.evalid=VALID_UNKNOWN}DictionaryObject_Bool.superClass.Populate.call(this,e,d)};DictionaryObject_Bool.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID,true);return false}else{return true}};DictionaryObject_Bool.prototype.toString=function(){var a=DictionaryObject_Bool.superClass.toString.call(this);for(var b=0;b<this.aValues.length;b++){a+="\nid :"+this.aValues[b].aID+" , name :"+this.aValues[b].aName+" , text :"+this.aValues[b].aText}return a};DictionaryObject_Bool.prototype.GetValue=function(){if(!this.Load(this)){return 0}if(this.currentValueID===0){if(this.flatProps.defaultmode=="UseDefault"){if(this.flatProps._default){return 1}return 2}return 0}return this.currentValueID};DictionaryObject_Bool.prototype.GetValueProp=function(b,a){if(!this.Load(this)){return null}if(this.aValueProps===null){return null}if(a===undefined){a=-1}if(a==-1){a=this.GetValue()}if(a===0){return null}for(var d=0;d<this.aValueProps.list.length;d++){if((this.aValueProps.list[d].aName==b)||(this.aValueProps.list[d].aID==b)){break}}if(d<this.aValueProps.list.length){return this.IDtoName(a,this.aValueProps.list[d].aName)}return null};DictionaryObject_Bool.prototype.GetValueAsString=function(d,b){var a=this.GetValue();if(a===0){return""}else{if(d){return(a==1?"TRUE":"FALSE")}}return this.IDtoName(a,b)};DictionaryObject_Bool.prototype.SetValue=function(a){if(a==PSEUDO_VALUE_EMPTY){this.Clear()}else{if(typeof a=="boolean"){this.SetValueAsBool(a)}else{if(typeof a=="string"){return this.SetValueAsString(a)}else{this.currentValueID=a;DictionaryObject_Bool.superClass.SetValue.call(this)}}}};DictionaryObject_Bool.prototype.SetValueAsString=function(a){if(!this.Load(this)){return null}if(a==PSEUDO_VALUE_EMPTY){this.Clear()}else{var b=this.NameToID(a);if(b!==0){this.SetValue(b)}else{if(a.toUpperCase()=="TRUE"){this.SetValue(1)}else{if(a.toUpperCase()=="FALSE"){this.SetValue(2)}else{hardError("Unknown boolean object value ["+a+"]");return}}}DictionaryObject_Bool.superClass.SetValueAsString.call(this)}};DictionaryObject_Bool.prototype.IDtoText=function(a){var b=this.ValueIDtoIndex(a);if(b>=0){return this.GetValueDescr(b)}return""};DictionaryObject_Bool.prototype.IDtoName=function(d,b){var e=this.ValueIDtoIndex(d);if(e>=0){var a="";if(b===true){a=this.GetValueDescr(e)}else{if(b){a=this.aValues[e][b]}else{a=this.aValues[e].aName}}return a}return""};DictionaryObject_Bool.prototype.NameToID=function(b){if(this.Load(this)){for(var a=0;a<this.aValues.length;a++){if(this.aValues[a].aName==b){return this.aValues[a].aID}}}return 0};DictionaryObject_Bool.prototype.GetNvalues=function(){if(this.Load(this)){return this.aValues.length}return 0};DictionaryObject_Bool.prototype.GetValueDescr=function(b){if(!this.aValueProps){return""}if((b<0)||(b>=this.aValues.length)){softError("GetValueDescr index out of bounds "+this.aName+" ["+b+"]");return""}var a="";var d=this.aValueProps.general.descriptionprop;if(d&&this.aValues[b].hasOwnProperty(d)){a=this.aValues[b][d]}if(a==""){a=this.aValues[b].aName}return a};DictionaryObject_Bool.prototype.SetValueProp=function(b,a,d){if(!this.Load(this)){return}if(this.aValueProps==null){return}if(a==-1){a=this.GetValue()}if(a===0){return}for(var f=0;f<this.aValueProps.list.length;f++){if(this.aValueProps.list[f].aID==b){break}}if(f<this.aValueProps.list.length){var e=this.ValueIDtoIndex(a);if(e>=0){this.aValues[e][this.aValueProps.list[f].aName]=d}}};DictionaryObject_Bool.prototype.GetValueAsBool=function(){var a=this.GetValue();if(a==1){return true}else{if(a==2){return false}}return null};DictionaryObject_Bool.prototype.SetValueAsBool=function(a){s=typeof(a);if(s=="string"){this.SetValueAsString(a)}else{if(s=="number"){if(a==1){this.SetValue(1)}else{this.SetValue(2)}}else{if(a){this.SetValue(1)}else{this.SetValue(2)}}}};DictionaryObject_Bool.prototype.IsValueSelected=function(a){return this.GetValue()==a};DictionaryObject_Bool.prototype.IsValueIndexSelected=function(a){if((a>=0)&&(a<this.aValues.length)){return this.aValues[a].aID==this.currentValueID}return false};DictionaryObject_Bool.prototype.IsValueValid=function(a){return this.IsValueIndexValid(this.ValueIDtoIndex(a))};DictionaryObject_Bool.prototype.IsOtherValueValid=function(){if(!this.Load(this)){return true}for(var a=0;a<this.aValues.length;a++){if(this.aValues[a].aID!=this.currentValueID){if(this.aValues[a].valid){return true}}}return false};DictionaryObject_Bool.prototype.IsValueIndexValid=function(a){if((a>=0)&&(a<this.aValues.length)){return this.aValues[a].valid}return true};DictionaryObject_Bool.prototype.ValueIDtoIndex=function(a){if(this.Load(this)){for(var b=0;b<this.aValues.length;b++){if(this.aValues[b].aID==a){return b}}}return -1};DictionaryObject_Bool.prototype.IndextoValueID=function(a){if(this.Load(this)){if((a>=0)&&(a<this.aValues.length)){return this.aValues[a].aID}}return -1};DictionaryObject_Bool.prototype.val=function(a){if(a===undefined){if(appSettings.treatBoolsAsList){return this.GetValueAsString()}else{return this.GetValueAsBool()}}else{this.SetValueAsBool(a);return this}};DictionaryObject_Bool.prototype.UnknownInvalids=function(){for(var a=0;a<this.aValues.length;a++){this.aValues[a].evalid=VALID_UNKNOWN}};DictionaryObject_Bool.prototype.ResolveInvalids=function(){for(var a=0;a<this.aValues.length;a++){this.aValues[a].valid=(this.aValues[a].evalid!=VALID_FALSE)}};DictionaryObject_Bool.prototype.GetValueValidity=function(a){return this.aValues[a].evalid};DictionaryObject_Bool.prototype.SetValueValidity=function(a,b){this.aValues[a].evalid=b};DictionaryObject_Bool.prototype.GetOldValueValidity=function(a){return this.aValues[a].ovalid};DictionaryObject_Bool.prototype.SaveValidity=function(){for(var a=0;a<this.aValues.length;a++){this.aValues[a].ovalid=this.aValues[a].evalid}};DictionaryObject_Bool.prototype.GetAllInValidValues=function(){if(this.Load(this)){var b=[];for(var d=0;d<this.aValues.length;d++){if(!this.aValues[d].valid){b[b.length]=this.aValues[d].aID}}return(b)}return(null)};DictionaryObject_Bool.prototype.SetValueInValid=function(a){if(this.Load(this)){if(a){for(var d=0;d<a.length;d++){for(var b=0;b<this.aValues.length;b++){if(this.aValues[b].aID==a[d]){this.aValues[b].valid=false;break}}}}}};DictionaryObject_Bool.prototype.ClearInvalid=function(){for(var a=0;a<this.aValues.length;a++){this.aValues[a].valid=true}};DictionaryObject_Bool.prototype.GetNselected=function(){if(this.IsEmpty()){return 0}return 1};DictionaryObject_Bool.prototype.GetNvalid=function(){var a=0;for(var b=0;b<this.aValues.length;b++){if(this.aValues[b].valid){a++}}return a};DictionaryObject_Bool.prototype.GetSelectedIndex=function(){return this.ValueIDtoIndex(this.currentValueID)+1};function DictionaryObject_Text(d,e,b,a){DictionaryObject_Text.baseConstructor.call(this,d,e,TYPE_TEXT,b);this.aLength=a;this.currentValue="";this._hintprops=["aType","aName","val([newValue])","clear();","run();","isEmpty()","props","prop(controlPropName[, newValue])"]}ObjectExtend(DictionaryObject_Text,DictionaryObject);DictionaryObject_Text.prototype.Reset=function(){DictionaryObject_Text.superClass.Reset.call(this)};DictionaryObject_Text.prototype.Clear=function(a){this.currentValue="";DictionaryObject_Text.superClass.Clear.call(this);if(this.flatProps&&a){if(this.flatProps.defaultmode=="SetDefault"){if((this.aLength>0)&&(this.flatProps._default.length>this.aLength)){this.SetValue(this.flatProps._default.substring(0,this.aLength))}else{this.SetValue(this.flatProps._default)}}}};DictionaryObject_Text.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID,true);return false}else{return true}};DictionaryObject_Text.prototype.Populate=function(b,a){DictionaryObject_Text.superClass.Populate.call(this,b,a)};DictionaryObject_Text.prototype.toObject=function(){var a=DictionaryObject_Text.superClass.toObject.call(this);a.aLength=this.aLength;return a};DictionaryObject_Text.prototype.GetValue=function(){if(!this.Load(this)){return null}if(!this.isDataFull){if(this.flatProps.defaultmode=="UseDefault"){if((this.aLength>0)&&(this.flatProps._default.length>this.aLength)){return this.flatProps._default.substring(0,this.aLength)}else{return this.flatProps._default}}}return this.currentValue};DictionaryObject_Text.prototype.GetValueAsString=function(){return this.GetValue()};DictionaryObject_Text.prototype.GetValueAsJSON=function(){var a=this.GetValue();a=ElementToStr(a);return a};DictionaryObject_Text.prototype.SetValue=function(a){if(a==PSEUDO_VALUE_EMPTY){this.Clear()}else{if(typeof a=="number"){a=a.toString()}else{if(typeof a=="boolean"){a=a?"true":"false"}else{if(typeof a!="string"){a=""}}}if((this.aLength>0)&&(a.length>this.aLength)){this.currentValue=a.substring(0,this.aLength)}else{this.currentValue=a}DictionaryObject_Text.superClass.SetValue.call(this)}};DictionaryObject_Text.prototype.SetValueAsString=function(a){this.SetValue(a)};DictionaryObject_Text.prototype.val=function(a){if(a===undefined){return this.GetValue()}else{this.SetValue(a);return this}};function DictionaryObject_Var(f,k,h,a,b,e,d,g,j){DictionaryObject_Var.baseConstructor.call(this,f,k,TYPE_VARIABLE,h);this.varType=a;if(this.varType==VARTYPE_NUM){this.aDecPlaces=b}else{this.aStrLength=b}this.dim1=e;this.dim2=d;this.initData=g;if(j&&(j.length>0)){this.description=j}this.tieddialog=0;this.data=null;this._hintprops=["aType","aName","val()","clear();","run();","elementVal(index1[, index2][, newValue])"]}ObjectExtend(DictionaryObject_Var,DictionaryObject);DictionaryObject_Var.prototype.Clear=function(a){DictionaryObject_Var.superClass.Clear.call(this);if($.isArray(this.initData)){if(this.dim1==1){this.data=this.initData.slice(0)}else{this.data=$.extend(true,[],this.initData)}}else{this.data=this.initData}if(a!=undefined){if(((this.varType==VARTYPE_NUM)&&(typeof a=="number"))||((this.varType==VARTYPE_STR)&&(typeof a=="string"))){if(!$.isArray(this.data)){this.data=a}else{for(var d=0;d<this.data.length;d++){if(!$.isArray(this.data[d])){this.data[d]=a}else{for(var b=0;b<this.data[d].length;b++){this.data[d][b]=a}}}}}}};DictionaryObject_Var.prototype.toString=function(){var d=DictionaryObject_Var.superClass.toString.call(this)+"\nType: "+this.varType+"\n";if(this.varType==VARTYPE_NUM){d+="Dec Places: "+this.aDecPlaces}else{d+="Str Length: "+this.aStrLength}d+="\nDimensions: "+this.dim1+","+this.dim2+"\n";var b,a;if(this.dim2!=1){for(b=1;b<=this.dim1;b++){if(b>1){d+=", "}d+="[";for(a=1;a<=this.dim2;a++){if(a>1){d+=", "}d+=this.data[b][a]}d+="]"}}else{if(this.dim1!=1){for(b=1;b<=this.dim1;b++){if(b>1){d+=", "}d+=this.data[b]}}else{d+=this.data}}return d};DictionaryObject_Var.prototype.toObject=function(){var a=DictionaryObject_Var.superClass.toObject.call(this);a.aLength=this.aLength;a.varType=this.varType;if(this.varType==VARTYPE_NUM){a.aDecPlacesOrLength=this.aDecPlaces}else{a.aDecPlacesOrLength=this.aStrLength}a.dim1=this.dim1;a.dim2=this.dim2;a.initData=this.initData;a.description=this.description;return a};DictionaryObject_Var.prototype.isFull=function(){return true};DictionaryObject_Var.prototype.GetValue=function(d,b){if(this.data==null){return null}if(d==null){d=1}if(b==null){b=1}var a="";if(this.dim2!=1){a=this.data[d][b]}else{if(this.dim1!=1){a=this.data[d]}else{a=this.data}}if(this.varType==VARTYPE_NUM){a=parseFloat(a.toFixed(this.aDecPlaces))}return a};DictionaryObject_Var.prototype.SetValue=function(b,e,d){if(b==PSEUDO_VALUE_EMPTY){if((e==null)&&(d==null)){this.Clear();return}if(this.varType==VARTYPE_STR){b=""}else{b=0}}if($.isArray(b)){var a;for(var f=0;(f<this.dim1)&&(f<b.length);f++){a=b[f];if(this.varType==VARTYPE_STR){if(this.aStrLength>0){a=a.substring(0,this.aStrLength)}}else{if(!appSettings.maxNumPrecis){a=RoundDP(a,this.aDecPlaces)}a=Number(a)}if(this.dim2!=1){this.data[f+1][1]=a}else{if(this.dim1!=1){this.data[f+1]=a}else{this.data=a}}}}else{if(this.varType==VARTYPE_STR){b=""+b;if((this.aStrLength>0)&&(b.length>this.aStrLength)){b=b.substring(0,this.aStrLength)}}else{if(!appSettings.maxNumPrecis){b=RoundDP(b,this.aDecPlaces)}b=Number(b)}if(e==null){e=1}if(d==null){d=1}if(this.dim2!=1){this.data[e][d]=b}else{if(this.dim1!=1){this.data[e]=b}else{this.data=b}}}DictionaryObject_Var.superClass.SetValue.call(this)};DictionaryObject_Var.prototype.SetValueAsString=function(a,d,b){this.SetValue(a,d,b)};DictionaryObject_Var.prototype.GetValueAsString=function(d,b){var a=this.GetValue(d,b);if((this.varType==VARTYPE_NUM)&&(typeof(a)=="number")){a=a.toFixed(this.aDecPlaces).toString()}return a};DictionaryObject_Var.prototype.GetValueAsJSON=function(){var d=this.data;if($.isArray(d)){var b=d.slice();b.splice(0,1);d=ArrayToStr(b)}else{d=ElementToStr(d)}return d};DictionaryObject_Var.prototype.SetValueAsJSON=function(aValue){var firstchr=aValue.substr(0,1);if((this.varType==VARTYPE_STR)&&(firstchr!="[")&&(aValue!=PSEUDO_VALUE_EMPTY)){if(firstchr!="'"&&firstchr!='"'){aValue=aValue.replace(/\'/g,"\\'");aValue="'"+aValue+"'"}if(this.aStrLength>0){aValue=aValue+".substring(0,"+this.aStrLength+")"}}if(aValue==PSEUDO_VALUE_EMPTY){this.Clear()}else{this.data=eval(aValue)}if(aValue.substr(0,1)=="["){this.data.splice(0,0,0)}};DictionaryObject_Var.prototype.val=function(b){if(b===undefined){return this.data}else{if((this.dim1==1)&&(this.dim2==1)){this.SetValue(b)}else{if(!$.isArray(b)){hardError("Must specify an array to [val] set method");return}if((b.length==1)&&!$.isArray(b[0])){hardError("First element of array must be an array");return}if((b.length==1)&&(b[0].length<=1)){hardError("First element of array must be at lease a 2 element array");return}var e,a;var d=0;for(e=0;e<b.length;e++){if(!$.isArray(b[e])){a=1}else{a=b[e].length}if(a>d){d=a}}this.dim1=b.length;this.dim2=d;this.data=b.slice(0);this.data.splice(0,0,0);for(e=1;e<this.data.length;e++){if(!$.isArray(this.data[e])){this.data[e]=[0,this.data[e]]}else{this.data[e].unshift(0)}if(this.data[e].length!=this.dim2+1){this.data[e].length=this.dim2+1}}}}};DictionaryObject_Var.prototype.elementVal=function(d,b,a){if((a===undefined)&&(this.dim2==1)){if((this.dim1==1)&&(this.dim2==1)&&(b===undefined)){a=d;d=1;b=1}else{a=b;b=1}}if(a===undefined){return this.GetValue(d,b)}else{return this.SetValue(a,d,b)}};DictionaryObject_Var.prototype.val2=DictionaryObject_Var.prototype.elementVal;function DictionaryObject_Proc(b,d,a){DictionaryObject_Proc.baseConstructor.call(this,b,d,TYPE_PROCEDURE,a);this.aCode=null;this.lastReturn=null;this.loaded=false;this._hintprops=["aType","aName","run();"]}ObjectExtend(DictionaryObject_Proc,DictionaryObject);DictionaryObject_Proc.prototype.toString=function(){var a=DictionaryObject_Proc.superClass.toString.call(this);a+="\ncode :"+this.aCode;return a};DictionaryObject_Proc.prototype.Populate=function(a){if((a!="")&&(a!=null)){this.aCode=a}else{this.aCode=""}DictionaryObject_Proc.superClass.Populate.call(this,null)};DictionaryObject_Proc.prototype.toObject=function(){var a=DictionaryObject_Proc.superClass.toObject.call(this);a.aCode=this.aCode;return a};DictionaryObject_Proc.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID,true);return false}else{return true}};var rsProtected=false;var replayProtection={groups:[],reset:function(){this.groups=[];rsProtected=false},enter:function(){this.groups.push({rsLen:replayStack.replayPos,objs:[]})},exit:function(g,f){if(this.groups.length==0){hardError("Replay protection exit without enter");return}var e;var d=this.groups.pop();for(e=d.rsLen;e<replayStack.aReplay.length;e++){if(replayStack.aReplay[e].aOperation==REPLAY_UI){return}}replayStack.aReplay.splice(d.rsLen,replayStack.aReplay.length-d.rsLen);if(!$.isPlainObject(f)){f={}}f.items=[];for(e=0;e<d.objs.length;e++){var b={id:d.objs[e].aObject.aID};if(d.objs[e].fullStore&&((d.objs[e].aObject.aType==TYPE_LIST)||(d.objs[e].aObject.aType==TYPE_BOOLEAN)||(d.objs[e].aObject.aType==TYPE_NUMERIC)||(d.objs[e].aObject.aType==TYPE_DATE)||(d.objs[e].aObject.aType==TYPE_TEXT))){b.obj=$.extend(true,{},d.objs[e].aObject)}var a=d.objs[e].aObject.val();if($.isArray(a)){a=$.extend(true,[],a)}b.v=a;f.items.push(b)}replayStack.Add(g,REPLAY_GROUPSET,0,0,f);replayStack.replayPos=replayStack.aReplay.length},set:function(a,b){if(this.groups.length>0){if(!b){b=false}var d=this.groups[this.groups.length-1].objs;for(var e=0;e<d.length;e++){if(d[e].aObject.aID==a.aID){if(!d[e].fullStore&&b){d[e].fullStore=true}return}}d.push({aObject:a,fullStore:b})}}};var aIndent=0;DictionaryObject_Proc.prototype.Run2=function(rsProtected,args){aIndent++;if(rsProtected){replayProtection.enter()}var s=this.aCode;if(s.substr(s.length-2)=="()"){s=s.substr(0,s.length-2)}try{if(wrapperOptions.nodejs){var fn;try{if(s.indexOf("(")==-1){fn=eval(s)}else{xrkb_func_args=Array.prototype.slice.call(args);s="(function(){var params = xrkb_func_args;\n"+s+"\n})()";fn=eval(s)}}catch(e){throw e}if($.isFunction(fn)){this.lastReturn=fn.apply(this,args)}else{this.lastReturn=fn}}else{if($.isFunction(window[s])){this.lastReturn=window[s].apply(this,args)}else{xrkb_func_args=Array.prototype.slice.call(args);s="(function(){var params = xrkb_func_args; "+s+"\n})()";this.lastReturn=eval(s)}}}catch(e){aIndent--;if(!(e instanceof inferenceIssue)){hardError("An error was encountered!\n\nProcedure: "+this.aName+(lastErr?"\nLine "+lastErr.ln+"\nCommand: "+lastErr.cmd:"")+"\n\n"+e);return}else{throw e}}if(rsProtected){replayProtection.exit(this.aID,{lastReturn:this.lastReturn})}aIndent--};DictionaryObject_Proc.prototype.Run=function(){this.lastReturn=null;if(!this.Load()){return false}if(rsProtected){if((replayStack.replayPos<replayStack.aReplay.length)&&(replayStack.aReplay[replayStack.replayPos].aOperation==REPLAY_GROUPSET)&&(replayStack.aReplay[replayStack.replayPos].pauseID==this.aID)){var a=replayStack.aReplay[replayStack.replayPos];for(var d=0;d<a.aExtra.items.length;d++){var b=_dgo(a.aExtra.items[d].id);if(b){if(a.aExtra.items[d].obj){if(b.aValues){b.aValues=$.extend(true,[],a.aExtra.items[d].obj.aValues)}if(b.flatProps){b.flatProps=$.extend(true,{},a.aExtra.items[d].obj.flatProps)}}b.val(a.aExtra.items[d].v)}}replayStack.replayPos+=1;this.lastReturn=a.aExtra.lastReturn}else{this.Run2(true,arguments)}}else{this.Run2(false,arguments)}if(this.lastReturn==undefined){return true}else{return this.lastReturn}};DictionaryObject_Proc.prototype.run=function(){return this.Run.apply(this,arguments)};function DictionaryObject_TxtProc(b,d,a){DictionaryObject_TxtProc.baseConstructor.call(this,b,d,TYPE_TXTPROCESSOR,a);this.aCode=null;this.aData=null;this.message="";this.loaded=false}ObjectExtend(DictionaryObject_TxtProc,DictionaryObject);DictionaryObject_TxtProc.prototype.toString=function(){var a=DictionaryObject_TxtProc.superClass.toString.call(this);a+="\ncode :"+this.aCode;return a};DictionaryObject_TxtProc.prototype.toObject=function(){var a=DictionaryObject_TxtProc.superClass.toObject.call(this);a.aData=this.aData;return a};DictionaryObject_TxtProc.prototype.Clear=function(a){if(!this.Load(this)){return null}this.message="";DictionaryObject_TxtProc.superClass.Clear.call(this)};DictionaryObject_TxtProc.prototype.Populate=function(a){this.aCode="";this.aData=null;if($.isPlainObject(a)){this.aData=a}else{if((a!="")&&(a!=null)){this.aCode=a}}DictionaryObject_TxtProc.superClass.Populate.call(this,null)};DictionaryObject_TxtProc.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID,true);return false}else{return true}};DictionaryObject_TxtProc.prototype.SetValue=function(a){this.message=a};DictionaryObject_TxtProc.prototype.GetValue=function(b){var a=this.message;if(b){a=a.replace("'","")}return a};DictionaryObject_TxtProc.prototype.val=function(a){if(a===undefined){return this.GetValue()}else{this.SetValue(a);return this}};DictionaryObject_TxtProc.prototype.atts=function(){var b=[];var e,a,d;for(e=0;e<this.aData.atts.length;e++){a=this.aData.atts[e];d=_dgo(a.aID);if(d){b.push(d)}}return b};DictionaryObject_TxtProc.prototype.Run=function(){if(!this.Load()){return false}if(this.aData){var c,att,o;for(c=0;c<this.aData.atts.length;c++){att=this.aData.atts[c];o=_dgo(att.aID);if(o){switch(o.aType){case TYPE_LIST:o.Clear();break;case TYPE_BOOLEAN:o.SetValueAsBool(false);break}}}var doMatch=function(match,aVal){var re=new RegExp(match,"i");return re.test(aVal)};var aVal=this.GetValue(true);for(c=0;c<this.aData.atts.length;c++){att=this.aData.atts[c];o=_dgo(att.aID);if(o){switch(o.aType){case TYPE_LIST:var vls=o.isMultiSel?[]:PSEUDO_VALUE_EMPTY;for(var v=0;v<att.vals.length;v++){if(doMatch(att.vals[v].match,aVal)){if(o.isMultiSel){vls.push(att.vals[v].aID)}else{vls=att.vals[v].aID;break}}}o.SetValue(vls);break;case TYPE_BOOLEAN:if(doMatch(att.match,aVal)){o.SetValueAsBool(true)}break}}}}else{if(this.aCode){eval(this.aCode)}}return true};DictionaryObject_TxtProc.prototype.run=DictionaryObject_TxtProc.prototype.Run;function DictionaryObject_Report(b,d,a){DictionaryObject_Report.baseConstructor.call(this,b,d,TYPE_REPORT,a);this.aText=null;this.aDisplay="";this.aProps=null;this.objList=null;this.loaded=false}ObjectExtend(DictionaryObject_Report,DictionaryObject);DictionaryObject_Report.prototype.Clear=function(){this.aDisplay="";DictionaryObject_Report.superClass.Clear.call(this)};DictionaryObject_Report.prototype.toString=function(){var a=DictionaryObject_Report.superClass.toString.call(this);a+="\ntext :"+this.aText;return a};DictionaryObject_Report.prototype.Populate=function(b,d,a){if((d!="")&&(d!=null)){this.aText=d;this.objList=a}else{this.aText=""}this.aProps=b;DictionaryObject_Report.superClass.Populate.call(this,null,null)};DictionaryObject_Report.prototype.toObject=function(){var a=DictionaryObject_Report.superClass.toObject.call(this);a.aText=this.aText;a.aProps=this.aProps;return a};DictionaryObject_Report.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID,true);return false}else{return true}};DictionaryObject_Report.prototype.GetText=function(b){if(!this.Load()){return false}else{if((this.aDisplay=="")&&b){if((this.aText.lastIndexOf("()")==this.aText.length-2)&&!wrapperOptions.nodejs){var a=this.aText.substr(0,this.aText.length-2);if($.isFunction(window[a])){this.aDisplay=window[a]()}}if(this.aDisplay==""){this.aDisplay=_expandEmbedded(this.aText,true)}}return this.aDisplay}};DictionaryObject_Report.prototype.GetObjList=function(){if(!this.Load(this)){return null}return this.objList};DictionaryObject_Report.prototype.Run=function(){if(!this.Load()){return false}else{var a=replayStack.PopReplay(this.aID);if(a==REPLAYPOP_HANDLED){return true}else{if(a==REPLAYPOP_CURRENT){this.aDisplay=_expandEmbedded(this.aText,true);throw new inferenceIssue(PASSBACK_PAUSE,this.aID)}else{hardError("Unknown replay pop return ["+a+"]");return}}}};DictionaryObject_Report.prototype.ReportPropValue=function(b,a){if(!this.Load()){return false}else{if(this.aProps){if(a){this.aProps[b]=a}else{return this.aProps[b]}}}};var lastDialogInstanceID=0;function DictionaryObject_Dlg(b,d,a){DictionaryObject_Dlg.baseConstructor.call(this,b,d,TYPE_DIALOG,a);this.loadedDefinition=null;this.formRules=null;this.aDefinition=null;this.aObjectList=[];this.aEmbeddedList=[];this.aPropList=[];this.aBoolCheckBoxList=null;this.isSubDialog=false;this.currentTiedObj=null;this.dialogUI=null;this.loaded=false;this.dirty=false;this._hintprops=["aType","aName","findControl(controlName)","run();"]}ObjectExtend(DictionaryObject_Dlg,DictionaryObject);DictionaryObject_Dlg.prototype.Clear=function(a){if(this.aDefinition&&this.aDefinition.instanceatts){for(var b=0;b<this.aDefinition.instanceatts.length;b++){if(this.aDefinition.instanceatts[b].data){delete this.aDefinition.instanceatts[b].data}}}};DictionaryObject_Dlg.prototype.Reset=function(){DictionaryObject_Dlg.superClass.Reset.call(this);if(this.dirty){this.aDefinition=$.extend(true,{},this.loadedDefinition);this.dirty=false}};DictionaryObject_Dlg.prototype.toString=function(){var a=DictionaryObject_Dlg.superClass.toString.call(this);a+="\ndefinition :"+this.aDefinition;return a};DictionaryObject_Dlg.prototype.createAttInstances=function(){if(this.aDefinition){if(this.aDefinition.instanceatts){if(this.aDefinition.instanceatts.length>0){for(var d=0;d<this.aDefinition.instanceatts.length;d++){if(!this.aDefinition.instanceatts[d].data){var b=_dgo(this.aDefinition.instanceatts[d].att);if(b){var a=null;if(b.aType==TYPE_DIALOG){a={current:0,dialogs:[]}}else{if(b.flatProps&&b.flatProps.instanceatts){a={current:0,dialogs:[]}}else{if(this.isSubDialog){a=$.extend(true,{},b);a.Clear();a.ResetInstanceRef()}else{a=null}}}this.aDefinition.instanceatts[d].data=a}}}}}}return true};DictionaryObject_Dlg.prototype.ResetInstanceRef=function(){DictionaryObject_Dlg.superClass.ResetInstanceRef.call(this);if(this.aDefinition){if(this.aDefinition.instanceatts){for(var b=0;b<this.aDefinition.instanceatts.length;b++){var a=_dgo(this.aDefinition.instanceatts[b].att,true);if(a){if((a.aType==TYPE_DIALOG)||(a.flatProps&&a.flatProps.instanceatts)){this.aDefinition.instanceatts[b].data={current:0,dialogs:[]}}}}}}};DictionaryObject_Dlg.prototype.assignAttInstancesToDictinary=function(){if(this.aDefinition.instanceatts&&this.isSubDialog){for(var d=0;d<this.aDefinition.instanceatts.length;d++){var a=this.aDefinition.instanceatts[d].data;if(a){var b=_dgo(this.aDefinition.instanceatts[d].att,true);if(b.aType!=TYPE_DIALOG){b.PushInstanceRef(a)}}}}};DictionaryObject_Dlg.prototype.revertAttInstancesToDictinary=function(){if(this.aDefinition.instanceatts){for(var b=0;b<this.aDefinition.instanceatts.length;b++){var a=_dgo(this.aDefinition.instanceatts[b].att,true);if(a){if(a.aType!=TYPE_DIALOG){a.PopInstanceRef()}}}}};DictionaryObject_Dlg.prototype.GetDialogInstObject=function(a){if(this.aDefinition.instanceatts){for(var b=0;b<this.aDefinition.instanceatts.length;b++){if(this.aDefinition.instanceatts[b].att==a){if(this.aDefinition.instanceatts[b].data!=null){return this.aDefinition.instanceatts[b].data}else{return dictionary.GetObject(a)}}}}return null};DictionaryObject_Dlg.prototype.GetDialogInstObjectByName=function(f,a){if(a){f=f.toLowerCase()}if(this.aDefinition.instanceatts){for(var e=0;e<this.aDefinition.instanceatts.length;e++){var d=dictionary.GetObject(this.aDefinition.instanceatts[e].att);if(d){var b=d.aName;if(a){b=b.toLowerCase()}if(b==f){if(this.aDefinition.instanceatts[e].data!=null){return this.aDefinition.instanceatts[e].data}else{return dictionary.GetObjectByName(f,a)}}}}}return null};DictionaryObject_Dlg.prototype.clearSubDlgInstances=function(){if(this.aDefinition.instanceatts){for(var a=0;a<this.aDefinition.instanceatts.length;a++){if(this.aDefinition.instanceatts[a].data!=null){this.aDefinition.instanceatts[a].data.dialogs=[]}}}};DictionaryObject_Dlg.prototype.addSubDlgInstance=function(d){if(!this.Load(this)){return null}var a=this.GetDialogInstObject(d);if(!a){return -1}var e=dictionary.GetObject(d,true);var b=$.extend(true,{},e);b.isSubDialog=true;b.createAttInstances();a.dialogs[a.dialogs.length]=b;return a.dialogs.length-1};DictionaryObject_Dlg.prototype.runSubDlgInstance=function(f,d){var b=this.GetDialogInstObject(f);if(!b){return null}if((d<0)||(d>=b.dialogs.length)){hardError("Sub dialog instance index out of bounds ["+d+"] for "+this.aName);return}var a=b.dialogs[d];b.current=d+1;var g=_dgo(f,true);g.PushInstanceRef(a);var e=replayStack.onFormTree;replayStack.onFormTree=false;if(a.Run()){g.PopInstanceRef();b.current=0;replayStack.onFormTree=e;return true}else{return false}};DictionaryObject_Dlg.prototype.delSubDlgInstance=function(d,b){var a=this.GetDialogInstObject(d);if(!a){return null}if((b<0)||(b>=a.dialogs.length)){hardError("Sub dialog instance index out of bounds ["+b+"] for "+this.aName);return}a.dialogs=a.dialogs.slice(0,b).concat(a.dialogs.slice(b+1));for(var e=0;e<this.aDefinition.instanceatts.length;e++){if(this.aDefinition.instanceatts[e].att==d){this.aDefinition.instanceatts[e].data=a}}};DictionaryObject_Dlg.prototype.GetDialogAttribData=function(a,e,d){var b=this.GetDialogInstObject(a);if(!b){hardError("Can not locate Attribute ID ["+a+"] for "+this.aName);return}if(typeof d=="string"){switch(d.toLowerCase()){case"count":return b.dialogs.length;case"current":return b.current}}else{if(e==0){return b.GetValueAsString()}else{e--;if((e<0)||(e>=b.dialogs.length)){hardError("Sub dialog instance index out of bounds ["+e+"] for "+this.aName);return}for(c=0;c<b.dialogs[e].aDefinition.instanceatts.length;c++){if(b.dialogs[e].aDefinition.instanceatts[c].isvisible&&(b.dialogs[e].aDefinition.instanceatts[c].att==d)){var f=b.dialogs[e].GetDialogInstObject(d);return f.GetValueAsString()}}}}return null};function AddObject(a,b){if(b){for(var d=0;d<a.length;d++){if(a[d]==b){return}}a[a.length]=b}}DictionaryObject_Dlg.prototype.BuildObjectList=function(a){switch(a.aType){case CONTROL_LISTBOX:AddObject(this.aObjectList,a.tieditem);break;case CONTROL_NUMERIC:AddObject(this.aObjectList,a.tieditem);break;case CONTROL_ARRAYEDIT:AddObject(this.aObjectList,a.tieditem);break;case CONTROL_CHECKBOX:AddObject(this.aObjectList,a.tieditem);break;case CONTROL_RADIOBTN:AddObject(this.aObjectList,a.tieditem);break;case CONTROL_ARRAYLIST:AddObject(this.aObjectList,a.tieditem);AddObject(this.aObjectList,a.indexvariable);break;case CONTROL_HOTSPOT:AddObject(this.aObjectList,a.tieditem);break;case CONTROL_GRID:AddObject(this.aObjectList,a.tieditem);break;case CONTROL_DATE:AddObject(this.aObjectList,a.tieditem);break;case CONTROL_TABSHEET:for(var d=0;d<a.tabsheets;d++){for(var b=0;b<a.tabsheets[d].controls.length;b++){this.BuildObjectList(a.tabsheets[d].controls[b])}}break;case CONTROL_FRAME:AddObject(this.aObjectList,a.tieditem);break}};DictionaryObject_Dlg.prototype.BuildEmbList=function(a){var d=this;function b(m,l){if(l){var k=/dictionary\.GetObject\((.*?)\)/g;var j=k.exec(l);if(j){var h={cntrl:a?a.aName:"",prop:m,value:l};d.aPropList.push(h);do{var g=parseInt(j[1],10);if(g&&$.inArray(g,d.aEmbeddedList)==-1){d.aEmbeddedList.push(g)}}while(j=k.exec(l))}}}var f,e;if(!a){b("caption",this.aDefinition.caption);b("bkgndimage",this.aDefinition.bkgndimage);for(f=0;f<this.aDefinition.controls.length;f++){this.BuildEmbList(this.aDefinition.controls[f])}}else{if(a.hasOwnProperty("caption")){b("caption",a.caption)}if(a.hasOwnProperty("imagepath")){b("imagepath",a.imagepath)}if(a.hasOwnProperty("tabsheets")){for(f=0;f<a.tabsheets.length;f++){for(e=0;e<a.tabsheets[f].controls.length;e++){this.BuildEmbList(a.tabsheets[f].controls[e])}}}}};DictionaryObject_Dlg.prototype.StaticCaptions=function(aCtrlList){for(var c=0;c<aCtrlList.length;c++){if(aCtrlList[c].hasOwnProperty("caption")){var s=aCtrlList[c].caption;if((s.substr(0,1)=="'")&&(s.substr(s.length-1,1)=="'")){s=s.substr(1,s.length-2);if(s.indexOf("'")==-1){if(s.indexOf("\\")>=0){s=eval("'"+s+"'")}aCtrlList[c].caption=s}}}if($.isArray(aCtrlList[c].tabsheets)){for(var cc=0;cc<aCtrlList[c].tabsheets.length;cc++){this.StaticCaptions(aCtrlList[c].tabsheets[cc].controls)}}if($.isArray(aCtrlList[c].controls)){this.StaticCaptions(aCtrlList[c].controls)}}};DictionaryObject_Dlg.prototype.Populate=function(a,d){this.StaticCaptions(a.controls);this.loadedDefinition=a;this.formRules=(d?d:null);this.aDefinition=$.extend(true,{},this.loadedDefinition);this.dirty=false;DictionaryObject_Dlg.superClass.Populate.call(this,null);this.aObjectList=[];if($.isArray(this.aDefinition.usage)){this.aObjectList=this.aDefinition.usage}else{for(var b=0;b<this.aDefinition.controls.length;b++){this.BuildObjectList(this.aDefinition.controls[b])}}this.BuildEmbList();this.createAttInstances(0)};DictionaryObject_Dlg.prototype.toObject=function(){var a=DictionaryObject_Dlg.superClass.toObject.call(this);a.loadedDefinition=this.loadedDefinition;a.formRules=this.formRules;return a};DictionaryObject_Dlg.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID);return false}else{return true}};DictionaryObject_Dlg.prototype.GetControlByName=function(h,e){if(e==null){e=this.aDefinition.controls}h=h.toLowerCase();var d;for(var g=0;g<e.length;g++){if(e[g].aName.toLowerCase()==h){return e[g]}if($.isArray(e[g].tabsheets)){for(var f=0;f<e[g].tabsheets.length;f++){d=this.GetControlByName(h,e[g].tabsheets[f].controls);if(d!=null){return d}}}if($.isArray(e[g].controls)){d=this.GetControlByName(h,e[g].controls);if(d!=null){return d}}if(e[g].aType=="container"){var b=dgo(this.aDefinition.pid);if(b){var a=b.GetControlByName(h,null);if(a){return a}}}}return null};DictionaryObject_Dlg.prototype.findCtrlParent=function(b){var a=function(e){var g,f,d;for(g=0;g<e.length;g++){if(e[g].aID==b){return{list:e,idx:g}}if($.isArray(e[g].tabsheets)){for(f=0;f<e[g].tabsheets.length;f++){d=a(e[g].tabsheets[f].controls);if(d){return d}}}if($.isArray(e[g].controls)){d=a(e[g].controls);if(d){return d}}}return null};return a(this.aDefinition.controls)};DictionaryObject_Dlg.prototype.GetControlByID=function(b,d){if(d==null){d=this.aDefinition.controls}var a;for(var f=0;f<d.length;f++){if(d[f].aID==b){return d[f]}if($.isArray(d[f].tabsheets)){for(var e=0;e<d[f].tabsheets.length;e++){a=this.GetControlByID(b,d[f].tabsheets[e].controls);if(a!=null){return a}}}if($.isArray(d[f].controls)){a=this.GetControlByID(b,d[f].controls);if(a!=null){return a}}}return null};DictionaryObject_Dlg.prototype.GetDialogControlValue=function(aCont,propName){var aText="";var aControl=null;if(!this.Load(this)){return aText}if(aCont==""){aCont=null}if(!aCont){aText=this.aDefinition[propName.toLowerCase()]}else{if(typeof aCont=="string"){aControl=this.GetControlByName(aCont.toLowerCase())}else{aControl=this.GetControlByID(aCont)}}if((aText=="")&&(aControl!=null)){aText=aControl[propName.toLowerCase()]}if((typeof aText=="string")&&(aText!="")){if(aText=="''"){return""}if(aText.substr(0,1)=="'"){aText=eval(aText)}}return aText};DictionaryObject_Dlg.prototype.findControl=function(a){return this.GetControlByName(a.toLowerCase())};DictionaryObject_Dlg.prototype.val=function(a,d,b){if(b!=undefined){this.SetDialogControlValue(a,d,b)}else{return this.GetDialogControlValue(a,d)}};DictionaryObject_Dlg.prototype.SetDialogControlValue=function(m,g,e,a,k,l){if(!this.Load(this)){return false}var h=null;if(m==""){m=null}if(!m){this.aDefinition[g]=e;return true}else{if(typeof(m)=="string"){h=this.GetControlByName(m.toLowerCase())}else{h=this.GetControlByID(m)}}if(h==null){hardError("Unknown control ["+m+"] on dialog ["+this.aName+"]");return}if(!h.hasOwnProperty(g)){g=g.toLowerCase()}if(g=="tieditem"){var b=dictionary.GetObjectByName(e);var f=h[g];h[g]=b.aID;if((f!=0)&&(f!=b.aID)){if(rebuildControl(f,h)){if($.isArray(this.aDefinition.usage)){this.aObjectList=this.aDefinition.usage}else{this.aObjectList=[];for(var d=0;d<this.aDefinition.controls.length;d++){this.BuildObjectList(this.aDefinition.controls[d])}}}}}else{if($.isArray(h[g])){if(a){h[g][a-1][k]=e}else{if(l){for(var j=0;j<h[g].length;j++){if(h[g][j].id==l){h[g][j][k]=e;break}}}}}else{h[g]=e}}return true};function SetDefaultControl(f,b){var e;for(var h=0;h<f.length;h++){var d=f[h];if(d.aType=="checkbox"){if(d.controltype!="buttonset"){e=_dgo(d.tieditem);if(e){if(!e.isFull()&&(e.aType==TYPE_BOOLEAN)&&(e.flatProps.defaultmode=="")){e.SetValueAsBool(false)}}}}else{if(d.aType=="slider"){e=_dgo(d.tieditem);if(e){if(!e.isFull()){var a=e.flatProps.minvalue;if(e.flatProps._default&&e.flatProps._default>e.flatProps.minvalue&&e.flatProps._default<=e.flatProps.maxvalue){a=e.flatProps._default}e.SetValue(a)}}}else{e=null;if(b){e=b}else{if(d.hasOwnProperty("tieditem")){e=_dgo(d.tieditem)}}if(e){if(!e.isFull()){if(e.flatProps&&(e.flatProps.defaultmode=="UseDefault")){e.SetValue(e.GetValue())}}}if($.isArray(d.tabsheets)){for(var g=0;g<d.tabsheets.length;g++){SetDefaultControl(d.tabsheets[g].controls)}}else{if($.isArray(d.controls)){SetDefaultControl(d.controls)}}}}}}DictionaryObject_Dlg.prototype.AssignNumSliders=function(a){if((a.aType==CONTROL_NUMERIC)&&(a.style=="horzscroll")){var b=dictionary.GetObject(a.tieditem);if(b&&!b.isFull()){b.SetValue(a.scrollrangemin)}}if($.isArray(a.controls)){for(var d=0;d<a.controls.length;d++){this.AssignNumSliders(a.controls[d])}}};DictionaryObject_Dlg.prototype.InitAttrib=function(){var b,a;for(b=0;b<this.aObjectList.length;b++){if(this.aObjectList[b]!=0){a=dictionary.GetObject(this.aObjectList[b]);if(a&&!a.Load(a)){return false}}}if(this.aDefinition){if(this.aDefinition.instanceatts){for(b=0;b<this.aDefinition.instanceatts.length;b++){a=_dgo(this.aDefinition.instanceatts[b].att);if(a&&!a.Load(a)){return false}}}}if(this.aBoolCheckBoxList){for(b=0;b<this.aBoolCheckBoxList.length;b++){a=dictionary.GetObject(this.aBoolCheckBoxList[b]);if(!a.Load(a)){return false}if((a.aType==TYPE_BOOLEAN)&&(!a.isFull())){a.SetValueAsBool(false)}}}if(isMobile){this.AssignNumSliders(this.aDefinition)}};DictionaryObject_Dlg.prototype.AppendCapturedAtts=function(a){for(var b=0;b<this.aObjectList.length;b++){if(this.aObjectList[b]!=0){AppendCapturedAtt(this.aObjectList[b])}}if(a){AppendCapturedAtt(a.aID)}};DictionaryObject_Dlg.prototype.DoUpdates=function(a){for(var d=0;d<this.aObjectList.length;d++){if(this.aObjectList[d]!=0){var b=_dgo(this.aObjectList[d]);if(b){b.FireEvent(EVENT_UPDATE)}}}if(a){a.FireEvent(EVENT_UPDATE)}};DictionaryObject_Dlg.prototype.RunAsTied=function(l,h){var d;if(!h){h=0}if(!this.isSubDialog){if($.inArray(this.aID,baseDialogs)==-1){baseDialogs.push(this.aID)}}this.currentTiedObj=l;activeDialogStack.push(this.aID);if(!this.Load()){return false}this.assignAttInstancesToDictinary(h);this.InitAttrib();this.AppendCapturedAtts(l);SetDefaultControl(this.aDefinition.controls,l);if(this.aDefinition.initialupdates){this.DoUpdates(l)}if(this.aDefinition.onenter){d=_dgo(this.aDefinition.onenter);if(d){d.Run(this)}}var a=replayStack.PopReplay(this.aID);if(a==REPLAYPOP_HANDLED){if(this.aDefinition.rules){if(currentDlg.aID==this.aID){this.dialogUI=currentDlg;this.aDefinition.rules(false)}}if(this.aDefinition.onexit){d=_dgo(this.aDefinition.onexit);if(d){d.Run(this)}}var e=this.aID+(l?"_"+l.aID:"");var m=$("#xruipage").parent();var g=m.find(".xrkb-htmldlg-body[aID="+e+"]");var k=parseInt(g.attr("idx"),10);g.remove();var b=m.find(".xrkb-htmldlg-body[idx="+k+"]");if(b.length!==0){b.show()}activeDialogStack.length=activeDialogStack.length-1}else{if(a==REPLAYPOP_CURRENT){var j=(!currentDlg||currentDlg.aID!=this.aID||currentDlg.tiedObj!=this.currentTiedObj||this.currentTiedObj===true);if(wrapperOptions.nodejs||wrapperOptions.xrengine){if(j&&!replayStack.LastOperationWasValidatedOK()){replayStack.RenderingUI(this.aID)}if(this.aDefinition&&this.aDefinition.usage&&this.aDefinition.usage.length>0){if(this.aDefinition.usage[0]!=-1){Constrain(this.aDefinition.usage)}}throw new inferenceIssue(PASSBACK_DIALOG,this.aName,{tiedObj:l})}if(j){if(currentDlg){currentDlg.free();currentDlg=undefined}var f={aID:this.aID,tiedObj:l,isFluid:false};ClearUI(this.aID,false,replayStack.LastOperationWasValidatedOK());currentDlg=XRdialog.create($("#xrui"),this.aDefinition,f,this.formRules);currentDlg.render()}this.dialogUI=currentDlg;currentDlg.populate();if(j&&this.aDefinition.onshow){d=_dgo(this.aDefinition.onshow);if(d){d.Run(this)}}if(this.aDefinition.onupdate){d=_dgo(this.aDefinition.onupdate);if(d){d.Run(this)}}throw new inferenceIssue(PASSBACK_WAIT)}else{if(a==REPLAYPOP_STOP){return false}else{hardError("Unknown replay pop return ["+a+"]");return}}}this.revertAttInstancesToDictinary();this.currentTiedObj=null;return true};DictionaryObject_Dlg.prototype.Run=function(a){return this.RunAsTied(null,a)};DictionaryObject_Dlg.prototype.FrameSet=function(a,e,d,b){if(b==null){b=this.aDefinition.controls}for(var h=0;h<b.length;h++){if(b[h].frame==a){if(b[h].hasOwnProperty(e)){b[h][e]=d}else{if(b[h].tieditem){var f=dictionary.GetObject(b[h].tieditem);if(f){switch(e){case"visible":if(f.flatProps&&f.flatProps.hasOwnProperty("isvisible")){f.flatProps.isvisible=d}break;case"enabled":if(f.flatProps&&f.flatProps.hasOwnProperty("isenabled")){f.flatProps.isenabled=d}break;case"allowblank":if(f.flatProps&&f.flatProps.hasOwnProperty("allowblank")){f.flatProps.allowblank=d}break}}}}}if($.isArray(b[h].tabsheets)){for(var g=0;g<b[h].tabsheets.length;g++){this.FrameSet(a,e,d,b[h].tabsheets[g].controls)}}if($.isArray(b[h].controls)){this.FrameSet(a,e,d,b[h].controls)}}};function ValidationCtrl(b,a){this.ctrl=b;this.aValue=a}function FindInvalid(b,a){for(var d=0;d<b.length;d++){if(b[d].ctrl.aID==a){return d}}return -1}function AddInvalid(b,a,d){if(FindInvalid(b,a.aID)==-1){b[b.length]=new ValidationCtrl(a,d)}}function RemoveInvalid(b,a){var d=FindInvalid(b,a);if(d!=-1){b.splice(d,1)}}function ValidatingCtrl(b,a){if(b===true){return true}else{if(b===false){return false}else{if(typeof b!="object"){return false}}}return b.aID==a}DictionaryObject_Dlg.prototype.ValidateControl=function(aControl,validation){if(aControl.aType==CONTROL_TABSHEET){for(var c=0;c<aControl.tabsheets;c++){if(aControl.tabsheets[c].isvisible){for(var cc=0;cc<aControl.tabsheets[c].controls.length;cc++){this.ValidateControl(aControl.tabsheets[c].controls[cc],validation)}}}}else{if(aControl.validation){var procName=aControl.validation;if(procName!=""){var tied=(aControl.tieditem?dictionary.GetObject(aControl.tieditem):this.currentTiedObj);var tiedName=(tied?tied.aName:"");var aValue=eval(procName+"('"+tiedName+"')");if((aValue!=true)&&(aValue!=undefined)){AddInvalid(validation,aControl,aValue)}}}}};DictionaryObject_Dlg.prototype.Validation=function(d){var a=[];if(d){this.ValidateControl(d,a)}else{for(var b=0;b<this.aDefinition.controls.length;b++){this.ValidateControl(this.aDefinition.controls[b],a)}}return a};function Dialog_FindProgressButton(a){for(var b=0;b<a.length;b++){if((a[b].aType=="button")&&((a[b].buttontype=="ok")||(a[b].buttontype=="change"))){return a[b]}}return null}function Dialog_FindNearestButton(a,e){var h,d,f,b;var g=false;for(h=0;h<e.length;h++){if(e[h].aID==a){g=true;break}}if(g){b=Dialog_FindProgressButton(e);return b!=null?b:true}else{for(h=0;h<e.length;h++){if(e[h].hasOwnProperty("tabsheets")){for(d=0;d<e[h].tabsheets.length;d++){f=Dialog_FindNearestButton(a,e[h].tabsheets[d].controls);if(f){if(f===true){b=Dialog_FindProgressButton(e);if(b!=null){f=b}}return f}}}}return false}}function RepopulateDefinitionFromDictionary(b,a){function f(g,j){if($.isPlainObject(g)){for(var d in g){if((typeof d=="string")&&((d=="tab")||(d.substr(0,1)=="$"))){break}if((typeof g[d]=="number")||(typeof g[d]=="boolean")||(typeof g[d]=="string")){j[d]=g[d]}else{if(j.hasOwnProperty(d)){f(g[d],j[d])}}}}else{if($.isArray(g)){for(var h=0;h<g.length;h++){if((typeof g[h]=="number")||(typeof g[h]=="boolean")||(typeof g[h]=="string")){j[h]=g[h]}else{f(g[h],j[h])}}}}}var e=_dgo(b);if(e&&(e.aType==TYPE_DIALOG)){f(e.aDefinition,a)}}function _GetControlByName(f,b){var a;f=f.toLowerCase();for(var e=0;e<b.length;e++){if(b[e].aName.toLowerCase()==f){return b[e]}if($.isArray(b[e].tabsheets)){for(var d=0;d<b[e].tabsheets.length;d++){a=this._GetControlByName(f,b[e].tabsheets[d].controls);if(a!=null){return a}}}if($.isArray(b[e].controls)){a=this._GetControlByName(f,b[e].controls);if(a!=null){return a}}}}function _SetTreeDialogDef(f,e,d,b){var a=this._GetControlByName(e,f.controls);if(a!=null){a[d]=b}}function renameCtrlInFormRules(e,b,a){if(e&&$.isArray(e.items)){for(var g=0;g<e.items.length;g++){var d=e.items[g];var f;for(f=0;f<d.conditions.length;f++){if(d.conditions[f].ctrl==b){d.conditions[f].ctrl=a}}for(f=0;f<d.actions.length;f++){if(d.actions[f].ctrl==b){d.actions[f].ctrl=a}}for(f=0;f<d.elses.length;f++){if(d.elses[f].ctrl==b){d.elses[f].ctrl=a}}}}}function DictionaryObject_Constr(d,b,a){DictionaryObject_Constr.baseConstructor.call(this,d,"~__CTAB",TYPE_CTABLE,a);this.aObjectList=b;this.aTables=null;this.aProcs=null;this.loaded=false}ObjectExtend(DictionaryObject_Constr,DictionaryObject);DictionaryObject_Constr.prototype.toString=function(){var a=DictionaryObject_Constr.superClass.toString.call(this);a+="\nobjects :"+this.aObjectList;a+="\ntables :"+this.aTables;return a};DictionaryObject_Constr.prototype.Populate=function(b,a){this.aTables=b;this.aProcs=a;DictionaryObject_Constr.superClass.Populate.call(this,null)};DictionaryObject_Constr.prototype.LookupObjs=function(){var b;for(var d=0;d<this.aTables.length;d++){this.aTables[d].oatts=[];for(b=0;b<this.aTables[d].atts.length;b++){for(var f=0;f<this.aObjectList.length;f++){if(this.aObjectList[f]==this.aTables[d].atts[b]){this.aTables[d].oatts[b]=dictionary.GetObject(this.aObjectList[f]);break}}}}if(this.aProcs){for(var e=0;e<this.aProcs.length;e++){this.aProcs[e].oatts=[];this.aProcs[e].aObject=dictionary.GetObject(this.aProcs[e].aID);for(b=0;b<this.aProcs[e].atts.length;b++){this.aProcs[e].oatts[b]=dictionary.GetObject(this.aProcs[e].atts[b])}}}};DictionaryObject_Constr.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID);return false}return true};function IsSelOrValid(a,b,d){if(a.aValues.length==0){return false}else{if(a.isFull()&&!d){return a.IsValueIndexSelected(b)}else{if(!a.isFull()&&!d&&(a.aType==TYPE_LIST)&&a.isMultiSel){return false}}}return a.GetValueValidity(b)!=VALID_FALSE}function SetValidity(a,b,e){var d;d=a.GetValueValidity(b);if(((d==VALID_UNKNOWN)||(d==VALID_NEWFALSE)||(d==VALID_TRUE))&&e){a.SetValueValidity(b,VALID_NEWTRUE);return true}else{if(((d==VALID_UNKNOWN)||(d==VALID_TRUE))&&!e){a.SetValueValidity(b,VALID_NEWFALSE);return true}}return false}function ConvertNewValidities(b){var a=false;var e,f,d;if((b.aType==TYPE_LIST)||(b.aType==TYPE_BOOLEAN)){d=b.GetNvalues()}else{d=1}for(var g=0;g<d;g++){e=b.GetValueValidity(g);f=b.GetOldValueValidity(g);if(e==VALID_NEWFALSE){if(f!=VALID_FALSE){b.SetValueValidity(g,VALID_FALSE);a=true}else{b.SetValueValidity(g,f)}}else{if(e==VALID_NEWTRUE){if(f!=VALID_TRUE){b.SetValueValidity(g,VALID_TRUE);a=true}else{b.SetValueValidity(g,f)}}}}return a}function procScan(g,b,e,f,l){var j;if(l>=g.oatts.length){var d=rsProtected;rsProtected=false;var k=g.aObject.Run();rsProtected=d;for(j=0;j<g.oatts.length;j++){if((f[j]>=0)&&(f[j]!==null)){SetValidity(g.oatts[j],f[j],k)}else{if(g.oatts[j].aType==TYPE_NUMERIC){SetValidity(g.oatts[j],-1,k)}}}}else{j=g.oatts[l];if((j.aID!=b)&&(((j.aType==TYPE_LIST)||(j.aType==TYPE_BOOLEAN))&&(e[l]!==0))||((j.aType==TYPE_NUMERIC)&&(e[l]!==null))){f[l]=-1;procScan(g,b,e,f,l+1)}else{if(j.aType==TYPE_NUMERIC){f[l]=null;procScan(g,b,e,f,l+1)}else{for(var h=0;h<j.aValues.length;h++){if(j.GetValueValidity(h)!=VALID_FALSE){f[l]=h;j.SetValue(j.aValues[h].aID);procScan(g,b,e,f,l+1)}}}}}}function processConstrProc(d,h){var b,j,g;var e=new Array(d.oatts.length);for(b=0;b<d.oatts.length;b++){e[b]=d.oatts[b].GetValue()}var f=new Array(d.oatts.length);procScan(d,h,e,f,0);for(b=0;b<d.oatts.length;b++){if((e[b]===null)||(e[b]===0)){g=null;if(d.oatts[b].aValues){g=new Array(d.oatts[b].aValues.length);for(j=0;j<d.oatts[b].aValues.length;j++){g[j]=d.oatts[b].aValues[j].valid}}else{g=d.oatts[b].valid}d.oatts[b].SetValue(PSEUDO_VALUE_EMPTY);if(d.oatts[b].aValues){for(j=0;j<d.oatts[b].aValues.length;j++){d.oatts[b].aValues[j].valid=g[j]}}else{d.oatts[b].valid=g}}else{d.oatts[b].SetValue(e[b])}}}function isEmptyLogical(a){if((a.aType!=TYPE_LIST)&&(a.aType!=TYPE_BOOLEAN)){return false}if(!a.IsEmpty()){return false}if((a.aType==TYPE_LIST)&&a.isMultiSel){return false}return true}DictionaryObject_Constr.prototype.Run=function(){if(!this.Load()){return}var y;var B;var x;var d;var m;var D;var h;var l;var j;var k;var p;var u;var C;var b;var f;var E;var q;var g;var z;var A=false;var n;this.LookupObjs();for(B=0;B<this.aObjectList.length;B++){if(this.aObjectList[B]!=0){p=dictionary.GetObject(this.aObjectList[B]);if(!p.Load()){return}if(isEmptyLogical(p)){A=true}if(p.aType==TYPE_NUMERIC){A=true}}}if(A){C=-1}else{C=0}for(;C<this.aObjectList.length;C++){if(C>=0){p=dictionary.GetObject(this.aObjectList[C]);switch(p.aType){case TYPE_LIST:case TYPE_BOOLEAN:if(isEmptyLogical(p)){continue}break;default:continue}}for(B=0;B<this.aObjectList.length;B++){p=dictionary.GetObject(this.aObjectList[B]);if((p.aType==TYPE_LIST)||(p.aType==TYPE_BOOLEAN)||(p.aType==TYPE_NUMERIC)){p.UnknownInvalids()}}do{y=false;for(B=0;B<this.aTables.length;B++){x=this.aTables[B];try{for(D=0;D<x.oatts.length;D++){if((x.oatts[D].aType==TYPE_LIST)||(x.oatts[D].aType==TYPE_BOOLEAN)||(x.oatts[D].aType==TYPE_NUMERIC)){x.oatts[D].SaveValidity()}}n=[];if(x.startinvalid){l=x.oatts[x.oatts.length-1];for(h=0;h<l.aValues.length;h++){n.push(h)}}for(m=0;m<x.rows.length;m++){d=x.rows[m];j=true;for(D=0;j&&(D<x.oatts.length);D++){if(C<0){b=false}else{b=(x.oatts[D].aID==this.aObjectList[C])}switch(d[D].ty){case TY_SV:if(!IsSelOrValid(x.oatts[D],d[D].vl,b)){j=false}break;case TY_MV:for(h=0,k=false;(!k)&&(h<d[D].vl.length);h++){if(IsSelOrValid(x.oatts[D],d[D].vl[h],b)){k=true}}if(!k){j=false}break;case TY_NT:if(x.oatts[D].isFull()){E=x.oatts[D].GetValue();q=d[D].vl;if((x.oatts[D].aType==TYPE_LIST)||(x.oatts[D].aType==TYPE_BOOLEAN)){for(h=0;j&&(h<q.length);h++){z=q[h].vl;switch(q[h].cp){case"<":if(E>=z){j=false}break;case"<=":if(E>z){j=false}break;case">":if(E<=z){j=false}break;case">=":if(E<z){j=false}break;case"=":if(E!=z){j=false}break;case"<>":if(E==z){j=false}break}}}else{if(q[0].at){z=_dgo(q[0].at).val()}else{z=q[0].vl}switch(q[0].cp){case"<":if(E>=z){j=false}break;case"<=":if(E>z){j=false}break;case">":if(E<=z){j=false}break;case">=":if(E<z){j=false}break;case"=":if(E!=z){j=false}break;case"<>":if(E==z){j=false}break}}}break;case TY_AT:hardError("Attribute comparison still in constraint table");return}}if(j){u=d[x.oatts.length];for(D=0;D<x.oatts.length;D++){switch(d[D].ty){case TY_SV:SetValidity(x.oatts[D],d[D].vl,u);break;case TY_MV:for(h=0;h<d[D].vl.length;h++){SetValidity(x.oatts[D],d[D].vl[h],u)}break;case TY_NT:SetValidity(x.oatts[D],0,u);break;case TY_AV:if((x.oatts[D].aType==TYPE_LIST)||(x.oatts[D].aType==TYPE_BOOLEAN)){for(h=x.oatts[D].GetNvalues()-1;h>=0;h--){SetValidity(x.oatts[D],h,u)}}break}}if(x.startinvalid){if(d[x.oatts.length-1].ty==TY_SV){n.splice($.inArray(d[x.oatts.length-1].vl,n),1)}}}else{D--;if(!d[D].hasOwnProperty("jp")){m++}else{if(d[D].jp!=0){m=d[D].jp}else{m=x.rows.length}}m--}}if(x.startinvalid){for(D=0;D<n.length;D++){SetValidity(x.oatts[x.oatts.length-1],n[D],0)}}for(D=0;D<x.oatts.length;D++){if((x.oatts[D].aType==TYPE_LIST)||(x.oatts[D].aType==TYPE_BOOLEAN)||(x.oatts[D].aType==TYPE_NUMERIC)){if(ConvertNewValidities(x.oatts[D])){y=true}}}}catch(w){if(!(w instanceof inferenceIssue)){hardError("An error was encountered in constraint ["+_dgo(x.oid).aName+"]\n\n"+w.message);return}else{throw w}}}if(this.aProcs){for(B=0;B<this.aProcs.length;B++){g=this.aProcs[B];for(D=0;D<g.oatts.length;D++){g.oatts[D].SaveValidity()}if(C<0){b=0}else{b=this.aObjectList[C]}processConstrProc(g,b);for(D=0;D<g.oatts.length;D++){if(ConvertNewValidities(g.oatts[D])){y=true}}}}}while(y);if(C<0){for(B=0;B<this.aObjectList.length;B++){p=dictionary.GetObject(this.aObjectList[B]);if((p.aType==TYPE_NUMERIC)||isEmptyLogical(p)){p.ResolveInvalids()}}}else{p=dictionary.GetObject(this.aObjectList[C]);p.ResolveInvalids()}}};function Constrain(e){var h=[];var g;var d;for(g=0;g<e.length;g++){d=dictionary.GetObject(e[g]);if(((d.aType==TYPE_LIST)||(d.aType==TYPE_BOOLEAN)||(d.aType==TYPE_NUMERIC))&&(d.constraintDomain!=0)){h[h.length]=d}}var b=[];var f;var a;for(g=0;g<h.length;g++){for(f=0,a=false;(!a)&&(f<b.length);f++){if(b[f]==h[g].constraintDomain){a=true}}if(!a){b[b.length]=h[g].constraintDomain}}for(g=0;g<b.length;g++){d=dictionary.GetObject(b[g]);if(!d){return}if(!d.Load()){return}}for(g=0;g<b.length;g++){d=dictionary.GetObject(b[g]);d.Run()}return b.length>0}function DictionaryObject_Hierarchy(b,d,a){DictionaryObject_Hierarchy.baseConstructor.call(this,b,d,TYPE_HIERARCHY,a);this.aDefinition=null;this.loaded=false;this.tree=[]}ObjectExtend(DictionaryObject_Hierarchy,DictionaryObject);DictionaryObject_Hierarchy.prototype.Clear=function(a){var b=function(e){var f;for(var h=0;h<e.length;h++){var d=e[h];f=d.item;if(f){f.Reset();if(f.staticData){f.Evaluate()}else{f.Clear(a)}}if($.isArray(d.local)){for(var g=0;g<d.local.length;g++){f=d.local[g].item;if(f){f.Reset();if(f.staticData){f.Evaluate()}else{f.Clear(a)}}}}if($.isArray(d.children)){b(d.children)}}};b(this.aDefinition.tree);DictionaryObject_Hierarchy.superClass.Clear.call(this)};DictionaryObject_Hierarchy.prototype.SetupObjectRefs=function(){var a=this;var b=function(d){for(var e=0;e<d.length;e++){(function(){var f=d[e];var g;if(f.id){g=dictionary.GetObject(f.id);if(g.aType==TYPE_PROCEDURE){f.baseDictObj=true;f.item=g;f.selected=function(){return false}}else{f.baseDictObj=!g.encounteredOnHierarchy;if(!f.baseDictObj){g=$.extend(true,{},g)}g.encounteredOnHierarchy=true;f.item=g;f.selected=function(){return f.item.isSelectedForHierarchy(false)}}}else{f.item=null;f.selected=function(){return true}}if($.isArray(f.local)){for(var h=0;h<f.local.length;h++){if(f.local[h].id){g=dictionary.GetObject(f.local[h].id);f.local[h].baseDictObj=!g.encounteredOnHierarchy;if(!f.local[h].baseDictObj){g=$.extend(true,{},g)}g.encounteredOnHierarchy=true;f.local[h].item=g}else{f.local[h].item=null}}}if($.isArray(f.children)){b(f.children)}})()}};b(this.aDefinition.tree)};DictionaryObject_Hierarchy.prototype.Populate=function(a){this.aDefinition=a;this.tree=this.aDefinition.tree;DictionaryObject_Hierarchy.superClass.Populate.call(this,null,null)};DictionaryObject_Hierarchy.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID,true);return false}else{return true}};DictionaryObject_Hierarchy.prototype.findNodeByObjId=function(f,b){if(!b){b=this.aDefinition.tree}for(var e=0;e<b.length;e++){var a=b[e];if(a.id==f){return a}if($.isArray(a.children)){var d=this.findNodeByObjId(f,a.children[e]);if(d){return d}}}return null};DictionaryObject_Hierarchy.prototype.GoTree=function(l,g){var h,j,f;for(var k=0;k<l.length;k++){var e=l[k];if(e.item){var d=e.item;var b=null;if(!e.baseDictObj){b=dictionary.GetObject(d.aID,true);b.PushInstanceRef(d)}if($.isArray(e.local)){for(h=0;h<e.local.length;h++){if(e.local[h].item&&!e.local[h].baseDictObj){j=e.local[h].item;f=dictionary.GetObject(j.aID,true);f.PushInstanceRef(j)}}}if(d.aType==TYPE_PROCEDURE){d.Run(this)}else{var a=$.extend(true,{},g);a.fromHierarchy=true;a.hierChildren=e.children;a.hierObj=this;a.hierParams=g;if(!d.Run(a)){return false}}if(!e.baseDictObj&&b){b.PopInstanceRef()}if($.isArray(e.local)){for(h=0;h<e.local.length;h++){if(e.local[h].item&&!e.local[h].baseDictObj){j=e.local[h].item;f=dictionary.GetObject(j.aID,true);f.PopInstanceRef()}}}}}return true};DictionaryObject_Hierarchy.prototype.toString=function(){return hierarchy.toString(this)};DictionaryObject_Hierarchy.prototype.val=function(){return this.toString()};DictionaryObject_Hierarchy.prototype.clear=function(){hierarchy.clear(this)};DictionaryObject_Hierarchy.prototype.Run=function(b){if(!this.Load()){return false}if(this.aDefinition.settings.exitprompt){if(b==undefined){b={exitOnEmpty:true}}else{if(!b.exitOnEmpty){b.exitOnEmpty=true}}}hierarchy.enter(this);var a=this.GoTree(this.aDefinition.tree,b);hierarchy.leave();return a};var NO_HIER_ERR="No current hierarchy";var hierarchy={_isHierarchy:true,stack:[],reset:function(){this.stack=[]},clear:function(d){var b=d?d:this.current();if(!b){hardError(NO_HIER_ERR);return}var a=function(e){for(var g=0;g<e.length;g++){var f=e[g];if((f.item.aType!=TYPE_HIERARCHY)&&(f.item.aType!=TYPE_PROCEDURE)){f.item.Clear()}if(f.children){a(f.children)}}};a(b.aDefinition.tree)},toString:function(d,f){if(typeof d=="string"){f=d;d=null}var b=d?d:this.current();if(!b){hardError(NO_HIER_ERR);return}if(!f){f="default"}function e(h){var n,m,g;var k="";for(n=0;n<h.length;n++){var j=h[n];if(j.selected()){var l=j.item;if(f=="default"){k+="<"+l.aName+" value='"+l.val()+"'";if(l.flatProps&&$.isArray(l.flatProps._hierexport)){for(m=0;m<l.flatProps._hierexport.length;m++){g=l.flatProps[l.flatProps._hierexport[m]];k+=" "+l.flatProps._hierexport[m]+"='"+HandleChars(g!=null?g:"")+"'"}}if(l.aValueProps&&l.aValueProps.general&&l.aValueProps.general._hierexport){for(m=0;m<l.aValueProps.general._hierexport.length;m++){g=l.GetValueProp(l.aValueProps.general._hierexport[m],-1);k+=" "+l.aValueProps.general._hierexport[m]+"='"+HandleChars(g!=null?g:"")+"'"}}if(j.children){k+=">\n"+e(j.children)+"</"+l.aName+">"}else{k+=" />"}k+="\n"}else{if(f=="legacy"){k+="<node name='"+l.aName+"' hierarchy='"+b.aName+"'>\n";if(l.flatProps&&$.isArray(l.flatProps._hierexport)){for(m=0;m<l.flatProps._hierexport.length;m++){g=l.flatProps[l.flatProps._hierexport[m]];k+="<prop name='"+l.flatProps._hierexport[m]+"' value='"+HandleChars(g!=null?g:"")+"'/>\n"}}k+="<value name='"+l.val()+"'>\n";if(l.aValueProps&&l.aValueProps.general&&l.aValueProps.general._hierexport){for(m=0;m<l.aValueProps.general._hierexport.length;m++){g=l.GetValueProp(l.aValueProps.general._hierexport[m],-1);k+="<prop name='"+l.aValueProps.general._hierexport[m]+"' value='"+HandleChars(g!=null?g:"")+"' />\n"}}k+="</value>\n";if(j.children){k+=e(j.children)}k+="</node>\n"}}}}return k}var a="<?xml version='1.0' encoding='ISO-8859-1'?>\n";if(f=="default"){a+="<"+b.aName+">\n"+e(b.aDefinition.tree)+"</"+b.aName+">"}else{if(f=="legacy"){a+="<log>\n"+e(b.aDefinition.tree)+"</log>"}else{hardError("Invalid hierarchy encoding ["+f+"]");return}}return a},enter:function(a){this.stack.push(a)},leave:function(){if(this.stack.length>1){this.stack.pop()}},current:function(){if(this.stack.length==0){return null}else{return this.stack[this.stack.length-1]}},idxToNode:function(a){var d=this.current();if(!d){hardError(NO_HIER_ERR);return}var f;function b(g){for(var k=0;k<g.length;k++){var j=g[k];if(j.selected()){f++;if(f==a){return j}if(j.children){var h=b(j.children);if(h){return h}}}}return null}f=0;var e=b(d.aDefinition.tree);if(!e){hardError("Hierarchy index is out of bounds ["+a+"]");return}return e},count:function(){var b=this.current();if(!b){hardError(NO_HIER_ERR);return}function a(e){var d=0;for(var g=0;g<e.length;g++){var f=e[g];if(f.selected()){d++;if(f.children){d+=a(f.children)}}}return d}return a(b.aDefinition.tree)}};function DictionaryObject_Cat(b,d,a){DictionaryObject_Cat.baseConstructor.call(this,b,d,TYPE_CATEGORY,a);this.loaded=true}ObjectExtend(DictionaryObject_Cat,DictionaryObject);DictionaryObject_Cat.prototype.toString=function(){return DictionaryObject_Cat.superClass.toString.call(this)};DictionaryObject_Cat.prototype.Clear=function(a){DictionaryObject_Cat.superClass.Clear.call(this)};DictionaryObject_Cat.prototype.Populate=function(){DictionaryObject_Cat.superClass.Populate.call(this,null)};DictionaryObject_Cat.prototype.Load=function(){return true};DictionaryObject_Cat.prototype.getAllowedClasses=function(){if(!this.objInfo.hasOwnProperty("allowed")||this.objInfo.allowall){var d,b;var a=[-TYPE_PROCEDURE,-TYPE_DIALOG,-TYPE_VARIABLE,-TYPE_TXTPROCESSOR,-TYPE_REPORT];for(d=0;d<dictionary.aDictionary.length;d++){b=dictionary.aDictionary[d];if(((b.aType==TYPE_LIST)||(b.aType==TYPE_NUMERIC)||(b.aType==TYPE_BOOLEAN)||(b.aType==TYPE_DATE)||(b.aType==TYPE_TEXT))&&(!b.flatProps.pid)){a.push(b.aID)}}return a}else{if($.isArray(this.objInfo.allowed)){return this.objInfo.allowed}else{return[]}}};var lastElementID=0;function GetNextElementID(){return("TTV-"+(++lastElementID))}function UIsetup(){msgFlashDiv=$("<div></div>").addClass("ui-widget ui-corner-all xrui-message-ovl").appendTo(document.body).html("hello World").hide();$(window).resize(function(){var a=($(window).width()-msgFlashDiv.outerWidth())/2;msgFlashDiv.css("left",(a<0?0:a)+"px")}).trigger("resize")}function ClearUI(dlgID,preview,supressUIadd){var c;if(currentDlg){currentDlg.free()}var aDiv=uidiv;if(aDiv!=null){for(c=aDiv.childNodes.length-1;c>=0;c--){aDiv.removeChild(aDiv.childNodes[c])}}if(isMobile){$("#mobheader").hide()}$("#"+popupIdBkgnd).unbind("click");if(!preview&&!customStartup&&!isEditor){if(!appSettings.noStyleProps){document.body.style.backgroundColor=appSettings.bgColor}document.title=appSettings.title}dialog_offset_y=0;aDiv=document.getElementById("xrui_prev");if(aDiv){for(c=aDiv.childNodes.length-1;c>=0;c--){aDiv.removeChild(aDiv.childNodes[c])}var s="";if(!preview){for(c=0;c<activeDialogStack.length-1;c++){var ss="";if(typeof(activeDialogStack[c])=="number"){var o=dictionary.GetObject(activeDialogStack[c]);if(o.aType==TYPE_DIALOG){ss=eval(o.aDefinition.caption)}else{if(o.aType==TYPE_REPORT){ss=o.aProps.description}}if(ss==""){ss=o.aName}}else{ss=activeDialogStack[c]}s+="<div class='prevdialogtitle'>&nbsp;<img src='"+xrkb_include_folder+"images/application_form.png'>&nbsp;"+ss+"</div>"}}dialog_offset_y+=((activeDialogStack.length-1)*26);if(aDiv){aDiv.innerHTML=s;if(s!=""){MakeVisible(aDiv)}else{MakeInvisible(aDiv)}}}HideDialogPage();currentDlg=null;if(!preview&&!supressUIadd){replayStack.RenderingUI(dlgID)}}function AttachElement2(a,b){if(b==null){b=uidiv}b.appendChild(a)}function AddDiv2(e,k,g,a,j,b,f){var d=document.createElement("div");if(g){d.className=g}d.id=GetNextElementID();if(a&&j&&b&&f){d.style.position="absolute";d.style.left=a+"px";d.style.top=j+"px";d.style.width=b+"px";d.style.height=f+"px";d.style.overflow="hidden"}if(k!==""){spn=document.createElement("span");spn.id=GetNextElementID();spn.innerHTML=k;d.appendChild(spn)}AttachElement2(d,e);return d}var defaultUI={_dialog:{usage:[],helpdoneinlabel:false,left:0,top:0,width:450,height:280,hascaption:true,centered:true,caption:"''+ConvertForDisplay(Dialog_GetTiedDescription(),false,false)+''",color:undefined,onenter:0,onexit:0,oncanexit:0,initialupdates:true,timeout:0,bkgndimage:"",resizable:false,font:{name:"Microsoft Sans Serif",size:13,isBold:false,isItalic:false},cssclassname:{name:"",dowysiwyg:true},controls:[{aID:1,aType:"label",aName:"control_label",left:24,top:8,width:392,height:40,tabno:0,borderstyle:"none",bkgndstyle:"transparent",justification:"left",color:"F0F0F0",textcolor:"000000",bordercolor:"646464",font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},caption:"''+ConvertForDisplay(Dialog_GetTiedDescription(true),false,true)+''",visible:true,ishtml:false,showscroll:false,attachmentobj:0,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},readonly:false},{aID:2,aType:"button",aName:"control_ok",left:248,top:200,width:80,height:40,tabno:0,caption:"'Next'",buttontype:"ok",visible:true,isarea:false,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},allowinvalid:0,allowincomplete:0,exitcheck:true,helpatt:0,helpid:0,macro:0,macroautook:false,briefhow:false,url:"",key:"none",applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},enabled:true},{aID:3,aType:"button",aName:"control_back",left:128,top:200,width:80,height:40,tabno:0,caption:"'Previous'",buttontype:"back",visible:true,isarea:false,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},allowinvalid:0,allowincomplete:0,exitcheck:true,helpatt:0,helpid:0,macro:0,macroautook:false,briefhow:false,url:"",key:"none",applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},enabled:true}],webinfhtmlpage:undefined,instanceatts:[],rules:false},_dialog_list:[{aID:4,aType:"listbox",aName:"control_list",left:150,top:40,width:150,height:120,tabno:0,tieditem:0,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},multiselmin:0,multiselmax:255,multiexcludegrey:false,excludemode:"showinvalid",visible:true,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},validation:"",showsearch:false,emptytext:"",showlabel:false,label:"",helpposition:"'top right'"}],_dialog_dropdown:[{aID:4,aType:"dropdown",aName:"control_list",left:150,top:40,width:150,height:120,tabno:0,tieditem:0,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},multiselmin:0,multiselmax:255,multiexcludegrey:false,excludemode:"showinvalid",visible:true,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},validation:"",showsearch:false,emptytext:"",showlabel:false,label:"",helpposition:"'top right'"}],_dialog_num:[{aID:4,aType:"number",aName:"control_numeric",left:180,top:80,width:90,height:24,tabno:0,tieditem:0,style:"editbox",scrollrangemin:0,scrollrangemax:100,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},visible:true,hasborder:true,color:"FFFFFF",textcolor:"000000",validation:"",applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},readonly:false,showlabel:true,label:""}],_dialog_bool:[{aID:4,aType:"radiobtn",aName:"control_boolean",left:184,top:80,width:72,height:64,tabno:0,tieditem:0,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},multiselmin:0,multiselmax:255,multiexcludegrey:false,excludemode:"showinvalid",visible:true,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},validation:"",showsearch:false,emptytext:"",hascaption:true,helpposition:"'top right'"}],_dialog_bool_mob:[{aID:4,aType:"listbox",aName:"control_boolean",left:150,top:40,width:150,height:120,tabno:0,tieditem:0,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},multiselmin:0,multiselmax:255,multiexcludegrey:false,excludemode:"showinvalid",visible:true,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},validation:"",showsearch:false,emptytext:"",showlabel:false,label:"",helpposition:"'top right'"}],_dialog_date:[{aID:4,aType:"date",aName:"control_date",left:155,top:80,width:140,height:24,tabno:0,tieditem:0,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},visible:true,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},validation:"",jqueryinit:{showOtherMonths:true,selectOtherMonths:true,showOn:"button",buttonImage:((!NODEJS&&window.hasOwnProperty("xrkb_include_folder"))?xrkb_include_folder:"")+"images/calendar.png",buttonImageOnly:true,buttonText:"Click to select date"},showlabel:true,label:""}],_dialog_text:[{aID:4,aType:"textedit",aName:"control_text",left:24,top:80,width:400,height:24,tabno:0,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},tieditem:0,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},validation:"",readonly:false,showlabel:true,label:""}],_dialog_var_num:[{aID:4,aType:"arrayedit",aName:"control_variable",left:180,top:80,width:90,height:24,tabno:0,font:{name:"Microsoft Sans Serif",size:13,isBold:false,isItalic:false},tieditem:0,dim1:1,dim2:1,obligatory:true,ispassword:false,visible:true,multiline:false,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},onchange:0,helptext:"",maskstring:"",controlpropname:undefined,readonly:false,validation:"",showlabel:true,label:""}],_dialog_var_text:[{aID:4,aType:"arrayedit",aName:"control_variable",left:24,top:80,width:400,height:24,tabno:0,font:{name:"Microsoft Sans Serif",size:13,isBold:false,isItalic:false},tieditem:0,dim1:1,dim2:1,obligatory:true,ispassword:false,visible:true,multiline:false,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},onchange:0,helptext:"",maskstring:"",controlpropname:undefined,readonly:false,validation:"",showlabel:true,label:""}],_dialog_report:[{aID:4,aType:"label",aName:"control_report",left:24,top:26,width:400,height:150,tabno:0,borderstyle:"none",bkgndstyle:"transparent",justification:"left",color:"F0F0F0",textcolor:"000000",bordercolor:"646464",font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},caption:"replaced from appSettings",visible:true,ishtml:true,showscroll:true,attachmentobj:0,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true}}],_dialog_final:[{aID:4,aType:"label",aName:"control_final",left:24,top:66,width:392,height:66,tabno:0,borderstyle:"none",bkgndstyle:"transparent",justification:"left",color:"F0F0F0",textcolor:"000000",bordercolor:"646464",font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},caption:"replaced from appSettings",visible:true,ishtml:true,showscroll:false,attachmentobj:0,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true}}],_dialog_arraylist:[{aID:4,aType:"arraylist",aName:"control_arraylist",left:104,top:192,width:64,height:64,tabno:0,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},tieditem:0,indexvariable:0,obligatory:true,style:"listbox",multisel:false,visible:true,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},helptext:"",emptytext:"",validation:"",showlabel:true,label:""}],emptyDialog:function(b){var a=$.extend(true,{},this._dialog);if(!b){a.controls.splice(0,a.controls.length);a.caption="Title Text"}return a},emptyCtrl:function(a){switch(a){case"label":return{aID:0,aType:"label",aName:"",left:24,top:8,width:392,height:40,tabno:0,borderstyle:"none",bkgndstyle:"transparent",justification:"left",color:"F0F0F0",textcolor:"000000",bordercolor:"646464",font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},caption:"Label",visible:true,ishtml:true,showscroll:false,attachmentobj:0,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},readonly:false};case"button":return{aID:0,aType:"button",aName:"",left:248,top:200,width:80,height:40,tabno:0,caption:"'Next'",buttontype:"ok",visible:true,isarea:false,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},allowinvalid:0,allowincomplete:0,exitcheck:true,helpatt:0,helpid:0,macro:0,macroautook:false,briefhow:false,url:"",key:"none",applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},enabled:true};case"columns":return{aID:0,aType:"columns",aName:"",numcolumns:2,autocollapse:false,autocollapsewidth:650,tabsheets:[{isvisible:true,controls:[]},{isvisible:true,controls:[]}]};case"image":return{aID:0,aType:"image",aName:"",left:32,top:168,width:48,height:48,imagepath:"",drawmode:"clipped",visible:true,cssclassname:{name:"",dowysiwyg:true},alttext:"",zoomable:true};case"container":return{aID:0,aType:"container",aName:""};case"panels":return{aID:0,aType:"panels",aName:"",controltype:"panels",showmarkers:true,tabsheets:[{id:1,caption:"Page 1",isvisible:true,showheader:true,initialshrunk:false,cssname:"",contentcssname:"",onchange:0,controls:[]},{id:2,caption:"Page 2",isvisible:true,showheader:true,initialshrunk:false,cssname:"",contentcssname:"",onchange:0,controls:[]}]};default:alert("Unknown control type : "+a)}},emptyControlForObj:function(b,a){var e,d;switch(b.aType){case TYPE_LIST:switch(a){case"dropdown":e=$.extend(true,{},this._dialog_dropdown[0]);break;case"grid":e={aID:0,aType:"grid",aName:"",tabno:0,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},color:"FFFFFF",tieditem:0,hascaption:true,visible:true,dynamicvals:true,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},rowheight:0,validation:"",controltype:"standard",showlabel:true,label:""};break;case"buttonset":e=$.extend(true,{},this._dialog_list[0]);e.aType="buttonset";break;case"imgmap":e={aID:0,aType:"imgmap",aName:"",tabno:0,imagewidth:0,imageheight:0,imagepath:"",cssclassname:{name:"",dowysiwyg:true},alttext:"",tieditem:0,imagemap:[]};break;default:e=$.extend(true,{},this._dialog_list[0])}if(a!="imgmap"){e.showlabel=true}return e;case TYPE_NUMERIC:switch(a){case"slider":e={aID:0,aType:"slider",aName:"",tabno:0,tieditem:0,scrollrangemin:0,scrollrangemax:100,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},cssclassname:{name:"",dowysiwyg:true},showlabel:true,label:""};break;default:e=$.extend(true,{},this._dialog_num[0])}return e;case TYPE_BOOLEAN:switch(a){case"dropdown":e=$.extend(true,{},this._dialog_dropdown[0]);break;case"checkbox":e={aID:0,aType:"checkbox",aName:"",tabno:0,tieditem:0,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},color:"F0F0F0",textcolor:"000000",caption:"Caption Text",selectablegrey:false,value:0,visible:true,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},validation:"",showlabel:true,label:"",jqmattributes:""};break;case"buttonset":e=$.extend(true,{},this._dialog_list[0]);e.aType="buttonset";break;case"imgmap":e={aID:0,aType:"imgmap",aName:"",tabno:0,imagewidth:0,imageheight:0,imagepath:"",cssclassname:{name:"",dowysiwyg:true},alttext:"",tieditem:0,imagemap:[]};break;default:e=$.extend(true,{},this._dialog_bool_mob[0])}return e;case TYPE_TEXT:return $.extend(true,{},this._dialog_text[0]);case TYPE_DATE:return $.extend(true,{},this._dialog_date[0]);case TYPE_VARIABLE:e=$.extend(true,{},this._dialog_arraylist[0]);e.showlabel=true;e.style=a;return e;default:return null}},render:function(b,a){var l=this.emptyDialog(true);var g=null;var f=isMobile;var k;if(typeof b=="string"){switch(b){case"final":g=$.extend(true,[],this._dialog_final);l.caption=appSettings.title;f=true;for(k=0;k<g.length;k++){if(g[k].aName=="control_final"){g[k].caption="<img style='vertical-align: middle' width='64' height='64' src='"+xrkb_include_folder+"images/tick.png'> "+a.caption;break}}for(k=0;k<l.controls.length;k++){if(l.controls[k].aName=="control_ok"){l.controls[k].caption="Restart";l.controls[k].buttontype="restart";break}}break}}else{switch(b.aType){case TYPE_LIST:g=$.extend(true,[],this._dialog_list);break;case TYPE_NUMERIC:g=$.extend(true,[],this._dialog_num);break;case TYPE_BOOLEAN:if(!isMobile){g=$.extend(true,[],this._dialog_bool)}else{g=$.extend(true,[],this._dialog_bool_mob)}break;case TYPE_DATE:g=$.extend(true,[],this._dialog_date);break;case TYPE_TEXT:g=$.extend(true,[],this._dialog_text);break;case TYPE_VARIABLE:switch(b.varType){case VARTYPE_NUM:g=$.extend(true,[],this._dialog_var_num);break;default:g=$.extend(true,[],this._dialog_var_text)}break;case TYPE_REPORT:g=$.extend(true,[],this._dialog_report);f=true;for(k=0;k<g.length;k++){if(g[k].aName=="control_report"){g[k].caption=b.GetText(true);break}}l.width=650;var m=l.controls[2].left-l.controls[1].left;l.controls[1].left=(l.width-m-l.controls[2].width)/2;l.controls[2].left=l.controls[1].left+m;var j=$("<div></div>").css({width:(l.width-50)+"px",left:"-10000px",position:"absolute","font-family":"Microsoft Sans Serif","font-size":"13px"}).html(b.GetText(true)).appendTo("body");var e=j.outerHeight(true);j.remove();if(e+156>$(window).height()){e=$(window).height()-156}l.height=l.height-150+e;for(k=0;k<l.controls.length;k++){if(l.controls[k].top>26){l.controls[k].top=l.controls[k].top-150+e}}for(k=0;k<g.length;k++){if(g[k].aName=="control_report"){g[k].height=e;g[k].width=l.width-50;break}}if(b.aProps.timeout){l.timeout=b.aProps.timeout}break}}if(g!=null){for(k=0;k<g.length;k++){l.controls.splice(1+k,0,g[k])}if(f){l.controls.splice(0,1)}}if(replayStack.isFirstDialog()){for(k=0;k<l.controls.length;k++){if(l.controls[k].aName=="control_back"){l.controls[k].enabled=false;break}}}return l}};function RenderObject(a){activeDialogStack[activeDialogStack.length]=a.aID;var e="";var b=null;var d;switch(a.aType){case TYPE_LIST:case TYPE_NUMERIC:case TYPE_BOOLEAN:case TYPE_DATE:case TYPE_TEXT:case TYPE_VARIABLE:case TYPE_REPORT:if(!currentDlg||currentDlg.aID!=a.aID){ClearUI(a.aID,false,replayStack.LastOperationWasValidatedOK());var f=defaultUI.render(a);d={aID:a.aID,tiedObj:a};if(wrapperOptions.nodejs){throw new inferenceIssue(PASSBACK_DIALOG,a.aName)}currentDlg=XRdialog.create($("#xrui"),f,d);currentDlg.render();currentDlg.populate();currentDlg.focus(a.aID)}else{currentDlg.populate()}break;case TYPE_DIALOG:d={aID:a.aID,tiedObj:null};ClearUI(aTask.aID,false,replayStack.LastOperationWasValidatedOK());currentDlg=XRdialog.create($("#xrui"),a.aDefinition,d);currentDlg.render();currentDlg.populate();currentDlg.focus();break;default:alert("Unsupported default capture type")}}function RenderFinal(){var d=appSettings.finalURL;if((d===undefined)||(d===null)){d=""}else{d=d.toUpperCase()}if(d=="RESTART"){replayStack.Initialize();Go();return}var b=false;if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))||(navigator.userAgent.match(/iPad/i))){b=true}if(appEmbedded){if(b){window.location="fake$End"}else{if(navigator.appVersion.indexOf("Win")!=-1){window.external.Notify("<method><name>End</name></method>")}else{alert("<method><name>End</name></method>")}}}else{if(d!=""&&!isEditor){window.location=appSettings.finalURL}else{activeDialogStack[activeDialogStack.length]="Final";if(d!=""){d="Once deployed, the user would be redirected to...<br /><div style='text-align: center; font-weight: bold; color: #a00; margin: 32px 0;'>"+d+"</div>"}else{d=getTranslation("final_text","The End!");if(d===undefined){d="End Of Inference"}}var e=defaultUI.render("final",{caption:d});var a={aID:0,tiedObj:null};if(wrapperOptions.nodejs){throw new inferenceIssue(PASSBACK_DIALOG,"final")}ClearUI(0);currentDlg=XRdialog.create($("#xrui"),e,a);currentDlg.render();currentDlg.populate()}}}function RenderError(b){var a="<img style='vertical-align: middle' width='64' height='64' src='"+xrkb_include_folder+"images/noEntery.png'> "+ConvertForDisplay(b,true);ShowModal(a,"An Error Has Occurred","")}var currentProcID=0;function RenderDebug(h,d,b){currentProcID=h;var g=d.indexOf("_|_");var e="";var f="";var a=false;if(g>=0){f=d.substr(g+3);d=d.substr(0,g);g=f.indexOf("_|_");if(g>=0){e=f.substr(g+3);f=f.substr(0,g)}g=e.indexOf("_|_");if(g>=0){a=(e.substr(g+3).toUpperCase()=="HTML");e=e.substr(0,g)}}if(f.length===0){f="Information"}if(!a){d=ConvertForDisplay(d,true)}if(!b){ShowModal(d,f,e,ModalCallback)}else{return d}}function ModalCallback(){if(currentProcID!=ADHOC_DIALOG_PSEUDOID){DebugOK(currentProcID)}}function RenderTreePage(aFunc,aTreeID){activeDialogStack[activeDialogStack.length]="Tree Web Page";ClearUI(aTreeID);AddDiv2(null,"&nbsp;Tree Page","capturetitle");var s=eval(aFunc+"()")+"<br><br><input type='button' class='capturebutton' value='"+OK_TEXT+"' onclick='DebugOK("+aTreeID+")'>";AddDiv2(null,s,"informationbody")}function SetValue2(b,a){replayStack.Add(b,REPLAY_CHANGEEVENT,b,a,PerformOK);Go()}function PerformOK(b){var a=replayStack.PopReplay(b.pauseID);if(a==REPLAYPOP_HANDLED){return true}else{if(a==REPLAYPOP_CURRENT){replayStack.Add(b.pauseID,REPLAY_OK);replayStack.Add(b.pauseID,REPLAY_OK);throw new inferenceIssue(PASSBACK_LOOP)}else{hardError("Unknown replay pop return ["+a+"]");return}}}function CheckValue(a){var b=document.getElementById("cb"+a);if(b){b.checked=true}}function SetMultiValues(g){var e=dictionary.GetObject(g);var b=[];for(var f=0;f<e.aValues.length;f++){var d=document.getElementById("cb"+e.aValues[f].aID);if(d!=null){if(d.checked){b[b.length]=e.aValues[f].aID}}}if(b.length===0){if(!e.flatProps.allowblank){alert("Please select a value!");return}b=PSEUDO_VALUE_EMPTY}replayStack.Add(g,REPLAY_CHANGEEVENT,g,b,PerformOK);Go()}function SetValueNum(f,a){var e=dictionary.GetObject(f);var d=document.getElementById(a);if(d!=null){var b=$(d).val();if(b.length===0&&e.flatProps.allowblank){b=PSEUDO_VALUE_EMPTY}else{if(b==""||!IsNumber(b)){alert("You must enter a valid value!");document.getElementById(a).focus();return false}b=parseFloat(b)}replayStack.Add(f,REPLAY_CHANGEEVENT,f,b,PerformOK);Go()}}function SetValueDate(g,a){var d=document.getElementById(a);if(d==null){return false}var f=dictionary.GetObject(g);var b=$(d).val();var e;if((b=="**/**/****")&&(f.flatProps.allowblank)){e=PSEUDO_VALUE_EMPTY}else{e=EncodeDate(b);if(isNaN(e)){alert("You must enter a valid value!");document.getElementById(a).focus();return false}}replayStack.Add(g,REPLAY_CHANGEEVENT,g,e,PerformOK);Go()}function DebugOK(a){replayStack.Add(a,REPLAY_CRITICALDONE);Go()}function SetValueVar(f,a){var e=dictionary.GetObject(f);var d=document.getElementById(a);if(d!=null){var b=d.value;if(e.aType==TYPE_TEXT){if((b.length==0)&&(e.flatProps.allowblank)){b=PSEUDO_VALUE_EMPTY}else{if(b==""){alert("You must enter a valid value!");document.getElementById(a).focus();return false}}}replayStack.Add(f,REPLAY_CHANGEEVENT,f,b,PerformOK);Go()}}function PopulatePopupReport(){if(popupReportObject){var a=popupReportObject;popupReportObject=null;return{text:popupReportText,object:a}}return null}function Go(d,l){if(delayedGoTimer){clearTimeout(delayedGoTimer);delayedGoTimer=null}dictionary.Clear(true);dictionary.ResetInstanceRefs();lastDialogInstanceID=0;replayStack.Reset();cookieCache.Clear();if(!wrapperOptions.nodejs&&msgFlashDiv){msgFlashDiv.hide()}hierarchy.reset();activeDialogStack.length=0;capturedAtts.length=0;lineOfReasoning.length=0;capturingAtts=true;baseDialogs.length=0;currentConditionalObj=null;lastErr=null;stk_reset();replayProtection.reset();working=true;performedGo=true;if(jsAjax&&!wrapperOptions.nodejs){var g={session:JSON.stringify(jsAjaxSessionID),replayStack:JSON.stringify(replayStack.aReplay)};if(l){g.options=JSON.stringify(l)}$.ajax({url:"xpertrule.js",type:"POST",dataType:"json",data:g,success:function(v){var w,q,p;replayStack.Initialize();if(!v.hasOwnProperty("state")){alert("Unknown server return code : "+v)}else{if(v.state!="ERROR"){jsAjaxSessionID=v.session;replayStack.replayPassedUIs=v.currentUI;replayStack.SetBookmark(replayStack.replayPassedUIs)}switch(v.state){case"DIALOG":if(v.data){for(w=0;w<v.data.length;w++){p=_dgo(v.data[w].id);if(!p){alert("Unknown object id ["+v.data[w].id+"]");break}if(p.aType==TYPE_VARIABLE){if(v.data[w].val==PSEUDO_VALUE_EMPTY){p.Clear()}else{p.data=v.data[w].val}}else{p.SetValue(v.data[w].val);if(p.aType==TYPE_LIST||p.aType==TYPE_BOOLEAN){p.ClearInvalid();p.SetValueInValid(v.data[w].inv)}}}}if(v.name=="tree_dialog"){if(v.def){q={aID:v.def.taskID,tiedObj:null};ClearUI(v.def.taskID,false,replayStack.LastOperationWasValidatedOK());currentDlg=XRdialog.create($("#xrui"),v.def,q);if(v.props){for(w=0;w<v.props.length;w++){_SetTreeDialogDef(v.def,v.props[w].cntrl,v.props[w].prop,v.props[w].val)}}currentDlg.render()}currentDlg.populate()}else{var n=_dgobn(v.name);if(!n){alert("Unknown dialog ["+v.name+"]");break}if(v.props){for(w=0;w<v.props.length;w++){var e="";var y=v.props[w].prop;var t=null;var r=v.props[w].val;var m=null;e=v.props[w].cntrl;if(e!=""){var x=e.split(".");if(x.length>1){e=x[0];m=x[1];t=y;y="tabsheets"}}n.SetDialogControlValue(e,y,r,null,t,m)}}n.currentTiedObj=v.tied;if(!currentDlg||currentDlg.aID!=n.aID||(n.currentTiedObj&&currentDlg.tiedObj.aID!=n.currentTiedObj)){if(currentDlg){currentDlg.free()}q={aID:n.aID,tiedObj:v.tied?_dgo(v.tied):null};ClearUI(n.aID,false,true);currentDlg=XRdialog.create($("#xrui"),n.aDefinition,q);currentDlg.render();n.dialogUI=currentDlg;if(n.aDefinition.onshow){p=_dgo(n.aDefinition.onshow);if(p){p.Run()}}}currentDlg.populate()}break;case"OBJECT":var u=_dgo(v.name);if(!u){alert("Unknown object ["+v.name+"]");break}if(v.data){for(w=0;w<v.data.length;w++){p=_dgo(v.data[w].id);if(!p){alert("Unknown object id ["+v.data[w].id+"]");break}if(v.data[w].val==PSEUDO_VALUE_EMPTY){continue}if(p.aType==TYPE_VARIABLE){if(v.data[w].val==PSEUDO_VALUE_EMPTY){p.Clear()}else{p.data=v.data[w].val}}else{p.SetValue(v.data[w].val)}}}RenderObject(u);break;case"DEBUG":RenderDebug(v.name,v.message);break;case"END":RenderFinal();break;case"ERROR":alert("An error occured : "+v.description);break;default:alert("Unknown server return state : "+v.state);break}}}});return}try{if(!TestTick()){return}if(appSettings.startObjectID==0){hardError("No start object defined");return}else{urlParams.Populate();if(appEmbedded){var k=Cmd_Phone(0,"Initialize",-1,[]);if(k&&(k.length>0)){try{k=$.parseJSON(k)}catch(j){hardError("Error parsing Initialize JSON ["+k+"] Error = ["+j+"]");return}xpertrule.setValuesWithObject(k)}}else{var a=replayStack.PopReplay(0);if(a==REPLAYPOP_CURRENT){if(wrapperOptions){if(wrapperOptions.startCallback){xpertrule.inStartup=true;wrapperOptions.startCallback(xpertrule);xpertrule.inStartup=false}}if(!wrapperOptions.nodejs){try{window.external.start()}catch(j){}}replayStack.Add(0,REPLAY_OK);_hb.su(function(){Go()});throw new inferenceIssue(PASSBACK_WAIT)}}var b=_dgo(appSettings.startObjectID);if(b==null){hardError("Unknown start object");return}else{b.Run()}}throw new inferenceIssue(PASSBACK_END,true)}catch(j){if(j instanceof inferenceIssue){if(wrapperOptions.nodejs){switch(j.aState){case PASSBACK_LOOP:return Go();case PASSBACK_WAIT:return;case PASSBACK_END:replayStack.RenderingUI(0);break}if($.isFunction(wrapperOptions.callback)){wrapperOptions.callback(j)}return j}switch(j.aState){case PASSBACK_PAUSE:var h=_dgo(j.aValue);RenderObject(h);break;case PASSBACK_ERROR:if($.isFunction(wrapperOptions.errorCallback)){wrapperOptions.errorCallback(xpertrule,j.aValue)}else{RenderError(j.aValue)}break;case PASSBACK_DEBUG:if($.isFunction(wrapperOptions.debugCallback)){wrapperOptions.debugCallback(xpertrule,RenderDebug(j.aValue,j.aExtra,true));DebugOK(j.aValue)}else{RenderDebug(j.aValue,j.aExtra)}break;case PASSBACK_PAUSETREEPAGE:RenderTreePage(j.aValue,j.aExtra);break;case PASSBACK_END:cookieCache.Write();InferenceEnd();_hb.ed();if(wrapperOptions){if(wrapperOptions.endCallback){if(wrapperOptions.endCallback(xpertrule,j.aValue)){break}}}RenderFinal();try{if(!wrapperOptions.nodejs){window.external.complete()}}catch(j){}break;case PASSBACK_WAIT:if($.isFunction(d)){d()}break;case PASSBACK_LOOP:Go();break;case PASSBACK_LOADIFRAME:LoadDialogPage2(j.aValue);break;case PASSBACK_DIALOG:if($.isFunction(wrapperOptions.pauseCallback)){wrapperOptions.pauseCallback(xpertrule,j.aValue);break}default:RenderError("Unknown inference state : ["+j.aState+"]");break}replayStack.SetBookmark(replayStack.replayPassedUIs);return j.aState}else{if(isEditor){throw j}if(wrapperOptions.nodejs){var f=new inferenceIssue(PASSBACK_ERROR,j);if($.isFunction(wrapperOptions.callback)){wrapperOptions.callback(f)}return f}else{if(j.hasOwnProperty("message")){RenderError(j.message)}else{RenderError(j)}return PASSBACK_ERROR}}}}function Set_ExtCssFile(b){if(b!==""){if($("link[rel=stylesheet][href='"+b+"']").size()==0){var a=document.getElementsByTagName("head")[0];var d=document.createElement("link");d.type="text/css";d.rel="stylesheet";d.href=b;d.media="screen";a.appendChild(d)}}}function loadStyleSheet(k,g,j){var h=document.getElementsByTagName("head")[0];var f=document.createElement("link");f.setAttribute("href",k);f.setAttribute("rel","stylesheet");f.setAttribute("type","text/css");f.setAttribute("media","screen");var e,b,a,d;if("sheet" in f){e="sheet";b="cssRules"}else{e="styleSheet";b="rules"}a=setInterval(function(){try{if(f[e]&&(isChrome||(f[e][b]&&(f[e][b].length>0)))){clearInterval(a);clearTimeout(d);g.call(j||window,true,f)}}catch(l){}finally{}},10);d=setTimeout(function(){clearInterval(a);clearTimeout(d);g.call(j||window,false,f)},3000);h.appendChild(f)}function loadLanguage(a,e){var d=setInterval(function(){try{if($.isPlainObject(lang)){clearInterval(d);clearTimeout(b);e(true)}}catch(f){}finally{}},10);var b=setTimeout(function(){clearInterval(d);clearTimeout(b);e(false)},500);Set_ExtJSFile(a)}function Set_ExtJSFile(a){if(a!=""){if($("script[src='"+a+"']").size()==0){var b=document.createElement("script");b.type="text/javascript";b.src=a;b.async=true;document.body.appendChild(b)}}}function XR_Startup(g,f){try{if(isMobile){$.mobile.ajaxEnabled=false}if(!appSettings){return}}catch(h){var d=document.getElementById("xruipage");if(d){d.style.display="none"}d=document.getElementById("loading_div");d.innerHTML="&nbsp;&nbsp;&nbsp;An error has occurred!<br />&nbsp;&nbsp;&nbsp;Please contact the administrator";d.style.color="#F00";return}customStartup=(f!=undefined);var b=f&&f.nodejs;XR_Setup(f);if(!b){if(!window.xrkb_include_folder){window.xrkb_include_folder=""}XR_DOMsetup(g);var a="";if(!isEditor&&appSettings.hasOwnProperty("customcss")&&(typeof appSettings.customcss=="string")){a=$.trim(appSettings.customcss)}if(a==""){a=appSettings.externalCSS}else{a=xrkb_include_folder+"assets/"+a}if(a&&(a!="")){if((a.substr(0,1)!="/")&&wrapperOptions&&wrapperOptions.subFolder){a=wrapperOptions.subFolder+a}loadStyleSheet(a,function(){XR_Startup2(f)})}else{XR_Startup2(f)}}else{XR_Startup2(f)}}function XR_Startup2(d){var b=d&&d.nodejs;if(!b&&!isEditor){if(appSettings.language&&(appSettings.language!="")){var a=appSettings.language;if(a.split(".").pop()=="js"){loadLanguage(xrkb_include_folder+"assets/"+a,XR_Startup3)}else{if(a.substr(0,1)=="_"){XR_Startup3()}else{loadLanguage((appSettings.developer?"localization/":xrkb_include_folder)+"lang_"+a+".js",XR_Startup3)}}}else{XR_Startup3()}}else{XR_Startup3()}}function XR_Startup3(){var b=true;if(!wrapperOptions.nodejs){$("#loading_div").hide().css("position","absolute")}if(isSmartTv()){smartTv.init()}StartTick();if((!customStartup)||(wrapperOptions.processURLparams)){urlParams.Setup()}replayStack.Initialize();dictionary.PopulateConstraintDomains();if(!appSettings.startObjectID){appSettings.startObjectID=parseInt(appSettings.startObject.substring(0,1)=="~"?appSettings.startObject.substring(1):Handle(appSettings.startObject),10)}if(urlParams.postIdent>0){var a=document.createElement("script");a.type="text/javascript";a.src="getdata.php?id="+urlParams.postIdent;$("head",document).append(a)}function d(l,k){function j(m){if(lang&&m!==""&&lang.hasOwnProperty(m)&&lang[m]!==""){return lang[m]}return m}function h(m){var p,o;var n;for(p=0;p<m.length;p++){n=m[p];if(n.tabsheets){for(o=0;o<n.tabsheets.length;o++){h(n.tabsheets[o].controls)}}else{if(n.hasOwnProperty("caption")){n.caption=j(n.caption)}if(n.hasOwnProperty("label")){n.label=j(n.label)}if(n.hasOwnProperty("validation")){n.validation=j(n.validation)}if(n.hasOwnProperty("emptytext")){n.emptytext=j(n.emptytext)}}}}if(l.toLowerCase()=="_xr_lang"){b=false;var g=xrkb_include_folder+"assets/"+k+".json";$.ajax({url:g,dataType:"json",error:function(o,m,n){if(autoRun){Go()}},success:function(p){var u,t,r,q,m;lang=p;for(u=0;u<dictionary.aDictionary.length;u++){q=dictionary.aDictionary[u];switch(q.aType){case TYPE_LIST:case TYPE_NUMERIC:case TYPE_BOOLEAN:case TYPE_DATE:case TYPE_TEXT:for(var n in q.loadedFlatProps){switch(n){case"maxvalue":case"minvalue":case"length":case"aDecPlaces":case"tieddialog":case"isdynamic":case"_default":case"allowblank":case"selectionmode":case"grouppreviousanswers":case"showontreedialog":case"hiddenvaluesprop":case"sortdirection":case"isselected":case"defaultmode":break;case"description":default:key=q.loadedFlatProps[n];if(typeof(key)=="string"){q.loadedFlatProps[n]=j(key)}}}if(q.aValueProps&&q.aValueProps.list){for(t=0;t<q.aValueProps.list.length;t++){if(q.aValueProps.list[t].realName!="Value"){for(r=0;r<q.aValues.length;r++){key=q.aValues[r][q.aValueProps.list[t].realName];if(typeof(key)=="string"){q.aValues[r][q.aValueProps.list[t].realName]=j(key)}}}}}break;case TYPE_DIALOG:q.aDefinition.caption=j(q.aDefinition.caption);h(q.aDefinition.controls);break}}if(autoRun){Go()}}})}}if((typeof appSettings.language=="string")&&(appSettings.language.substr(0,1)=="_")){d("_xr_lang",appSettings.language.substr(1))}else{for(var f=0;f<urlParams.aParams.length;f++){d(urlParams.aParams[f].aName,urlParams.aParams[f].aValue)}}if(urlParams.postData){for(var e in urlParams.postData){d(e,urlParams.postData[e])}}if(autoRun&&b){Go()}}function PostData(a){urlParams.postData=a;Go()}function XR_DOMsetup(a){DialogPagesSetup();ModalSetup();BackSetup();UIsetup();if(!a){a="xrui"}uidiv=document.getElementById(a);if(!uidiv){uidiv=document.getElementById(dlgPageFrameName)}}function getInternetExplorerVersion(){var d=-1;if(!wrapperOptions.nodejs){if(navigator.appName=="Microsoft Internet Explorer"){var a=navigator.userAgent;var b=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(b.exec(a)!=null){d=parseFloat(RegExp.$1)}}}return d}function XR_Setup(b){if(b!=undefined){wrapperOptions=b}else{wrapperOptions={}}var a=getInternetExplorerVersion();if(a>-1&&a<9){alert("You should upgrade your copy of Windows Internet Explorer to the latest version!")}}function Dialog_GetKMName(){var a=appSettings.description?appSettings.description:"";if(a.length==0){return appSettings.title}return a}function Dialog_GetTiedName(a){if(a!=undefined){return a.aName}else{if(currentDlg&&currentDlg.tiedObj){return currentDlg.tiedObj.aName}}return""}function Dialog_GetTiedDescription(b,a){if(b==undefined){b=true}if(a!=undefined){return a.GetDescription(b)}else{if(currentDlg&&currentDlg.tiedObj){return currentDlg.tiedObj.GetDescription(b)}}return""}function Dialog_RenderTiedHelp(b){var a=b;if(typeof a=="number"){a=_dgo(a)}if(!a){return""}if(!a.flatProps){return""}if(!a.flatProps.helptext){return""}if(a.flatProps.helptext==""){return""}if(isMobile){return a.flatProps.helptext}if(currentDlg||jsAjax){return"input_help_aobject__id="+a.aID}return"<span class='input_help' style='display:inline-block;overflow:hidden'>"+a.flatProps.helptext+"</span>"}function Dialog_GetTiedFlatProp(d,b){function a(f){var e=f.GetFlatProp(d);if(e==null){e=f.GetValueProp(d,-1)}return e}if(b){return a(b)}else{if(currentDlg&&currentDlg.tiedObj){return a(currentDlg.tiedObj)}}return""}function Dialog_GetDebug(){function e(g){if((g.aType==TYPE_LIST)||(g.aType==TYPE_BOOLEAN)||(g.aType==TYPE_NUMERIC)||(g.aType==TYPE_DATE)||(g.aType==TYPE_TEXT)){return(g.aTree||g.aExamples)}return false}var f;var d;var b="";var a;a=false;for(f=0;f<capturedAtts.length;f++){d=_dgo(capturedAtts[f]);if(!a){b+="<tr><th colspan='2'>Captured Objects</th></tr>"}b+="<tr><td>"+d.aName+"</td><td>"+ConvertForDisplay(d.val())+"</td></tr>";a=true}a=false;for(f=0;f<dictionary.aDictionary.length;f++){d=dictionary.aDictionary[f];if($.inArray(d.aID,capturedAtts)==-1){if((d.aType==TYPE_LIST)||(d.aType==TYPE_BOOLEAN)||(d.aType==TYPE_NUMERIC)||(d.aType==TYPE_DATE)||(d.aType==TYPE_TEXT)){if(!e(d)&&d.isFull()){if(!a){b+="<tr><th colspan='2'>Assigned Objects</th></tr>"}b+="<tr><td>"+d.aName+"</td><td>"+ConvertForDisplay(d.val())+"</td></tr>";a=true}}}}a=false;for(f=0;f<dictionary.aDictionary.length;f++){d=dictionary.aDictionary[f];if(e(d)&&d.isFull()){if(!a){b+="<tr><th colspan='2'>Knowledge Results</th></tr>"}b+="<tr><td>"+d.aName+"</td><td>"+ConvertForDisplay(d.val())+"</td></tr>";a=true}}b="<table class='dbg_table' cellspacing='0' cellpadding='4px' width='100%'>"+b+"</table>";return b}function Dialog_GetLineOfReasoning(){var f;var e;var a="";var d=LOR_NONE;for(f=0;f<lineOfReasoning.length;f++){e=_dgo(lineOfReasoning[f].id);if(!e.isFull()){continue}var b=ConvertForDisplay(e.aType==TYPE_DATE?e.GetValueAsString(true):e.GetValueAsString());if(lineOfReasoning[f].atype==LOR_ATT){if(d==LOR_NONE){a+="Given that"}else{if(d==LOR_ATT){a+="And"}else{a+="And given that"}}a+=" "+e.aName+" is "+b+"\n"}else{if(d==LOR_NONE){a+="Set"}else{if(d==LOR_ATT){a+="Then"}else{a+="And"}}a+=" "+e.aName+" = "+b+"\n"}d=lineOfReasoning[f].atype}return a}var closeCallback=null;var modalDlg=null;function ShowModal(innerHTML,title,params,callback,cancelCallback){if(isEditor){xrkb.msgbox({body:innerHTML,header:title,ok_callback:callback});return}if((isMobile!=undefined)&&isMobile){var btnText="OK";if(params&&(params.length>0)){try{if(typeof params=="string"){btnText=params}}catch(e){}}var options={mode:"button",headerText:title,headerClose:false,buttonPrompt:"<p class='ui_modal_p'>"+innerHTML+"</p>",width:"92.5%",buttons:{OK:{id:"my_modal_button_id",click:function(){if($.isFunction(callback)){callback()}},value:"test"}}};if(params&&params.showCancelBtn){options.buttons.Cancel={click:function(){if($.isFunction(cancelCallback)){cancelCallback()}},icon:"delete",theme:"c"}}modalDlg=$("<div></div>").simpledialog2(options);$("#my_modal_button_id").find(".ui-btn-text").html(btnText);return}else{$("#modalContent").html(innerHTML);if(title){modalDlg.dialog("option","title",title)}if(params&&(params.length>0)){try{if(typeof params=="string"){$(".ui-button-text").html(params)}else{modalDlg.dialog("option",eval("({"+params+"})"))}}catch(e){}}modalDlg.dialog("open")}closeCallback=$.isFunction(callback)?callback:null}function CloseCallback(){if(closeCallback){closeCallback()}}function HideModal(){if(modalDlg){modalDlg.dialog("close")}CloseCallback()}function ModalSetup(){if(modalDlg){return}if((isMobile!=undefined)&&isMobile){return}else{var a=$(CreateElement2("div","modalWindow","<div id='modalContent'></div>"));modalDlg=a.dialog({width:600,modal:true,autoOpen:false,resizable:false,close:CloseCallback,buttons:{Ok:function(){$(this).dialog("close")}}})}$("#loadingScreen").dialog({autoOpen:false,dialogClass:"loadingScreenWindow",closeOnEscape:false,draggable:false,width:360,minHeight:50,modal:true,buttons:{},resizable:false,open:function(){$("body").css("overflow","hidden")},close:function(){$("body").css("overflow","auto")}})}function waitingDialog(a){$("#loadingScreen").html(a.message&&(a.message!="")?a.message:"Please wait...");$("#loadingScreen").dialog("option","title",a.title&&(a.title!="")?a.title:"Working");$("#loadingScreen").dialog("open")}function isWaitingDialogOpen(){return $("#loadingScreen").dialog("isOpen")}function closeWaitingDialog(){$("#loadingScreen").dialog("close")}var popupId="xrui";var popupIdBkgnd="xrui_bkgnd";function PopupSetup(){if($("#"+popupId).length==0){$("<div id='"+popupId+"'></div>").appendTo("body")}if($("#"+popupIdBkgnd).length==0){$("<div id='"+popupIdBkgnd+"' class='modal-bkgnd'></div>").appendTo("body")}return popupId}function PopupStart(){$("#"+popupIdBkgnd).show()}function PopupEnd(){$("#"+popupIdBkgnd).hide()}var dlgPageFrameName="jframe";function DialogPagesSetup(){$("body").append("<div id='"+dlgPageFrameName+"' style='visibility:hidden; position:absolute; left:0; top:0; right:0; bottom:0' />");$(window).resize()}function HideDialogPage(){$("#"+dlgPageFrameName).css("visibility","hidden")}var treeDialogs={currentDisplay:{taskID:0,lastList:[]},DIALOG_DEF:{hascaption:true,centered:true,caption:"''",width:400,height:240,timeout:0,cssclassname:{name:""},font:{name:"arial",size:12,isBold:false,isItalic:false},controls:[{aID:1,aType:"panels",aName:"tabsheet",left:8,top:8,width:384,height:200,activesheet:1,tabsheets:[],controltype:"panels",showmarkers:false}],instanceatts:[],scrolltop:0},DIALOG_PANEL:{id:1,caption:"''",isvisible:true,showborder:true,showheader:false,collapsable:true,initialshrunk:false,cssname:"",contentcssname:"",controls:[]},DIALOG_LABEL:{aID:2,aType:"label",aName:"label",left:0,top:0,width:372,height:16,tabno:0,borderstyle:"none",bkgndstyle:"transparent",justification:"left",textcolor:"000000",bordercolor:"000000",caption:"''",visible:true,ishtml:false,showscroll:false,cssclassname:{name:""},applydialogfont:true},DIALOG_LISTBOX:{aID:3,aType:"listbox",aName:"logical",left:0,top:24,width:372,height:100,tabno:0,tieditem:0,style:"dropdownlist",excludemode:"showinvalid",visible:true,applydialogfont:true,controltype:"standard",validation:"",showsearch:false,cssclassname:{name:""},emptytext:""},DIALOG_BUTTON:{aID:4,aType:"button",aName:"button",left:0,top:0,width:48,height:26,tabno:0,caption:"'OK'",buttontype:"ok",visible:true,isarea:false,allowinvalid:0,allowincomplete:0,exitcheck:true,key:"none",applydialogfont:true,cssclassname:{name:""},enabled:true},DIALOG_CHECKBOX:{aID:5,aType:"checkbox",aName:"checkbox",left:0,top:24,width:372,height:28,tabno:0,tieditem:0,color:"ECE9D8",textcolor:"000000",caption:"'CheckBox'",selectablegrey:false,value:0,visible:true,applydialogfont:true,controltype:"buttonset",cssclassname:{name:""},validation:""},DIALOG_NUMERIC:{aID:6,aType:"number",aName:"numeric",left:0,top:24,width:372,height:24,tabno:0,tieditem:0,style:"editbox",visible:true,hasborder:true,color:"FFFFFF",textcolor:"000000",applydialogfont:true,cssclassname:{name:""},validation:""},DIALOG_TEXTBOX:{aID:7,aType:"textedit",aName:"text",left:0,top:24,width:372,height:24,tabno:0,tieditem:0,applydialogfont:true,cssclassname:{name:""},validation:""},DIALOG_GRID:{aID:8,aType:"grid",aName:"grid",left:0,top:24,width:372,height:24,tabno:0,tieditem:0,color:"FFFFFF",dynamicvals:true,controltype:"standard",cssclassname:{name:""},validation:""},DIALOG_DROPDOWN:{aID:9,aType:"dropdown",aName:"dropdown",left:0,top:24,width:372,height:120,tabno:0,tieditem:0,emptytext:"",helpposition:"'top right'",label:"",visible:true,applydialogfont:true,controltype:"standard",validation:"",showsearch:false,cssclassname:{name:""},emptytext:""},DIALOG_BUTTONGROUP:{aID:10,aType:"buttonset",aName:"buttonset",left:0,top:24,width:372,height:120,tabno:0,tieditem:0,emptytext:"",helpposition:"'top right'",label:"",visible:true,applydialogfont:true,validation:"",cssclassname:{name:""},emptytext:""},DIALOG_SLIDER:{aID:11,aType:"slider",aName:"slider",left:0,top:24,width:372,height:120,tabno:0,tieditem:0,helpposition:"'top right'",label:"",visible:true,applydialogfont:true,validation:"",cssclassname:{name:""},emptytext:""},DIALOG_DATE:{aID:12,aType:"date",aName:"date",left:155,top:24,width:140,height:24,tabno:0,tieditem:0,helpposition:"'top right'",label:"",visible:true,applydialogfont:true,validation:"",cssclassname:{name:""},emptytext:""},FindMaxID:function(b){var a=0;for(var f=0;f<b.controls.length;f++){if(b.controls[f].aID>a){a=b.controls[f].aID}switch(b.controls[f].aType){case"tabsheet":case"accordian":case"panels":case"columns":for(var e=0;f<b.controls[f].tabsheets;e++){if(b.controls[f].tabsheets[e].id>a){a=b.controls[f].tabsheets[e]}var d=this.FindMaxID(b.controls[f].tabsheets[e]);if(d>a){a=d}}break}}return a},UpdateIDs:function(d,a){for(var g=0;g<d.controls.length;g++){var b=d.controls[g];b.aID=++a.id;var e={orig:b.aName};b.aName="control"+b.aID;e.anew=b.aName;a.renames.push(e);if(b.tabno){b.tabno=0}switch(b.aType){case"tabsheet":case"accordian":case"panels":case"columns":for(var f=0;f<b.tabsheets.length;f++){b.tabsheets[f].id=++a.id;this.UpdateIDs(b.tabsheets[f],a)}break}}},UpdateTiedIDs:function(e,a){var f={doneHelp:false};for(var j=0;j<e.controls.length;j++){var d=e.controls[j];if(d.tieditem==0){d.tieditem=a}function h(k){k=k.replace(/Dialog_GetTiedDescription\((.*?)\)/,"Dialog_GetTiedDescription($1,dictionary.GetObject("+a+"))");k=k.replace(/Dialog_GetTiedName\(\)/,"Dialog_GetTiedName(dictionary.GetObject("+a+"))");k=k.replace(/Dialog_GetTiedFlatProp\((.*?)\)/,"Dialog_GetTiedFlatProp($1,dictionary.GetObject("+a+"))");k=k.replace(/Dialog_GetKMName\(\)/,"Dialog_GetKMName()");if(k.indexOf("Dialog_RenderTiedHelp()")>=0){k=k.replace(/Dialog_RenderTiedHelp\(\)/,"Dialog_RenderTiedHelp(dictionary.GetObject("+a+"))");f.doneHelp=true}k=k.replace(/\{__(.*?)\}/,"{__$1|"+a+"}");return k}if(d.hasOwnProperty("caption")){d.caption=h(d.caption)}if(d.hasOwnProperty("label")){d.label=h(d.label)}switch(d.aType){case"tabsheet":case"accordian":case"panels":case"columns":for(var g=0;g<d.tabsheets.length;g++){var b=this.UpdateTiedIDs(d.tabsheets[g],a);if(b.doneHelp){f.doneHelp=true}}break}}return f},SetTabNos:function(d,a){for(var f=0;f<d.controls.length;f++){var b=d.controls[f];switch(b.aType){case"listbox":case"dropdown":case"linklistbox":case"ticklistbox":case"number":case"checkbox":case"radiobtn":case"date":case"textedit":b.tabno=a++;break;case"tabsheet":case"accordian":case"panels":case"columns":for(var e=0;e<b.tabsheets.length;e++){a=this.SetTabNos(b.tabsheets[e],a)}break}}return a},scanCtrls:function(a,b){if(!$.isArray(a.controls)){return}if(!$.isFunction(b)){return}for(var f=a.controls.length-1;f>=0;f--){var d=a.controls[f];if(b(d)){a.controls.splice(f,1)}else{if((d.aType!="panels")&&$.isArray(d.tabsheets)){for(var e=0;e<d.tabsheets.length;e++){this.scanCtrls(d.tabsheets[e],b)}}}}},TiePanelButtonsAndControls:function(g,a,f,b,e){if(g.flatProps.grouppreviousanswers!=""){var h=[];this.scanCtrls(a,function(j){switch(j.aType){case"label":case"image":case"accordian":case"columns":case"container":case"button":case"panels":case"tabsheet":case"subdialog":return false}h.push(j);return false});if(h.length==0){h.push(b.aID)}var d=false;this.scanCtrls(a,function(j){if((j.aType=="button")&&(j.buttontype=="ok")){d=true;j.buttontype="change";if(f){j.caption=getTranslation("change","Change")}j.doOK=!f;j.changeCtrl=[];if(b&&(b.aType==TYPE_DIALOG)){j.treeDlgDlg=b.aID}for(var k=0;k<h.length;k++){if(typeof h[k]=="object"){j.changeCtrl.push(wrapperOptions.nodejs?h[k].aName:h[k]);h[k].isPrev=true}else{j.changeCtrl.push(wrapperOptions.nodejs?h[k].aName:h[k])}}}else{if((j.aType=="button")&&(j.buttontype=="exit")&&f){return true}}return false});if(!f){this.scanCtrls(e,function(j){if((j.aType=="button")&&(j.buttontype=="ok")){d=true;j.buttontype="change";j.doOK=true;j.changeCtrl=[];if(b&&(b.aType==TYPE_DIALOG)){j.treeDlgDlg=b.aID}for(var k=0;k<h.length;k++){if(typeof h[k]=="object"){j.changeCtrl.push(wrapperOptions.nodejs?h[k].aName:h[k]);h[k].isPrev=true}else{j.changeCtrl.push(wrapperOptions.nodejs?h[k].aName:h[k])}}}})}}},_SetaType:function(a){for(var b=0;b<a.length;b++){if(a[b].aType=="panels"){return a[b]}}return null},_ctrlScan:function(a,b){for(var e=0;e<a.length;e++){if(b(a[e])){return true}if(a[e].aType=="columns"){for(var d=0;d<a[e].tabsheets.length;d++){if(this._ctrlScan(a[e].tabsheets[d].controls,b)){return true}}}}return false},Render:function(a,G){var q=false;var E=a.flatProps.tieddialog;var D=this.DIALOG_DEF;var N;if(E){N=_dgo(E);if(N&&(N.aType==TYPE_DIALOG)){N.Load(N);D=N.loadedDefinition;q=true}}var Q=$.extend(true,{},D);Q.instanceatts=[];if(!q){Q.caption=a.GetDescription(true)}else{N={id:0,renames:[]};this.UpdateIDs(Q,N)}Q.grouppreviousanswers=a.flatProps.grouppreviousanswers;Q.previousanswersreadonly=a.flatProps.previousanswersreadonly;var v=null;var b=null;var S,T;if(appSettings.layout=="positional"){v=this._SetaType(Q.controls);for(S=0;(S<Q.controls.length)&&!b;S++){if((Q.controls[S].aType=="button")&&(Q.controls[S].buttontype=="ok")){b=Q.controls[S]}}T=false;for(S=0;(S<Q.controls.length)&&!T;S++){if((Q.controls[S].aType=="button")&&(Q.controls[S].buttontype=="macro")&&Q.controls[S].macroautook){T=true}}}else{this._ctrlScan(Q.controls,function(o){if((o.aType=="tabsheet")||(o.aType=="panels")){v=o;return true}return false});this._ctrlScan(Q.controls,function(o){if((o.aType=="button")&&(o.buttontype=="ok")){b=o;return true}return false});T=false;this._ctrlScan(Q.controls,function(o){if((o.aType=="button")&&(o.buttontype=="macro")&&o.macroautook){T=o;return true}return false})}if(b){}var n=false;var d=[];var z;var A=undefined;var m=[];if(v){var w=this.DIALOG_PANEL;if(v.tabsheets.length>0){w=v.tabsheets[0];w.isvisible=true;w.showborder=true;w.showheader=false;w.collapsable=true;w.initialshrunk=false}v.tabsheets=[];var x=this.FindMaxID(Q);var e=true;var H,k;for(S=0;S<G.length;S++){z=G[S];if(z){var f=false;for(var C=0;(C<S)&&!f;C++){if(G[C]&&(z.aID==G[C].aID)){f=true}}if(!f){d[d.length]=z.aID;Q.instanceatts.push({att:z.aID,isvisible:true});H=$.extend(true,{},w);H.id=++x;if(a.flatProps.grouppreviousanswers==""){e=false}else{if(!G[G.length-1]&&(S==G.length-2)){e=false}else{if(G[G.length-1]&&(S==G.length-1)){e=false}else{if((z.aType==TYPE_LIST)||(z.aType==TYPE_NUMERIC)||(z.aType==TYPE_DATE)||(z.aType==TYPE_BOOLEAN)||(z.aType==TYPE_TEXT)){if(z.IsEmpty()){}}}}}var y=dictionary.GetObject(z.aID);if(e){H.showheader=true;H.initialshrunk=true;if($.isFunction(xpertrule.previousAnswerCaptionRender)){H.caption=xpertrule.previousAnswerCaptionRender(y)}else{var J;if(y.aType==TYPE_DATE){J=y.GetValueAsString(true)}else{if((y.aType==TYPE_LIST)&&!y.isMultiSel){var K=y.GetValue();if(K>0){K=y.ValueIDtoIndex(K);J=y.aValues[K].aText}else{J=y.GetValueAsString()}}else{J=y.GetValueAsString(null,true)}}H.caption="<div class='prev-ans-att'>"+y.GetDescription(true)+"</div><div class='prev-ans-val'>"+(J?"("+J+")":"")+"</div>"}v.groupInitialCollapsed=true;n=true}else{H.caption=y.GetDescription(true)}if(z.flatProps&&z.flatProps.tieddialog){E=z.flatProps.tieddialog;N=_dgo(E);if(N&&(N.aType==TYPE_DIALOG)){N.Load(N);N=$.extend(true,{},N.loadedDefinition);H.controls=N.controls;if(Q.width<N.width+20){Q.width=N.width+20;v.width=Q.width-16}if(N.onshow){m.push(N.onshow)}N={id:x,renames:[]};this.UpdateIDs(H,N);x=N.id;var L=this.UpdateTiedIDs(H,z.aID);if(L.doneHelp){Q.helpdoneinlabel=true}this.TiePanelButtonsAndControls(a,H,e,z,Q)}}else{if(z.aType==TYPE_DIALOG){z.Load(z);N=$.extend(true,{},z.loadedDefinition);H.controls=N.controls;for(var l=0;l<N.controls.length;l++){N.controls[l].parentdlg=z.aID}if(N.onshow){m.push(N.onshow)}N={id:x,renames:[]};this.UpdateIDs(H,N);if($.isPlainObject(z.formRules)&&$.isArray(z.formRules.items)&&(z.formRules.items.length>0)){newRules=$.extend(true,{},z.formRules);var g;for(g=0;g<N.renames.length;g++){renameCtrlInFormRules(newRules,N.renames[g].orig,N.renames[g].anew)}if(A===undefined){A={items:[]}}for(g=0;g<newRules.items.length;g++){A.items.push(newRules.items[g])}}x=N.id;this.TiePanelButtonsAndControls(a,H,e,z,Q)}else{if(z.aType==TYPE_REPORT){var j=$.extend(true,{},this.DIALOG_LABEL);j.aID=++x;j.aName=j.aName+j.aID;j.width=v.width-10;j.height=100;j.ishtml=true;j.showscroll=true;j.caption=z.GetText(true);H.controls[H.controls.length]=j;this.TiePanelButtonsAndControls(a,H,e,z,Q)}else{if(!isMobile){var O=$.extend(true,{},this.DIALOG_LABEL);O.aID=++x;O.aName=O.aName+O.aID;O.width=v.width-10;O.caption=z.GetDescription(true);H.controls[H.controls.length]=O}k=null;switch(z.aType){case TYPE_LIST:k=$.extend(true,{},this.DIALOG_LISTBOX);k.width=v.width-10;break;case TYPE_BOOLEAN:k=$.extend(true,{},this.DIALOG_CHECKBOX);k.width=v.width-10;break;case TYPE_NUMERIC:k=$.extend(true,{},this.DIALOG_NUMERIC);k.width=v.width-10;break;case TYPE_TEXT:k=$.extend(true,{},this.DIALOG_TEXTBOX);k.width=v.width-10;break}if(k){k.aID=++x;k.aName=k.aName+k.aID;k.tieditem=z.aID;H.controls[H.controls.length]=k}if((a.flatProps.grouppreviousanswers!="")&&!q){var t=$.extend(true,{},this.DIALOG_BUTTON);t.aID=++x;t.aName=t.aName+t.aID;t.top=H.controls[H.controls.length-1].top+24+6;t.left=H.controls[H.controls.length-1].left;t.buttontype="change";if(e){t.caption=getTranslation("change","Change");t.width=Math.floor(t.width*1.5)}t.changeCtrl=[wrapperOptions.nodejs?k.aName:k];t.doOK=!e;k.isPrev=true;H.controls[H.controls.length]=t}this.TiePanelButtonsAndControls(a,H,e,z,Q)}}}if(appSettings.layout=="positional"){this._SetaType(H.controls)}v.tabsheets[v.tabsheets.length]=H}}else{d[d.length]=0;if(b){}else{if(!T){H=$.extend(true,{},this.DIALOG_PANEL);H.id=++x;k=$.extend(true,{},this.DIALOG_BUTTON);k.aID=++x;k.aName=k.aName+k.aID;H.controls[H.controls.length]=k;v.tabsheets[v.tabsheets.length]=H}}}}}this.SetTabNos(Q,1);var B=false;if(currentDlg){B=(currentDlg.aID!=a.aID)||n}var F=0;if(a.aID!=this.currentDisplay.taskID){B=true;Q.scrolltop=0;if(a.aID){N=dictionary.GetObject(a.aID);if(N.scrolltop){Q.scrolltop=N.scrolltop}}}else{if(isMobile){Q.scrolltop=$(document).height()}else{Q.scrolltop=$(window).scrollTop()}if(d.length!=this.currentDisplay.lastList.length){B=true;var R=this.currentDisplay.lastList.length;for(S=this.currentDisplay.lastList.length-1;S>=0;S--){if(this.currentDisplay.lastList[S]!=0){R=S+1;break}}if(R<d.length){F=d[R]}}else{for(S=0;(S<d.length)&&!B;S++){if(d[S]!=this.currentDisplay.lastList[S]){B=true}}}}if(this.currentDisplay.taskID){N=_dgo(this.currentDisplay.taskID);N.scrolltop=$(window).scrollTop()}if(B){if(wrapperOptions.nodejs){Q.taskID=a.aID;var I=[];for(S=0;S<G.length;S++){z=G[S];if(z){I.push(z.aID)}}throw new inferenceIssue(PASSBACK_DIALOG,"tree_dialog",{def:Q,usedIDs:I,taskID:a.aID})}if((a.flatProps.grouppreviousanswers!="")&&(a.flatProps.reversepreviousanswers)&&(v.tabsheets.length>2)){for(var h=0;h<Math.floor(v.tabsheets.length/2);h++){var g=v.tabsheets.length-2-h;var M=v.tabsheets[h];v.tabsheets[h]=v.tabsheets[g];v.tabsheets[g]=M}}var P={aID:a.aID,tiedObj:null};ClearUI(a.aID,false,replayStack.LastOperationWasValidatedOK());currentDlg=XRdialog.create($("#xrui"),Q,P,A);currentDlg.render();currentDlg.populate();currentDlg.focus(F);for(S=0;S<m.length;S++){N=_dgo(m[S]);if(N){N.Run(Q)}}this.currentDisplay.taskID=a.aID;this.currentDisplay.lastList=d}else{if(wrapperOptions.nodejs){throw new inferenceIssue(PASSBACK_DIALOG,"tree_dialog")}currentDlg.populate()}}};var AT_NUM=1;var AT_STR=2;var AT_BOOL=3;var AT_SUB=4;var AT_ADD=5;var AT_MUL=6;var AT_DIV=7;var AT_EQ=8;var AT_NE=9;var AT_LT=10;var AT_LE=11;var AT_GT=12;var AT_GE=13;var AT_AND=14;var AT_OR=15;var AT_NOT=16;var AT_OBJ=17;var AT_DEREF=18;var AT_FUNC=19;var AT_PROP=20;var AT_IN=21;var AT_ARR=22;var AT_SYSOBJ=23;var FUNC_ABS=1;var FUNC_SQRT=2;var FUNC_PI=3;var SYSOBJ_HIER=1;var EVAL_STR=1;var EVAL_NUM=2;var EVAL_BOOL=3;var EVAL_DATE=4;function TokCmd_castToForced(d,a){switch(a){case EVAL_NUM:if(typeof d=="string"){var b=parseFloat(d);if(b){return b}}else{if(typeof d=="boolean"){return d?1:0}else{if(d instanceof Date){return d.getTime()/86400000}}}break;case EVAL_STR:if(typeof d=="number"){return d+""}else{if(typeof d=="boolean"){return d?"true":"false"}else{if(d instanceof Date){return Cmd_DateToStr(d)}}}break;case EVAL_BOOL:if(typeof d=="string"){return d.toUpperCase()=="TRUE"?true:false}else{if(typeof d=="number"){return d!=0}}break}return d}function TokCmd_jsToType(b){var a=typeof b;switch(a){case"string":return EVAL_STR;case"number":return EVAL_NUM;case"boolean":return EVAL_BOOL;default:throw"Cannot convert to type ["+a+"]"}}function TokCmd_GetValueIndex(d,a){var b=0;if(a.idxs){if(a.idxs.length!=1){throw"Too many indexes (only 1 allowed for value index)"}b=TokCmd_Eval(a.idxs[0],EVAL_NUM)-1;if(!d.isMultiSel&&((b<0)||(b>=d.aValues.length))){throw"Attempt to get invalid value index ("+(b+1)+") for ["+d.aName+"]"}}else{b=d.GetValue();if(!d.isMultiSel){if(b==0){throw"Attempt to get current value for ["+d.aName+"] but currently empty"}b=d.ValueIDtoIndex(b)}}return b}function TokCmd_Eval(a,d,l){var q=typeof a;if((q=="string")||(q=="number")||(q=="boolean")||$.isArray(a)){return TokCmd_castToForced(a,d)}if((a.atype==AT_DEREF)&&(l)){var g=$.extend(false,{},a);g.atype=AT_PROP;g.val=TokCmd_Eval(a.val,EVAL_STR).toLowerCase();a=g}var C,G,F,A,u,f,D,e,b,t;switch(a.atype){case AT_NUM:return TokCmd_castToForced(a.val,d);case AT_STR:return TokCmd_castToForced(a.val,d);case AT_BOOL:return TokCmd_castToForced(a.val,d);case AT_ARR:t=[];for(C=0;C<a.prms.length;C++){t.push(TokCmd_Eval(a.prms[C],d,l))}return t;case AT_OBJ:case AT_DEREF:if(l){throw"Cannot have object below object"}if(a.atype==AT_OBJ){l=dictionary.GetObject(a.val)}else{var x=TokCmd_Eval(a.val,EVAL_STR);l=dictionary.GetObjectByName(x);if(!l){throw"Cannot find indirect reference ["+x+"]"}}if(a.idxs){if(l.aType!=TYPE_VARIABLE){throw"Only variables can have an index"}if(a.idxs.length>2){throw"Too many indexes for variable"}G=TokCmd_Eval(a.idxs[0],EVAL_NUM);F=(a.idxs.length>=2)?TokCmd_Eval(a.idxs[1],EVAL_NUM):1;return TokCmd_castToForced(l.GetValue(G,F),d)}else{if(a.sub){return TokCmd_Eval(a.sub,d,l)}else{if(l.aType==TYPE_PROCEDURE){u=[];if(a.prms){for(C=0;C<a.prms.length;C++){u.push(TokCmd_Eval(a.prms[C]))}}A=l.Run.apply(l,u)}else{if((l.aType==TYPE_DATE)&&(d==EVAL_STR)){A=l.GetValueAsString(true)}else{A=l.val()}}return TokCmd_castToForced(A,d)}}break;case AT_SYSOBJ:if(l){throw"Woops 1"}switch(a.val){case SYSOBJ_HIER:if(!a.sub){throw"Woops 2"}l=hierarchy;return TokCmd_Eval(a.sub,d,l);default:throw"Woops 3"}break;case AT_PROP:if(!l){throw"Property reference must be after an object"}if(l._isDialogControl){if(!l.hasOwnProperty(a.val)){if((a.val=="visible")&&l.hasOwnProperty("isvisible")){a.val="isvisible"}else{throw"Control property expected"}}if(a.val=="tabsheets"){if(!$.isArray(a.idxs)){throw"Tabsheet index expected"}if(a.idxs.length!=1){throw"1 tabsheet index expected"}var j=TokCmd_Eval(a.idxs[0],EVAL_NUM);if((j<1)||(j>l.tabsheets.length)){throw"Tabsheet index out of range ["+j+"]"}if(!a.sub){throw"Tabsheet property expected"}l=l.tabsheets[j-1];l._isDialogControl=true;var m=TokCmd_Eval(a.sub,d,l);if(typeof m=="string"){return XRdialog.expandEmbedded(m)}return m}else{if(a.sub){throw"Unexpected property"}var k=l[a.val];if(a.val=="tieditem"){k=_dgo(k);k=k?k.aName:""}return TokCmd_castToForced(k,d)}}if(l._isHierarchy){if(a.val=="item"){if(!a.prms){throw"Parameter expected"}if(a.prms.length!=1){throw"1 parameter expected"}G=TokCmd_Eval(a.prms[0],EVAL_NUM);if(a.sub){return TokCmd_Eval(a.sub,d,l.idxToNode(G).item)}else{l=l.idxToNode(G).item;if((l.aType==TYPE_DATE)&&(d==EVAL_STR)){A=l.GetValueAsString(true)}else{A=l.val()}return TokCmd_castToForced(A,d)}}if(!$.isFunction(l[a.val])){throw"Unknown hierarchy property ["+a.val+"]"}u=[];if(a.prms){for(C=0;C<a.prms.length;C++){u.push(TokCmd_Eval(a.prms[C]))}}return TokCmd_castToForced(l[a.val].apply(l,u),d)}if(l._isDialogInsts){if(a.val=="count"){return TokCmd_castToForced(l.dialogs.length,d)}if(!l.hasOwnProperty(a.val)){if(l.current){f=l.dialogs[l.current-1];return TokCmd_Eval(a,d,f)}throw"Unknown dialog instance property ["+a.val+"]"}return TokCmd_castToForced(l[a.val],d)}if(l._isDialogInst){var w=dictionary.GetObjectByName(a.val,true);if(!w){throw"Unknown dialog instance object ["+a.val+"]"}for(C=0;C<l.aDefinition.instanceatts.length;C++){if(l.aDefinition.instanceatts[C].att==w.aID){var z=l.GetDialogInstObject(w.aID);if(a.sub){if(a.idxs){if(a.idxs.length>1){throw"Too many indexes for variable"}G=TokCmd_Eval(a.idxs[0],EVAL_NUM);if((G<1)||(G>z.dialogs.length)){throw"Sub dialog instance ref out of bounds ["+G+"]"}z=z.dialogs[G-1];z._isDialogInst=true}return TokCmd_Eval(a.sub,d,z)}else{return TokCmd_castToForced(z.val(),d)}}}throw"Object does not exist on dialog instance ["+a.val+"]"}if(l._isValueProp){if(a.val=="description"){return TokCmd_castToForced(l.aDescription,d)}else{if(a.val=="displayorder"){return TokCmd_castToForced(l.display,d)}}throw"Displayorder is expected"}switch(a.val){case"name":return TokCmd_castToForced(l.aName,d);case"baseclass":return TokCmd_castToForced(l.GetBaseClassName(),d);case"multiselect":return TokCmd_castToForced(l.isMultiSel,d);case"default":return TokCmd_castToForced(l.flatProps._default,d);case"hascases":return TokCmd_castToForced(l.aExamples!=null,d);case"hastree":return TokCmd_castToForced(l.aTree!=null,d)}if((l.aType==TYPE_LIST)||(l.aType==TYPE_NUMERIC)||(l.aType==TYPE_DATE)||(l.aType==TYPE_BOOLEAN)||(l.aType==TYPE_TEXT)){if(a.val=="isempty"){return TokCmd_castToForced(l.IsEmpty(true),d)}if(a.val=="nvalid"){return TokCmd_castToForced(l.GetNvalid(),d)}if(a.val=="selectedindex"){return TokCmd_castToForced(l.GetSelectedIndex(),d)}if(a.val=="nvalues"){return TokCmd_castToForced(l.GetNvalues(),d)}if(a.val=="nselected"){return TokCmd_castToForced(l.GetNselected(),d)}if(l.flatProps.hasOwnProperty(a.val)){if(a.idxs){throw"Index not supported for flat props"}return TokCmd_castToForced(l.flatProps[a.val],d)}if(l.aValueProps){if(a.val=="valid"){G=TokCmd_GetValueIndex(l,a);return TokCmd_castToForced(l.IsValueIndexValid(G),d)}if(a.val=="selected"){G=TokCmd_GetValueIndex(l,a);return TokCmd_castToForced(l.IsValueIndexSelected(G),d)}if(a.val=="probability"){G=TokCmd_GetValueIndex(l,a);if((G<0)||(G>=l.aValues.length)){throw"Index out of bounds ["+G+"]"}return TokCmd_castToForced(l.aValues[G].prob,d)}for(C=0;C<l.aValueProps.list.length;C++){if(l.aValueProps.list[C].realName.toLowerCase()==a.val.toLowerCase()){if(a.sub){l.aValueProps.list[C]._isValueProp=true;return TokCmd_Eval(a.sub,d,l.aValueProps.list[C])}else{if(!a.idxs&&!l.isFull()){A=l.val();return TokCmd_castToForced(A,d)}var y=l.aValueProps.list[C].aName;if(false){if(!a.idxs){G=l.GetValueProp(y,-1)}else{G=l.GetValueProp(y,a.idxs)}return TokCmd_castToForced(G,d)}else{G=TokCmd_GetValueIndex(l,a);if(G<0&&l.isMultiSel){return TokCmd_castToForced("",d)}else{return TokCmd_castToForced(l.aValues[G][y],d)}}}}}}}if(l.aType==TYPE_DIALOG){if(l.aDefinition.hasOwnProperty(a.val)){if(a.sub){throw"Unexpected property"}return l.aDefinition[a.val]}var h=l.GetControlByName((l._isDialogParentControl?"parent_dot_":"")+a.val);if(h){if(!a.sub){throw"Control property expected"}h._isDialogControl=true;return TokCmd_Eval(a.sub,d,h)}if(a.val=="parent"){l._isDialogParentControl=true;var E=TokCmd_Eval(a.sub,d,l);delete l._isDialogParentControl;return E}f=l.GetDialogInstObjectByName(a.val,true);if(f){if(a.idxs){if(a.idxs.length>1){throw"Too many indexes for variable"}G=TokCmd_Eval(a.idxs[0],EVAL_NUM);if((G<1)||(G>f.dialogs.length)){throw"Sub dialog instance ref out of bounds ["+G+"]"}f=f.dialogs[G-1];f._isDialogInst=true}else{if(!a.sub){return TokCmd_castToForced(f.val(),d)}f._isDialogInsts=true}return TokCmd_Eval(a.sub,d,f)}}throw"Unknown property ["+a.val+"]";case AT_ADD:case AT_SUB:case AT_MUL:case AT_DIV:if(a.prms.length!=2){throw"Operator requires 2 sides"}D=((a.atype==AT_ADD)||(a.atype==AT_SUB)?undefined:EVAL_NUM);e=TokCmd_castToForced(TokCmd_Eval(a.prms[0],D));b=TokCmd_castToForced(TokCmd_Eval(a.prms[1],D));if($.isArray(e)||$.isArray(b)){if(!$.isArray(e)||!$.isArray(b)){throw"Array operator must contains matching sides"}t=e;switch(a.atype){case AT_ADD:for(C=0;C<b.length;C++){t.push(b[C])}break;case AT_SUB:for(C=0;C<b.length;C++){var B=$.inArray(b[C],t);if(B>=0){t.splice(B,1);continue}}break;default:throw"Invalid array operator ["+a.atype+"]"}}else{switch(a.atype){case AT_ADD:t=e+b;break;case AT_SUB:t=e-b;break;case AT_MUL:t=e*b;break;case AT_DIV:t=e/b;break}}return TokCmd_castToForced(t,d);case AT_IN:if(a.prms.length!=2){throw"Operator requires 2 sides"}e=TokCmd_castToForced(TokCmd_Eval(a.prms[0],EVAL_STR));b=TokCmd_Eval(a.prms[1]);t=$.inArray(e,b)>=0;return TokCmd_castToForced(t,d);case AT_FUNC:switch(a.val){case FUNC_ABS:case FUNC_SQRT:if(a.prms.length!=1){throw"Bad number of arguments #1"}e=TokCmd_Eval(a.prms[0],EVAL_NUM);switch(a.val){case FUNC_ABS:t=Math.abs(e);break;case FUNC_SQRT:t=Math.sqrt(e);break}return TokCmd_castToForced(t,d);case FUNC_PI:if(a.prms.length!==0){throw"Bad number of arguments #2"}return TokCmd_castToForced(Math.PI,d);case FUNC_LEN:if(a.prms.length!==1){throw"Bad number of arguments #3"}e=TokCmd_Eval(a.prms[0],EVAL_STR);t=e.length;return TokCmd_castToForced(t,d)}break;case AT_NOT:if(a.prms.length!=1){throw"Bad number of arguments #4"}e=TokCmd_Eval(a.prms[0],EVAL_BOOL);t=!e;return TokCmd_castToForced(t,d);case AT_AND:case AT_OR:if(a.prms.length<2){throw"Bad number of arguments #5"}t=TokCmd_Eval(a.prms[0],EVAL_BOOL);for(C=1;(C<a.prms.length)&&!(((a.atype==AT_AND)&&!t)||((a.atype==AT_OR)&&t));C++){e=TokCmd_Eval(a.prms[C],EVAL_BOOL);switch(a.atype){case AT_AND:t=t&&e;break;case AT_OR:t=t||e;break}}return TokCmd_castToForced(t,d);case AT_EQ:case AT_NE:case AT_LT:case AT_LE:case AT_GT:case AT_GE:if(a.prms.length!=2){throw"Bad number of arguments #6"}e=TokCmd_Eval(a.prms[0]);b=TokCmd_Eval(a.prms[1]);switch(a.atype){case AT_EQ:t=e==b;break;case AT_NE:t=e!=b;break;case AT_LT:t=e<b;break;case AT_LE:t=e<=b;break;case AT_GT:t=e>b;break;case AT_GE:t=e>=b;break}return TokCmd_castToForced(t,d)}throw"Cannot evaluate atom"}var OBJECTREF_OBJECT=1;var OBJECTREF_ARRAYITEM=2;var OBJECTREF_FLATPROP=3;var OBJECTREF_VALUEPROP=4;var OBJECTREF_DIALOGPROP=5;var OBJECTREF_METHOD=6;var OBJECTREF_USCEVENT=7;var OBJECTREF_VALUEPROPPROP=8;var OBJECTREF_TXTPROCPROP=9;function TokCmd_ObjectRef(b,a,d){this.aType=b;this.aObject=a;this.aExtra=d}function TokCmd_Lookup(j,b,m){var l=typeof b;if((l=="string")||(l=="number")||(l=="boolean")){throw"Invalid object reference"}if((b.atype==AT_DEREF)&&(j)){var f=$.extend(false,{},b);f.atype=AT_PROP;f.val=TokCmd_Eval(b.val,EVAL_STR).toLowerCase();b=f}var w,v,t,e;switch(b.atype){case AT_OBJ:case AT_DEREF:if(j){throw"Invalid object.object reference"}var k="";var a=0;if(b.atype==AT_OBJ){j=dictionary.GetObject(b.val)}else{a=b.val.indexOf("[");if(a>=0){k=b.val.substr(a);b.val=b.val.substr(0,a)}j=dictionary.GetObjectByName(TokCmd_Eval(b.val,EVAL_STR));if(!j){throw"Unknown object in dereference ["+b.val+"]"}}if(b.idxs){if(j.aType!=TYPE_VARIABLE){throw"Only variables can contain a indicies"}if(b.idxs.length>2){throw"Too many indicies for variable"}w=TokCmd_Eval(b.idxs[0],EVAL_NUM);v=(b.idxs.length>=2)?TokCmd_Eval(b.idxs[1],EVAL_NUM):1;return new TokCmd_ObjectRef(OBJECTREF_ARRAYITEM,j,{idx1:w,idx2:v})}else{if(k!=""){if(j.aType!=TYPE_VARIABLE){throw"Only variables can contain a indicies"}if(k.substr(k.length-1)!="]"){throw"Missing close bracket"}k=k.substr(1,k.length-2);a=k.indexOf(",");if(a<0){w=parseInt(k);v=1}else{w=parseInt(k.substr(0,a));v=parseInt(k.substr(a+1))}return new TokCmd_ObjectRef(OBJECTREF_ARRAYITEM,j,{idx1:w,idx2:v})}else{if(b.sub){return TokCmd_Lookup(j,b.sub,j)}else{return new TokCmd_ObjectRef(OBJECTREF_OBJECT,j)}}}return;case AT_PROP:if(j._isDialogControl){if(!j.hasOwnProperty(b.val)){if((b.val=="visible")&&j.hasOwnProperty("isvisible")){b.val="isvisible"}else{throw"Control property expected"}}if(b.val=="tabsheets"){if(!$.isArray(b.idxs)){throw"Tabsheet index expected"}if(b.idxs.length!=1){throw"1 tabsheet index expected"}var h=TokCmd_Eval(b.idxs[0],EVAL_NUM);if((h<1)||(h>j.tabsheets.length)){throw"Tabsheet index out of range ["+h+"]"}if(!b.sub){throw"Tabsheet property expected"}j=j.tabsheets[h-1];j._isDialogControl=true;return TokCmd_Lookup(j,b.sub,m)}else{if(b.sub){throw"Unexpected property"}return new TokCmd_ObjectRef(OBJECTREF_DIALOGPROP,j,{dlg:m,prop:b.val})}}if(j._isValueProp){if(b.val=="displayorder"){return new TokCmd_ObjectRef(OBJECTREF_VALUEPROPPROP,j,{prop:"display"})}if(b.sub){throw"Unknown value property property ["+arom.val+"]"}}if(j._isDialogInsts){if(b.val=="clear"){return new TokCmd_ObjectRef(OBJECTREF_METHOD,j,{aMethod:"clearsubdlginsts"})}if(!j.hasOwnProperty(b.val)){if(j.current){e=j.dialogs[j.current-1];return TokCmd_Lookup(e,b,m)}throw"Unknown dialog instance property ["+b.val+"]"}throw"Invalid dialog instance property ["+b.val+"]"}if(j._isDialogInst){var n=dictionary.GetObjectByName(b.val,true);if(!n){throw"Unknown dialog instance object ["+b.val+"]"}for(t=0;t<j.aDefinition.instanceatts.length;t++){if(j.aDefinition.instanceatts[t].att==n.aID){var q=j.GetDialogInstObject(n.aID);if(b.sub){if(b.idxs){if(b.idxs.length>1){throw"Too many indexes for variable"}w=TokCmd_Eval(b.idxs[0],EVAL_NUM);if((w<1)||(w>q.dialogs.length)){throw"Sub dialog instance ref out of bounds ["+w+"]"}q=q.dialogs[w-1];q._isDialogInst=true}}return TokCmd_Lookup(q,b.sub,m)}}throw"Unknown dialog instance property ["+b.val+"]"}if((j.aType==TYPE_LIST)||(j.aType==TYPE_NUMERIC)||(j.aType==TYPE_DATE)||(j.aType==TYPE_BOOLEAN)||(j.aType==TYPE_TEXT)){if(b.val=="default"){b.val="_default"}if(j.flatProps.hasOwnProperty(b.val)){if(b.idxs){throw"Index not allowed for object.flatprop"}return new TokCmd_ObjectRef(OBJECTREF_FLATPROP,j,{prop:b.val})}if(j.aValueProps){for(t=0;t<j.aValueProps.list.length;t++){if(j.aValueProps.list[t].realName.toLowerCase()==b.val.toLowerCase()){if(b.sub){j.aValueProps.list[t]._isValueProp=true;return TokCmd_Lookup(j.aValueProps.list[t],b.sub,m)}var p=j.aValueProps.list[t].aName;w=TokCmd_GetValueIndex(j,b);return new TokCmd_ObjectRef(OBJECTREF_VALUEPROP,j,{idx:w,prop:p})}}}if(j.aType==TYPE_LIST){switch(b.val){case"delinstance":if(b.prms.length!=1){throw"delinstance requires 1 parameter"}w=TokCmd_castToForced(TokCmd_Eval(b.prms[0],EVAL_NUM));return new TokCmd_ObjectRef(OBJECTREF_METHOD,j,{aMethod:"delinstance",idx:w});case"addinstance":if(b.prms.length!=1){throw"addinstance requires 1 parameter"}var r=TokCmd_castToForced(TokCmd_Eval(b.prms[0],EVAL_STR));return new TokCmd_ObjectRef(OBJECTREF_METHOD,j,{aMethod:"addinstance",valName:r});case"clearinstances":if(b.prms!=undefined){throw"clearinstances requires 0 parameters"}return new TokCmd_ObjectRef(OBJECTREF_METHOD,j,{aMethod:"clearinstances"})}}switch(b.val){case"clear":if(b.prms){throw"clear requires 0 parameters"}return new TokCmd_ObjectRef(OBJECTREF_METHOD,j,{aMethod:"clear"});case"evaluate":if(b.prms){throw"evaluate requires 0 parameters"}return new TokCmd_ObjectRef(OBJECTREF_METHOD,j,{aMethod:"evaluate"});case"oncapture":case"onupdate":case"onleave":case"onhierarchyenter":case"onhierarchyexit":if(b.prms){throw"event requires 0 parameters"}var d;switch(b.val){case"oncapture":d=EVENT_CAPTURE;break;case"onupdate":d=EVENT_UPDATE;break;case"onleave":d=EVENT_LEAVE;break;case"onhierarchyenter":d=EVENT_HIERARCHYENTER;break;case"onhierarchyexit":d=EVENT_HIERARCHYEXIT;break}return new TokCmd_ObjectRef(OBJECTREF_USCEVENT,j,{aEvent:d})}}if(j.aType==TYPE_DIALOG){if(b.val=="doupdates"){return new TokCmd_ObjectRef(OBJECTREF_METHOD,j,{aMethod:"doupdates"})}if(j.aDefinition.hasOwnProperty(b.val)){if(b.sub){throw"Unexpected property"}return new TokCmd_ObjectRef(OBJECTREF_DIALOGPROP,j.aDefinition,{dlg:j,prop:b.val})}var g=j.GetControlByName((j._isDialogParentControl?"parent_dot_":"")+b.val);if(g){if(!b.sub){throw"Control property expected"}g._isDialogControl=true;return TokCmd_Lookup(g,b.sub,j)}if(b.val=="parent"){if(!b.sub){throw"Control name expected"}j._isDialogParentControl=true;var u=TokCmd_Lookup(j,b.sub,j);delete j._isDialogParentControl;return u}e=j.GetDialogInstObjectByName(b.val,true);if(e){if(b.idxs){if(b.idxs.length>1){throw"Too many indexes for variable"}w=TokCmd_Eval(b.idxs[0],EVAL_NUM);if((w<1)||(w>e.dialogs.length)){throw"Sub dialog instance ref out of bounds ["+w+"]"}e=e.dialogs[w-1];e._isDialogInst=true}else{if(!b.sub){return new TokCmd_ObjectRef(OBJECTREF_OBJECT,e)}e._isDialogInsts=true}return TokCmd_Lookup(e,b.sub,e)}}if(j.aType==TYPE_TXTPROCESSOR){if(b.val=="text"){return new TokCmd_ObjectRef(OBJECTREF_TXTPROCPROP,j,{prop:b.val})}}throw"Unknown property ["+b.val+"]";default:throw"Invalid object reference"}}function TokCmd_Set(b,a){switch(b.aType){case OBJECTREF_OBJECT:b.aObject.val(a);break;case OBJECTREF_ARRAYITEM:b.aObject.SetValue(a,b.aExtra.idx1,b.aExtra.idx2);break;case OBJECTREF_FLATPROP:b.aObject.flatProps[b.aExtra.prop]=TokCmd_castToForced(a,TokCmd_jsToType(b.aObject.flatProps[b.aExtra.prop]));replayProtection.set(b.aObject,true);break;case OBJECTREF_VALUEPROP:b.aObject.aValues[b.aExtra.idx][b.aExtra.prop]=TokCmd_castToForced(a,TokCmd_jsToType(b.aObject.aValues[b.aExtra.idx][b.aExtra.prop]));if(b.aExtra.prop==b.aObject.aValueProps.general.descriptionprop){b.aObject.aValues[b.aExtra.idx].aText=b.aObject.GetValueDescr(b.aExtra.idx)}break;case OBJECTREF_DIALOGPROP:b.aObject[b.aExtra.prop]=TokCmd_castToForced(a,TokCmd_jsToType(b.aObject[b.aExtra.prop]));if(b.aExtra.dlg){b.aExtra.dlg.dirty=true}break;case OBJECTREF_VALUEPROPPROP:b.aObject[b.aExtra.prop]=TokCmd_castToForced(a,TokCmd_jsToType(b.aObject[b.aExtra.prop]));break;case OBJECTREF_TXTPROCPROP:b.aObject.val(a);break;default:throw"Expression does not reference an assignable item"}}var OBJECT_TYPE_ERR="Expression does not reference a compatible object";var INDEX_OUT_ERR="Index out of bounds";function TokCmd_TypeCheck(e,b,a,d){if(typeof e!=b){throw"Invalid parameter type passed in @"+a+" command. Expected ["+b+"] but received ["+(typeof e)+"]"+(d?" for parameter ["+d+"]":"")}}var call_stack=[];function stk_reset(){call_stack=[]}function stk_in(a){call_stack.push(a)}function stk_out(){call_stack.splice(call_stack.length-1,1)}function stk_isValid(){return call_stack.length>0}function stk_toString(){var a="[";for(var b=call_stack.length-1;b>=0;b--){a+=(b<call_stack.length-1?" <- ":"")+call_stack[b]}return a+"]"}function FPC(d,b,a){if(typeof d==a){return d}softError("Fixing parameter type for ["+b+"]. Expected ["+a+"] but received ["+(typeof d)+"]");switch(a){case"string":return""+d;case"number":return parseFloat(d);case"boolean":switch(typeof d){case"string":return(d.toLowerCase=="true")||(d.toLowerCase=="yes");case"number":return d>0;default:return false}}}function TokCmd_ArrAssign(b,a){if(b.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if(b.aObject.aType!=TYPE_VARIABLE){throw OBJECT_TYPE_ERR}if(!$.isArray(b.aObject.data)){throw INDEX_OUT_ERR}if(!$.isArray(a)){throw INDEX_OUT_ERR}for(var d=0;d<a.length;d++){if(d>=b.aObject.dim1){throw INDEX_OUT_ERR}if($.isArray(b.aObject.data[d+1])){if($.isArray(a[d])){b.aObject.data[d+1]=a[d].slice(0);b.aObject.data[d+1].splice(0,0,0)}else{b.aObject.data[d+1][1]=a[d]}}else{if($.isArray(a[d])){b.aObject.data[d+1]=a[d][0]}else{b.aObject.data[d+1]=a[d]}}}}function TokCmd_Do(b,a){switch(b.aType){case OBJECTREF_OBJECT:if((b.aObject.aType==TYPE_LIST)||(b.aObject.aType==TYPE_NUMERIC)||(b.aObject.aType==TYPE_DATE)||(b.aObject.aType==TYPE_BOOLEAN)||(b.aObject.aType==TYPE_TEXT)){if(typeof a=="number"){return b.aObject.Run({exitOnEmpty:a==1})}else{return b.aObject.Run()}}else{if(a){return b.aObject.Run.apply(b.aObject,a)}}return b.aObject.run();case OBJECTREF_METHOD:switch(b.aExtra.aMethod){case"delinstance":b.aObject.DelInstance(b.aExtra.idx);return true;case"addinstance":b.aObject.AddInstance(b.aExtra.valName);return true;case"clearinstances":b.aObject.ClearInstances();return true;case"clear":b.aObject.Clear();return true;case"evaluate":b.aObject.Evaluate();return true;case"doupdates":b.aObject.DoUpdates();return true;case"clearsubdlginsts":b.aObject.current=0;b.aObject.selectedIndex=0;b.aObject.dialogs=[];return true;default:throw"Unknown method ["+b.aObject.aName+"."+b.aExtra.aMethod+"]"}break;case OBJECTREF_USCEVENT:b.aObject.FireEvent(b.aExtra.aEvent);return true;default:throw OBJECT_TYPE_ERR}}function TokCmd_Clear(a){if(a.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}a.aObject.Clear()}function TokCmd_Evaluate(a){if(a.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}a.aObject.Evaluate()}function TokCmd_InitArray(b,a){if(!b){throw"TODO: @InitArray on all the arrays"}else{if(b.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}}if(b.aObject.aType!=TYPE_VARIABLE){throw OBJECT_TYPE_ERR}b.aObject.Clear(a)}function TokCmd_ListOp(f,h,e){if(f.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if(f.aObject.aType!=TYPE_LIST){throw OBJECT_TYPE_ERR}if(!f.aObject.isMultiSel){throw OBJECT_TYPE_ERR}var g,b;for(g=0;g<e.length;g++){var a=f.aObject.NameToID(e[g]);if(a===0){throw"Unknown object value ["+e[g]+"] for object ["+f.aObject.aName+"]"}e[g]=a}switch(h){case"SET":f.aObject.SetValue(e);break;case"ADD":b=f.aObject.GetValue();for(g=0;g<e.length;g++){b.push(e[g])}f.aObject.SetValue(b);break;case"DEL":b=f.aObject.GetValue();for(g=0;g<e.length;g++){var d=$.inArray(e[g],b);if(d>=0){b.splice(d,1)}}f.aObject.SetValue(b);break}}function TokCmd_AttribVals(b,a){if(b.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if((b.aObject.aType!=TYPE_LIST)&&(b.aObject.aType!=TYPE_BOOLEAN)){throw OBJECT_TYPE_ERR}if(a.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if(a.aObject.aType!=TYPE_VARIABLE){throw OBJECT_TYPE_ERR}if(a.aObject.varType!=VARTYPE_STR){throw OBJECT_TYPE_ERR}for(var d=0;d<b.aObject.aValues.length;d++){a.aObject.SetValue(b.aObject.aValues[d].aName,d+1)}return b.aObject.aValues.length}function TokCmd_Copy(d,b,a){TokCmd_TypeCheck(d,"string","Copy","Source");return d.substr(b-1,a)}function TokCmd_LogToNum(a){if(a.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if((a.aObject.aType!=TYPE_LIST)&&(a.aObject.aType!=TYPE_BOOLEAN)){throw OBJECT_TYPE_ERR}return a.aObject.ValueIDtoIndex(a.aObject.GetValue())+1}function TokCmd_NumToLog(a,b){if(b.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if((b.aObject.aType!=TYPE_LIST)&&(b.aObject.aType!=TYPE_BOOLEAN)){throw OBJECT_TYPE_ERR}if(a<1){throw INDEX_OUT_ERR}if(a>b.aObject.aValues.length){throw INDEX_OUT_ERR}b.aObject.SetValue(b.aObject.aValues[a-1].aID)}function TokCmd_Pad(a,b){TokCmd_TypeCheck(a,"string","Pad","String");while(a.length<b){a+=" "}return a}function TokCmd_UnPad(a){TokCmd_TypeCheck(a,"string","UnPad","String");return $.trim(a)}function TokCmd_Pos(b,a){TokCmd_TypeCheck(a,"string","Pos","String");return a.indexOf(b)+1}function TokCmd_GetReportText(a){if(a.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if(a.aObject.aType!=TYPE_REPORT){throw OBJECT_TYPE_ERR}return a.aObject.GetText(true)}function TokCmd_Date(a){return Cmd_GetDate(a?a:1)}function TokCmd_DecodeDate(b){var a=Cmd_Decode_Date(b);return{d:a.getUTCDate(),m:a.getUTCMonth()+1,y:a.getUTCFullYear()}}function TokCmd_Time(a){return Cmd_StrTime(Cmd_GetTime(a))}function TokCmd_RunMode(){return Cmd_RunMode()}function TokCmd_Rnd(a){return Math.random()*a}function TokCmd_Frac(a){return cmd_Frac(a)}function TokCmd_Sqr(a){return Math.pow(a,2)}function TokCmd_DecodeData(d,b,a){return{err:Cmd_DecodeData(d,(b=="XML"),-1,0)}}function TokCmd_RefListToIDlist(b){var a=[];if($.isArray(b)){for(var d=0;d<b.length;d++){if(b[d].aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}a.push(b[d].aObject.aID)}}return a}function TokCmd_EncodeData(b,a,g,f){var e="";var h=TokCmd_RefListToIDlist(f);if(a){h.push(-1)}switch(b){case"XML":e=Cmd_EncodeData(h,true,"",true);break;case"XML_EXTEND":var d="";e=Cmd_EncodeData_Extend(h,true,"",true,d);break;case"XML_NOPROPS":e=Cmd_EncodeData(h,true,"","3");break;case"TXT":e=Cmd_EncodeData(h,false,"",false);break}return e}function TokCmd_DecodeDataXML(d,b,e){var a=0;if(e){if(e.aType==OBJECTREF_OBJECT){a=e.aObject.aID}}return{err:Cmd_DecodeDataXML(d,-1,a,b)}}function TokCmd_EncodeDataXML(a,g,e,d){var f=TokCmd_RefListToIDlist(e);var b=a?"3":true;if(g){return Cmd_EncodeData_Extend(f,true,"",b,d)}return Cmd_EncodeData(f,true,"",b)}function TokCmd_Constrain(b,a){if(b.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if(!a){Constrain([b.aObject.aID])}else{replayStack.CriticalSection(function(d){Constrain([b.aObject.aID]);d.CriticalDone()})}}function TokCmd_Val(a){var b={val:parseFloat(a),err:0};if(isNaN(b.val)){b.val=0;b.err=1}return b}function TokCmd_UrlFetch(e,b,a){var d=Cmd_URLfetch(e,b,undefined,undefined,a);return{ret:d.data,ok:d.success}}function TokCmd_Regex(g,d,f,j){if(j.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}var h=new RegExp(d,f);switch(j.aObject.aType){case TYPE_BOOLEAN:j.aObject.SetValueAsBool(h.test(g));break;case TYPE_VARIABLE:if(j.aObject.varType!=VARTYPE_STR){throw OBJECT_TYPE_ERR}var b=0;var a,e;do{a=h.exec(g);if(a){e=a[0]}else{e=""}j.aObject.SetValue(e,++b,1);if(!h.global){a=false}}while(a);break;default:throw OBJECT_TYPE_ERR}}function TokCmd_Split(e,d,f){TokCmd_TypeCheck(e,"string","Split","String");if(f.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if(f.aObject.varType!=VARTYPE_STR){throw OBJECT_TYPE_ERR}var b=e.split(d);if((b.length>1)&&(b[b.length-1].length==0)){b.splice(b.length-1,1)}f.aObject.SetValue(b);return{cnt:b.length}}function TokCmd_Message(a,b){if(msgFlashDivTimer){clearTimeout(msgFlashDivTimer);msgFlashDivTimer=null}if($.trim(a).length===0){msgFlashDiv.hide()}else{msgFlashDiv.html(a).show();if(b){setTimeout(function(){TokCmd_Message("")},b*1000)}}}function TokCmd_HierarchyToStr(b){var a=null;if(b){if(b.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if(b.aObject.varType!=VARTYPE_HIERARCHY){throw OBJECT_TYPE_ERR}a=b.aObject}return hierarchy.toString(a,"legacy")}function TokCmd_NumToStr(b,a){TokCmd_TypeCheck(b,"number","NumToStr","number");TokCmd_TypeCheck(a,"number","NumToStr","decs");return b.toFixed(a).toString()}function TokCmd_EncodeDate(a,e,f){if(arguments.length==0){var b=new Date();return Cmd_EncodeDate(b.getFullYear(),b.getMonth()+1,b.getDate())}else{if(typeof a!="number"){throw"Invalid number type for Day"}if(typeof e!="number"){throw"Invalid number type for Month"}if(typeof f!="number"){throw"Invalid number type for Year"}return Cmd_EncodeDate(f,e,a)}}function TokCmd_Uncaptured(a){if(a.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}return GetUncaptured(a.aObject)}function TokCmd_EncodeDialogXML(a){var b;if(a){b=TokCmd_RefListToIDlist(a)}return Cmd_DialogInstanceData(undefined,b)}function TokCmd_DBcall(d,b,h,f,a){var g={};var e=replayStack.PopReplay(d.aID,false,g);if(e==REPLAYPOP_HANDLED){if(!g.ok&&a){hardError(g.error);return}return g}else{if(e==REPLAYPOP_CURRENT){ServerCall(d.aID,"method=DB&dbid="+b+"&sql="+escape(h)+"&retarr="+(f?"1":"0")+"&pauseid="+d.aID);return false}else{hardError("Unknown replay pop return ["+e+"]");return}}}function TokCmd_Phone(a,d,b){return Cmd_Phone(a,d,-1,b)}function TokCmd_PhoneFeature(a,b){return Cmd_PhoneFeature(a,b,-1)}function TokCmd_SetDialogInstanceData(b,a){return Cmd_SetDialogInstanceData(b,a)}function TokCmd_DoBayes(a){if(!a){throw OBJECT_TYPE_ERR}if(a.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if(a.aObject.aType!=TYPE_LIST){throw OBJECT_TYPE_ERR}var b=a.aObject;b.runBayes()}function TokCmd_GetBookmark(){return urlParams.site+"?bm="+escape(replayStack.Serialize())+urlParams.toString(true)}function TokCmd_GetDays(a){if(typeof a!="object"){return 0}return a.getTime()/86400000}function TokCmd_ArrayMin(a,d){if(d>a.dim1){d=a.dim1}var e=null;for(var f=0;f<d;f++){var b=a.GetValue(f+1);if((e===null)||(b<e)){e=b}}return e}function TokCmd_ArrayMax(a,d){if(d>a.dim1){d=a.dim1}var e=null;for(var f=0;f<d;f++){var b=a.GetValue(f+1);if((e===null)||(b>e)){e=b}}return e}function TokCmd_ArrayAvg(a,d){if(d>a.dim1){d=a.dim1}var b=0;for(var e=0;e<d;e++){b+=a.GetValue(e+1)}return e>0?b/e:null}function TokCmd_ArrayLen(a){return a.dim1}function _dbg(a){lastErr=a}var XRdocClassifier={stop_words:["a","about","above","above","across","after","afterwards","again","against","all","almost","alone","along","already","also","although","always","am","among","amongst","amoungst","amount","an","and","another","any","anyhow","anyone","anything","anyway","anywhere","are","around","as","at","back","be","became","because","become","becomes","becoming","been","before","beforehand","behind","being","below","beside","besides","between","beyond","bill","both","bottom","but","by","call","can","cannot","cant","co","con","could","couldnt","cry","de","describe","detail","do","done","down","due","during","each","eg","eight","either","eleven","else","elsewhere","empty","enough","etc","even","ever","every","everyone","everything","everywhere","except","few","fifteen","fify","fill","find","fire","first","five","for","former","formerly","forty","found","four","from","front","full","further","get","give","go","had","has","hasnt","have","he","hence","her","here","hereafter","hereby","herein","hereupon","hers","herself","him","himself","his","how","however","hundred","ie","if","in","inc","indeed","interest","into","is","it","its","itself","keep","last","latter","latterly","least","less","ltd","made","many","may","me","meanwhile","might","mill","mine","more","moreover","most","mostly","move","much","must","my","myself","name","namely","neither","never","nevertheless","next","nine","no","nobody","none","noone","nor","not","nothing","now","nowhere","of","off","often","on","once","one","only","onto","or","other","others","otherwise","our","ours","ourselves","out","over","own","part","per","perhaps","please","put","rather","re","same","see","seem","seemed","seeming","seems","serious","several","she","should","show","side","since","sincere","six","sixty","so","some","somehow","someone","something","sometime","sometimes","somewhere","still","such","system","take","ten","than","that","the","their","them","themselves","then","thence","there","thereafter","thereby","therefore","therein","thereupon","these","they","thickv","thin","third","this","those","though","three","through","throughout","thru","thus","to","together","too","top","toward","towards","twelve","twenty","two","un","under","until","up","upon","us","very","via","was","we","well","were","what","whatever","when","whence","whenever","where","whereafter","whereas","whereby","wherein","whereupon","wherever","whether","which","while","whither","who","whoever","whole","whom","whose","why","will","with","within","without","would","yet","you","your","yours","yourself","yourselves","the"],_stemmer:function(){var h={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},e={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},j="[^aeiou]",l="[aeiouy]",a=j+"[^aeiouy]*",g=l+"[aeiou]*",f="^("+a+")?"+g+a,b="^("+a+")?"+g+a+"("+g+")?$",d="^("+a+")?"+g+a+g+a,k="^("+a+")?"+l;return function(t){var n,v,u,x,q,p,o,m=t;if(t.length<3){return t}u=t.substr(0,1);if(u=="y"){t=u.toUpperCase()+t.substr(1)}x=/^(.+?)(ss|i)es$/;q=/^(.+?)([^s])s$/;if(x.test(t)){t=t.replace(x,"$1$2")}else{if(q.test(t)){t=t.replace(q,"$1$2")}}x=/^(.+?)eed$/;q=/^(.+?)(ed|ing)$/;if(x.test(t)){var r=x.exec(t);x=new RegExp(f);if(x.test(r[1])){x=/.$/;t=t.replace(x,"")}}else{if(q.test(t)){var r=q.exec(t);n=r[1];q=new RegExp(k);if(q.test(n)){t=n;q=/(at|bl|iz)$/;p=new RegExp("([^aeiouylsz])\\1$");o=new RegExp("^"+a+l+"[^aeiouwxy]$");if(q.test(t)){t=t+"e"}else{if(p.test(t)){x=/.$/;t=t.replace(x,"")}else{if(o.test(t)){t=t+"e"}}}}}}x=new RegExp("^(.*"+l+".*)y$");if(x.test(t)){var r=x.exec(t);n=r[1];t=n+"i"}x=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/;if(x.test(t)){var r=x.exec(t);n=r[1];v=r[2];x=new RegExp(f);if(x.test(n)){t=n+h[v]}}x=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/;if(x.test(t)){var r=x.exec(t);n=r[1];v=r[2];x=new RegExp(f);if(x.test(n)){t=n+e[v]}}x=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/;q=/^(.+?)(s|t)(ion)$/;if(x.test(t)){var r=x.exec(t);n=r[1];x=new RegExp(d);if(x.test(n)){t=n}}else{if(q.test(t)){var r=q.exec(t);n=r[1]+r[2];q=new RegExp(d);if(q.test(n)){t=n}}}x=/^(.+?)e$/;if(x.test(t)){var r=x.exec(t);n=r[1];x=new RegExp(d);q=new RegExp(b);p=new RegExp("^"+a+l+"[^aeiouwxy]$");if(x.test(n)||(q.test(n)&&!(p.test(n)))){t=n}}x=/ll$/;q=new RegExp(d);if(x.test(t)&&q.test(t)){x=/.$/;t=t.replace(x,"")}if(u=="y"){t=u.toLowerCase()+t.substr(1)}return t}},_stem:null,stem:function(a){if(!this._stem){this._stem=this._stemmer()}return this._stem(a)},_addDocument:function(b,e,d){var a={words:this._getWordArray(e),word_frequencies:[],data:d};b.documents.push(a)},_computAllWordFrequencies:function(b){b.words=[];for(var d=0;d<b.documents.length;d++){var a=b.documents[d];a.word_frequencies=[]}for(var d=0;d<b.documents.length;d++){var a=b.documents[d];for(var e=0;e<a.words.length;e++){var f=a.words[e];this._computeWordFrequenciesWithWord(b,f,d)}}},_computeWordFrequenciesWithWord:function(e,h,d){for(var f=0;f<e.documents.length;f++){var b=e.documents[f];var a=(f==d?1:0);var g=this._arrayBinaryGetObjectWithName(b.word_frequencies,h);if(!g){g={name:h,count:a};this._arrayBinaryInsertObject(b.word_frequencies,g)}else{g.count+=a}if(a==1&&g.count==1){var j=this._arrayBinaryGetObjectWithName(e.words,g.name);if(!j){j={name:g.name,appearance_count:a};this._arrayBinaryInsertObject(e.words,j)}else{j.appearance_count+=a}}}},_computeTfIdfValues:function(b){for(var d=0;d<b.documents.length;d++){var a=b.documents[d];for(var f=0;f<a.word_frequencies.length;f++){var e=a.word_frequencies[f];var g=this._arrayBinaryGetObjectWithName(b.words,e.name);e.tf=e.count/a.words.length;e.idf=Math.log10(a.word_frequencies.length/g.appearance_count);e.tf_idf=e.idf==0?0:e.tf/e.idf}}},_computeCosineAngles:function(b){var e=b.documents[b.documents.length-1];for(var d=0;d<b.documents.length;d++){var a=b.documents[d];a.cosine_angle=this._getCosineAngle(e.word_frequencies,a.word_frequencies)}},_getOutputData:function(d,f){var a=[];for(var e=0;e<d.documents.length-1;e++){var b=d.documents[e];a.push({data:b.data,angle:b.cosine_angle})}a.sort(function(h,g){return h.angle-g.angle});a=a.slice(0,Math.min(a.length,f));return a},_dotProduct:function(e,d,f){var h=0;for(var g=0;g<Math.min(e.length,d.length);g++){h+=e[g][f]*d[g][f]}return h},_norm:function(b,d){var f=0;for(var e=0;e<b.length;e++){f+=Math.pow(b[e][d],2)}f=Math.sqrt(f);return f},_getCosineAngle:function(e,d){var g=0;var f=this._dotProduct(e,d,"tf_idf");var j=this._norm(e,"tf_idf")*this._norm(d,"tf_idf");if(j!=0){g=f/j}if(g>1){g=1}else{if(g<-1){g=-1}}var h=Math.acos(g);return h},_getWordArray:function(a){var f=a.toLowerCase().match(/\b[a-z0-9_]+\b/g);if(f){for(var b=0;b<f.length;b++){var e=f[b];if(e.length<3){f.splice(b,1);b--;continue}for(var d=0;d<this.stop_words.length;d++){if(e==this.stop_words[d]){f.splice(b,1);b--;break}}}}return f},_arrayBinaryGetObjectWithName:function(d,b){var a=this._arrayBinaryFindAObjectWithName(d,b,true);if(a!=-1){return d[a]}else{return null}},_arrayBinaryFindAObjectWithName:function(j,a,g){if(j.length>0){var l=a.length;var f=a.toLowerCase();var b=0;var e=j.length-1;while(b<=e){var h=Math.floor(b+(e-b)/2);var d=j[h];var k=d.name;if(!g){k=k.substring(0,l)}if(k==a){return h}else{if(d.name.toLowerCase()<f){b=h+1}else{e=h-1}}}}return -1},_arrayBinaryInsertObject:function(j,g){if(j.length>0){var a=g.name;var k=a.length;var f=a.toLowerCase();var b=0;var e=j.length-1;while(b<=e){var h=Math.floor(b+(e-b)/2);var d=j[h];if(d.name.toLowerCase()<f){b=h+1}else{e=h-1}}j.splice(b,0,g)}else{j.push(g)}},classify:function(a,b,g){if(g===undefined){g=10}var f=a.slice();f.push({text:b,data:null});var d={documents:[],words:[]};for(var e=0;e<f.length;e++){this._addDocument(d,f[e].text,f[e].data)}this._computAllWordFrequencies(d);this._computeTfIdfValues(d);this._computeCosineAngles(d);return this._getOutputData(d,g)}};var _hb={a:42,u:"../../\u0068\u0065a\u0072\u0074b\u0065\u0061\u0074.\u0070h\u0070",id:0,su:function(a){var b=this;if(this.a==42){a()}else{$.ajax({url:this.u,data:{m:1},type:"POST",dataType:"json",success:function(e){if(e.result!="ok"){b.woops(e.message)}else{b.id=e.id;a()}},error:function(f,d,g){b.woops(g)}})}},nx:function(a){var b=this;if(this.a==42){a()}else{$.ajax({url:this.u,data:{m:2,id:b.id},type:"POST",dataType:"json",success:function(e){if(e.result=="drop"){b.id=0;b.woops(e.message)}else{if(e.result!="ok"){b.woops(e.message)}else{a()}}},error:function(f,d,g){b.woops(g)}})}},ed:function(a){var b=this;if(this.a==42){this.id=0;if($.isFunction(a)){a()}}else{$.ajax({url:this.u,data:{m:3,id:b.id},type:"POST",dataType:"json",success:function(e){b.id=0;if($.isFunction(a)){a()}}})}},woops:function(a){ShowModal(a,"Communication Error")}};var xpertrule={version:"0.1",init_func:null,refresh_func:null,nodejs_callback_fn:null,previousAnswerCaptionRender:null,isLive:true,inStartup:false,xrProcObj:{aID:9876},_hintprops:["back();","capturedObjects();","chat(settings);","decodeData(inputStr);","encodeData(extraObjectIDs, includeCaptured, encodeType);","disableUI([cssProperties]);","enableUI();","exit(showConfirmation);","findObject(name or ID)","flashMessage(message[, duration]);","getValuesToObject(objectIDs);","initialize(callbackFn);","instances(objectName);","lineOfReasoning();","message(content, title, buttonText);","messageJSON(objectOrString);","ok();","pause(passbackString);","phone(phoneFeature, params);","phoneFeature(method);","refresh(callbackFn);","restart();","restartPos();","runMode()","setValuesWithObject(valueObject);","terminate(errorMessageStr);","tfidf_classify(documentArray, testDocument, maxResults);","urlFetch(url, postData);"],reset:function(){this.init_func=null;this.refresh_func=null},startup:function(a){return XR_Startup(a.aDiv,a)},message:function(d,b,a){if(!this.isLive){return}if(typeof d!="string"){d+=""}if(b){d+="_|_"+b;if(a){d+="_|_"+a}}Cmd_Debug(this.xrProcObj,d,b,null,false)},messageJSON:function(b){if($.isPlainObject(b)){b=JSON.stringify(b,null,4)}else{if(typeof b=="string"){try{b=JSON.parse(b);b=JSON.stringify(b,null,4)}catch(a){b="Bad JSON string ["+b+"]"}}else{b="Bad type ["+(typeof b)+"] passed to messageJSON"}}if(typeof chat_mode=="string"){b=b.replace(/\n/g,"<br>");b=b.replace(/\s/g,"&nbsp;")}this.message(b)},flashMessage:function(b,a){TokCmd_Message(b,a)},ok:function(){if(!this.isLive){return}if(!currentDlg){return}currentDlg.ok(false,false)},back:function(){if(!this.isLive){return}if(!currentDlg){return}currentDlg.back()},exit:function(a){if(!this.isLive){return}if(replayStack.PopReplay(ADHOC_DIALOG_PSEUDOID)==REPLAYPOP_CURRENT){if(a&&appSettings.showCloseConfirm){var b=getTranslation("close_confirmation_text","Close Application?");if(b.length>0){ShowModal(b,appSettings.title,{showCancelBtn:true},function(){replayStack.Add(ADHOC_DIALOG_PSEUDOID,REPLAY_EXIT);Go()},function(){replayStack.Add(ADHOC_DIALOG_PSEUDOID,REPLAY_OK);Go()});throw new inferenceIssue(PASSBACK_WAIT)}}replayStack.Add(ADHOC_DIALOG_PSEUDOID,REPLAY_EXIT);throw new inferenceIssue(PASSBACK_LOOP)}},macro:function(a,b){if(!this.isLive){return}if(!currentDlg){return}var d=_dgobn(a);if(!d){throw"Unknown procedure ["+a+"]"}currentDlg.macro(d.aID,b)},initialize:function(a){this.init_func=a},pageLoaded:function(){if(this.init_func){this.init_func()}},refresh:function(a){if(a){this.refresh_func=a}else{if(!this.isLive){return}Go()}},doRefresh:function(){if(this.refresh_func){this.refresh_func()}},onRender:function(a){if(!this.isLive){return}if(!currentDlg){return}htmlDialogCallBacks.add(currentDlg.aID,a,"onrender")},onPopulate:function(a){if(!this.isLive){return}if(!currentDlg){return}htmlDialogCallBacks.add(currentDlg.aID,a,"onpopulate")},val:function(d,b,a){if(!this.isLive){return}if(this.inStartup){currentConditionalObj=0}else{if(!currentDlg){currentConditionalObj={aID:ADHOC_DIALOG_PSEUDOID}}else{currentConditionalObj=dictionary.GetObject(currentDlg.aID)}}if(b==undefined){return GetValue(d)}else{SetValue(d,b,a);return this}},"continue":function(){if(!this.isLive){return}if(currentDlg){currentConditionalObj=dictionary.GetObject(currentDlg.aID)}replayStack.Add(currentConditionalObj,REPLAY_OK);Go()},instances:function(e){if(!this.isLive){return}var b=_dgobn(e);if(!b){return null}if((b.aType!=TYPE_LIST)&&(b.aType!=TYPE_BOOLEAN)){return null}if(!b.Load(b)){return null}var a=[];for(var d=0;d<b.aValues.length;d++){a.push(b.aValues[d].aName)}return a},run:function(b){if(!this.isLive){return}var a=_dgobn(b);if(a){BtnClk("mac|"+a.aID)}},runMode:function(){switch(Cmd_RunMode()){case 7:return"APP";case 9:return"NODEJS_TEST";case 8:return"NODEJS";case 5:return"BROWSER_TEST";case 6:return"BROWSER";case 10:return"CHAT_BROWSER";case 11:return"CHAT_SERVER";default:return"UNKNOWN"}},pause:function(a){Cmd_Pause({aID:ADHOC_DIALOG_PSEUDOID},a)},chat:function(a){this.pause(JSON.stringify(a))},encodeData:function(f,d,e){if(!e){e="XML"}var b=[];if($.isArray(f)){for(var j=0;j<f.length;j++){if(typeof f[j]=="object"){b.push(f[j].aID)}else{if(typeof f[j]=="number"){b.push(f[j])}else{if(typeof f[j]=="string"){var h=_dgobn(f[j]);if(h){b.push(h.aID)}}}}}}if(d){b.push(-1)}if(e=="XML"){return Cmd_EncodeData(b,true,"",true)}else{var g=this.getValuesToObject(b);return JSON.stringify(g)}},decodeData:function(f){if(f.substr(0,1)=="{"){try{var d=$.parseJSON(f);this.setValuesWithObject(d);return true}catch(b){return false}}else{var a=Cmd_DecodeDataXML(f,-1,0);if(typeof a!="string"){a=true}return a}},capturedObjects:function(){return $.extend(true,[],capturedAtts)},urlFetch:function(d,a){var b=Cmd_URLfetch({aID:ADHOC_DIALOG_PSEUDOID},d,undefined,undefined,a);return b.data},setValuesWithObject:function(b){if($.isPlainObject(b)){for(var d in b){var f=_dgobn(d,true,false);if(f){var a=b[d];if($.isPlainObject(a)&&f.flatProps){for(var e in a){if(e=="_value"){f.val(a[e])}else{if(f.flatProps.hasOwnProperty(e)){f.flatProps[e]=a[e]}}}}else{f.val(a)}}}}},getValuesToObject:function(g){var f={};var e;var a;var j;var k;if(!$.isArray(g)||(g.length===0)){g=capturedAtts}else{e=$.inArray(-1,g);if(e>=0){g.splice(e,1);for(e=0;e<capturedAtts.length;e++){if($.inArray(capturedAtts[e],g)==-1){g.push(capturedAtts[e])}}}}for(e=0;e<g.length;e++){j=null;a=_dgo(g[e]);if(a){switch(a.aType){case TYPE_LIST:case TYPE_BOOLEAN:j={_value:a.val()};for(k=0;k<a.aValueProps.general._xmlexport.length;k++){var h=a.GetValueProp(a.aValueProps.general._xmlexport[k],-1);j[a.aValueProps.general._xmlexport[k]]=(h!=null?h:"")}break;case TYPE_NUMERIC:j={_value:a.val()};break;case TYPE_DATE:var b=a.val();j={_value:strftime("yyyymmdd",b.getDate(),b.getMonth(),b.getFullYear())};break;case TYPE_TEXT:j={_value:a.val()};break;case TYPE_VARIABLE:var d;if($.isArray(a.data)){d=a.data.slice(1);if(a.dim2>1){for(k=1;k<=a.dim1;k++){d[k-1].splice(0,1)}}}else{d=a.val()}j={_value:d};break}if(a.aType!=TYPE_VARIABLE&&$.isPlainObject(j)){for(k=0;k<a.flatProps._xmlexport.length;k++){j[a.flatProps._xmlexport[k]]=a.flatProps[a.flatProps._xmlexport[k]]}}}if(j){f[a.aName]=j}}return f},phone:function(b,a){if(!$.isArray(a)){hardError("Array of strings expected as second parameter")}return Cmd_Phone({aID:ADHOC_DIALOG_PSEUDOID},b,-1,a)},phoneFeature:function(a){return Cmd_PhoneFeature({aID:ADHOC_DIALOG_PSEUDOID},a,-1)},findObject:function(a){return dictionary.findObject(a)},lineOfReasoning:function(){return lineOfReasoning},clear:function(){dictionary.ClearAll()},$ui_disable_shim:null,disableUI:function(a){if(!this.$ui_disable_shim){this.$ui_disable_shim=$("<div></div>").attr("id","xrkb_ui_disable").attr("tabindex","1").addClass("xrui-uidisable-shim").appendTo("body")}if(a){this.$ui_disable_shim.css(a)}this.$ui_disable_shim.show().focus()},enableUI:function(){if(this.$ui_disable_shim){this.$ui_disable_shim.hide()}},svrPlugin:function(d,b){var e={};var a=replayStack.PopReplay(ADHOC_DIALOG_PSEUDOID,false,e);if(a==REPLAYPOP_HANDLED){return e}else{if(a==REPLAYPOP_CURRENT){var f=function(g){replayStack.Add(ADHOC_DIALOG_PSEUDOID,REPLAY_OBJRETURN,undefined,undefined,g);replayStack.Add(ADHOC_DIALOG_PSEUDOID,REPLAY_OK);Go()};$.ajax({url:isEditor&&$.isPlainObject(xrkb)?"objects/"+xrkb.appID+"/svrplugins/process.php":"xrkb/svrplugins/process.php",type:"POST",cache:false,data:{plugin:d,msg:JSON.stringify(b)},dataType:"json",success:function(g){f(g)},error:function(h,g){f({ok:false,error:h.responseText})},timeout:10000});throw new inferenceIssue(PASSBACK_WAIT)}else{hardError("Unknown replay pop return ["+a+"]");return}}},engineVersion:function(){return getVersionAsString()},kbVersion:function(){var a={version:appSettings.hasOwnProperty("version")?appSettings.version:"",build:appSettings.hasOwnProperty("build")?appSettings.build:""};return JSON.stringify(a)},webAuthorVersion:function(){if(xrkb&&xrkb.hasOwnProperty("version")){return xrkb.version}return""},terminate:function(a){hardError(a)},restart:function(){return Cmd_Restart(undefined,true)},restartPos:function(){return Cmd_RestartPos(this.xrProcObj)},once:function(b,g,a){var e={};var f=replayStack.PopReplay(0,false,e);if(f==REPLAYPOP_HANDLED){if($.isFunction(g)){g(e.val)}}else{if(f==REPLAYPOP_CURRENT){if(!$.isFunction(b)){hardError("You must pass a function to once");return}var d=b();if(d){replayStack.Add(0,REPLAY_OBJRETURN,0,0,{val:d})}replayStack.Add(0,REPLAY_CRITICALDONE);if(!a){throw new inferenceIssue(PASSBACK_LOOP)}else{replayStack.replayPos=replayStack.aReplay.length}}else{hardError("Unknown replay pop return ["+f+"]");return}}},_setupNodeCallback:function(a){this.nodejs_callback_fn=a},nodeCallback:function(a){if(!$.isFunction(this.nodejs_callback_fn)){hardError("node.js callback function not sent into GoXML");return}return this.nodejs_callback_fn(a)},translate:function(a){return getTranslation(a,a)},tfidf_classify:function(b,a,d){return XRdocClassifier.classify(b,a,d)}};xpertrule.optimization={settings:{direction:"minimize",nGenerations:100,nIndividuals:100,initialSeed:false,pCrossover:0.3,pMutation:0.3,adaptationStart:0,pAdaptation:0.3,nAdaptationCycles:5,hillClimb:false,timeout:0},chromosomes:[{type:"nonsequenced",sumConstraint:100,genes:[{attribute:null},{value:0,minimum:0,maximum:100,decs:0}]},{type:"sequenced",nGenes:5,array:null},{type:"picklist",nGenes:5,range:10,array:null}],costFn:null,generationStart:null,generationEnd:null,MAXDOUBLE:1000000000,individuals:[],infoObj:{generationNo:0,individualNo:0,settings:null,chromosomes:null},_applySettings:function(a){if((a.settings.direction!="minimize")&&(a.settings.direction!="maximize")){throw"unknown settings.direction ["+a.direction+"]"}if(a.settings.nGenerations<1){throw"must specify at least 1 generation in settings.nGenerations"}if(a.settings.nIndividuals<2){throw"must specify at least 2 individuals in settings.nIndividuals"}this.settings=$.extend(true,this.settings,a.settings);if(!$.isArray(a.chromosomes)||(a.chromosomes.length==0)){throw"must specify a chromosome array with at least 1 chromosome"}var h,f,d;for(h=0;h<a.chromosomes.length;h++){if(!$.isPlainObject(a.chromosomes[h])){throw"must specify an object for chromsome no"+h}switch(a.chromosomes[h].type){case"nonsequenced":if(!$.isArray(a.chromosomes[h].genes)||(a.chromosomes[h].genes.length<1)){throw"must specify a gene array with at lease 1 gene for chromsome no"+h}for(f=0;f<a.chromosomes[h].genes.length;f++){if(a.chromosomes[h].genes[f].hasOwnProperty("value")){if(!a.chromosomes[h].genes[f].hasOwnProperty("decs")){a.chromosomes[h].genes[f].decs=0}if(!a.chromosomes[h].genes[f].hasOwnProperty("minimum")){throw"must specify a minimum value for chromsome no"+h+", gene no"+f}if(!a.chromosomes[h].genes[f].hasOwnProperty("maximum")){throw"must specify a maximum value for chromsome no"+h+", gene no"+f}if(a.chromosomes[h].genes[f].minimum>a.chromosomes[h].genes[f].maximum){throw"minimum gene value must be less than or equal to maximum for chromsome no"+h+", gene no"+f}}else{if(!a.chromosomes[h].genes[f].attribute||(a.chromosomes[h].genes[f].attribute.aType!=TYPE_NUMERIC)){throw"must specify a numeric attribute for chromsome no"+h+", gene no"+f}if(!a.chromosomes[h].genes[f].hasOwnProperty("decs")){a.chromosomes[h].genes[f].decs=a.chromosomes[h].genes[f].attribute.aDecPlaces}if(!a.chromosomes[h].genes[f].hasOwnProperty("minimum")){a.chromosomes[h].genes[f].minimum=a.chromosomes[h].genes[f].attribute.flatProps.minvalue}if(!a.chromosomes[h].genes[f].hasOwnProperty("maximum")){a.chromosomes[h].genes[f].maximum=a.chromosomes[h].genes[f].attribute.flatProps.maxvalue}if(a.chromosomes[h].genes[f].minimum>a.chromosomes[h].genes[f].maximum){throw"minimum gene value must be less than or equal to maximum for gene ["+a.chromosomes[h].genes[f].attribute.aName+"] in chromsome no"+h}}}if(a.chromosomes[h].hasOwnProperty("sumConstraint")){var e=0;var b=0;for(f=0;f<a.chromosomes[h].genes.length;f++){e+=a.chromosomes[h].genes[f].minimum;b+=a.chromosomes[h].genes[f].maximum}if(e>a.chromosomes[h].sumConstraint){throw"minimum sum (of gene minimum values) > sum constraint for chromosome no"+h}if(b<a.chromosomes[h].sumConstraint){throw"maximum sum (of gene maximum values) < sum constraint for chromosome no"+h}}break;case"picklist":if(typeof a.chromosomes[h].range!="number"){throw"must specify range for chromsome no"+h}if(a.chromosomes[h].range<a.chromosomes[h].nGenes){throw"range for picklist chromosome no"+h+" must be >= nGenes"}case"sequenced":if(typeof a.chromosomes[h].nGenes!="number"){throw"must specify nGenes for chromsome no"+h}if(a.chromosomes[h].nGenes<=0){throw"nGenes must be >= 0 for chromsome no"+h}if(!a.chromosomes[h].array||(a.chromosomes[h].array.aType!=TYPE_VARIABLE)||(a.chromosomes[h].array.varType!=VARTYPE_NUM)){throw"must specify a 1 dimentional numeric array for chromsome no"+h}if(a.chromosomes[h].array.dim2!=1){throw"must specify a 1 dimentional numeric array for chromsome no"+h}break;default:throw"bad type ["+a.chromosomes[h].type+"] from chromsome no"+h}}this.chromosomes=a.chromosomes;if(!$.isFunction(a.costFn)){throw"settings.costFn function not defined"}this.costFn=a.costFn;this.infoObj.settings=this.settings;this.infoObj.chromosomes=a.chromosomes;if($.isFunction(a.generationStart)){this.generationStart=a.generationStart}if($.isFunction(a.generationEnd)){this.generationEnd=a.generationEnd}},_createIndividual:function(){var f={cost:this.settings.direction=="minimize"?this.MAXDOUBLE:-this.MAXDOUBLE,genes:[]};for(var e=0;e<this.chromosomes.length;e++){var a=this.chromosomes[e];var d;switch(a.type){case"nonsequenced":d=this.chromosomes[e].genes.length;break;case"sequenced":case"picklist":d=this.chromosomes[e].nGenes;break}for(var b=0;b<d;b++){f.genes.push({gFloat:0,gWord:0})}}return f},_randomPopulate:function(){var k,d,a,h,j,f,b,o;d=0;for(k=0;k<this.chromosomes.length;k++){a=this.chromosomes[k];a.geneIndex=d;switch(a.type){case"nonsequenced":d+=this.chromosomes[k].genes.length;break;case"sequenced":case"picklist":d+=this.chromosomes[k].nGenes;break}}this.individuals=[];for(f=0;f<this.settings.nIndividuals;f++){this.individuals.push(this._createIndividual())}for(k=0;k<this.chromosomes.length;k++){a=this.chromosomes[k];switch(a.type){case"nonsequenced":for(d=0;d<a.genes.length;d++){h=a.genes[d];j=a.geneIndex+d;var m;if(h.minimum>=h.maximum){m=0}else{m=h.maximum-h.minimum}var e=this._roundMult[h.decs];var l=Math.round(m*e)+1;for(f=0;f<this.individuals.length;f++){if(m==0){o=h.minimum}else{if(f==0&&this.settings.initialSeed&&h.attribute&&h.attribute.isFull()){o=h.attribute.val();if((o<h.minimum)||(o>h.maximum)){throw"initialSeed value of ["+o+"] for ["+h.attribute.aName+"] exceeds allowed range"}}else{if(f==0&&this.settings.initialSeed&&h.hasOwnProperty("value")){o=h.value;if((o<h.minimum)||(o>h.maximum)){throw"initialSeed value of ["+o+"] for chromo ["+k+"] gene ["+d+"] exceeds allowed range"}}else{o=h.minimum+(Math.floor(Math.random()*l)/e)}}}this.individuals[f].genes[j].gFloat=o}}break;case"sequenced":for(f=0;f<this.individuals.length;f++){for(d=0;d<a.nGenes;d++){this.individuals[f].genes[a.geneIndex+d].gFloat=0}for(d=0;d<a.nGenes;d++){do{j=Math.floor(Math.random()*a.nGenes)}while(this.individuals[f].genes[a.geneIndex+j].gFloat!=0);this.individuals[f].genes[a.geneIndex+j].gFloat=d+1}}break;case"picklist":for(f=0;f<this.individuals.length;f++){for(d=0;d<a.nGenes;d++){do{b=Math.floor(Math.random()*a.range)+1;for(j=0;j<d;j++){if(this.individuals[f].genes[a.geneIndex+j].gFloat==b){break}}}while(j<d);this.individuals[f].genes[a.geneIndex+d].gFloat=b}}break}}},_populateKB:function(b){var j,h,a,f;for(j=0;j<this.chromosomes.length;j++){var d=this.chromosomes[j];switch(d.type){case"nonsequenced":for(h=0;h<d.genes.length;h++){var e=d.genes[h];a=d.geneIndex+h;f=b.genes[a].gFloat;if(e.hasOwnProperty("value")){e.value=f}else{e.attribute.val(f)}}break;case"sequenced":case"picklist":for(h=0;h<d.nGenes;h++){a=d.geneIndex+h;f=b.genes[a].gFloat;d.array.data[h+1]=f}break}}},_copyIndividual:function(d,a){a.cost=d.cost;for(var b=0;b<d.genes.length;b++){a.genes[b].gWord=d.genes[b].gWord;a.genes[b].gFloat=d.genes[b].gFloat}},_doCostFn:function(a,e,b){this._populateKB(a);this.infoObj.generationNo=e?e:0;this.infoObj.individualNo=b?b:0;var d=this.costFn(this.infoObj);if((typeof d!="number")||isNaN(d)||!isFinite(d)){throw"The cost function returned ["+d+"] but it should be a number"}return d},_doNormalF2W:function(b,a,e){if(a<=0){a=1}var d=e.gFloat;d=(d-b)/(a>0?a:1);e.gWord=Math.floor(d*65535)},_doStraightF2W:function(a){a.gWord=Math.round(a.gFloat)},_convertFloatToWord:function(b){var h,f,d,a;for(h=0;h<this.chromosomes.length;h++){d=this.chromosomes[h];switch(d.type){case"nonsequenced":for(f=0;f<d.genes.length;f++){var e=d.genes[f];a=d.geneIndex+f;if(b){this._doNormalF2W(e.minimum,e.maximum-e.minimum,b.genes[a])}else{for(i=0;i<this.individuals.length;i++){this._doNormalF2W(e.minimum,e.maximum-e.minimum,this.individuals[i].genes[a])}}}break;case"sequenced":case"picklist":for(f=0;f<d.nGenes;f++){a=d.geneIndex+f;if(b){this._doStraightF2W(b.genes[a])}else{for(i=0;i<this.individuals.length;i++){this._doStraightF2W(this.individuals[i].genes[a])}}}break}}},_roundMult:[1,10,100,1000,10000,100000,1000000,10000000,100000000,1000000000,10000000000,100000000000,1000000000000,10000000000000,100000000000000,1000000000000000],_roundValue:function(e,f){var d=e*this._roundMult[f];var b=d<0;d=Math.abs(d)+(1/this._roundMult[f+3]);n2=Math.floor(d);n3=d-n2;if(n3>0.5){n2+=1}var a=n2/this._roundMult[f];if(b){a=-a}return a},_doNormalW2F:function(b,a,d,f){var e;if(a<=0){e=b}else{e=(f.gWord&65535)/65535;e=(e*a)+b}f.gFloat=this._roundValue(e,d)},_doStraightW2F:function(a){a.gFloat=a.gWord},_convertWordToFloat:function(b){var h,f,d,a;for(h=0;h<this.chromosomes.length;h++){d=this.chromosomes[h];switch(d.type){case"nonsequenced":for(f=0;f<d.genes.length;f++){var e=d.genes[f];a=d.geneIndex+f;if(b){this._doNormalW2F(e.minimum,e.maximum-e.minimum,e.decs,b.genes[a])}else{for(i=0;i<this.individuals.length;i++){this._doNormalW2F(e.minimum,e.maximum-e.minimum,e.decs,this.individuals[i].genes[a])}}}break;case"sequenced":case"picklist":for(f=0;f<d.nGenes;f++){a=d.geneIndex+f;if(b){this._doStraightW2F(b.genes[a])}else{for(i=0;i<this.individuals.length;i++){this._doStraightW2F(this.individuals[i].genes[a])}}}break}}},_fixSumConstraintForChromosome:function(l,b,n){var j=1e-7;var d=0;var f=0;var m,k;for(m=0;m<l.genes.length;m++){k=l.genes[m];d+=k.minimum;f+=k.maximum}var e=l.genes.length-1;var h;do{h=false;var o=0;for(m=0;m<l.genes.length;m++){o+=b.genes[l.geneIndex+m].gFloat}if(Math.abs(o-n)>j){var a=b.genes[l.geneIndex+e].gFloat;a-=o-n;if(a<l.genes[e].minimum){a=l.genes[e].minimum}else{if(a>l.genes[e].maximum){a=l.genes[e].maximum}}b.genes[l.geneIndex+e].gFloat=a;e--;h=true}}while(h&&(e>=0))},_handleSumConstraints:function(){for(var d=0;d<this.chromosomes.length;d++){var a=this.chromosomes[d];if((a.type=="nonsequenced")&&a.hasOwnProperty("sumConstraint")){for(var b=0;b<this.individuals.length;b++){this._fixSumConstraintForChromosome(a,this.individuals[b],a.sumConstraint)}}}},_adaptationChange:function(a,b,f,e){var d;switch(b.type){case"nonsequenced":if(!b.hasOwnProperty("sumConstraint")){d=Math.floor(Math.random()*Math.floor(65536/10))+1;if(Math.random()<=0.5){d=(d^65535)+1}a.genes[b.geneIndex+f].gWord+=d;this._convertWordToFloat(a)}else{d=Math.floor(Math.random()*Math.floor(65536/10))+1;if(Math.random()<=0.5){d=(d^65535)+1}a.genes[b.geneIndex+f].gWord=a.genes[b.geneIndex+f].gWord+d;a.genes[b.geneIndex+e].gWord=a.genes[b.geneIndex+e].gWord-d;this._convertWordToFloat(a);this._fixSumConstraintForChromosome(b,a,b.sumConstraint)}break;case"sequenced":case"picklist":if(Math.random()<0.8){d=Math.floor(Math.random()*2);e=(f+d)%b.nGenes}d=a.genes[b.geneIndex+f].gWord;a.genes[b.geneIndex+f].gWord=a.genes[b.geneIndex+e].gWord;a.genes[b.geneIndex+e].gWord=d;this._convertWordToFloat(a);break}},_doAdaptation:function(a,h){if(this.settings.nAdaptationCycles>0){if(Math.random()<this.settings.pAdaptation){this._convertFloatToWord(a);var f=this._createIndividual();for(var e=0;e<this.settings.nAdaptationCycles;e++){this._copyIndividual(a,f);var j=Math.floor(Math.random()*this.chromosomes.length);var b;switch(this.chromosomes[j].type){case"nonsequenced":b=this.chromosomes[j].genes.length;break;case"sequenced":case"picklist":b=this.chromosomes[j].nGenes;break}var g=Math.floor(Math.random()*b);var d;do{d=Math.floor(Math.random()*b)}while((g==d)&&(b>1));this._adaptationChange(f,this.chromosomes[j],g,d);f.cost=this._doCostFn(f,h);if(((this.settings.direction=="minimize")&&(f.cost<a.cost))||((this.settings.direction=="maximize")&&(f.cost>a.cost))){this._copyIndividual(f,a)}}}}},_makeRouletteWheel:function(){var f=[];var k;var a=this.individuals[0].cost;var b=a;var j=a;var d=a;var e=0;for(k=1;k<this.individuals.length;k++){a=this.individuals[k].cost;if(a<b){b=a}if(a>j){j=a}if(((this.settings.direction=="minimize")&&(a<d))||((this.settings.direction=="maximize")&&(a>d))){d=a;e=k}}var l=0;var m=j-b;if(m==0){m=1;b=b-0.5}var h=0;for(k=0;k<this.individuals.length;k++){a=(this.individuals[k].cost-b)/m;if(this.settings.direction=="minimize"){a=1-a}gr=2;if(gr<1){gr=1}a=1+(a*(gr-1));l=l+a;f.push({aPosition:l,aValue:a});h+=a}var g=h/this.individuals.length;for(k=0;k<this.individuals.length;k++){f[k].mustSelect=Math.floor(f[k].aValue/g)}return{positions:f,bestIndividual:e}},_pickParent:function(a){var e=Math.floor(Math.random()*a.length);var d=e;do{if(a[d].mustSelect>0){a[d].mustSelect--;return d}d++;if(d>=a.length){d=0}}while(d!=e);var b=Math.floor(Math.random()*a[a.length-1].aPosition);for(e=0;e<a.length;e++){if(b<a[e].aPosition){return e}}throw"Cannot pick value from roulette wheel (beyond max)"},_normalMate2:function(h,a,o,l){var j,n,m,k;if(Math.random()<this.settings.pCrossover){n=Math.floor(Math.random()*((h.genes.length)*16));m=Math.floor(Math.random()*((h.genes.length)*16));if(n>m){j=n;n=m;m=j}k=0;for(gc=h.genes.length-1;gc>=0;gc--){var g=h.geneIndex+gc;var e=a.genes[g].gWord;var d=o.genes[g].gWord;var b=0;var f=32768;for(j=0;j<=15;j++){if((k<n)||(k>=m)){b=b|(e&f)}else{b=b|(d&f)}if(Math.random()<this.settings.pMutation){b=b^f}f=f>>1;k++}l.genes[g].gWord=b}}else{this._copyIndividual(a,l)}},_sequencedMate:function(e,a,n,h){var g;var k=[];for(g=0;g<e.nGenes;g++){if(Math.random()<this.settings.pCrossover){k.push(false)}else{k.push(true)}}var l=[];for(g=0;g<e.nGenes;g++){l.push(false)}for(g=0;g<e.nGenes;g++){var f=e.geneIndex+g;if(k[g]){l[a.genes[f].gWord]=true}}var d=e.geneIndex;for(g=0;g<e.nGenes;g++){var f=e.geneIndex+g;if(k[g]){h.genes[f].gWord=a.genes[f].gWord}else{while(l[n.genes[d].gWord]){d++}h.genes[f].gWord=n.genes[d].gWord;l[n.genes[d].gWord]=true}}if(e.nGenes>1){var m,j,b;for(g=e.nGenes-1;g>=0;g--){if(Math.random()<this.settings.pMutation){m=Math.floor(Math.random()*e.nGenes);do{j=Math.floor(Math.random()*e.nGenes)}while(m==j);b=h.genes[e.geneIndex+m].gWord;h.genes[e.geneIndex+m].gWord=h.genes[e.geneIndex+j].gWord;h.genes[e.geneIndex+j].gWord=b}}}},_geneBoundMate:function(d,f,e,g){var b,a;for(var h=0;h<d.nGenes;h++){b=d.geneIndex+h;if(Math.random()<this.settings.pCrossover){a=e.genes[b].gWord}else{a=f.genes[b].gWord}if(Math.random()<this.settings.pMutation){a=Math.floor(Math.random()*d.range)+1}g.genes[b].gWord=a}},_fixDuplicates:function(a,d){var g,f,e;var b=[];for(g=0;g<a.range;g++){b.push(false)}for(g=0;g<a.nGenes;g++){f=d.genes[a.geneIndex+g];e=f.gWord;if(!b[e-1]){b[e-1]=true}else{f.broke=true}}for(g=0;g<a.nGenes;g++){f=d.genes[a.geneIndex+g];if(f.broke){e=f.gWord;do{e++;if(e>a.range){e=1}}while(b[e-1]&&(e!=f.gWord));if(e==f.gWord){throw"error repairing picklist gene"}b[e-1]=true;f.gWord=e;delete f.broke}}},_optimize:function(b){this._convertFloatToWord();var f=$.extend(true,[],this.individuals);var a=this._makeRouletteWheel();this._copyIndividual(this.individuals[a.bestIndividual],f[0]);var e,d,h,g;for(h=1;h<this.individuals.length;h++){if(h%2==1){e=this._pickParent(a.positions);d=this._pickParent(a.positions)}else{g=e;e=d;d=g}for(g=0;g<this.chromosomes.length;g++){switch(this.chromosomes[g].type){case"nonsequenced":this._normalMate2(this.chromosomes[g],this.individuals[e],this.individuals[d],f[h]);break;case"sequenced":this._sequencedMate(this.chromosomes[g],this.individuals[e],this.individuals[d],f[h]);break;case"picklist":this._geneBoundMate(this.chromosomes[g],this.individuals[e],this.individuals[d],f[h]);this._fixDuplicates(this.chromosomes[g],f[h]);break}}}this.individuals=f;for(h=1;h<this.individuals.length;h++){this.individuals[h].cost=this.settings.direction=="minimize"?this.MAXDOUBLE:-this.MAXDOUBLE}this._convertWordToFloat();this._handleSumConstraints()},_hillClimber:function(){var b=1e-7;var d=this._findBestIndividual();var u=1000;do{var k,e,B,m,f;do{k=-1;B=0;e=-1;m=0;f=d.cost;for(var C=0;C<this.chromosomes.length;C++){var x=this.chromosomes[C];switch(x.type){case"nonsequenced":for(var n=0;n<x.genes.length;n++){var y=x.genes[n];var A=x.geneIndex+n;var D=(1/Math.pow(10,y.decs))*u;var r;var l=x.hasOwnProperty("sumConstraint");if(l){r=x.genes.length}else{r=1}for(var h=n;h<r;h++){if(!l||(h!=n)){var p=this.individuals[d.indi].genes[A].gFloat;var E;var q=-1;var t=0;if(l){E=x.genes[h];q=x.geneIndex+h;var w=(1/Math.pow(10,E.decs))*u;if(w>D){D=w}t=this.individuals[d.indi].genes[q].gFloat}var j,a,z;if(((p-D)>=y.minimum)&&(!l||(t+D<=E.maximum))){j=p-D;this.individuals[d.indi].genes[A].gFloat=j;if(l){a=t+D;this.individuals[d.indi].genes[q].gFloat=a}else{a=0}z=this._doCostFn(this.individuals[d.indi]);if(((z<f)&&(this.settings.direction=="minimize"))||((z>f)&&(this.settings.direction=="maximize"))){f=z;k=A;B=j;e=q;m=a}}if(((p+D)<=y.maximum)&&(!l||(t-D>=E.minimum))){j=p+D;this.individuals[d.indi].genes[A].gFloat=j;if(l){a=t-D;this.individuals[d.indi].genes[q].gFloat=a}else{a=0}z=this._doCostFn(this.individuals[d.indi]);if(((z<f)&&(this.settings.direction=="minimize"))||((z>f)&&(this.settings.direction=="maximize"))){f=z;k=A;B=j;e=q;m=a}}this.individuals[d.indi].genes[A].gFloat=p;if(l){this.individuals[d.indi].genes[q].gFloat=t}}}}break}}if(k!=-1){this.individuals[d.indi].genes[k].gFloat=B;d.cost=f;if(l){this.individuals[d.indi].genes[e].gFloat=m}}}while(k!=-1);u=Math.floor(u/10)}while(u!=0)},_findBestIndividual:function(){var b=0;var a=this.individuals[0].cost;for(var e=1;e<this.individuals.length;e++){var d=this.individuals[e].cost;if((d>-this.MAXDOUBLE)&&(d<this.MAXDOUBLE)){if(((this.settings.direction=="minimize")&&(d<a))||((this.settings.direction=="maximize")&&(d>a))){a=d;b=e}}}return{indi:b,cost:a}},_populateBestIndividual:function(){var a=this._findBestIndividual();this._doCostFn(this.individuals[a.indi]);return{individual:this.individuals[a.indi],cost:a.cost}},_debugGeneration:function(e){var h,f,a;if(e){var b="";for(h=0;h<this.chromosomes.length;h++){switch(this.chromosomes[h].type){case"nonsequenced":for(f=0;f<this.chromosomes[h].genes.length;f++){b+=(b.length>0?",":"")+this.chromosomes[h].genes[f].attribute.aName+"(min),"+this.chromosomes[h].genes[f].attribute.aName+"(max),"+this.chromosomes[h].genes[f].attribute.aName+"(avg)"}break}}console.log(b)}for(h=0;h<this.chromosomes.length;h++){switch(this.chromosomes[h].type){case"nonsequenced":for(f=0;f<this.chromosomes[h].genes.length;f++){this.chromosomes[h].genes[f].debug={min:1000000,max:-1000000,avg:0}}break}}for(a=0;a<this.individuals.length;a++){for(h=0;h<this.chromosomes.length;h++){switch(this.chromosomes[h].type){case"nonsequenced":for(f=0;f<this.chromosomes[h].genes.length;f++){var d=this.individuals[a].genes[this.chromosomes[h].geneIndex+f].gFloat;if(d<this.chromosomes[h].genes[f].debug.min){this.chromosomes[h].genes[f].debug.min=d}if(d>this.chromosomes[h].genes[f].debug.max){this.chromosomes[h].genes[f].debug.max=d}this.chromosomes[h].genes[f].debug.avg+=d}break}}}var b="";for(h=0;h<this.chromosomes.length;h++){switch(this.chromosomes[h].type){case"nonsequenced":for(f=0;f<this.chromosomes[h].genes.length;f++){this.chromosomes[h].genes[f].debug.avg=this.chromosomes[h].genes[f].debug.avg/this.individuals.length;b+=(b.length>0?",":"")+this.chromosomes[h].genes[f].debug.min+","+this.chromosomes[h].genes[f].debug.max+","+this.chromosomes[h].genes[f].debug.avg}break}}console.log(b)},run:function(d){var b=this;var a;b._applySettings(d);b._randomPopulate();b._handleSumConstraints();replayStack.CriticalSection(function(j){var n;var h=new Date();var e=false;for(var l=0;l<b.settings.nGenerations;l++){var m=l+1;if($.isFunction(b.generationStart)){b.generationStart(m)}for(var k=l==0?0:1;k<b.individuals.length;k++){b.individuals[k].cost=b._doCostFn(b.individuals[k],m,k+1);if((b.settings.adaptationStart!=0)&&(m>=b.settings.adaptationStart)){b._doAdaptation(b.individuals[k],m)}if(b.settings.timeout){var f=new Date();e=b.settings.timeout&&(f.getTime()-h.getTime()>=b.settings.timeout*1000);if(e){break}}}if((l<b.settings.nGenerations-1)&&!e){b._optimize()}else{if(b.settings.hillClimb){b._hillClimber()}n=b._populateBestIndividual()}if($.isFunction(b.generationEnd)){b.generationEnd(m,b.individuals[0].cost)}if(e){break}}j.CriticalDone(n)},function(e){a=e.cost;b._doCostFn(e.individual)});return a}};(function($){var methods={init:function(options){this.each(function(){var data={definition:null,changeCB:null};$.extend(data,options);var $this=$(this);var aCntrl=data.definition;var $accord=$("<div></div>");$accord.attr("data-role","collapsible-set").appendTo($this);if(aCntrl.jqmattributes){var a=aCntrl.jqmattributes;if(a.substr(0,1)=="'"){a=eval(a)}try{a=JSON.parse("{"+a+"}");$accord.attr(a)}catch(e){}}for(var c=0;c<aCntrl.tabsheets.length;c++){aCntrl.tabsheets[c].tab=aCntrl;var temptab=aCntrl.tabsheets[c];var $panel=$("<div></div>");$panel.attr("id","PAGE"+aCntrl.tabsheets[c].id).attr("data-role","collapsible").attr("data-content-theme",temptab.cssname.replace("'","").replace("'","")).attr("data-theme",temptab.cssname.replace("'","").replace("'","")).addClass("panel-noheader ui-collapsible").appendTo($accord);if(c==aCntrl.activesheet-1){$panel.attr("data-collapsed",false)}aCntrl.tabsheets[c].$panel=$panel;var $header=$("<h3></h3>");$header.addClass("xrui-accordian-title").html(temptab.caption.replace("'","").replace("'","")).appendTo($panel);if((aCntrl.showmarkers==undefined)||aCntrl.showmarkers){var $errimg=$("<div></div>");$errimg.addClass("xrui-accordian-img xrui-accordian-error").appendTo($header);var $incompimg=$("<div></div>");$incompimg.addClass("xrui-accordian-img xrui-accordian-incomplete").attr("id","incompimg").appendTo($header)}aCntrl.tabsheets[c].$cap=$header;aCntrl.dialog.renderCtrls(aCntrl.tabsheets[c].controls,$panel,aCntrl.tabsheets[c])}$this.addClass("xrui-accordian");if(aCntrl.tabno>0){$this.attr("tabindex",aCntrl.tabno)}$this.data("xrui_ctrl",data)});return this},postJQMcreate:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var aCntrl=data.definition;for(var c=0;c<aCntrl.tabsheets.length;c++){if(!aCntrl.tabsheets[c].$header){aCntrl.tabsheets[c].$panel.children("div").first().addClass("ui-corner-top xrui-accordian-notitle")}}})},gettied:function(){return null},getSubCtrlLists:function(){var scl=[];this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");if(!data){return}var aCntrl=data.definition;for(var c=0;c<aCntrl.tabsheets.length;c++){scl.push(aCntrl.tabsheets[c])}});return scl},populate:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var aCntrl=data.definition;aCntrl.dialog.validate(true);for(var c=0;c<aCntrl.tabsheets.length;c++){$(".xrui-accordian-title",aCntrl.tabsheets[c].$cap).html(aCntrl.dialog.expandEmbedded(aCntrl.tabsheets[c].caption));if(aCntrl.tabsheets[c].invalid){$(".xrui-accordian-inv",aCntrl.tabsheets[c].$cap).show()}else{$(".xrui-accordian-inv",aCntrl.tabsheets[c].$cap).hide()}aCntrl.dialog.populateCtrls(aCntrl.tabsheets[c].controls);if(aCntrl.tabsheets[c].isvisible){aCntrl.tabsheets[c].$panel.show()}else{aCntrl.tabsheets[c].$panel.hide()}if(aCntrl.tabsheets[c].invalid){$(".xrui-accordian-incomplete",$("#PAGE"+aCntrl.tabsheets[c].id)).show()}else{$(".xrui-accordian-incomplete",$("#PAGE"+aCntrl.tabsheets[c].id)).hide()}$(".xrui-accordian-error",$("#PAGE"+aCntrl.tabsheets[c].id)).hide()}});return this},focus:function(){var focused=false;this.each(function(){focused=true});return focused},destroy:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");$this.removeData("xrui_ctrl")})}};$.fn.xrui_accordian=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.xrui_accordian")}}}})(jQuery);(function($){var methods={init:function(options){this.each(function(){var data={definition:null,kb:null,changeCB:null,tiedDlgObj:0,currentVal:"",type:"text"};$.extend(data,options);var $this=$(this);var aCntrl=data.definition;data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));var aDescr=(data.kb?data.kb.GetDescription(true):"");data.type="text";if(data.kb){if((data.kb.aType==TYPE_VARIABLE)&&(data.kb.varType==VARTYPE_NUM)){data.type="number"}if(aCntrl.ispassword){data.type="password"}}$this.addClass("ui-widget-content xrui-arrayedit");if(data.type=="number"){$this.addClass("xrui-number")}var $fieldset=$("<fieldset></fieldset>");$fieldset.attr("data-role","controlgroup").appendTo($this);if(aCntrl.showlabel){if(aCntrl.label!=""){aDescr=aCntrl.dialog.expandEmbedded(aCntrl.label)}var $legend=$("<legend></legend>");aCntrl.dialog.populateLabel($legend,aDescr);$legend.appendTo($fieldset)}else{$this.addClass("xrui-nocaption")}var $input=$("<input></input>");$input.text(aCntrl.aName).addClass("ui-input-text ui-body-c ui-corner-all ui-shadow-inset").attr("id",aCntrl.aName).attr("name",aCntrl.aName).attr("type",(data.type=="number")&&isChromeDesktop?"text":data.type).keypress(function(e){return !data.definition.readonly}).appendTo($fieldset);var cName="";cName=(aCntrl.cssclassname?aCntrl.cssclassname.name:"");if(cName.substr(0,1)=="'"){cName=eval(cName)}if(cName.length>0){$this.addClass(cName)}if(aCntrl.cssclassname&&aCntrl.cssclassname.dowysiwyg&&!appSettings.noStyleProps){if(!aCntrl.applydialogfont){$this.css(aCntrl.dialog.fontToStyleObj(aCntrl.font))}}if(aCntrl.tabno>0){$this.attr("tabindex",aCntrl.tabno)}var aMask=aCntrl.maskstring;if(aMask&&(aMask!="")&&!aCntrl.multiline){if(aMask.substr(0,1)=="'"){aMask=eval(aMask)}$("input",$this).mask(aMask)}if(data.type=="number"){$input.addClass("ui-widget").numeric({decs:data.kb.aDecPlaces,decSeparator:appSettings.decSeparator?appSettings.decSeparator:".",changeCB:function(){if(data.currentVal!=$input.numeric("get")){if($.isFunction(data.changeCB)){data.currentVal=$input.numeric("get");data.changeCB(data.definition)}}},returnKeyCB:function(){data.currentVal=$input.numeric("get");data.changeCB(data.definition);aCntrl.dialog.progressOnCR(data.definition)}})}else{$input.change(function(ev){if(data.currentVal!=$input.val()){if($.isFunction(data.changeCB)){data.currentVal=$input.val();data.changeCB(data.definition)}}}).keydown(function(event){if(event.which==13){event.preventDefault();if(data.currentVal!=$input.val()){data.currentVal=$input.val();$this.xrui_arrayedit("setselection")}aCntrl.dialog.progressOnCR(data.definition)}})}if(data.kb){data.$helpDiv=aCntrl.dialog.renderHelp($this,data.kb)}$this.data("xrui_ctrl",data)});$(this).xrui_arrayedit("_setSelectedIDfromDictionary");return this},gettied:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");return data.kb},getSubCtrlLists:function(){return null},populate:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var aCntrl=data.definition;var $txt=$("input,textarea",$this);if($txt.length!=1){return}if(data.kb){data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));var aVal;if(data.kb.aType==TYPE_VARIABLE){aVal=data.kb.GetValue(aCntrl.dim1,aCntrl.dim2)}else{if(aCntrl.controlpropname&&data.kb.flatProps){aVal=data.kb.flatProps[controlpropname]}else{aVal=data.kb.GetValue()}}data.currentVal=aVal;if(data.type=="number"){$txt.numeric("set",aVal)}else{$txt.val(aVal)}if(!aCntrl.visible){$this.hide();if(data.$helpDiv){data.$helpDiv.hide()}}else{$this.show();if(data.$helpDiv){data.$helpDiv.show()}}}if(aCntrl.invalid){$txt.addClass("xrui-arrayedit-invalid")}else{$txt.removeClass("xrui-arrayedit-invalid")}});return this},_setSelectedIDfromDictionary:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");if(data.kb){data.currentVal=data.kb.GetValue()}});return this},setselection:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var value=data.currentVal;if(value==""){value=PSEUDO_VALUE_EMPTY}if(data.kb){if(data.kb.aType==TYPE_VARIABLE){replayStack.Add(data.definition.dialog.aID,REPLAY_CHANGEEVENT,data.kb.aID,value,{dim1:data.definition.dim1,dim2:data.definition.dim2})}else{if(data.definition.controlpropname){replayStack.Add(data.definition.dialog.aID,REPLAY_CHANGEEVENT,data.kb.aID,value,{flatprop:data.definition.controlpropname})}else{replayStack.Add(data.definition.dialog.aID,REPLAY_CHANGEEVENT,data.kb.aID,value)}}}})},isvalid:function(){var valid=true;this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");if(data.kb){if((data.kb.aType==TYPE_VARIABLE)&&(data.kb.varType==VARTYPE_STR)&&(data.currentVal=="")){if(data.definition.obligatory&&data.definition.visible){valid=false}}}});return valid},focus:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");var $txt=$("input,textarea",$this);if($txt.length!=1){return false}if($txt.is(":visible")){var s=$txt.val();$txt.val("").focus().val(s);return true}return false},designtime:function(){return{showlabel:"bool",dim1:{atype:"int",adefault:1},dim2:{atype:"int",adefault:1},multiline:{atype:"bool",adefault:false},ispassword:{atype:"bool",adefault:false},label:"str",}},destroy:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");$this.removeData("xrui_ctrl")})}};$.fn.xrui_arrayedit=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.xrui_arrayedit")}}}})(jQuery);(function($){var methods={init:function(options){this.each(function(){var data={definition:null,kb:null,idx:null,changeCB:null,tiedDlgObj:0,selectedID:0};$.extend(data,options);var $this=$(this);var aCntrl=data.definition;data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));data.idx=dictionary.GetObject(aCntrl.indexvariable);var aDescr=(data.kb?data.kb.GetDescription(true):"Description");var $fieldset=$("<fieldset></fieldset>");$fieldset.attr("data-role","controlgroup").appendTo($this);if(aCntrl.showlabel){if(aCntrl.label!=""){aDescr=aCntrl.dialog.expandEmbedded(aCntrl.label)}var $legend=$("<legend></legend>");aCntrl.dialog.populateLabel($legend,aDescr);$legend.appendTo($fieldset)}else{$this.addClass("xrui-nocaption")}var a;if(aCntrl.style=="listbox"){$this.addClass("xrui-listbox");if(aCntrl.jqmattributes){a=aCntrl.jqmattributes;if(a.substr(0,1)=="'"){a=eval(a)}try{a=JSON.parse("{"+a+"}");$fieldset.attr(a)}catch(e){}}}else{$this.addClass("xrui-dropdown");if(true){$this.addClass("xrkb-obligatory");$("<div class='xrkb-obligatory-marker'></div>").appendTo($fieldset)}var $input=$("<select></select>");$input.attr("data-theme",aCntrl.cssclassname.name).addClass("xrui-dropdown").attr("data-native-menu",!aCntrl.multisel).change(function(ev,ui){if($.isFunction(data.changeCB)){var val=PSEUDO_VALUE_EMPTY;if(aCntrl.multisel){val=$(this).val();if(!val){val=PSEUDO_VALUE_EMPTY}else{for(var c=0;c<val.length;c++){val[c]=parseInt(val[c])}}}else{val=parseInt(ev.currentTarget.value,10);if(val>0){$input.val(val)}else{val=PSEUDO_VALUE_EMPTY}}data.selectedID=val;data.clicked=true;data.changeCB(data.definition);data.clicked=false}}).appendTo($fieldset);if(aCntrl.multisel){$input.attr("multiple","multiple")}if(aCntrl.jqmattributes){var s="{"+eval(aCntrl.jqmattributes)+"}";a=JSON.parse(s);$input.attr(a)}}if(data.kb){data.$helpDiv=aCntrl.dialog.renderHelp($this,data.kb)}if(aCntrl.tabno>0){$this.attr("tabindex",aCntrl.tabno)}$this.data("xrui_ctrl",data)});$(this).xrui_arraylist("_setSelectedIDfromDictionary");return this},gettied:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");return data.kb},getSubCtrlLists:function(){return null},populate:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var aCntrl=data.definition;var $lb;if(aCntrl.style=="listbox"){$lb=$("fieldset",$this)}else{$lb=$("select",$this)}if($lb.length!=1){return}var items=[];var $inputsDiv;var firstPopulate=false;if(data.kb){if(data.clicked&&!jsAjax){if(aCntrl.style=="listbox"){if(data.kb&&!aCntrl.multisel){$inputsDiv=$(".ui-controlgroup-controls",$lb);$inputsDiv.removeClass("xrui-arraylist-invalid")}return}else{return}}var c;var cc=1;data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));if(data.definition.dialog.editing){var rows=(data.kb.dim1>=3)?3:data.kb.dim1;for(cc=1;cc<=rows;cc++){items[items.length]={id:cc,text:" "}}}else{do{var txt=data.kb.GetValueAsString(cc,1);if(txt==null){txt=""}if(txt.length>0){items[items.length]={id:cc,text:txt}}cc++}while((txt.length>0)&&(cc<=data.kb.dim1))}firstPopulate=(data.lastValues==null);var changed=firstPopulate;if(!changed){changed=data.lastValues.length!=items.length}if(!changed){for(c=0;(c<data.lastValues.length)&&!changed;c++){if(c>=items.length){changed=true}else{if(data.lastValues[c].id!=items[c].id){changed=true}else{if(data.lastValues[c].text!=items[c].text){changed=true}}}}}var aVal=data.selectedID;if(!aCntrl.multisel){if(aVal==PSEUDO_VALUE_EMPTY){aVal=0}}if(data.idx){if(!aCntrl.multisel){aVal=data.idx.GetValue();if(aVal<1||aVal>items.length){aVal=0}data.selectedID=aVal}}if(changed){data.lastValues=items;if(aCntrl.style=="listbox"){data.lastID=data.selectedID;data.lastValues=items;$lb.empty();if(true){$this.addClass("xrkb-obligatory");$("<div class='xrkb-obligatory-marker'></div>").appendTo($lb)}if(aCntrl.showlabel){var aDescr;if(aCntrl.label!=""){aDescr=aCntrl.dialog.expandEmbedded(aCntrl.label)}else{aDescr=data.kb.GetDescription(true)}var $legend=$("<legend></legend>");$legend.text(aDescr).appendTo($lb)}for(c=0;c<items.length;c++){var $input=$("<input></input>");$lb.append($input.attr("name",aCntrl.aName+"_rd").attr("id",aCntrl.aName+"_rd"+c).attr("type",(aCntrl.multisel?"checkbox":"radio")).attr("value",items[c].id).attr("data-theme",aCntrl.cssclassname.name).change(function(ev){var prevSel=data.selectedID;data.selectedID=0;if($.isFunction(data.changeCB)){var vID=parseInt(ev.currentTarget.value);if(aCntrl.multisel){var array=[];if($(ev.currentTarget).attr("checked")=="checked"){array.push(vID)}else{var i=jQuery.inArray(vID,array);if(i>=0){array.splice(i,1)}}data.selectedID=array}else{data.selectedID=vID;if(prevSel==vID){return}}if(prevSel==data.selectedID){data.selectedID=PSEUDO_VALUE_EMPTY;$lb.find("input").attr("checked",false)}data.clicked=true;data.changeCB(data.definition);data.clicked=false}}));var $label=$("<label></label>");$label.attr("for",aCntrl.aName+"_rd"+c).attr("id",aCntrl.aName+"_rdlbl"+c).appendTo($lb).text(items[c].text)}if(!firstPopulate){$this.trigger("create")}}else{$lb=$("select",$this);if($lb.length!=1){return}$lb.empty();var $opt=$("<option></option>").attr("data-placeholder","true");if(aCntrl.multisel){$opt.text(data.kb.GetDescription(true))}else{var emptyTxt="";if(aCntrl.emptytext){emptyTxt=eval(aCntrl.emptytext)}if(emptyTxt.length==0){emptyTxt=getTranslation("dropdown_deselected_text","No Selection")}$opt.text(emptyTxt).attr("value","0")}$lb.append($opt);for(c=0;c<items.length;c++){var $o=$("<option></option>").attr("value",items[c].id).text(items[c].text);$lb.append($o)}}}if(aCntrl.style=="listbox"){if(aVal){if(!$.isArray(aVal)){$("input[value='"+aVal+"']",$this).attr("checked",true)}else{for(c=0;c<aVal.length;c++){$("input[value='"+aVal[c]+"']",$this).attr("checked",true)}}}else{$lb.find("input").attr("checked",false)}$inputsDiv=$(".ui-controlgroup-controls",$lb);if(aCntrl.invalid){$inputsDiv.addClass("xrui-arraylist-invalid ui-corner-all")}else{$inputsDiv.removeClass("xrui-arraylist-invalid")}}else{if($.isArray(aVal)){for(c=0;c<aVal.length;c++){$lb.val(aVal[c]);if(!firstPopulate){$lb.val(aVal[c]).selectmenu("refresh",true)}}}else{$lb.val(aVal);if(!firstPopulate){$lb.selectmenu("refresh",true)}}if(aCntrl.invalid){$lb.parent().addClass("xrui-arraylist-invalid")}else{$lb.parent().removeClass("xrui-arraylist-invalid")}}}if(!aCntrl.visible){$this.hide();if(data.$helpDiv){data.$helpDiv.hide()}}else{$this.show();if(data.$helpDiv){data.$helpDiv.show()}}if(aCntrl.style=="listbox"){if(!firstPopulate){$this.find("input").checkboxradio("refresh")}}});return this},_setSelectedIDfromDictionary:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");if(data.kb){data.selectedID=PSEUDO_VALUE_EMPTY}});return this},_selection:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");return data.selectedID},setselection:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var aCntrl=data.definition;var value=$this.xrui_arraylist("_selection");if(data.idx){if(!value){value=PSEUDO_VALUE_EMPTY}replayStack.Add(data.definition.dialog.aID,REPLAY_CHANGEEVENT,data.idx.aID,value)}})},isvalid:function(){var valid=true;this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var aCntrl=data.definition;var aValueID=data.selectedID;if(aCntrl.obligatory&&aCntrl.visible){if(aCntrl.multisel){var allBlank=true;for(var c=0;(c<aValueID.length)&&allBlank;c++){if(aValueID[c]!=0){allBlank=false}}if(allBlank){valid=false}}else{if(aValueID==PSEUDO_VALUE_EMPTY){valid=false}else{if(!aValueID){valid=false}}}}});return valid},focus:function(){var $this=$(this.get(0));var $lb=$("select",$this);if($lb.length!=1){return false}if($lb.is(":visible")){$lb.focus();return true}return false},designtime:function(){return{indexvariable:{atype:"tied",accepted:[TYPE_NUMERIC]},multisel:{atype:"bool",adefault:false},tieditem:{atype:"tied",accepted:[TYPE_VARIABLE]},cssclassname:{atype:"css",displayname:"swatch"},showlabel:{atype:"bool",adefault:true},label:"str",jqmattributes:"str"}},destroy:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");$this.removeData("xrui_ctrl")})}};$.fn.xrui_arraylist=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.xrui_arraylist")}}}})(jQuery);(function($){var methods={init:function(options){this.each(function(){var data={definition:null,firstPopulate:true};$.extend(data,options);var $this=$(this);var aCntrl=data.definition;aCntrl.isarea=false;var aCaption=aCntrl.caption;var c=aCaption.indexOf("&");if((c!=-1)&&(c<aCaption.length-1)){if(aCaption.charAt(c+1)!="&"){$this.attr("accesskey","'"+aCaption.charAt(c+1)+"'")}aCaption=aCaption.substring(0,c)+aCaption.substring(c+1);aCntrl.caption=aCaption}$this.attr("data-role","");var $input=$("<a></a>");$input.click(function(e){var aCntrl=data.definition;e.preventDefault();switch(aCntrl.buttontype){case ("ok"):aCntrl.dialog.ok();break;case ("back"):aCntrl.dialog.back();break;case ("exit"):aCntrl.dialog.exit(aCntrl.exitcheck);break;case ("macro"):var macParam=undefined;if(aCntrl.hasOwnProperty("macroparameter")&&(aCntrl.macroparameter!="")){macParam=aCntrl.dialog.expandEmbedded(aCntrl.macroparameter)}aCntrl.dialog.macro(aCntrl.macro,aCntrl.macroautook,macParam);break;case ("restart"):aCntrl.dialog.restart(aCntrl.exitcheck);break;case ("change"):aCntrl.dialog.change(aCntrl.doOK,aCntrl.changeCtrl,aCntrl.treeDlgDlg);break;case ("url"):window.open(aCntrl.dialog.expandEmbedded(aCntrl.url));break}}).attr("data-theme",aCntrl.cssclassname.name).attr("data-role","button").appendTo($this);if(aCntrl.jqmattributes){var a=aCntrl.jqmattributes;if(a.substr(0,1)=="'"){a=eval(a)}try{a=JSON.parse("{"+a+"}");$input.attr(a)}catch(e){}}if(aCntrl.cssclassname&&aCntrl.cssclassname.dowysiwyg&&!appSettings.noStyleProps){if(!aCntrl.applydialogfont){$this.css(aCntrl.dialog.fontToStyleObj(aCntrl.font))}}if(aCntrl.tabno>0){$this.attr("tabindex",aCntrl.tabno)}$this.data("xrui_ctrl",data)});return this},gettied:function(){return null},getSubCtrlLists:function(){return null},populate:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var aCntrl=data.definition;if(data.firstPopulate){if(aCntrl.changeCtrl&&$.isArray(aCntrl.changeCtrl)){for(var c=0;c<aCntrl.changeCtrl.length;c++){if(typeof aCntrl.changeCtrl[c]=="string"){aCntrl.changeCtrl[c]=aCntrl.dialog.findControl(aCntrl.changeCtrl[c])}}}data.firstPopulate=false}var $link=$("a",$this);aCntrl=data.definition;var $t=$link.find(".ui-btn-text");if($t.length==0){$t=$link}$t.html(aCntrl.dialog.expandEmbedded(aCntrl.caption));var isEnabled=aCntrl.enabled;if((aCntrl.buttontype=="back")&&replayStack.isFirstDialog()&&!aCntrl.dialog.editing){isEnabled=false}if(!isEnabled){$link.addClass("ui-disabled")}else{$link.removeClass("ui-disabled")}if(!aCntrl.visible&&!aCntrl.dialog.editing){$this.hide()}else{$this.show()}});return this},postJQMcreate:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");if($this.length!=1){return}var $span=$(".ui-btn-inner",$this);if($span.parent().is("div")){$span.addClass("dialog_control")}},designtime:function(){return{caption:{atype:"str",adefault:"button caption"},buttontype:{atype:"enum",vals:["ok","back","macro","exit","restart"],adefault:"ok"},visible:{atype:"bool",adefault:true},exitcheck:{atype:"bool",adefault:true},macro:{atype:"tied",accepted:[TYPE_PROCEDURE]},macroautook:{atype:"bool",adefault:false},macroparameter:"str",cssclassname:{atype:"css",displayname:"swatch"},enabled:{atype:"bool",adefault:true},jqmattributes:"str"}},destroy:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");$this.removeData("xrui_ctrl")})}};$.fn.xrui_button=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.xrui_button")}}}})(jQuery);(function($){var methods={init:function(options){this.each(function(){var data={definition:null,kb:null,changeCB:null,tiedDlgObj:0,selectedID:0,lastValues:null,lastID:0};$.extend(data,options);var $this=$(this);var aCntrl=data.definition;$this.addClass("xrui-buttonset");data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));var aDescr=(data.kb?data.kb.GetDescription(true):"Description");if(data.kb){var $fieldset=$("<fieldset></fieldset>");$fieldset.attr("data-role","controlgroup").attr("data-type","horizontal").appendTo($this);if(!data.kb.flatProps.allowblank){$this.addClass("xrkb-obligatory");$("<div class='xrkb-obligatory-marker'></div>").appendTo($fieldset)}if(aCntrl.jqmattributes){var a=aCntrl.jqmattributes;if(a.substr(0,1)=="'"){a=eval(a)}try{a=JSON.parse("{"+a+"}");$fieldset.attr(a)}catch(e){}}if(aCntrl.showlabel){if(aCntrl.label!=""){aDescr=aCntrl.dialog.expandEmbedded(aCntrl.label)}var $legend=$("<legend></legend>");aCntrl.dialog.populateLabel($legend,aDescr);$legend.appendTo($fieldset)}data.$helpDiv=data.definition.dialog.renderHelp($this,data.kb)}if(aCntrl.tabno>0){$this.attr("tabindex",aCntrl.tabno)}$this.data("xrui_ctrl",data)});$(this).xrui_buttonset("_setSelectedIDfromDictionary");return this},gettied:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");return data.kb},getSubCtrlLists:function(){return null},populate:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var aCntrl=data.definition;var $lb=$("fieldset",$this);if($lb.length!=1){return}if(data.kb){data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));data.kb=_dgo(data.kb.aID)}function setValueClasses(vals){if(!data.kb){return}var aVal=data.kb.GetValue();var isSel;data.lastID=aVal;for(var c=0;c<vals.length;c++){$input=$this.find("#"+aCntrl.aName+"_rd"+c);var $lbl=$input.next();if(!vals[c].valid){if(!data.kb.flatProps.allowinvalid){$input.attr("disabled","disabled")}else{$lbl.addClass("xrui-buttonset-constrained")}if(vals[c].aID==aVal){$lbl.removeClass("xrui-buttonset-constrained");$lbl.addClass("xrui-buttonset-selinv")}else{$lbl.removeClass("xrui-buttonset-selinv")}}else{$lbl.removeClass("xrui-buttonset-constrained xrui-buttonset-selinv");$input.removeAttr("disabled")}if($.isArray(aVal)){isSel=($.inArray(vals[c].aID,aVal)>=0)}else{isSel=(aVal==vals[c].aID)}if(isSel){$input.attr("checked","checked")}else{$input.removeAttr("checked")}}}if(data.kb){data.selectedID=data.kb.GetValue();var vals=data.kb.aValues.slice(0);if(data.kb.flatProps.sortinvalid&&(data.kb.aType!=TYPE_BOOLEAN)){vals.sort(sortfunction2)}var c;if(!data.kb.flatProps.showinvalid){for(c=vals.length-1;c>=0;c--){if(!vals[c].valid){vals.splice(c,1)}}}var hiddenValueProp=!data.kb.flatProps.hasOwnProperty("hiddenvaluesprop")?null:data.kb.flatProps.hiddenvaluesprop==""?null:data.kb.flatProps.hiddenvaluesprop;for(c=vals.length-1;c>=0;c--){if((vals[c].visible===false)||(hiddenValueProp&&vals[c][hiddenValueProp]===true)){vals.splice(c,1)}}if(data.clicked){if(aCntrl.invalid){$lb.addClass("xrui-buttonset-invalid")}else{$lb.removeClass("xrui-buttonset-invalid")}setValueClasses(vals);return}var firstPopulate=data.lastValues==null;var changed=firstPopulate;if(!changed){changed=data.lastValues.length!=vals.length}if(!changed){for(c=0;(c<data.lastValues.length)&&!changed;c++){if(c>=vals.length){changed=true}else{if(data.lastValues[c].aID!=vals[c].aID){changed=true}else{if(data.lastValues[c].selected!=vals[c].selected){changed=true}else{if(data.lastValues[c].valid!=vals[c].valid){changed=true}}}}}}var $input;if(changed){data.lastValues=vals;$lb.find(".ui-controlgroup-controls").remove();if(data.kb.flatProps.sortinvalid&&(data.kb.aType!=TYPE_BOOLEAN)){vals.sort(sortfunction2)}for(c=0;c<vals.length;c++){$input=$("<input></input>");$lb.append($input.attr("name",aCntrl.aName+"_rd").attr("id",aCntrl.aName+"_rd"+c).attr("type",(data.kb.isMultiSel?"checkbox":"radio")).attr("value",vals[c].aID).attr("data-theme",aCntrl.cssclassname.name).change(function(ev){if($.isFunction(data.changeCB)){var vID=parseInt(ev.currentTarget.value,10);if(data.kb.isMultiSel){var array=[];$this.find("input").each(function(){if($(this).is(":checked")){array.push(parseInt($(this).attr("value"),10))}});data.selectedID=array}else{if((data.lastID==vID)&&data.kb.flatProps.allowdeselect){vID=0}data.selectedID=vID}data.clicked=true;data.changeCB(aCntrl);data.clicked=false}}));var $label=$("<label></label>");$label.attr("for",aCntrl.aName+"_rd"+c).appendTo($lb);var s=data.kb.GetValueDescr(data.kb.ValueIDtoIndex(vals[c].aID));if(aCntrl.ishtml){$label.html(s)}else{$label.text(s)}if(vals[c].valid){$label.removeClass("ui-list-invalid")}else{$label.addClass("ui-list-invalid")}if(!data.kb.flatProps.showinvalid){if(!vals[c].valid){$input.remove();$label.remove()}}if(!vals[c].valid){$input.addClass("ui-state-disabled");if(!data.kb.flatProps.allowinvalid){$input.attr("disabled","disabled")}}}if(!firstPopulate){$this.trigger("create")}}setValueClasses(vals);var aVal=data.kb.GetValue();for(c=0;c<vals.length;c++){$input=$this.find("#"+aCntrl.aName+"_rd"+c);var $lbl=$input.next();if(!vals[c].valid){if(!data.kb.flatProps.allowinvalid){$input.attr("disabled","disabled")}else{$lbl.addClass("xrui-buttonset-constrained")}if(vals[c].aID==aVal){$lbl.addClass("xrui-buttonset-selinv")}else{$lbl.removeClass("xrui-buttonset-selinv")}}else{$lbl.removeClass("xrui-buttonset-constrained xrui-buttonset-selinv");$input.removeAttr("disabled")}}$lb.find("input[type='radio']").attr("checked",false);if(aVal){$lb.find("input[type='checkbox']").attr("checked",false);if($.isArray(aVal)){for(c=0;c<aVal.length;c++){$lb.find("input[type='checkbox'][value='"+aVal[c]+"']").attr("checked",true)}}else{$lb.find("input[type='radio'][value='"+aVal+"']").attr("checked",true)}}if(!firstPopulate){if($.isArray(aVal)){$lb.find("input[type='checkbox']").checkboxradio("refresh")}else{$lb.find("input[type='radio']").checkboxradio("refresh")}}if(!data.kb.flatProps.isenabled){$lb.addClass("ui-disabled");$lb.attr("disabled","disabled")}else{$lb.removeClass("ui-disabled");$lb.removeAttr("disabled")}if(data.kb.flatProps.hasOwnProperty("isvisible")){if(!data.kb.flatProps.isvisible){$this.hide()}else{$this.show()}}}if(aCntrl.invalid){$lb.addClass("xrui-buttonset-invalid")}else{$lb.removeClass("xrui-buttonset-invalid")}});return this},_setSelectedIDfromDictionary:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");if(data.kb){var v=data.kb.GetValue();if($.isArray(v)){if(v.length>0){data.selectedID=v}else{data.selectedID=0}}else{data.selectedID=v}}});return this},_selection:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");return data.selectedID},setselection:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");if(data.kb){var val=$this.xrui_buttonset("_selection");if(!val){val=PSEUDO_VALUE_EMPTY}replayStack.Add(data.definition.dialog.aID,REPLAY_CHANGEEVENT,data.kb.aID,val)}})},isvalid:function(){var valid=true;this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var selID=$this.xrui_buttonset("_selection");if(!data.definition.dialog.isValueValid(data.kb,selID)){valid=false}if(data.kb.isMultiSel){var nSel=$.isArray(selID)?selID.length:0;if((nSel<data.definition.multiselmin)||(nSel>data.definition.multiselmax)){valid=false}}});return valid},focus:function(){var $this=$(this.get(0));var $lb=$("fieldset",$this);if($lb.length!=1){return false}if($lb.is(":visible")){$lb.focus();return true}return false},designtime:function(){return{tieditem:{atype:"tied",accepted:[TYPE_LIST,TYPE_BOOLEAN]},cssclassname:{atype:"css",displayname:"swatch"},showlabel:{atype:"bool",adefault:true},label:"str",jqmattributes:"str"}},destroy:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");$this.removeData("xrui_ctrl")})}};$.fn.xrui_buttonset=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.xrui_buttonset")}}}})(jQuery);(function($){var methods={init:function(options){this.each(function(){var data={definition:null,kb:null,changeCB:null,tiedDlgObj:0,aName:"",currentID:0};$.extend(data,options);var $this=$(this);var aCntrl=data.definition;data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));data.aName=data.definition.dialog.expandEmbedded(data.definition.caption);var $fieldset=$("<fieldset></fieldset>");$fieldset.attr("data-role","controlgroup").appendTo($this);var aDesc="Descr";if(data.kb){aDesc=data.kb.GetDescription(true)}if(aCntrl.showlabel){var aDescr="";if(aCntrl.label!=""){aDescr=aCntrl.dialog.expandEmbedded(aCntrl.label)}else{if(data.kb){aDescr=data.kb.GetDescription(true)}}var $legend=$("<legend></legend>");if(aCntrl.ishtml){$legend.html(aDescr)}else{$legend.text(aDescr)}$legend.appendTo($fieldset)}var $label=$("<label></label>");$label.addClass("xrui-checkbox-caption").attr("for",aCntrl.aName).appendTo($fieldset);aDesc=$.trim(data.kb.flatProps.description);if(aDesc.length==0){$label.html(data.definition.dialog.editing?"<span style='color: #888; font-style: italic; font-weight: normal;'>"+data.kb.aName+" description shows here</span>":"&nbsp;")}else{if(aCntrl.ishtml){$label.html(aDesc)}else{$label.text(aDesc)}}var aValueID=aCntrl.value;if(data.kb){if(data.kb.aType==TYPE_BOOLEAN){aValueID=0}}$input=$("<input></input>");$input.addClass("").attr("id",aCntrl.aName).attr("name",aCntrl.aName).attr("type","checkbox").attr("value",aValueID).attr("data-theme",aCntrl.cssclassname.name).appendTo($fieldset);if(aCntrl.jqmattributes){var a=aCntrl.jqmattributes;if(a.substr(0,1)==="'"){a=eval(a)}try{a=JSON.parse("{"+a+"}");$input.attr(a)}catch(e){}}$this.addClass("xrui-checkbox");var fStyle=(aCntrl.cssclassname?aCntrl.cssclassname.name:"");if(fStyle.substr(0,1)=="'"){fStyle=eval(fStyle)}if(fStyle.length>0){$this.addClass(fStyle)}if(aCntrl.cssclassname&&aCntrl.cssclassname.dowysiwyg&&!appSettings.noStyleProps){if(!aCntrl.applydialogfont){$this.css(aCntrl.dialog.fontToStyleObj(aCntrl.font))}}if(aCntrl.tabno>0){$this.attr("tabindex",aCntrl.tabno)}if(data.kb){if(data.kb.aType==TYPE_BOOLEAN&&!data.kb.isFull()){replayStack.Add(aCntrl.dialog.aID,REPLAY_CHANGEEVENT,data.kb.aID,2)}$this.change(function(){if($.isFunction(data.changeCB)){data.clicked=true;data.changeCB(data.definition);data.clicked=false}});data.$helpDiv=aCntrl.dialog.renderHelp($this,data.kb)}$this.data("xrui_ctrl",data)});return this},gettied:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");return data.kb},getSubCtrlLists:function(){return null},populate:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");if($this.length!=1){return}var aCntrl=data.definition;var aValue=0;if(data.kb){aValue=data.kb.GetValue()}var $cb=$this.find("input");var jqm_created=$cb.parent().get(0).tagName.toLowerCase()=="div";var $txt=$this.find(".ui-btn-text");if(data.kb){data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));data.aName=data.definition.dialog.expandEmbedded(data.definition.caption);var isSelected=false;if(data.kb.isMultiSel){for(var c=0;c<aValue.length;c++){if(aValue[c]==$cb.attr("value")){isSelected=true;break}}}else{if(data.kb.aType==TYPE_BOOLEAN){isSelected=aValue==1}else{isSelected=aValue==$cb.attr("value")}}if(!data.clicked){if(!data.kb.flatProps.isvisible){$this.hide();if(data.$helpDiv){data.$helpDiv.hide()}}else{$this.show();if(data.$helpDiv){data.$helpDiv.show()}}$cb.attr("checked",isSelected)}var dis=!data.kb.flatProps.isenabled;var val=true;if(data.kb.aType==TYPE_BOOLEAN){if(isSelected&&!data.kb.IsValueValid(2)){dis=true}else{if(!isSelected&&!data.kb.IsValueValid(1)){dis=true}}if(!isSelected&&!data.kb.IsValueValid(2)){val=false}else{if(isSelected&&!data.kb.IsValueValid(1)){val=false}}}else{if(!isSelected&&!data.kb.IsValueValid($cb.attr("value"))){dis=true}if(!data.kb.IsValueValid($cb.attr("value"))){val=false}}var $lbl=$this.find(".xrui-checkbox-caption");if(dis){if(!data.kb.flatProps.allowinvalid){$cb.attr("disabled",true);if(jqm_created){$cb.checkboxradio("refresh")}}else{$lbl.addClass("xrui-checkbox-constrained")}}else{if(val||data.kb.flatProps.allowinvalid){$cb.removeAttr("disabled");if(jqm_created){$cb.checkboxradio("refresh")}}$lbl.removeClass("xrui-checkbox-constrained")}if(!val){$lbl.addClass("xrui-checkbox-selinv")}else{$lbl.removeClass("xrui-checkbox-selinv")}if(aCntrl.invalid){$lbl.addClass("xrui-checkbox-invalid")}else{$lbl.removeClass("xrui-checkbox-invalid")}}if(!data.clicked){if(aCntrl.hascaption){$("legend",$this).text(data.aName)}}});return this},_selection:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");if($this.length!=1){return false}var $cb=$this.find("input");var checked=$cb.attr("checked")=="checked";var valueID=$cb.attr("value");if(valueID==0){return checked}return checked?valueID:false},setselection:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var value=$this.xrui_checkbox("_selection");if(data.kb){if(data.kb.aType==TYPE_BOOLEAN){value?value=1:value=2}replayStack.Add(data.definition.dialog.aID,REPLAY_CHANGEEVENT,data.kb.aID,value)}})},isvalid:function(){var valid=true;this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");if(data.kb){var value;if(data.kb.aType==TYPE_BOOLEAN){value=$this.xrui_checkbox("_selection")?1:2}else{value=$this.xrui_checkbox("_selection")}valid=data.definition.dialog.isValueValid(data.kb,value)}});return valid},focus:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");if($("span",$this).length!=2){return false}var $img=$(".xrui-checkbox-image",$this);if($img.is(":visible")){$img.focus();return true}return false},designtime:function(){return{tieditem:{atype:"tied",accepted:[TYPE_BOOLEAN]},cssclassname:{atype:"css",displayname:"swatch"},selectablegrey:{atype:"bool",adefault:false},showlabel:{atype:"bool",adefault:true},label:"str",jqmattributes:"str",ishtml:{atype:"bool",adefault:false}}},destroy:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");$this.removeData("xrui_ctrl")})}};$.fn.xrui_checkbox=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.xrui_checkbox")}}}})(jQuery);(function(b){var a={init:function(d){this.each(function(){var g={definition:null,changeCB:null};b.extend(g,d);var h=b(this);var f=g.definition;h.addClass("xrui-columns");var j=b("<fieldset></fieldset>");j.addClass("ui-grid-fieldset ui-grid-"+String.fromCharCode(96+f.numcolumns-1)).appendTo(h);for(var k=0;k<f.tabsheets.length;k++){f.tabsheets[k].tab=f;var e=b("<div></div>").attr("id","TAB_"+f.aName+"_"+k).addClass("xrui-columns-column ui-block-"+String.fromCharCode(96+k+1)).appendTo(j);f.tabsheets[k].$div=e;if((f.tabsheets[k].controls.length===0)&&f.dialog.editing){xrkb_dlg.renderDropHelper(e,{ctrlArr:f.tabsheets[k].controls,ctrlIdx:0})}else{f.dialog.renderCtrls(f.tabsheets[k].controls,e,f.tabsheets[k])}}h.data("xrui_ctrl",g)});return this},gettied:function(){return null},getSubCtrlLists:function(){var d=[];this.each(function(){var g=b(this);var f=g.data("xrui_ctrl");if(!f){return}var e=f.definition;for(var h=0;h<e.tabsheets.length;h++){d.push(e.tabsheets[h])}});return d},populate:function(){this.each(function(){var f=b(this);var e=f.data("xrui_ctrl");var d=e.definition;var j;for(j=0;j<d.tabsheets.length;j++){if(d.tabsheets[j].isvisible||d.dialog.editing){d.tabsheets[j].$div.show();d.dialog.populateCtrls(d.tabsheets[j].controls)}else{d.tabsheets[j].$div.hide()}}var h=0;for(j=0;j<d.tabsheets.length;j++){if(d.tabsheets[j].isvisible||d.dialog.editing){h++;d.tabsheets[j].$div.removeClass("ui-block-a ui-block-b ui-block-c ui-block-d").addClass("xrui-columns-column ui-block-"+String.fromCharCode(96+h))}}var g=f.find(".ui-grid-fieldset");g.removeClass("ui-grid-a ui-grid-b ui-grid-c ui-grid-d");if(h>1){g.addClass("ui-grid-"+String.fromCharCode(96+h-1))}});return this},resize:function(){this.each(function(){var j=b(this);var g=j.data("xrui_ctrl");var f=g.definition;if(g.definition.autocollapse){var h=j.find(".xrui-columns-column");var e=false;if(j.parents(".ui-page").width()<g.definition.autocollapsewidth){e=!h.hasClass("xrui-columns-disable");h.addClass("xrui-columns-disable")}else{e=h.hasClass("xrui-columns-disable");h.removeClass("xrui-columns-disable")}if(e&&g.definition.reversecollapse){var d=null;h.each(function(){var k=b(this);if(d){k.insertBefore(d)}d=k})}}});return this},focus:function(){var d=false;this.each(function(){var g=b(this);var f=g.data("xrui_ctrl");var e=f.definition;var h;for(h=0;(h<e.tabsheets.length)&&!d;h++){if(e.dialog.focusCtrls(e.tabsheets[h].controls)){d=true}}});return d},designtime:function(){return{numcolumns:"int",autocollapse:"bool",autocollapsewidth:"int",reversecollapse:"bool"}},destroy:function(){this.each(function(){var e=b(this);var d=e.data("xrui_ctrl");e.removeData("xrui_ctrl")})}};b.fn.xrui_columns=function(d){if(a[d]){return a[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){return a.init.apply(this,arguments)}else{b.error("Method "+d+" does not exist on jQuery.xrui_columns")}}}})(jQuery);(function(b){var a={init:function(d){this.each(function(){var f={};b.extend(f,d);var g=b(this);var e=f.definition;if(e.dialog.renderingParent){if((e.dialog.definition.controls.length==0)&&e.dialog.editing){xrkb_dlg.renderNewDialogHelper(g,true)}else{g.hide();e.dialog.renderingParent=false;e.dialog.renderCtrls(e.dialog.definition.controls,e.dialog.$body);e.dialog.renderingParent=true}}else{g.html("Child controls go here").addClass("xrui-container-placeholder").removeAttr("data-role")}g.data("xrui_ctrl",f)});return this},gettied:function(){return null},getSubCtrlLists:function(){var d=[];this.each(function(){var g=b(this);var f=g.data("xrui_ctrl");if(!f){return}var e=f.definition;if(e.dialog.definition.pid){d.push(e.dialog.definition)}});return d},populate:function(){this.each(function(){var f=b(this);var e=f.data("xrui_ctrl");var d=e.definition;if(d.dialog.renderingParent){d.dialog.renderingParent=false;d.dialog.populateCtrls(d.dialog.definition.controls);d.dialog.renderingParent=true}});return this},focus:function(){return false},designtime:function(){return{}},destroy:function(){this.each(function(){var e=b(this);var d=e.data("xrui_ctrl");e.removeData("xrui_ctrl")})}};b.fn.xrui_container=function(d){if(a[d]){return a[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){return a.init.apply(this,arguments)}else{b.error("Method "+d+" does not exist on jQuery.xrui_container")}}}})(jQuery);(function($){var isEmptyInput=function(value){return((typeof value=="string")&&(value==""))||(value===null)};var methods={init:function(options){this.each(function(){var data={definition:null,kb:null,changeCB:null,tiedDlgObj:0,currentVal:"",lastValue:null,minValue:null,maxValue:null};$.extend(data,options);var $this=$(this);var aCntrl=data.definition;$this.addClass("xrui-date");data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));var $fieldset=$("<fieldset></fieldset>");$fieldset.attr("data-role","controlgroup").appendTo($this);if(data.kb){if(!data.kb.flatProps.allowblank){$this.addClass("xrkb-obligatory");$("<div class='xrkb-obligatory-marker'></div>").appendTo($fieldset)}var aDescr;if(aCntrl.showlabel){if(aCntrl.label!=""){aDescr=aCntrl.dialog.expandEmbedded(aCntrl.label)}else{aDescr=data.kb?data.kb.GetDescription(true):""}var $legend=$("<legend></legend>");aCntrl.dialog.populateLabel($legend,aDescr);$legend.appendTo($fieldset)}else{$this.addClass("xrui-align-"+aCntrl.align)}var $date=$("<input></input>");$date.attr("type","text").attr("name",aCntrl.aName).attr("id",aCntrl.aName).attr("data-theme",aCntrl.cssclassname.name).attr("placeholder",getTranslation(appSettings.dateFormat,appSettings.dateFormat)).addClass("xrui-align-element").appendTo($fieldset);var fStyle=(aCntrl.cssclassname?aCntrl.cssclassname.name:"");if(fStyle.substr(0,1)=="'"){fStyle=eval(fStyle)}if(fStyle.length>0){$this.addClass(fStyle)}var fStyleObj=undefined;if(aCntrl.cssclassname&&aCntrl.cssclassname.dowysiwyg&&!appSettings.noStyleProps){if(!aCntrl.applydialogfont){fStyleObj=aCntrl.dialog.fontToStyleObj(aCntrl.font)}}if(aCntrl.tabno>0){$this.attr("tabindex",aCntrl.tabno)}if(data.kb.flatProps.minvalue){data.minValue=new Date(data.kb.flatProps.minvalue*86400000)}if(data.kb.flatProps.maxvalue){data.maxValue=new Date(data.kb.flatProps.maxvalue*86400000)}if(data.minValue&&data.maxValue&&data.minValue>=data.maxValue){data.minValue=null;data.maxValue=null}var aDate=new Date();var o=appSettings.dateFormat.toLowerCase().replace(/\//g,"");var dt=data.kb.val();if(dt==null){dt=aDate}if(aCntrl.usepopup===false){}else{var opt={preset:"date",theme:"jqm",mode:"scroller",display:"modal",lang:"fr",dateOrder:o,dateFormat:appSettings.dateFormat.toLowerCase(),setText:getTranslation("date_set","set"),cancelText:getTranslation("date_cancel","cancel"),yearText:getTranslation("date_year","year"),monthText:getTranslation("date_month","month"),dayText:getTranslation("date_day","day"),minDate:data.minValue,maxDate:data.maxValue,startYear:aDate.getFullYear()-100,endYear:aDate.getFullYear()+100};$date.mobiscroll().date(opt);if(dt!=0){$date.mobiscroll("setDate",dt,false)}}$date.change(function(ev){if($.isFunction(data.changeCB)){var dt=Cmd_StrToDate($date.val());data.currentVal=$this.xrui_date("_decodedate",dt);data.changeCB(data.definition)}});if(fStyleObj){$date.css(fStyleObj);$("#ui-datepicker-div").css(fStyleObj)}data.$helpDiv=aCntrl.dialog.renderHelp($this,data.kb)}if(aCntrl.tabno>0){$this.attr("tabindex",aCntrl.tabno)}$this.data("xrui_ctrl",data)});$(this).xrui_date("_setSelectedIDfromDictionary");return this},gettied:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");return data.kb},getSubCtrlLists:function(){return null},_decodedate:function(aValue){if(aValue){return Cmd_DateToStr(aValue)}return""},populate:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var aCntrl=data.definition;var $date=$("input",$this);if($date.length!=1){return}if(data.kb){data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));if(!data.kb.flatProps.isvisible){$this.hide();if(data.$helpDiv){data.$helpDiv.hide()}}else{var aVal=data.kb.GetValue();var changed=data.lastValue==null;if(!changed){changed=data.lastValue!=aVal}if(changed){if(aCntrl.usepopup!==false||aCntrl.invalid!==true){var v;if(aVal){v=$this.xrui_date("_decodedate",aVal)}else{v=""}data.currentVal=v;$date.val(v)}}$this.show();if(data.$helpDiv){data.$helpDiv.show()}}if(data.kb.flatProps.isenabled){$date.mobiscroll("enable")}else{$date.mobiscroll("disable")}}if(aCntrl.invalid){$date.addClass("xrui-date-invalid")}else{$date.removeClass("xrui-date-invalid")}});return this},_setSelectedIDfromDictionary:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var aCntrl=data.definition;if(data.kb){var aVal=data.kb.GetValue();if(aVal){aVal=$this.xrui_date("_decodedate",aVal)}else{aVal=""}data.currentVal=aVal}});return this},_selection:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");if(data.currentVal){if(Cmd_StrToDate(data.currentVal)==-1){data.currentVal=""}}return data.currentVal},setselection:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var aCntrl=data.definition;if(data.kb){var value=$this.xrui_date("_selection");var selectedDate=new Date(Cmd_StrToDate(value)*86400000);if((selectedDate<data.minValue||selectedDate>data.maxValue)&&(data.minValue<data.maxValue)){value=PSEUDO_VALUE_EMPTY}replayStack.Add(data.definition.dialog.aID,REPLAY_CHANGEEVENT,data.kb.aID,value)}})},isvalid:function(){var valid=true;this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var value=$this.xrui_date("_selection");if(data.kb){if(!data.kb.flatProps.allowblank&&data.kb.flatProps.isvisible&&data.kb.flatProps.isenabled){if(value==""){valid=false}else{var selectedDate=new Date(Cmd_StrToDate(value)*86400000);if(!data.minValue){if(data.maxValue&&(selectedDate>data.maxValue)){valid=false}}else{if(!data.maxValue){if(data.minValue&&(selectedDate<data.minValue)){valid=false}}else{if((selectedDate<data.minValue||selectedDate>data.maxValue)&&(data.minValue<data.maxValue)){valid=false}}}}}}});return valid},isInteractiveValid:function(){var valid=true;this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var $date=$("input",$this);var value=$date.val();var dateValue=new Date(Cmd_StrToDate(value)*86400000);if(data.kb){if(value){if(value!=""&&Cmd_StrToDate(value)==-1){valid="Not a date"}else{if(data.minValue===data.maxValue){}else{if(data.minValue!==null&&data.maxValue!==null){if(dateValue<data.minValue||dateValue>data.maxValue){if((data.minValue==data.maxValue)&&data.minValue===null){}else{if(data.minValue<data.maxValue){valid="("+Cmd_DateToStr(data.minValue)+" - "+Cmd_DateToStr(data.maxValue)+")"}else{valid="(Invalid Min-Max property values)"}}}}else{if(data.maxValue!==null){if(dateValue>data.maxValue){valid="(> "+Cmd_DateToStr(data.maxValue)+")"}}else{if(data.minValue!==null){if(dateValue<data.minValue){valid="(< "+Cmd_DateToStr(data.minValue)+")"}}}}}}}}});return valid},focus:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");var $date=$("input",$this);if($date.length!=1){return false}if($date.is(":visible")){return true}if($date.val()==getTranslation(appSettings.dateFormat,appSettings.dateFormat)){$date.select()}return false},designtime:function(){return{tieditem:{atype:"tied",accepted:[TYPE_DATE]},cssclassname:{atype:"css",displayname:"swatch"},showlabel:{atype:"bool",adefault:true},usepopup:{atype:"bool",adefault:true},label:"str"}},destroy:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");$this.removeData("xrui_ctrl")})}};$.fn.xrui_date=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.xrui_date")}}}})(jQuery);(function(b){b.widget("mobile.jqmMobiscroll",b.mobile.widget,{options:{theme:"jqm",preset:"date",animate:"pop"},_create:function(){var d=this.element,a=b.extend(this.options,d.jqmData("options"));d.mobiscroll(a)}});b(document).bind("pagebeforecreate",function(a){b('input[type="date"]:jqmData(role="mobiscroll")',a.target).prop("type","text")});b(document).bind("pagecreate create",function(a){b(document).trigger("mobiscrollbeforecreate");b(':jqmData(role="mobiscroll")',a.target).each(function(){"undefined"===typeof b(this).data("mobiscroll")&&b(this).jqmMobiscroll()})})})(jQuery);(function(al){function af(am,an){function aq(p){return al.isArray(ap.readonly)?(p=al(".dwwl",K).index(p),ap.readonly[p]):ap.readonly}function D(p){var u="",r;for(r in m[p]){u+='<li class="dw-v" data-val="'+r+'" style="height:'+C+"px;line-height:"+C+'px;"><div class="dw-i">'+m[p][r]+"</div></li>"}return u}function S(){var p=document.body,r=document.documentElement;return Math.max(p.scrollHeight,p.offsetHeight,r.clientHeight,r.scrollHeight,r.offsetHeight)}function ao(p){ai=al("li.dw-v",p).eq(0).index();ak=al("li.dw-v",p).eq(-1).index();G=al("ul",K).index(p);ae=C;ac=V}function N(p){var r=ap.headerText;return r?"function"==typeof r?r.call(z,p):r.replace(/\{value\}/i,p):""}function E(){V.temp=y&&(null!==V.val&&V.val!=O.val()||!O.val().length)||null===V.values?ap.parseValue(O.val()||"",V):V.values.slice(0);V.setValue(!0)}function H(u,p,r,v){B("validate",[K,p]);al(".dww ul",K).each(function(av){var Z=al(this),ay=al('li[data-val="'+V.temp[av]+'"]',Z),w=ay.index(),at=av==p||void 0===p;if(!ay.hasClass("dw-v")){for(var aw=ay,au=0,ax=0;aw.prev().length&&!aw.hasClass("dw-v");){aw=aw.prev(),au++}for(;ay.next().length&&!ay.hasClass("dw-v");){ay=ay.next(),ax++}(ax<au&&ax&&2!==v||!au||!aw.hasClass("dw-v")||1==v)&&ay.hasClass("dw-v")?w+=ax:(ay=aw,w-=au)}if(!ay.hasClass("dw-sel")||at){V.temp[av]=ay.attr("data-val"),al(".dw-sel",Z).removeClass("dw-sel"),ay.addClass("dw-sel"),V.scroll(Z,av,w,u)}});V.change(r)}function f(){function aE(){al(".dwc",K).each(function(){ay=al(this).outerWidth(!0);az+=ay;aG=ay>aG?ay:aG});ay=az>p?aG:az;ay=al(".dwwr",K).width(ay+1).outerWidth();aw=aA.outerHeight()}if("inline"!=ap.display){var az=0,aG=0,p=al(window).width(),aF=window.innerHeight,aH=al(window).scrollTop(),aA=al(".dw",K),ay,aD,aC,aw,ax,aB={},av,v=void 0===ap.anchor?O:ap.anchor,aF=aF||al(window).height();if("modal"==ap.display){aE(),aC=(p-ay)/2,aD=aH+(aF-aw)/2}else{if("bubble"==ap.display){aE();var au=v.offset(),at=al(".dw-arr",K),u=al(".dw-arrw-i",K),Z=aA.outerWidth();ax=v.outerWidth();aC=au.left-(aA.outerWidth(!0)-ax)/2;aC=aC>p-Z?p-(Z+20):aC;aC=0<=aC?aC:20;aD=au.top-(aA.outerHeight()+3);aD<aH||au.top>aH+aF?(aA.removeClass("dw-bubble-top").addClass("dw-bubble-bottom"),aD=au.top+v.outerHeight()+3,av=aD+aA.outerHeight(!0)>aH+aF||au.top>aH+aF):aA.removeClass("dw-bubble-bottom").addClass("dw-bubble-top");aD=aD>=aH?aD:aH;aH=au.left+ax/2-(aC+(Z-u.outerWidth())/2);aH>u.outerWidth()&&(aH=u.outerWidth());at.css({left:aH})}else{aB.width="100%","top"==ap.display?aD=aH:"bottom"==ap.display&&(aD=aH+aF-aA.outerHeight(),aD=0<=aD?aD:0)}}aB.top=aD;aB.left=aC;aA.css(aB);al(".dwo, .dw-persp",K).height(0).height(S());av&&al(window).scrollTop(aD+aA.outerHeight(!0)-aF)}}function B(r,p){var u;p.push(V);al.each([h,an],function(w,v){v[r]&&(u=v[r].apply(z,p))});return u}function J(p){var r=+p.data("pos")+1;ah(p,r>ak?ai:r,1)}function a(p){var r=+p.data("pos")-1;ah(p,r<ai?ak:r,2)}var V=this,d=al.mobiscroll,z=am,O=al(z),b,n,ap=T({},t),h={},ar,C,F,K,m=[],q={},y=O.is("input"),o=!1;V.enable=function(){ap.disabled=!1;y&&O.prop("disabled",!1)};V.disable=function(){ap.disabled=!0;y&&O.prop("disabled",!0)};V.scroll=function(au,v,p,Z,at,u){function w(){clearInterval(q[v]);q[v]=void 0;au.data("pos",p).closest(".dwwl").removeClass("dwa")}var av=(ar-p)*C,r,u=u||R;au.attr("style",(Z?k+"-transition:all "+Z.toFixed(1)+"s ease-out;":"")+(j?k+"-transform:translate3d(0,"+av+"px,0);":"top:"+av+"px;"));q[v]&&w();Z&&void 0!==at?(r=0,au.closest(".dwwl").addClass("dwa"),q[v]=setInterval(function(){r+=0.1;au.data("pos",Math.round((p-at)*Math.sin(r/Z*(Math.PI/2))+at));r>=Z&&(w(),u())},100),B("onAnimStart",[v,Z])):(au.data("pos",p),u())};V.setValue=function(p,u,r,v){v||(V.values=V.temp.slice(0));o&&p&&H(r);u&&(F=ap.formatResult(V.temp),V.val=F,y&&O.val(F).trigger("change"))};V.validate=function(p,r){H(0.2,p,!0,r)};V.change=function(p){F=ap.formatResult(V.temp);"inline"==ap.display?V.setValue(!1,p):al(".dwv",K).html(N(F));p&&B("onChange",[F])};V.hide=function(p){if(!1===B("onClose",[F])){return !1}al(".dwtd").prop("disabled",!1).removeClass("dwtd");O.blur();K&&("inline"!=ap.display&&ap.animate&&!p?(al(".dw",K).addClass("dw-"+ap.animate+" dw-out"),setTimeout(function(){K.remove();K=null},350)):(K.remove(),K=null),o=!1,al(window).unbind(".dw"))};V.changeWheel=function(v,r){if(K){var Z=0,p,w,u=v.length;for(p in ap.wheels){for(w in ap.wheels[p]){if(-1<al.inArray(Z,v)&&(m[Z]=ap.wheels[p][w],al("ul",K).eq(Z).html(D(Z)),u--,!u)){f();H(r);return}Z++}}}};V.show=function(u){if(ap.disabled||o){return !1}"top"==ap.display&&(ap.animate="slidedown");"bottom"==ap.display&&(ap.animate="slideup");E();B("onBeforeShow",[K]);var r=0,Z,v="",p="",w="";ap.animate&&!u&&(p='<div class="dw-persp">',w="</div>",v="dw-"+ap.animate+" dw-in");v='<div class="'+ap.theme+" dw-"+ap.display+'">'+("inline"==ap.display?'<div class="dw dwbg dwi"><div class="dwwr">':p+'<div class="dwo"></div><div class="dw dwbg '+v+'"><div class="dw-arrw"><div class="dw-arrw-i"><div class="dw-arr"></div></div></div><div class="dwwr">'+(ap.headerText?'<div class="dwv"></div>':""));for(u=0;u<ap.wheels.length;u++){v+='<div class="dwc'+("scroller"!=ap.mode?" dwpm":" dwsc")+(ap.showLabel?"":" dwhl")+'"><div class="dwwc dwrc"><table cellpadding="0" cellspacing="0"><tr>';for(Z in ap.wheels[u]){m[r]=ap.wheels[u][Z],v+='<td><div class="dwwl dwrc dwwl'+r+'">'+("scroller"!=ap.mode?'<div class="dwwb dwwbp" style="height:'+C+"px;line-height:"+C+'px;"><span>+</span></div><div class="dwwb dwwbm" style="height:'+C+"px;line-height:"+C+'px;"><span>&ndash;</span></div>':"")+'<div class="dwl">'+Z+'</div><div class="dww dwrc" style="height:'+ap.rows*C+"px;min-width:"+ap.width+'px;"><ul>',v+=D(r),v+='</ul><div class="dwwo"></div></div><div class="dwwol"></div></div></td>',r++}v+="</tr></table></div></div>"}v+=("inline"!=ap.display?'<div class="dwbc'+(ap.button3?" dwbc-p":"")+'"><span class="dwbw dwb-s"><span class="dwb">'+ap.setText+"</span></span>"+(ap.button3?'<span class="dwbw dwb-n"><span class="dwb">'+ap.button3Text+"</span></span>":"")+'<span class="dwbw dwb-c"><span class="dwb">'+ap.cancelText+"</span></span></div>"+w:'<div class="dwcc"></div>')+"</div></div></div>";K=al(v);H();"inline"!=ap.display?K.appendTo("body"):O.is("div")?O.html(K):K.insertAfter(O);o=!0;"inline"!=ap.display&&(al(".dwb-s span",K).click(function(){if(V.hide()!==false){V.setValue(false,true);B("onSelect",[V.val])}return false}),al(".dwb-c span",K).click(function(){V.hide()!==false&&B("onCancel",[V.val]);return false}),ap.button3&&al(".dwb-n span",K).click(ap.button3),ap.scrollLock&&K.bind("touchmove",function(at){at.preventDefault()}),al("input,select").each(function(){al(this).prop("disabled")||al(this).addClass("dwtd")}),al("input,select").prop("disabled",!0),f(),al(window).bind("resize.dw",f));K.delegate(".dwwl","DOMMouseScroll mousewheel",function(au){if(!aq(this)){au.preventDefault();var au=au.originalEvent,au=au.wheelDelta?au.wheelDelta/120:au.detail?-au.detail/3:0,av=al("ul",this),at=+av.data("pos"),at=Math.round(at-au);ao(av);ah(av,at,au<0?1:2)}}).delegate(".dwb, .dwwb",l,function(){al(this).addClass("dwb-a")}).delegate(".dwwb",l,function(au){var at=al(this).closest(".dwwl");if(!aq(at)&&!at.hasClass("dwa")){au.preventDefault();au.stopPropagation();var av=at.find("ul"),aw=al(this).hasClass("dwwbp")?J:a;aj=true;ao(av);clearInterval(ag);ag=setInterval(function(){aw(av)},ap.delay);aw(av)}}).delegate(".dwwl",l,function(at){at.preventDefault();if(!ad&&!aq(this)&&!aj&&ap.mode!="clickpick"){ad=true;aa=al("ul",this);aa.closest(".dwwl").addClass("dwa");Y=+aa.data("pos");ao(aa);A=q[G]!==void 0;x=W(at);P=new Date;U=x;V.scroll(aa,G,Y)}});B("onShow",[K,F]);b.init(K,V)};V.init=function(p){b=T({defaults:{},init:R},d.themes[p.theme||ap.theme]);n=d.i18n[p.lang||ap.lang];T(an,p);T(ap,b.defaults,n,an);V.settings=ap;O.unbind(".dw");if(p=d.presets[ap.preset]){h=p.call(z,V),T(ap,h,an),T(I,h.methods)}ar=Math.floor(ap.rows/2);C=ap.height;void 0!==O.data("dwro")&&(z.readOnly=g(O.data("dwro")));o&&V.hide();"inline"==ap.display?V.show():(E(),y&&ap.showOnFocus&&(O.data("dwro",z.readOnly),z.readOnly=!0,O.bind("focus.dw",function(){V.show()})))};V.values=null;V.val=null;V.temp=null;V.init(an)}function Q(f){for(var d in f){if(void 0!==e[f[d]]){return !0}}return !1}function W(f){var d=f.originalEvent,h=f.changedTouches;return h||d&&d.changedTouches?d?d.changedTouches[0].pageY:h[0].pageY:f.pageY}function g(b){return !0===b||"true"==b}function L(f,d,h){f=f>h?h:f;return f<d?d:f}function ah(b,q,o,a,m){var q=L(q,ai,ak),d=al("li",b).eq(q),p=G,a=a?q==m?0.1:Math.abs(0.1*(q-m)):0;ac.scroll(b,p,q,a,m,function(){ac.temp[p]=d.attr("data-val");ac.validate(p,o)})}function X(f,d,h){return I[d]?I[d].apply(f,Array.prototype.slice.call(h,1)):"object"===typeof d?I.init.call(f,d):f}var ab={},ag,R=function(){},ae,ai,ak,ac,M=(new Date).getTime(),ad,aj,aa,G,x,U,P,Y,A,e=document.createElement("modernizr").style,j=Q(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]),k=function(){var f=["Webkit","Moz","O","ms"],d;for(d in f){if(Q([f[d]+"Transform"])){return"-"+f[d].toLowerCase()}}return""}(),T=al.extend,l="touchstart mousedown",t={width:70,height:40,rows:3,delay:300,disabled:!1,readonly:!1,showOnFocus:!0,showLabel:!0,wheels:[],theme:"",headerText:"{value}",display:"modal",mode:"scroller",preset:"",lang:"en-US",setText:"Set",cancelText:"Cancel",scrollLock:!0,formatResult:function(b){return b.join(" ")},parseValue:function(z,y){var u=y.settings.wheels,w=z.split(" "),v=[],r=0,q,o,p;for(q=0;q<u.length;q++){for(o in u[q]){if(void 0!==u[q][o][w[r]]){v.push(w[r])}else{for(p in u[q][o]){v.push(p);break}}r++}}return v}},I={init:function(b){void 0===b&&(b={});return this.each(function(){this.id||(M+=1,this.id="scoller"+M);ab[this.id]=new af(this,b)})},enable:function(){return this.each(function(){var b=ab[this.id];b&&b.enable()})},disable:function(){return this.each(function(){var b=ab[this.id];b&&b.disable()})},isDisabled:function(){var b=ab[this[0].id];if(b){return b.settings.disabled}},option:function(f,d){return this.each(function(){var a=ab[this.id];if(a){var b={};"object"===typeof f?b=f:b[f]=d;a.init(b)}})},setValue:function(f,d,h,m){return this.each(function(){var a=ab[this.id];a&&(a.temp=f,a.setValue(!0,d,h,m))})},getInst:function(){return ab[this[0].id]},getValue:function(){var b=ab[this[0].id];if(b){return b.values}},show:function(){var b=ab[this[0].id];if(b){return b.show()}},hide:function(){return this.each(function(){var b=ab[this.id];b&&b.hide()})},destroy:function(){return this.each(function(){var a=ab[this.id];a&&(a.hide(),al(this).unbind(".dw"),delete ab[this.id],al(this).is("input")&&(this.readOnly=g(al(this).data("dwro"))))})}};al(document).bind("touchmove mousemove",function(b){ad&&(b.preventDefault(),U=W(b),ac.scroll(aa,G,L(Y+(x-U)/ae,ai-1,ak+1)),A=!0)});al(document).bind("touchend mouseup",function(b){if(ad){b.preventDefault();var d=new Date-P,b=L(Y+(x-U)/ae,ai-1,ak+1),f;f=aa.offset().top;300>d?(d=(U-x)/d,d=d*d/0.0012,0>U-x&&(d=-d)):d=U-x;if(!d&&!A){f=Math.floor((U-f)/ae);var a=al("li",aa).eq(f);a.addClass("dw-hl");setTimeout(function(){a.removeClass("dw-hl")},200)}else{f=Math.round(Y-d/ae)}ah(aa,f,0,!0,Math.round(b));ad=!1;aa=null}aj&&(clearInterval(ag),aj=!1);al(".dwb-a").removeClass("dwb-a")});al.fn.mobiscroll=function(a){T(this,al.mobiscroll.shorts);return X(this,a,arguments)};al.mobiscroll=al.mobiscroll||{setDefaults:function(b){T(t,b)},presetShort:function(b){this.shorts[b]=function(a){return X(this,T(a,{preset:b}),arguments)}},shorts:{},presets:{},themes:{},i18n:{}};al.scroller=al.scroller||al.mobiscroll;al.fn.scroller=al.fn.scroller||al.fn.mobiscroll})(jQuery);(function(d){var f=d.mobiscroll,e=new Date,g={dateFormat:"mm/dd/yy",dateOrder:"mmddy",timeWheels:"hhiiA",timeFormat:"hh:ii A",startYear:e.getFullYear()-100,endYear:e.getFullYear()+1,monthNames:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),monthNamesShort:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),dayNames:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),dayNamesShort:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),shortYearCutoff:"+10",monthText:"Month",dayText:"Day",yearText:"Year",hourText:"Hours",minuteText:"Minutes",secText:"Seconds",ampmText:"&nbsp;",nowText:"Now",showNow:!1,stepHour:1,stepMinute:1,stepSecond:1,separator:" "},b=function(L){function af(j,h,k){return void 0!==aa[h]?+j[aa[h]]:void 0!==k?k:a[X[h]]?a[X[h]]():X[h](a)}function V(j,h){return Math.floor(j/h)*h}function Y(j){var h=af(j,"h",0);return new Date(af(j,"y"),af(j,"m"),af(j,"d",1),af(j,"ap")?h+12:h,af(j,"i",0),af(j,"s",0))}var ae=d(this),R={},ab;if(ae.is("input")){switch(ae.attr("type")){case"date":ab="yy-mm-dd";break;case"datetime":ab="yy-mm-ddTHH:ii:ssZ";break;case"datetime-local":ab="yy-mm-ddTHH:ii:ss";break;case"month":ab="yy-mm";R.dateOrder="mmyy";break;case"time":ab="HH:ii:ss"}var ag=ae.attr("min"),ae=ae.attr("max");ag&&(R.minDate=f.parseDate(ab,ag));ae&&(R.maxDate=f.parseDate(ab,ae))}var ai=d.extend({},g,R,L.settings),Z=0,R=[],M=[],aa={},ah,X={y:"getFullYear",m:"getMonth",d:"getDate",h:function(h){h=h.getHours();h=C&&12<=h?h-12:h;return V(h,l)},i:function(h){return V(h.getMinutes(),T)},s:function(h){return V(h.getSeconds(),t)},ap:function(h){return W&&11<h.getHours()?1:0}},G=ai.preset,A=ai.dateOrder,U=ai.timeWheels,Q=A.match(/D/),W=U.match(/a/i),C=U.match(/h/),P="datetime"==G?ai.dateFormat+ai.separator+ai.timeFormat:"time"==G?ai.timeFormat:ai.dateFormat,a=new Date,l=ai.stepHour,T=ai.stepMinute,t=ai.stepSecond,x=ai.minDate||new Date(ai.startYear,0,1),I=ai.maxDate||new Date(ai.endYear,11,31,23,59,59);ab=ab||P;if(G.match(/date/i)){d.each(["y","m","d"],function(j,h){ah=A.search(RegExp(h,"i"));-1<ah&&M.push({o:ah,v:h})});M.sort(function(j,h){return j.o>h.o?1:-1});d.each(M,function(j,h){aa[h.v]=j});ag={};for(ae=0;3>ae;ae++){if(ae==aa.y){Z++;ag[ai.yearText]={};var ac=x.getFullYear(),ad=I.getFullYear();for(ah=ac;ah<=ad;ah++){ag[ai.yearText][ah]=A.match(/yy/i)?ah:(ah+"").substr(2,2)}}else{if(ae==aa.m){Z++;ag[ai.monthText]={};for(ah=0;12>ah;ah++){ac=A.replace(/[dy]/gi,"").replace(/mm/,9>ah?"0"+(ah+1):ah+1).replace(/m/,ah),ag[ai.monthText][ah]=ac.match(/MM/)?ac.replace(/MM/,'<span class="dw-mon">'+ai.monthNames[ah]+"</span>"):ac.replace(/M/,'<span class="dw-mon">'+ai.monthNamesShort[ah]+"</span>")}}else{if(ae==aa.d){Z++;ag[ai.dayText]={};for(ah=1;32>ah;ah++){ag[ai.dayText][ah]=A.match(/dd/i)&&10>ah?"0"+ah:ah}}}}}R.push(ag)}if(G.match(/time/i)){M=[];d.each(["h","i","s"],function(j,h){j=U.search(RegExp(h,"i"));-1<j&&M.push({o:j,v:h})});M.sort(function(j,h){return j.o>h.o?1:-1});d.each(M,function(j,h){aa[h.v]=Z+j});ag={};for(ae=Z;ae<Z+3;ae++){if(ae==aa.h){Z++;ag[ai.hourText]={};for(ah=0;ah<(C?12:24);ah+=l){ag[ai.hourText][ah]=C&&0==ah?12:U.match(/hh/i)&&10>ah?"0"+ah:ah}}else{if(ae==aa.i){Z++;ag[ai.minuteText]={};for(ah=0;60>ah;ah+=T){ag[ai.minuteText][ah]=U.match(/ii/)&&10>ah?"0"+ah:ah}}else{if(ae==aa.s){Z++;ag[ai.secText]={};for(ah=0;60>ah;ah+=t){ag[ai.secText][ah]=U.match(/ss/)&&10>ah?"0"+ah:ah}}}}}W&&(aa.ap=Z++,ae=U.match(/A/),ag[ai.ampmText]={"0":ae?"AM":"am",1:ae?"PM":"pm"});R.push(ag)}L.setDate=function(j,h,n,m){for(var k in aa){this.temp[aa[k]]=j[X[k]]?j[X[k]]():X[k](j)}this.setValue(!0,h,n,m)};L.getDate=function(h){return Y(h)};return{button3Text:ai.showNow?ai.nowText:void 0,button3:ai.showNow?function(){L.setDate(new Date,!1,0.3,!0)}:void 0,wheels:R,headerText:function(){return f.formatDate(P,Y(L.temp),ai)},formatResult:function(h){return f.formatDate(ab,Y(h),ai)},parseValue:function(j){var o=new Date,n,m=[];try{o=f.parseDate(ab,j,ai)}catch(k){}for(n in aa){m[aa[n]]=o[X[n]]?o[X[n]]():X[n](o)}return m},validate:function(u){var r=L.temp,q={y:x.getFullYear(),m:0,d:1,h:0,i:0,s:0,ap:0},o={y:I.getFullYear(),m:11,d:31,h:V(C?11:23,l),i:V(59,T),s:V(59,t),ap:1},p=!0,n=!0;d.each("y,m,d,ap,h,i,s".split(","),function(m,D){if(aa[D]!==void 0){var k=q[D],N=o[D],h=31,z=af(r,D),j=d("ul",u).eq(aa[D]),ak,O;if(D=="d"){ak=af(r,"y");O=af(r,"m");N=h=32-(new Date(ak,O,32)).getDate();Q&&d("li",j).each(function(){var y=d(this),w=y.data("val"),v=(new Date(ak,O,w)).getDay(),w=A.replace(/[my]/gi,"").replace(/dd/,w<10?"0"+w:w).replace(/d/,w);d(".dw-i",y).html(w.match(/DD/)?w.replace(/DD/,'<span class="dw-day">'+ai.dayNames[v]+"</span>"):w.replace(/D/,'<span class="dw-day">'+ai.dayNamesShort[v]+"</span>"))})}p&&x&&(k=x[X[D]]?x[X[D]]():X[D](x));n&&I&&(N=I[X[D]]?I[X[D]]():X[D](I));if(D!="y"){var H=d('li[data-val="'+k+'"]',j).index(),aj=d('li[data-val="'+N+'"]',j).index();d("li",j).removeClass("dw-v").slice(H,aj+1).addClass("dw-v");D=="d"&&d("li",j).removeClass("dw-h").slice(h).addClass("dw-h")}z<k&&(z=k);z>N&&(z=N);p&&(p=z==k);n&&(n=z==N);if(ai.invalid&&D=="d"){var F=[];ai.invalid.dates&&d.each(ai.invalid.dates,function(w,v){v.getFullYear()==ak&&v.getMonth()==O&&F.push(v.getDate()-1)});if(ai.invalid.daysOfWeek){var K=(new Date(ak,O,1)).getDay(),S;d.each(ai.invalid.daysOfWeek,function(w,v){for(S=v-K;S<h;S=S+7){S>=0&&F.push(S)}})}ai.invalid.daysOfMonth&&d.each(ai.invalid.daysOfMonth,function(w,v){v=(v+"").split("/");v[1]?v[0]-1==O&&F.push(v[1]-1):F.push(v[0]-1)});d.each(F,function(v,w){d("li",j).eq(w).removeClass("dw-v")})}r[aa[D]]=z}})},methods:{getDate:function(h){var j=d(this).mobiscroll("getInst");if(j){return j.getDate(h?j.temp:j.values)}},setDate:function(h,m,k,j){void 0==m&&(m=!1);return this.each(function(){var n=d(this).mobiscroll("getInst");n&&n.setDate(h,m,k,j)})}}}};d.each(["date","time","datetime"],function(h,j){f.presets[j]=b;f.presetShort(j)});f.formatDate=function(n,t,a){if(!t){return null}var a=d.extend({},g,a),j=function(m){for(var h=0;l+1<n.length&&n.charAt(l+1)==m;){h++,l++}return h},q=function(m,h,o){h=""+h;if(j(m)){for(;h.length<o;){h="0"+h}}return h},x=function(m,h,p,o){return j(m)?o[h]:p[h]},l,v="",w=!1;for(l=0;l<n.length;l++){if(w){"'"==n.charAt(l)&&!j("'")?w=!1:v+=n.charAt(l)}else{switch(n.charAt(l)){case"d":v+=q("d",t.getDate(),2);break;case"D":v+=x("D",t.getDay(),a.dayNamesShort,a.dayNames);break;case"o":v+=q("o",(t.getTime()-(new Date(t.getFullYear(),0,0)).getTime())/86400000,3);break;case"m":v+=q("m",t.getMonth()+1,2);break;case"M":v+=x("M",t.getMonth(),a.monthNamesShort,a.monthNames);break;case"y":v+=j("y")?t.getFullYear():(10>t.getYear()%100?"0":"")+t.getYear()%100;break;case"h":var k=t.getHours(),v=v+q("h",12<k?k-12:0==k?12:k,2);break;case"H":v+=q("H",t.getHours(),2);break;case"i":v+=q("i",t.getMinutes(),2);break;case"s":v+=q("s",t.getSeconds(),2);break;case"a":v+=11<t.getHours()?"pm":"am";break;case"A":v+=11<t.getHours()?"PM":"AM";break;case"'":j("'")?v+="'":w=!0;break;default:v+=n.charAt(l)}}}return v};f.parseDate=function(G,I,x){var B=new Date;if(!G||!I){return B}var I="object"==typeof I?I.toString():I+"",H=d.extend({},g,x),t=H.shortYearCutoff,x=B.getFullYear(),E=B.getMonth()+1,J=B.getDate(),L=-1,C=B.getHours(),B=B.getMinutes(),k=0,D=-1,K=!1,A=function(h){(h=l+1<G.length&&G.charAt(l+1)==h)&&l++;return h},j=function(h){A(h);h=I.substr(w).match(RegExp("^\\d{1,"+("@"==h?14:"!"==h?20:"y"==h?4:"o"==h?3:2)+"}"));if(!h){return 0}w+=h[0].length;return parseInt(h[0],10)},a=function(m,h,n){m=A(m)?n:h;for(h=0;h<m.length;h++){if(I.substr(w,m[h].length).toLowerCase()==m[h].toLowerCase()){return w+=m[h].length,h+1}}return 0},w=0,l;for(l=0;l<G.length;l++){if(K){"'"==G.charAt(l)&&!A("'")?K=!1:w++}else{switch(G.charAt(l)){case"d":J=j("d");break;case"D":a("D",H.dayNamesShort,H.dayNames);break;case"o":L=j("o");break;case"m":E=j("m");break;case"M":E=a("M",H.monthNamesShort,H.monthNames);break;case"y":x=j("y");break;case"H":C=j("H");break;case"h":C=j("h");break;case"i":B=j("i");break;case"s":k=j("s");break;case"a":D=a("a",["am","pm"],["am","pm"])-1;break;case"A":D=a("A",["am","pm"],["am","pm"])-1;break;case"'":A("'")?w++:K=!0;break;default:w++}}}100>x&&(x+=(new Date).getFullYear()-(new Date).getFullYear()%100+(x<=("string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10))?0:-100));if(-1<L){E=1;J=L;do{H=32-(new Date(x,E-1,32)).getDate();if(J<=H){break}E++;J-=H}while(1)}C=new Date(x,E-1,J,-1==D?C:D&&12>C?C+12:!D&&12==C?0:C,B,k);if(C.getFullYear()!=x||C.getMonth()+1!=E||C.getDate()!=J){throw"Invalid date"}return C}})(jQuery);(function(b){b.mobiscroll.themes.jqm={defaults:{jqmBody:"c",jqmHeader:"b",jqmWheel:"d",jqmClickPick:"c",jqmSet:"b",jqmCancel:"c"},init:function(d,a){var e=a.settings;b(".dw",d).removeClass("dwbg").addClass("ui-overlay-shadow ui-corner-all ui-body-a");b(".dwb-s span",d).attr("data-role","button").attr("data-theme",e.jqmSet);b(".dwb-n span",d).attr("data-role","button").attr("data-theme",e.jqmCancel);b(".dwb-c span",d).attr("data-role","button").attr("data-theme",e.jqmCancel);b(".dwwb",d).attr("data-role","button").attr("data-theme",e.jqmClickPick);b(".dwv",d).addClass("ui-header ui-bar-"+e.jqmHeader);b(".dwwr",d).addClass("ui-body-"+e.jqmBody);b(".dwpm .dww",d).addClass("ui-body-"+e.jqmWheel);"inline"!=e.display&&b(".dw",d).addClass("pop in");d.trigger("create");b(".dwo",d).click(function(){a.hide()})}}})(jQuery);(function($){var methods={init:function(options){this.each(function(){var data={definition:null,kb:null,changeCB:null,tiedDlgObj:0,selectedID:0,jqmPatched:false};$.extend(data,options);var $this=$(this);var aCntrl=data.definition;var aDescr;data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));if(data.kb){if(aCntrl.showsearch){var $fwrap=$("<div></div>").addClass("xrui-listbox-filter").appendTo($this);if(aCntrl.showlabel){$legend=$("<div></div>").addClass("ui-controlgroup-label");if(aCntrl.label!=""){aDescr=aCntrl.dialog.expandEmbedded(aCntrl.label)}else{aDescr=(data.kb?data.kb.GetDescription(true):"Description")}aCntrl.dialog.populateLabel($legend,aDescr,aCntrl.ishtml);$legend.appendTo($fwrap)}data.$filter=$('<input data-type="search">').appendTo($fwrap).keyup(function(){$this.xrui_dropdown("populate")})}var $fieldset=$("<fieldset></fieldset>");$fieldset.attr("data-role","controlgroup").appendTo($this);if(!data.kb.flatProps.allowblank){$this.addClass("xrkb-obligatory");$("<div class='xrkb-obligatory-marker'></div>").appendTo($fieldset)}var doneChange=false;if(aCntrl.showlabel){var $legend=$("<legend></legend>");if(!aCntrl.showsearch){if(aCntrl.label!=""){aDescr=aCntrl.dialog.expandEmbedded(aCntrl.label)}else{aDescr=(data.kb?data.kb.GetDescription(true):"Description")}aCntrl.dialog.populateLabel($legend,aDescr,aCntrl.ishtml)}$legend.appendTo($fieldset)}else{$this.addClass("xrui-nocaption")}$.mobile.selectmenu.prototype.options.hidePlaceholderMenuItems=false;var mobileDevice=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);var onHTMLdialog=aCntrl.dialog.definition.hasOwnProperty("dialogMode")&&(aCntrl.dialog.definition.dialogMode=="html");var $input=$("<select></select>");$input.attr("id","mySelect").attr("name","mySelect").attr("data-theme",aCntrl.cssclassname.name).addClass("xrui-dropdown").attr("data-native-menu",(mobileDevice&&onHTMLdialog)||(!aCntrl.showinline&&(mobileDevice&&!data.kb.isMultiSel))).change(function(ev,ui){if($.isFunction(data.changeCB)){var val=0;if(data.kb.isMultiSel){val=$(this).val();for(var c=0;c<val.length;c++){val[c]=parseInt(val[c],10)}}else{val=parseInt(ev.currentTarget.value,10);if(val>0){if(!data.kb.aValues[data.kb.ValueIDtoIndex(val)].valid&&!data.kb.flatProps.allowinvalid){val=data.selectedID;$input.val(val)}}}data.selectedID=val;data.clicked=true;data.changeCB(data.definition);data.clicked=false}}).appendTo($fieldset);if(aCntrl.jqmattributes){var a=aCntrl.jqmattributes;if(a.substr(0,1)=="'"){a=eval(a)}try{a=JSON.parse("{"+a+"}");$input.attr(a)}catch(e){}}if(data.kb.isMultiSel){$input.attr("multiple","multiple")}if(aCntrl.showinline){$("<div></div>").addClass("xrui-dropdown-inline-wrap").appendTo($fieldset)}data.$helpDiv=data.definition.dialog.renderHelp($this,data.kb)}if(aCntrl.tabno>0){$this.attr("tabindex",aCntrl.tabno)}$this.data("xrui_ctrl",data)});return this},gettied:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");return data.kb},getSubCtrlLists:function(){return null},postJQMcreate:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");if(data.jqmPatched){return}data.jqmPatched=true;var aCntrl=data.definition;if(aCntrl.showinline){var $inline=$this.find(".xrui-dropdown-inline-wrap");if($inline.is(":visible")){$this.find(".ui-select .ui-btn").removeClass("ui-corner-bottom ui-controlgroup-last");$this.find(".ui-select .ui-icon").removeClass("ui-icon-arrow-d").addClass("ui-icon-arrow-u")}else{$this.find(".ui-select .ui-btn").addClass("ui-corner-bottom ui-controlgroup-last");$this.find(".ui-select .ui-icon").removeClass("ui-icon-arrow-u").addClass("ui-icon-arrow-d")}$this.find("a.ui-btn").unbind("vclick keydown").unbind("navigate").click(function(ev){if(!$inline.is(":visible")){$inline.show();$this.find(".ui-select .ui-btn").removeClass("ui-corner-bottom ui-controlgroup-last");$this.find(".ui-select .ui-icon").removeClass("ui-icon-arrow-d").addClass("ui-icon-arrow-u")}else{$inline.hide();$this.find(".ui-select .ui-btn").addClass("ui-corner-bottom ui-controlgroup-last");$this.find(".ui-select .ui-icon").removeClass("ui-icon-arrow-u").addClass("ui-icon-arrow-d")}ev.preventDefault()})}})},populate:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var aCntrl=data.definition;var $lb=$("select",$this);if($lb.length!=1){return}var c;if(data.clicked&&!jsAjax){$lb.parent().removeClass("xrui-dropdown-invalid");if(data.selectedID&&!data.kb.IsValueValid(data.selectedID)){$this.addClass("xrui-dropdown-invalidvalue")}else{$this.removeClass("xrui-dropdown-invalidvalue")}return}var $inline=null;if(aCntrl.showinline){$inline=$this.find(".xrui-dropdown-inline-wrap");if($inline.is(":visible")){$this.find(".ui-select .ui-btn").removeClass("ui-corner-bottom ui-controlgroup-last");$this.find(".ui-select .ui-icon").removeClass("ui-icon-arrow-d").addClass("ui-icon-arrow-u")}else{$this.find(".ui-select .ui-btn").addClass("ui-corner-bottom ui-controlgroup-last");$this.find(".ui-select .ui-icon").removeClass("ui-icon-arrow-u").addClass("ui-icon-arrow-d")}}if(data.kb){var vals=$.extend(true,[],data.kb.aValues);if(data.$filter){var f=data.$filter.val().toLowerCase();if(f.length>0){for(c=vals.length-1;c>=0;c--){var tt=data.kb.GetValueDescr(data.kb.ValueIDtoIndex(vals[c].aID)).toLowerCase();if(tt.indexOf(f)==-1){vals.splice(c,1)}}}}if(data.kb.flatProps.sortinvalid){vals.sort(sortfunction2)}if(!data.kb.flatProps.showinvalid){for(c=vals.length-1;c>=0;c--){if(!vals[c].valid){vals.splice(c,1)}}}var hiddenValueProp=!data.kb.flatProps.hasOwnProperty("hiddenvaluesprop")?null:data.kb.flatProps.hiddenvaluesprop==""?null:data.kb.flatProps.hiddenvaluesprop;for(c=vals.length-1;c>=0;c--){if((vals[c].visible===false)||(hiddenValueProp&&vals[c][hiddenValueProp]===true)){vals.splice(c,1)}}var firstPopulate=(data.lastValues==null);var changed=firstPopulate;if(!changed){changed=data.lastValues.length!=vals.length}if(!changed){for(c=0;(c<data.lastValues.length)&&!changed;c++){if(c>=vals.length){changed=true}else{if(data.lastValues[c].aID!=vals[c].aID){changed=true}else{if(data.lastValues[c].valid!=vals[c].valid){changed=true}}}}}if(changed){data.lastValues=vals;if($inline){$inline.empty()}$lb.empty();data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));var $opt=$("<option></option>").attr("data-placeholder","true");if(data.kb.isMultiSel){$opt.text(data.kb.GetDescription(true))}else{var emptyTxt="";if(aCntrl.emptytext){emptyTxt=aCntrl.dialog.expandEmbedded(aCntrl.emptytext)}if(emptyTxt.length==0){emptyTxt=getTranslation("dropdown_deselected_text","No Selection")}$opt.attr("value","0");if(aCntrl.ishtml){$opt.html(emptyTxt)}else{$opt.text(emptyTxt)}}$lb.append($opt);for(c=0;c<vals.length;c++){var $o=$("<option></option>").attr("value",vals[c].aID);var t=data.kb.GetValueDescr(data.kb.ValueIDtoIndex(vals[c].aID));if(!vals[c].valid){t="["+t+"]!"}if(aCntrl.ishtml){$o.html(t)}else{$o.text(t)}$lb.append($o);if($inline){var $input=$("<input></input>");$inline.append($input.attr("name",aCntrl.aName+"_rd").attr("id",aCntrl.aName+"_rd"+c).attr("type",(data.kb.isMultiSel?"checkbox":"radio")).attr("value",vals[c].aID).attr("data-theme",aCntrl.cssclassname.name).change(function(ev){$this.find("a.ui-btn").click();var vid=parseInt($(this).attr("value"),10);$lb.val(vid).selectmenu("refresh").change()}));var $label=$("<label></label>").attr("for",aCntrl.aName+"_rd"+c).attr("id",aCntrl.aName+"_rdlbl"+c).appendTo($inline);t=data.kb.GetValueDescr(data.kb.ValueIDtoIndex(vals[c].aID));if(aCntrl.ishtml){$label.html(t)}else{$label.text(t)}}}}data.selectedID=data.kb.GetValue();var aVal=data.selectedID;if($.isArray(aVal)){for(c=0;c<aVal.length;c++){$lb.val(aVal[c]);if(!firstPopulate){$lb.val(aVal[c]).selectmenu("refresh",true)}}}else{$lb.val(aVal);if(!firstPopulate&&!isEditor){$lb.selectmenu("refresh",true)}if(aVal&&!data.kb.IsValueValid(aVal)){$this.addClass("xrui-dropdown-invalidvalue")}else{$this.removeClass("xrui-dropdown-invalidvalue")}if($inline){$inline.find("input[value="+aVal+"]").attr("checked","checked");if(!firstPopulate&&!isEditor){$inline.find("input").checkboxradio("refresh")}}}if(!data.kb.flatProps.isvisible){$this.hide();if(data.$helpDiv){data.$helpDiv.hide()}}else{$this.show();if(data.$helpDiv){data.$helpDiv.show()}}if(!data.kb.flatProps.isenabled){if(firstPopulate){$lb.attr("disabled",true)}else{$lb.selectmenu("disable")}}else{if(firstPopulate){$lb.removeAttr("disabled")}else{$lb.selectmenu("enable")}}if(aCntrl.invalid){$lb.parent().addClass("xrui-dropdown-invalid")}else{$lb.parent().removeClass("xrui-dropdown-invalid")}}});return this},setselection:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");if(data.kb){replayStack.Add(data.definition.dialog.aID,REPLAY_CHANGEEVENT,data.kb.aID,data.selectedID)}})},isvalid:function(){var valid=true;this.each(function(){var selectedID=0;var $this=$(this);var $lb=$("select",$this);var data=$this.data("xrui_ctrl");if($lb.find("option").length==0){selectedID=data.kb.GetValue()}else{selectedID=data.selectedID}valid=data.definition.dialog.isValueValid(data.kb,selectedID)});return valid},focus:function(){var $this=$(this.get(0));var $lb=$("select",$this);if($lb.length!=1){return false}if($lb.is(":visible")){$lb.focus();return true}return false},designtime:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");if(data&&data.kb&&data.kb.isMultiSel){return{tieditem:{atype:"tied",accepted:[TYPE_LIST,TYPE_BOOLEAN]},excludemode:{atype:"enum",vals:["showinvalid"]},cssclassname:{atype:"css",displayname:"swatch"},showlabel:{atype:"bool",adefault:true},showinline:{atype:"bool",adefault:false},showsearch:{atype:"bool",adefault:false},label:"str",jqmattributes:"str",ishtml:{atype:"bool",adefault:false}}}return{tieditem:{atype:"tied",accepted:[TYPE_LIST,TYPE_BOOLEAN]},excludemode:{atype:"enum",vals:["showinvalid"]},cssclassname:{atype:"css",displayname:"swatch"},emptytext:"str",showinline:"bool",showlabel:"bool",showsearch:"bool",label:"str",jqmattributes:"str",ishtml:{atype:"bool",adefault:false}}},destroy:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");$this.removeData("xrui_ctrl")})}};$.fn.xrui_dropdown=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.xrui-dropdown")}}}})(jQuery);(function($){var methods={init:function(options){this.each(function(){var data={definition:null,kb:null,changeCB:null,tiedDlgObj:0,currentID:0,columns:null,sortDir:1,sortCol:-1,lastValues:null,lastID:0};$.extend(data,options);var $this=$(this);$this.data("xrui_ctrl",data);data.kb=dictionary.GetObject(data.definition.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));var aCntrl=data.definition;var $fieldset=$("<fieldset></fieldset>");$fieldset.attr("data-role","controlgroup").appendTo($this);if(aCntrl.showlabel){var aDescr;if(aCntrl.label!=""){aDescr=aCntrl.dialog.expandEmbedded(aCntrl.label)}else{aDescr=data.kb?data.kb.GetDescription(true):""}var $legend=$("<legend></legend>");aCntrl.dialog.populateLabel($legend,aDescr,aCntrl.ishtml);$legend.appendTo($fieldset)}else{$this.addClass("xrui-nocaption")}var cName="";cName=(aCntrl.cssclassname?aCntrl.cssclassname.name:"");if(cName.substr(0,1)=="'"){cName=eval(cName)}if(cName.length>0){$this.addClass(cName)}if(aCntrl.cssclassname&&aCntrl.cssclassname.dowysiwyg&&!appSettings.noStyleProps){if(!aCntrl.applydialogfont){$this.css(aCntrl.dialog.fontToStyleObj(aCntrl.font))}}if(data.kb){if(!data.kb.flatProps.allowblank){$this.addClass("xrkb-obligatory");$("<div class='xrkb-obligatory-marker'></div>").appendTo($fieldset)}var VSCROLL_WIDTH=19;var w=aCntrl.width;var cwidths=0;var columns=[];var propIdx;var c;var dispOrder=data.kb.getDisplayOrder();var defSort=(data.kb.flatProps.sortproperty?data.kb.flatProps.sortproperty:"");var defSortDir;if(data.kb.flatProps.sortdirection=="Ascending"){defSortDir=1}else{defSortDir=2}if(defSort!=""){for(c=0;c<dispOrder.length;c++){propIdx=dispOrder[c];if(data.kb.aValueProps.list[propIdx].realName.toLowerCase()==defSort.toLowerCase()){data.sortCol=c;data.sortDir=defSortDir}}}for(c=0;c<dispOrder.length;c++){propIdx=dispOrder[c];var colWidth=data.kb.aValueProps.list[propIdx].width;if((colWidth===undefined)||(colWidth==0)){colWidth=80}var ss=(data.kb.aValueProps.list[propIdx].aDescription.length==0?data.kb.aValueProps.list[propIdx].realName:data.kb.aValueProps.list[propIdx].aDescription);var sss=data.kb.aValueProps.list[propIdx].aName;var ty=data.kb.aValueProps.list[propIdx].aType;ty=data.kb.aValueProps.list[propIdx];if(ss.length==0){ss=sss}if(c<dispOrder.length-1){cwidths+=colWidth}else{colWidth=(w-VSCROLL_WIDTH)-cwidths}columns[columns.length]={id:ty,name:ss,field:sss,width:colWidth,sortable:true}}data.columns=columns;var $table=$("<table></table>");$table.attr("data-role","table").attr("cellspacing","0").attr("cellpadding","0").attr("border","0").attr("data-mode","reflow").addClass("xrui-mgrid-table").appendTo($fieldset);if(aCntrl.hascaption){var $thead=$("<thead></thead>");$thead.appendTo($table);var $tr=$("<tr></tr>");$tr.appendTo($thead);if(!aCntrl.readonly){var $canwrite=$("<th></th>");$canwrite.addClass("xrui-mgrid-table-header-check ui-bar-c").html("&nbsp;").appendTo($tr)}for(c=0;c<columns.length;c++){var $col=$("<th></th>");$col.attr("cid",columns[c].field).addClass("xrui-mgrid-table-header ui-bar-c").css("width",c<columns.length-1?columns[c].width:"").attr("smode","").text(columns[c].name).click(function(){var fld=$(this).attr("cid");var sMode=$(this).attr("smode");if(sMode=="1"){sMode="2"}else{sMode="1"}$(this).attr("smode",sMode);if(fld){var sortColIdx=-1;for(var cc=0;cc<dispOrder.length;cc++){var propIdx=dispOrder[cc];if(data.kb.aValueProps.list[propIdx].aName==fld){sortColIdx=cc;break}}if(sortColIdx>=0){$this.xrui_grid("_reSortValues",sortColIdx,parseInt(sMode));data.lastValues=null;data.changeCB(data.definition)}}}).appendTo($tr);if(c==columns.length-1){$col.css("border-top-"+(isRTL()?"left":"right")+"-radius","0.6em")}}}var $tbody=$("<tbody></tbody>");$tbody.appendTo($table);data.$helpDiv=aCntrl.dialog.renderHelp($this,data.kb)}if(aCntrl.tabno>0){$this.attr("tabindex",aCntrl.tabno)}$this.addClass("xrui-grid")});return this},gettied:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");return data.kb},getSubCtrlLists:function(){return null},_reSortValues:function(propIdx,sortDir){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");if(sortDir){data.sortDir=sortDir}else{var isSameCol=(data.sortCol==propIdx);if(isSameCol){if(data.sortDir==1){data.sortDir=2}else{data.sortDir=1}}else{data.sortDir=1}}data.sortCol=propIdx},_swap:function(items,idx1,idx2){var tmp=items[idx1];items[idx1]=items[idx2];items[idx2]=tmp;return items},_sortValues:function(rows,sortType){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");if(data.sortDir==0){return rows}else{var dispOrder=data.kb.getDisplayOrder();var propIdx=dispOrder[data.sortCol];var propName=data.kb.aValueProps.list[propIdx].aName;var s1,s2;for(var c=0;c<rows.length;c++){for(var cc=c;cc<rows.length;cc++){s1=rows[c][propName];s2=rows[cc][propName];if(data.sortDir==2){if(s1<s2){rows=$this.xrui_grid("_swap",rows,c,cc)}}else{if(s1>s2){rows=$this.xrui_grid("_swap",rows,c,cc)}}}}return rows}},_sortInvalidValues:function(rows){var $this=$(this.get(0));for(var c=0;c<rows.length;c++){for(var cc=c;cc<rows.length;cc++){if(!rows[c].valid&&rows[cc].valid){rows=$this.xrui_grid("_swap",rows,c,cc)}}}return rows},_removeHiddenValues:function(rows,hiddenValueProp){var c;var allVisible=true;for(c=0;(c<rows.length)&&allVisible;c++){if((rows[c].visible===false)||(hiddenValueProp&&rows[c][hiddenValueProp]===true)){allVisible=false}}if(allVisible){return rows}var result=[];for(c=0;c<rows.length;c++){if(rows[c].visible!==false){if(!hiddenValueProp||rows[c][hiddenValueProp]!==true){result[result.length]=rows[c]}}}return result},populate:function(){this.each(function(){function isNumeric(obj){return !jQuery.isArray(obj)&&(obj-parseFloat(obj)+1)>=0}var $this=$(this);var data=$this.data("xrui_ctrl");var aCntrl=data.definition;var $table=$("table",$this);if($this.length!=1){return}if(data.kb){data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));var c;var vals=data.kb.aValues.slice(0);if(data.kb.flatProps.sortinvalid){vals.sort(sortfunction2)}if(!data.kb.flatProps.showinvalid){for(c=vals.length-1;c>=0;c--){if(!vals[c].valid){vals.splice(c,1)}}}var rows=vals;var aVal=data.kb.GetValue();var changed=data.currentID!=aVal;data.currentID=aVal;var sortType="T";var dispOrder=data.kb.getDisplayOrder();for(c=0;c<dispOrder.length;c++){var propIdx=dispOrder[c];if(data.sortCol==c){sortType=data.kb.aValueProps.list[propIdx].aType;break}}if(data.sortCol!=-1){rows=$this.xrui_grid("_sortValues",rows,sortType)}if(data.kb.flatProps.sortinvalid){rows=$this.xrui_grid("_sortInvalidValues",rows)}rows=$this.xrui_grid("_removeHiddenValues",rows,!data.kb.flatProps.hasOwnProperty("hiddenvaluesprop")?null:data.kb.flatProps.hiddenvaluesprop==""?null:data.kb.flatProps.hiddenvaluesprop);if(!changed){changed=data.lastValues==null}if(!changed){changed=data.lastID!=data.currentID}if(!changed){changed=data.lastValues.length!=vals.length}if(!changed){for(c=0;(c<data.lastValues.length)&&!changed;c++){if(c>=vals.length){changed=true}else{for(var p in data.lastValues[c]){if(data.lastValues[c][p]!=vals[c][p]){changed=true;break}}}}}if(changed){data.lastID=data.currentID;data.lastValues=$.extend(true,[],vals);var s="",isSelected;$("tbody",$table).remove();var $tbody=$("<tbody></tbody>");$tbody.appendTo($table);var aImg;if(data.kb.isMultiSel){aImg="ui-icon-checkbox-"}else{aImg="ui-icon-radio-"}for(c=0;c<rows.length;c++){if(data.kb.isMultiSel){isSelected=rows[c].selected}else{isSelected=(rows[c].aID==aVal)}var $tr=$("<tr></tr>");$tr.attr("rid",rows[c].id).addClass("xrui-mgrid-table-td ui-btn-up-c").click(function(e){if($(this).attr("data-disabled")!="disabled"){if($.isFunction(data.changeCB)){if(aCntrl.readonly){return}var vID=parseInt($(this).attr("rid"));if(data.kb.isMultiSel){var array=data.kb.GetValue();var i=jQuery.inArray(vID,array);if(i>=0){array.splice(i,1)}else{array.push(vID)}data.currentID=array}else{if(data.currentID==vID){data.currentID=0}else{data.currentID=vID}}if(e.target.type!=="checkbox"){$(":checkbox",this).trigger("click")}data.changeCB(data.definition)}}}).hover(function(){if(!aCntrl.readonly){$(this).addClass("ui-btn-hover-c")}},function(){if(!aCntrl.readonly){$(this).removeClass("ui-btn-hover-c")}}).appendTo($tbody);var $col1,$col2;if(!aCntrl.readonly){$col1=$("<td></td>");$col1.addClass("mgrid-check").appendTo($tr);if(c==rows.length-1){$col1.css("border-bottom-"+(isRTL()?"right":"left")+"-radius","0.6em")}var $span=$("<span></span>");$span.css("display","block").addClass("ui-icon "+aImg+(isSelected?"on":"off")).appendTo($col1);if(data.kb.isMultiSel){$span.css("-webkit-border-radius","0px")}}var cc;for(cc=0;cc<data.columns.length;cc++){s=rows[c][data.columns[cc].field];$col2=$("<td></td>");$col2.css("width",cc<data.columns.length-1?data.columns[cc].width:"").addClass(isNumeric(s)?"xrui-mgrid-table-number-td":"xrui-mgrid-table-td").appendTo($tr);if(aCntrl.ishtml){$col2.html(s)}else{$col2.text(s)}if((c==rows.length-1)&&(cc==data.columns.length-1)){$col2.css("border-bottom-"+(isRTL()?"left":"right")+"-radius","0.6em")}}if(!rows[c].valid){if(!data.kb.flatProps.allowinvalid){$tr.attr("disabled","disabled")}else{$tr.addClass("xrui-grid-constrained")}if(rows[c].aID==aVal){$tr.removeClass("xrui-grid-constrained");$tr.addClass("xrui-grid-selinv")}else{$tr.removeClass("xrui-grid-selinv")}}else{$tr.removeClass("xrui-grid-constrained xrui-grid-selinv");$tr.removeAttr("disabled")}if(!rows[c].valid){$col1.addClass("ui-list-invalid");$col2.addClass("ui-list-invalid")}if(!data.kb.flatProps.showinvalid){if(!rows[c].valid){$tr.remove()}}if(!data.kb.flatProps.allowinvalid){if(!rows[c].valid){$tr.css("opacity","0.25");$tr.attr("data-disabled","disabled")}}}}if(data.kb.flatProps.isenabled){$table.attr("disabled",false);$table.removeClass("ui-disabled")}else{$table.attr("disabled",true);$table.addClass("ui-disabled").blur()}if(!data.kb.flatProps.isvisible){$this.hide();if(data.$helpDiv){data.$helpDiv.hide()}}else{$this.show();if(data.$helpDiv){data.$helpDiv.show()}}if(aCntrl.invalid){$table.addClass("xrui-grid-invalid")}else{$table.removeClass("xrui-grid-invalid")}}});return this},_selection:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");return data.currentID},setselection:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");if(data.kb){var selID=$this.xrui_grid("_selection");if(selID===0){selID=PSEUDO_VALUE_EMPTY}replayStack.Add(data.definition.dialog.aID,REPLAY_CHANGEEVENT,data.kb.aID,selID)}})},isvalid:function(){var valid=true;this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var selID=$this.xrui_grid("_selection");if(!data.definition.dialog.isValueValid(data.kb,selID)){valid=false}if(data.kb.isMultiSel&&data.definition.hasOwnProperty("multiselmin")&&data.definition.hasOwnProperty("multiselmax")){var nSel=$.isArray(selID)?selID.length:0;if((nSel<data.definition.multiselmin)||(nSel>data.definition.multiselmax)){valid=false}}});return valid},focus:function(){var $this=$(this.get(0));if($this.length!=1){return false}if($this.is(":visible")){$this.focus();return true}return false},designtime:function(){return{cssclassname:{atype:"css",displayname:"swatch"},hascaption:{atype:"bool",adefault:true},dynamicvals:{atype:"bool",adefault:true},label:"str",showlabel:{atype:"bool",adefault:true},tieditem:{atype:"tied",accepted:[TYPE_LIST,TYPE_BOOLEAN]},ishtml:{atype:"bool",adefault:false}}},destroy:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");$this.removeData("xrui_ctrl")})}};$.fn.xrui_grid=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.xrui_grid")}}}})(jQuery);(function($){var methods={init:function(options){this.each(function(){var data={definition:null};$.extend(data,options);var $this=$(this);var aCntrl=data.definition;$this.attr("data-role","");var $img=$("<img></img>");$img.appendTo($this);if(data.definition.zoomable){$img.off("click");$img.on("click",function(){xpertrule.phone("ViewImage",[$img.attr("src"),"false"])})}if(data.definition.dialog.editing){$img.on("load",function(){if((data.lastSz.width!=$img.width())||(data.lastSz.height!=$img.height())){data.lastSz={width:$img.width(),height:$img.height()};if($.isFunction(data.definition.dialog.imgSizeChangeCB)){data.definition.dialog.imgSizeChangeCB(data.definition,$(this))}}})}var fStyle=(aCntrl.cssclassname?aCntrl.cssclassname.name:"");if(fStyle.substr(0,1)=="'"){fStyle=eval(fStyle)}if(fStyle.length>0){$img.addClass(fStyle)}if(aCntrl.tabno>0){$this.attr("tabindex",aCntrl.tabno)}$this.addClass((aCntrl.cssclassname.name.length>0?"ui-body-"+aCntrl.cssclassname.name+" ":"")+"ui-corner-all xrui-image").data("xrui_ctrl",data)});return this},gettied:function(){return null},getSubCtrlLists:function(){return null},populate:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var aCntrl=data.definition;var $img=$("img",$this);if($img.length!=1){return}var src=aCntrl.dialog.expandEmbedded(aCntrl.imagepath);if(aCntrl.dialog.editing){src=xrkb_resources.getResourceURL(src)}else{if(src.indexOf("/")==-1){if(window.hasOwnProperty("xrkb")){src=xrkb_resources.getResourceURL(src)}else{src=xrkb_include_folder+"assets/"+src}}else{if(src.indexOf(":")==-1){if(src.substr(0,1)!="/"){if(src.substr(0,5)!=xrkb_include_folder){if(src.substr(0,7)=="assets/"){src=xrkb_include_folder+src}else{if(src.substr(0,8)=="objects/"){src=xrkb_include_folder+src}else{if(xrkb_include_folder!=""){src=xrkb_include_folder+"assets/"+src}}}}}}}}if((src.length==0)&&(aCntrl.dialog.editing)){$img.attr("width","64px").attr("height","64px");src="images/dlg_image_broken.png"}else{$img.removeAttr("width").removeAttr("height");if(aCntrl.scaled){$img.attr("width","100%")}}if($img.attr("src")!=src){$img.attr("src",src);data.lastSz={width:$img.width(),height:$img.height()}}if(aCntrl.alttext!=""){$img.attr("alt",aCntrl.dialog.expandEmbedded(aCntrl.alttext))}if(!aCntrl.visible&&!aCntrl.dialog.editing){$this.hide()}else{$this.show()}});return this},designtime:function(){return{visible:"bool",zoomable:"bool",alttext:"str",imagepath:{atype:"resource",displayname:"image",accepted:["*.png","*.jpg","*.gif","*.svg"]},scaled:"bool"}},destroy:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");$this.removeData("xrui_ctrl")})}};$.fn.xrui_image=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.xrui_image")}}}})(jQuery);(function(b){var a={init:function(d){this.each(function(){var j={definition:null,kb:null,selectedID:PSEUDO_VALUE_EMPTY};b.extend(j,d);var k=b(this);var h=j.definition;k.attr("data-role","");var f=b("<center></center>");f.appendTo(k);var g=b("<img></img>");g.addClass("xrui-imgmap").appendTo(f);var e;if(j.definition.dialog.editing){g.on("load",function(){if((j.lastSz.width!=g.width())||(j.lastSz.height!=g.height())){j.lastSz={width:g.width(),height:g.height()};if(b.isFunction(j.definition.dialog.imgSizeChangeCB)){j.definition.dialog.imgSizeChangeCB(j.definition,b(this))}}})}else{g.on("load",function(){e.css("width",g.width()+"px").css("height",g.height()+"px").css("top","-"+g.height()+"px");f.height(g.height()+"px")})}j.kb=dictionary.GetObject(h.tieditem||(j.tiedDlgObj?j.tiedDlgObj.aID:0));if(!j.definition.dialog.editing){e=b("<div></div>").addClass("xrui-imgmap-wrap").hover(function(){b(this).addClass("xrui-imgmap-wrap-hover")},function(){b(this).removeClass("xrui-imgmap-wrap-hover")}).appendTo(f);for(var l=0;l<j.definition.imagemap.length;l++){b("<div></div>").addClass("xrui-imgmap-area").css("left",j.definition.imagemap[l].x+"px").css("top",j.definition.imagemap[l].y+"px").css("width",j.definition.imagemap[l].w+"px").css("height",j.definition.imagemap[l].h+"px").attr("vid",j.definition.imagemap[l].vid).click(function(){if(j.kb&&!j.kb.flatProps.isenabled){return}var o=j.selectedID;j.selectedID=PSEUDO_VALUE_EMPTY;if(b.isFunction(j.changeCB)){var m=parseInt(b(this).attr("vid"));if(j.kb.isMultiSel){var p=j.kb.GetValue();var n=b.inArray(m,p);if(n>=0){p.splice(n,1)}else{p.push(m)}j.selectedID=p}else{j.selectedID=m;if((o==m)&&(!j.kb.flatProps.allowdeselect)){return}if(o==j.selectedID){j.selectedID=PSEUDO_VALUE_EMPTY}}j.changeCB(j.definition)}}).appendTo(e)}}if(h.tabno>0){k.attr("tabindex",h.tabno)}k.addClass((h.cssclassname.name.length>0?h.cssclassname.name+" ":"")+"ui-corner-all").data("xrui_ctrl",j)});return this},gettied:function(){var e=b(this.get(0));var d=e.data("xrui_ctrl");return d.kb},getSubCtrlLists:function(){return null},populate:function(){this.each(function(){var h=b(this);var g=h.data("xrui_ctrl");var f=g.definition;var e=b("img",h);if(e.length!=1){return}var j=f.dialog.expandEmbedded(g.definition.imagepath);if(g.definition.dialog.editing){j=xrkb_resources.getResourceURL(j)}else{if(j.indexOf("/")==-1){if(window.hasOwnProperty("xrkb")){j=xrkb_resources.getResourceURL(j)}else{j=xrkb_include_folder+"assets/"+j}}else{if(j.indexOf(":")==-1){if(j.substr(0,1)!="/"){if(j.substr(0,5)!=xrkb_include_folder){if(j.substr(0,7)=="assets/"){j=xrkb_include_folder+j}else{if(j.substr(0,8)=="objects/"){j=xrkb_include_folder+j}else{if(xrkb_include_folder!=""){j=xrkb_include_folder+"assets/"+j}}}}}}}}if((j.length==0)&&(g.definition.dialog.editing)){e.attr("width","64px").attr("height","64px");j="images/dlg_image_broken.png"}else{e.removeAttr("width").removeAttr("height")}if(e.attr("src")!=j){e.attr("src",j);g.lastSz={width:e.width(),height:e.height()}}if(g.definition.alttext!=""){e.attr("alt",g.definition.dialog.expandEmbedded(g.definition.alttext))}if(g.kb){if(!g.kb.flatProps.isvisible){h.hide()}else{h.show();if(h.find("center").height()==0){h.find("center").css("height","auto");h.find("center").height(e.height());h.find(".xrui-imgmap-wrap").css("width",e.width()+"px").css("height",e.height()+"px").css("top","-"+e.height()+"px")}}g.selectedID=g.kb.GetValue();var d=g.selectedID;h.find(".xrui-imgmap-area").removeClass("xrui-imgmap-area-selected");if(d){if(!b.isArray(d)){h.find(".xrui-imgmap-area[vid='"+d+"']").addClass("xrui-imgmap-area-selected")}else{for(c=0;c<d.length;c++){h.find(".xrui-imgmap-area[vid='"+d[c]+"']").addClass("xrui-imgmap-area-selected")}}}}if(g.definition.invalid){h.addClass("xrui-imgmap-invalid")}else{h.removeClass("xrui-imgmap-invalid")}});return this},setselection:function(){return this.each(function(){var e=b(this);var d=e.data("xrui_ctrl");if(d.kb){replayStack.Add(d.definition.dialog.aID,REPLAY_CHANGEEVENT,d.kb.aID,d.selectedID)}})},isvalid:function(){var d=true;this.each(function(){var f=b(this);var e=f.data("xrui_ctrl");d=e.definition.dialog.isValueValid(e.kb,e.selectedID)});return d},focus:function(){var d=b(this.get(0));return false},designtime:function(){return{alttext:"str",imagepath:{atype:"resource",displayname:"image",accepted:["*.png","*.jpg","*.gif"]},tieditem:{atype:"tied",accepted:[TYPE_LIST,TYPE_BOOLEAN]},imagemap:"imgmap"}},destroy:function(){return this.each(function(){var e=b(this);var d=e.data("xrui_ctrl");e.removeData("xrui_ctrl")})}};b.fn.xrui_imgmap=function(d){if(a[d]){return a[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){return a.init.apply(this,arguments)}else{b.error("Method "+d+" does not exist on jQuery.xrui_imgmap")}}}})(jQuery);(function(b){var a={init:function(d){this.each(function(){var g={definition:null,changeCB:null};b.extend(g,d);var h=b(this);var f=g.definition;var j=h.parent().children().not(h);j.detach();h.removeAttr("data-role");h.removeClass("ui-field-control ui-body ui-br");var e=b("<div></div>").addClass("xrui-jqmbreak-topleft").appendTo(h);j.appendTo(e);h.data("xrui_ctrl",g)});return this},gettied:function(){return null},getSubCtrlLists:function(){return null},rendered:function(){this.each(function(){var f=b(this);var e=f.data("xrui_ctrl");var g=f.parent().children().not(f);g.detach();var d=b("<div></div>").addClass("xrui-jqmbreak-bottomright").appendTo(f);g.appendTo(d)});return this},destroy:function(){this.each(function(){var e=b(this);var d=e.data("xrui_ctrl");e.removeData("xrui_ctrl")})}};b.fn.xrui_jqmbreak=function(d){if(a[d]){return a[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){return a.init.apply(this,arguments)}else{b.error("Method "+d+" does not exist on jQuery.jqmbreak_panels")}}}})(jQuery);(function($){var methods={init:function(options){this.each(function(){var data={definition:null,lastValue:null};$.extend(data,options);var $this=$(this);var aCntrl=data.definition;var fStyle=(aCntrl.cssclassname?aCntrl.cssclassname.name:"");if(fStyle.substr(0,1)=="'"){fStyle=eval(fStyle)}if(!aCntrl.ishtml){$this.css("text-align",aCntrl.justification)}var a=fStyle.split(" ");for(var cc=0;cc<a.length;cc++){if(a[cc].length==1){$this.addClass("ui-body-"+a[cc]);$this.css("padding","10px")}else{$this.addClass(a[cc])}}if(aCntrl.tabno>0){$this.attr("tabindex",aCntrl.tabno)}$this.addClass("xrui-label").data("xrui_ctrl",data)});return this},gettied:function(){return null},getSubCtrlLists:function(){return null},populate:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var aCntrl=data.definition;if(!aCntrl.visible&&!aCntrl.dialog.editing){$this.hide()}else{var doEscaping=!aCntrl.hasOwnProperty("ishtml");var txt=aCntrl.dialog.expandEmbedded(aCntrl.caption,doEscaping);var changed=data.lastValue==null;if(!changed){changed=data.lastValue!=txt}if(changed){data.lastValue=txt;var a=txt.split("input_help_aobject__id=");if(a.length==2){txt=a[0];if($(".input_help",$this.parents()).length==0){var att=dictionary.GetObject(parseInt(a[1]));if(att&&$this.parent().is(":visible")){data.definition.dialog.definition.helpdoneinlabel=false;data.definition.dialog.renderHelp($this,att)}}}if(txt!="__EMPTY__"){if(aCntrl.ishtml||!aCntrl.hasOwnProperty("ishtml")){$this.html(txt);if(data.definition.dialog.editing){$this.find("img").each(function(){var $img=$(this);var h=$img.height();$img.on("load",function(){if(($img.height()!=h)&&$.isFunction(data.definition.dialog.imgSizeChangeCB)){data.definition.dialog.imgSizeChangeCB(data.definition,$img)}})})}}else{if(txt.match(/\x0d|\x0a/)){txt=ConvertForDisplay(txt,false,false);$this.html(txt)}else{$this.text(txt)}}}else{if(aCntrl.dialog.editing){$this.addClass("xrui-label-xrkb-empty").html("Empty Label")}}}$this.show()}});return this},designtime:function(){return{justification:{atype:"enum",vals:["left","right","center"],adefault:"left",displayrule:function(ctrl){return !ctrl.ishtml}},caption:"str",visible:{atype:"bool",adefault:true},ishtml:{atype:"bool",adefault:true}}},destroy:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");$this.removeData("xrui_ctrl")})}};$.fn.xrui_label=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.xrui_label")}}}})(jQuery);(function($){var methods={init:function(options){this.each(function(){var data={definition:null,kb:null,changeCB:null,tiedDlgObj:0,selectedID:0,lastValues:null,lastID:0};$.extend(data,options);var $this=$(this);var aCntrl=data.definition;$this.addClass("xrui-listbox");data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));var aDescr=(data.kb?data.kb.GetDescription(true):"Description");var $legend;if(data.kb){if(aCntrl.showsearch){var $fwrap=$("<div></div>").addClass("xrui-listbox-filter").appendTo($this);if(aCntrl.showlabel){$legend=$("<div></div>").addClass("ui-controlgroup-label");if(aCntrl.label!=""){aDescr=aCntrl.dialog.expandEmbedded(aCntrl.label)}aCntrl.dialog.populateLabel($legend,aDescr,aCntrl.ishtml);$legend.appendTo($fwrap)}data.$filter=$("<input data-type='search'>").appendTo($fwrap).keyup(function(){$this.xrui_listbox("populate")})}var $fieldset=$("<fieldset></fieldset>");$fieldset.attr("data-role","controlgroup").appendTo($this);if(!data.kb.flatProps.allowblank){$this.addClass("xrkb-obligatory");$("<div class='xrkb-obligatory-marker'></div>").appendTo($fieldset)}if(aCntrl.jqmattributes){var a=aCntrl.jqmattributes;if(a.substr(0,1)=="'"){a=eval(a)}try{a=JSON.parse("{"+a+"}");$fieldset.attr(a)}catch(e){}}if(aCntrl.showlabel){$("<legend></legend>").appendTo($fieldset)}else{$this.addClass("xrui-nocaption")}data.$helpDiv=data.definition.dialog.renderHelp($this,data.kb);data.selectedID=data.kb.GetValue()}if(aCntrl.tabno>0){$this.attr("tabindex",aCntrl.tabno)}$this.data("xrui_ctrl",data)});return this},gettied:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");return data.kb},getSubCtrlLists:function(){return null},populate:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var aCntrl=data.definition;var $lb=$("fieldset",$this);if($lb.length!=1){return}var c,$label,$input,$inputsDiv;if(data.kb){data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0))}if(data.clicked){if(data.kb){$inputsDiv=$(".ui-controlgroup-controls",$lb).removeClass("xrui-listbox-invalid")}return}if(data.kb){data.selectedID=data.kb.GetValue();var vals=data.kb.aValues.slice(0);if(data.$filter){var f=data.$filter.val().toLowerCase();if(f.length>0){for(c=vals.length-1;c>=0;c--){var tt=data.kb.GetValueDescr(data.kb.ValueIDtoIndex(vals[c].aID)).toLowerCase();if(tt.indexOf(f)==-1){vals.splice(c,1)}}}}if(!data.kb.flatProps.showinvalid){for(c=vals.length-1;c>=0;c--){if(!vals[c].valid){vals.splice(c,1)}}}var hiddenValueProp=!data.kb.flatProps.hasOwnProperty("hiddenvaluesprop")?null:data.kb.flatProps.hiddenvaluesprop==""?null:data.kb.flatProps.hiddenvaluesprop;for(c=vals.length-1;c>=0;c--){if((vals[c].visible===false)||(hiddenValueProp&&vals[c][hiddenValueProp]===true)){vals.splice(c,1)}}if(data.kb.flatProps.sortinvalid){vals.sort(sortfunction2)}var firstPopulate=data.lastValues==null;var changed=firstPopulate;if(!changed){changed=data.lastID!=data.selectedID}if(!changed){changed=data.lastValues.length!=vals.length}if(!changed){for(c=0;(c<data.lastValues.length)&&!changed;c++){if(c>=vals.length){changed=true}else{if(data.lastValues[c].aID!=vals[c].aID){changed=true}else{if(data.lastValues[c].valid!=vals[c].valid){changed=true}}}}}if(changed){data.lastID=data.selectedID;data.lastValues=$.extend(true,[],vals);$lb.empty();if(!data.kb.flatProps.allowblank){$this.addClass("xrkb-obligatory");$("<div class='xrkb-obligatory-marker'></div>").appendTo($lb)}if(aCntrl.showlabel){var $legend=$("<legend></legend>");if(!aCntrl.showsearch){var aDescr;if(aCntrl.label!=""){aDescr=aCntrl.dialog.expandEmbedded(aCntrl.label)}else{aDescr=data.kb.GetDescription(true)}if(aCntrl.ishtml){$legend.html(aDescr)}else{$legend.text(aDescr)}}$legend.appendTo($lb)}if(isSmartTv()){smartTv.disassociateInput(data.kb.aID)}for(c=0;c<vals.length;c++){if(!vals[c].valid&&!data.kb.flatProps.showinvalid){continue}$input=$("<input></input>");$lb.append($input.attr("name",aCntrl.aName+"_rd").attr("id",aCntrl.aName+"_rd"+c).attr("type",(data.kb.isMultiSel?"checkbox":"radio")).attr("value",vals[c].aID).attr("data-theme",aCntrl.cssclassname.name).change(function(ev){if(!data.kb.flatProps.isenabled){throw"Microsoft has problems with pointer-events: none;"}var prevSel=data.selectedID;data.selectedID=0;if($.isFunction(data.changeCB)){var vID=parseInt($(this).attr("value"));if(data.kb.isMultiSel){var array=[];$this.find("input").each(function(){if($(this).is(":checked")){array.push(parseInt($(this).attr("value"),10))}});data.selectedID=array}else{data.selectedID=vID;if((prevSel==vID)&&(!data.kb.flatProps.allowdeselect)){return}}if(prevSel==data.selectedID){data.selectedID=PSEUDO_VALUE_EMPTY;$lb.find("input").attr("checked",false)}data.clicked=true;data.changeCB(data.definition);data.clicked=false}}));$label=$("<label></label>").attr("for",aCntrl.aName+"_rd"+c).attr("id",aCntrl.aName+"_rdlbl"+c).appendTo($lb);var t=data.kb.GetValueDescr(data.kb.ValueIDtoIndex(vals[c].aID));if(isSmartTv()){smartTv.associateInput(data.kb.aID,vals[c].aID,$input,function(info){var $input=$("input[value="+info.valID+"]");$input.click();$input.checkboxradio("refresh")})}if(aCntrl.ishtml){$label.html(t)}else{$label.text(t)}}if(!firstPopulate){$this.trigger("create")}}for(c=0;c<vals.length;c++){$label=$this.find("#"+aCntrl.aName+"_rdlbl"+c);$input=$this.find("#"+aCntrl.aName+"_rd"+c);if(vals[c].valid){$label.removeClass("ui-list-invalid")}else{$label.addClass("ui-list-invalid")}if(!data.kb.flatProps.allowinvalid){if(!vals[c].valid){$input.addClass("ui-state-disabled");$input.attr("disabled","disabled")}else{$input.removeClass("ui-state-disabled");$input.removeAttr("disabled")}}}var aVal=data.selectedID;if(aVal){if(!$.isArray(aVal)){$("input[value='"+aVal+"']",$this).attr("checked",true)}else{for(c=0;c<aVal.length;c++){$("input[value='"+aVal[c]+"']",$this).attr("checked",true)}}}else{$lb.find("input").attr("checked",false)}if(!data.kb.flatProps.isvisible){$this.hide();if(data.$helpDiv){data.$helpDiv.hide()}}else{$this.show();if(data.$helpDiv){data.$helpDiv.show()}}if(!data.kb.flatProps.isenabled){$lb.addClass("ui-disabled");$lb.attr("disabled","disabled")}else{$lb.removeClass("ui-disabled");$lb.removeAttr("disabled")}$inputsDiv=$(".ui-controlgroup-controls",$lb);if(aCntrl.invalid){$inputsDiv.addClass("xrui-listbox-invalid ui-corner-all")}else{$inputsDiv.removeClass("xrui-listbox-invalid")}if(!firstPopulate){$lb.find("input").checkboxradio("refresh")}}});return this},setselection:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");if(data.kb){replayStack.Add(data.definition.dialog.aID,REPLAY_CHANGEEVENT,data.kb.aID,data.selectedID)}})},isvalid:function(){var valid=true;this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");if(data.kb.isMultiSel){var nSel=$.isArray(data.selectedID)?data.selectedID.length:0;if((nSel<data.definition.multiselmin)||(nSel>data.definition.multiselmax)){valid=false}if(data.selectedID==0){replayStack.Add(data.definition.dialog.aID,REPLAY_CHANGEEVENT,data.kb.aID,[])}}if(!data.definition.dialog.isValueValid(data.kb,data.selectedID)){valid=false}});return valid},focus:function(){var $this=$(this.get(0));var $lb=$("fieldset",$this);if($lb.length!=1){return false}if($lb.is(":visible")){$lb.focus();return true}return false},designtime:function(){return{tieditem:{atype:"tied",accepted:[TYPE_LIST,TYPE_BOOLEAN]},excludemode:{atype:"enum",vals:["showinvalid"]},cssclassname:{atype:"css",displayname:"swatch"},showlabel:{atype:"bool",adefault:true},showsearch:{atype:"bool",adefault:false},label:"str",jqmattributes:"str",ishtml:{atype:"bool",adefault:false}}},destroy:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");$this.removeData("xrui_ctrl")})}};$.fn.xrui_listbox=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.xrui_listbox")}}}})(jQuery);function sortfunction2(e,d){if(e.valid&&!d.valid){return -1}if(!e.valid&&d.valid){return 1}if(e.idx<d.idx){return -1}if(e.idx>d.idx){return 1}return 0}(function($){var isEmptyInput=function(value){return((typeof value=="string")&&(value==""))||(value===null)};var methods={init:function(options){this.each(function(){var data={definition:null,kb:null,changeCB:null,tiedDlgObj:0,minValue:null,maxValue:null,currentVal:""};$.extend(data,options);var $this=$(this).addClass("ui-widget-content xrui-number");var aCntrl=data.definition;data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));var $fieldset=$("<fieldset></fieldset>");$fieldset.attr("data-role","controlgroup").appendTo($this);if(aCntrl.showlabel){var aDescr;if(aCntrl.label!=""){aDescr=aCntrl.dialog.expandEmbedded(aCntrl.label)}else{aDescr=data.kb?data.kb.GetDescription(true):""}var $legend=$("<legend></legend>");aCntrl.dialog.populateLabel($legend,aDescr);$legend.appendTo($fieldset)}else{$this.addClass("xrui-align-"+aCntrl.align)}var $num=$("<input></input>");$num.attr("id","Num_input").attr("name","Num_input").attr("type",isChromeDesktop?"text":"number").addClass("xrui-align-element").appendTo($fieldset);if(data.kb&&data.kb.flatProps&&data.kb.flatProps.units&&(data.kb.flatProps.units!="")){var $units=$("<span></span>");$units.addClass("xrui-number-units xrui-align-element").html(data.kb.flatProps.units).appendTo($fieldset)}if(aCntrl.jqmattributes){var a=aCntrl.jqmattributes;if(a.substr(0,1)=="'"){a=eval(a)}try{a=JSON.parse("{"+a+"}");$num.attr(a)}catch(e){}}var cName="";cName=(aCntrl.cssclassname?aCntrl.cssclassname.name:"");if(cName.substr(0,1)=="'"){cName=eval(cName)}if(cName.length>0){$this.addClass(cName)}if(aCntrl.cssclassname&&aCntrl.cssclassname.dowysiwyg&&!appSettings.noStyleProps){if(!aCntrl.applydialogfont){$this.css(aCntrl.dialog.fontToStyleObj(aCntrl.font))}}if(data.kb){if(!data.kb.flatProps.allowblank){$this.addClass("xrkb-obligatory");$("<div class='xrkb-obligatory-marker'></div>").appendTo($fieldset)}if(typeof data.kb.flatProps.minvalue=="number"){data.minValue=data.kb.flatProps.minvalue}if(typeof data.kb.flatProps.maxvalue=="number"){data.maxValue=data.kb.flatProps.maxvalue}$num.numeric({decs:data.kb.aDecPlaces,decSeparator:appSettings.decSeparator?appSettings.decSeparator:".",changeCB:function(){var v=$num.numeric("get");if(data.currentVal!==v){if($.isFunction(data.changeCB)){data.currentVal=v;data.changeCB(data.definition)}}},returnKeyCB:function(){var v=$num.numeric("get");if(data.currentVal!==v){data.currentVal=v;data.changeCB(data.definition)}aCntrl.dialog.progressOnCR(data.definition)},readonly:data.definition.readonly});data.$helpDiv=aCntrl.dialog.renderHelp($this,data.kb)}if(aCntrl.tabno>0){$this.attr("tabindex",aCntrl.tabno)}$this.data("xrui_ctrl",data)});$(this).xrui_number("_setSelectedIDfromDictionary");return this},gettied:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");return data.kb},getSubCtrlLists:function(){return null},populate:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var aCntrl=data.definition;var $num=$("input",$this);if($num.length!=1){return}if(data.kb){data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));var v=data.kb.GetValue();if(v==null){v=""}data.currentVal=v;$num.numeric("set",v);if(!data.kb.flatProps.isvisible){$this.hide();if(data.$helpDiv){data.$helpDiv.hide()}}else{$this.show();if(data.$helpDiv){data.$helpDiv.show()}}if(aCntrl.readonly){$num.attr("readonly",true)}else{$num.attr("readonly",false)}if(!data.kb.flatProps.isenabled){$num.addClass("xrui-number-disabled");$num.numeric("option","readonly",true)}else{$num.removeClass("xrui-number-disabled");$num.numeric("option","readonly",false)}if(!data.kb.valid){$num.addClass("xrui-number-constrained")}else{$num.removeClass("xrui-number-constrained")}}if(aCntrl.invalid){$num.addClass("xrui-number-invalid")}else{$num.removeClass("xrui-number-invalid")}});return this},_setSelectedIDfromDictionary:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");if(data.kb){data.currentVal=data.kb.GetValue()}});return this},setselection:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var value=data.currentVal;if(data.kb){if(isEmptyInput(value)){value=PSEUDO_VALUE_EMPTY}replayStack.Add(data.definition.dialog.aID,REPLAY_CHANGEEVENT,data.kb.aID,value)}})},isvalid:function(){var valid=true;this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var value=data.currentVal;if(data.kb){if(isEmptyInput(value)&&!data.kb.flatProps.allowblank&&data.kb.flatProps.isvisible&&data.kb.flatProps.isenabled){valid=false}else{if(!isEmptyInput(value)&&isNaN(value)){valid=false}else{if(!data.kb.valid&&data.kb.flatProps.isvisible&&data.kb.flatProps.isenabled){valid=false}}}}});return valid},isInteractiveValid:function(){var valid=true;this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var value=data.currentVal;if(data.kb){if(!isEmptyInput(value)){if(isNaN(value)){valid="Not a number"}else{if(data.minValue===data.maxValue){}else{if(data.minValue!==null&&data.maxValue!==null){if(value<data.minValue||value>data.maxValue){if((data.minValue==data.maxValue)&&data.minValue===null){}else{if(data.minValue<data.maxValue){valid="("+data.minValue.toFixed(data.kb.aDecPlaces)+" - "+data.maxValue.toFixed(data.kb.aDecPlaces)+")"}else{valid="(Invalid Min-Max property values)"}}}}else{if(data.maxValue!==null){if(value>data.maxValue){valid="(> "+data.maxValue+")"}}else{if(data.minValue!==null){if(value<data.minValue){valid="(< "+data.minValue+")"}}}}}}}}});return valid},focus:function(){var $this=$(this.get(0));var $num=$("input",$this);if($num.length!=1){return false}if($num.is(":visible")){var s=$num.val();$num.val("").focus().val(s);return true}return false},designtime:function(){return{tieditem:{atype:"tied",accepted:[TYPE_NUMERIC]},readonly:{atype:"bool",adefault:false},cssclassname:{atype:"css",displayname:"swatch"},showlabel:{atype:"bool",adefault:true},label:"str",jqmattributes:"str"}},destroy:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");$this.removeData("xrui_ctrl")})}};$.fn.xrui_number=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.xrui_number")}}}})(jQuery);(function(b){var a={init:function(d){this.each(function(){var h={definition:null,changeCB:null};b.extend(h,d);var o=b(this);var f=h.definition;var q=false;var l=(f.groupInitialCollapsed?true:false);var k=f.dialog.definition.grouppreviousanswers=="Below";var n;for(n=0;n<f.tabsheets.length;n++){if((!f.tabsheets[n].initialshrunk||!f.groupInitialCollapsed)&&l){q=true}}var g;var u=getTranslation("previous_answers_text","Previous Answers / Re-answer");for(n=0;n<f.tabsheets.length;n++){var j=o;if(q&&(n<f.tabsheets.length-1)){if(n===0){g=b("<div></div>",{id:"PAGE0"}).attr("data-role","collapsible").attr("data-collapsed",true).attr("data-content-theme","e").attr("data-theme","e").addClass("xrui-panels-page xrui-reanswer-page").appendTo(j);var m=(u?u:DEFAULT_PREVIOUSANSWERSTEXT)+" ("+(f.tabsheets.length-1)+")";b("<h3></h3>").html(m).appendTo(g)}j=g}f.tabsheets[n].tab=f;var t=b("<div></div>",{id:"PAGE"+f.tabsheets[n].id}).attr("data-role","collapsible").attr("data-collapsed",!f.dialog.editing&&f.tabsheets[n].initialshrunk).attr("data-content-theme",f.tabsheets[n].contentcssname.replace("'","").replace("'","")).attr("data-theme",f.tabsheets[n].cssname.replace("'","").replace("'","")).addClass("xrui-panels-page");var r=false;if(q){if((n===0)&&(j.attr("id")==="PAGE0")&&!k){r=true}else{if((n==f.tabsheets.length-1)&&k){r=true}}}if(r){t.prependTo(j)}else{t.appendTo(j)}f.tabsheets[n].$panel=t;var e=null;if(f.tabsheets[n].showheader){e=b("<h3></h3>").html(f.dialog.expandEmbedded(f.tabsheets[n].caption)).appendTo(t)}f.tabsheets[n].$header=e;var p=t;f.tabsheets[n].$div=p;if((f.tabsheets[n].controls.length===0)&&f.dialog.editing){xrkb_dlg.renderDropHelper(p,{ctrlArr:f.tabsheets[n].controls,ctrlIdx:0})}else{f.dialog.renderCtrls(f.tabsheets[n].controls,p,f.tabsheets[n])}}if(f.tabno>0){o.attr("tabindex",f.tabno)}o.addClass("xrui-panels").css("height","auto").data("xrui_ctrl",h)});return this},postJQMcreate:function(){this.each(function(){var f=b(this);var e=f.data("xrui_ctrl");var d=e.definition;for(var g=0;g<d.tabsheets.length;g++){if(!d.tabsheets[g].$header){d.tabsheets[g].$panel.children("div").first().addClass("ui-corner-top xrui-panel-notitle")}}})},gettied:function(){return null},getSubCtrlLists:function(){var d=[];this.each(function(){var g=b(this);var f=g.data("xrui_ctrl");if(!f){return}var e=f.definition;for(var h=0;h<e.tabsheets.length;h++){d.push(e.tabsheets[h])}});return d},populate:function(){this.each(function(){var j=b(this);var h=j.data("xrui_ctrl");var f=h.definition;var l;var k=0;for(l=0;l<f.tabsheets.length;l++){var e=f.dialog.expandEmbedded(f.tabsheets[l].caption);var d=f.tabsheets[l].$panel.children("h3");var g=d.find("span.ui-btn-text");if(g.length!=1){g=d}g.html(e);if((!treeDialogs||treeDialogs.currentDisplay.taskID!==f.dialog.aID)&&f.showmarkers&&!f.dialog.editing){b("<img></img>").addClass("xrui-panels-incomplete").attr("src",xrkb_include_folder+"images/error.png").appendTo(g)}f.dialog.populateCtrls(f.tabsheets[l].controls);if(f.tabsheets[l].isvisible||f.dialog.editing){f.tabsheets[l].$panel.show()}else{f.tabsheets[l].$panel.hide()}b(".xrui-panels-error",f.tabsheets[l].$header).hide()}f.dialog.validate(true);for(l=0;l<f.tabsheets.length;l++){if(f.tabsheets[l].invalid){b(".xrui-panels-incomplete",f.tabsheets[l].$header).show()}else{b(".xrui-panels-incomplete",f.tabsheets[l].$header).hide()}}});return this},focus:function(){var d=false;this.each(function(){d=true});return d},designtime:function(){return{showmarkers:"bool",tabsheets:"sheets"}},destroy:function(){this.each(function(){var e=b(this);var d=e.data("xrui_ctrl");e.removeData("xrui_ctrl")})}};b.fn.xrui_panels=function(d){if(a[d]){return a[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){return a.init.apply(this,arguments)}else{b.error("Method "+d+" does not exist on jQuery.xrui_panels")}}}})(jQuery);(function($){var methods={init:function(options){this.each(function(){var data={definition:null,kb:null,changeCB:null,tiedDlgObj:0,lastValue:null,minVal:0,maxVal:100};$.extend(data,options);var $this=$(this);$this.addClass("xrui-slider");var aCntrl=data.definition;data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));var $fieldset=$("<fieldset></fieldset>");$fieldset.attr("data-role","controlgroup").appendTo($this);if(aCntrl.showlabel){var aDescr="";if(aCntrl.label!=""){aDescr=aCntrl.dialog.expandEmbedded(aCntrl.label)}else{aDescr=data.kb?data.kb.GetDescription(true):""}var $legend=$("<legend></legend>");aCntrl.dialog.populateLabel($legend,aDescr);$legend.appendTo($fieldset)}var aValue=aCntrl.scrollrangemin;data.minVal=aCntrl.scrollrangemin;data.maxVal=aCntrl.scrollrangemax;if(data.kb){data.minVal=data.kb.flatProps.minvalue;data.maxVal=data.kb.flatProps.maxvalue;aValue=(data.kb.GetValue()?data.kb.GetValue():data.minVal)}var init={min:data.minVal,max:data.maxVal,value:aValue,change:function(){if($.isFunction(data.changeCB)){data.changeCB(data.definition)}}};var $num=$("<input></input>");$num.attr("id",aCntrl.aName).attr("name",aCntrl.aName).attr("type","number").attr("data-type","range").attr("min",data.minVal).attr("max",data.maxVal).attr("data-role","none").attr("data-theme",aCntrl.cssclassname.name).appendTo($fieldset);$num.slider(init);var fStyle=(aCntrl.cssclassname?aCntrl.cssclassname.name:"");if(fStyle.substr(0,1)=="'"){fStyle=eval(fStyle)}if(fStyle.length>0){$this.addClass(fStyle)}if(aCntrl.cssclassname&&aCntrl.cssclassname.dowysiwyg&&!appSettings.noStyleProps){if(aCntrl.applydialogfont===false){$this.css(aCntrl.dialog.fontToStyleObj(aCntrl.font))}}if(aCntrl.tabno>0){$this.attr("tabindex",aCntrl.tabno)}$num.change(function(){if($.isFunction(data.changeCB)){data.changeCB(data.definition)}});$this.data("xrui_ctrl",data)});return this},gettied:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");return data.kb},getSubCtrlLists:function(){return null},populate:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");if($this.length!=1){return}$num=$("input",$this);var aCntrl=data.definition;if(data.kb){data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));if(!data.kb.flatProps.isvisible){$this.hide()}else{var aValue=(data.kb.GetValue()?data.kb.GetValue():data.minVal);var firstPopulate=data.lastValue==null;var changed=data.lastValue==null;if(!changed){changed=data.lastValue!=aValue}if(changed){if(aValue<data.minVal){aValue=data.minVal}if(aValue>data.maxVal){aValue=data.maxVal}data.lastValue=aValue;$num.prop("value",aValue);if(!isEditor){setTimeout(function(){$num.slider("refresh")},20)}}$this.show()}if(data.kb.flatProps.isenabled){$num.slider("enable")}else{$num.slider("disable")}}if(aCntrl.readonly){$num.attr("readonly");$num.slider("disable")}else{$num.removeAttr("readonly");if(data.kb.flatProps.isenabled){$num.slider("enable")}}if(aCntrl.invalid){$num.addClass("xrui-slider-invalid")}else{$num.removeClass("xrui-slider-invalid")}});return this},_selection:function(){var $this=$(this.get(0));var $slider=$(".ui-slider-input",$this);if($slider.length==1){return parseInt($slider.val())}return(PSEUDO_VALUE_EMPTY)},setselection:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var value=$this.xrui_slider("_selection");if(data.kb){replayStack.Add(data.definition.dialog.aID,REPLAY_CHANGEEVENT,data.kb.aID,value)}})},isvalid:function(){var valid=true;this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var value=$this.xrui_slider("_selection");data.definition.invalid=false;if(data.kb){if(!data.kb.flatProps.allowblank&&data.kb.flatProps.isvisible&&data.kb.flatProps.isenabled){if(value.length==0){data.definition.invalid=true;valid=false}}}});return valid},focus:function(){var $this=$(this.get(0));var $slider=$(".xrui-slider",$this);if($this.length!=1){return false}if($this.is(":visible")){$this.focus();return true}return false},designtime:function(){return{tieditem:{atype:"tied",accepted:[TYPE_NUMERIC]},readonly:{atype:"bool",adefault:false},cssclassname:{atype:"css",displayname:"swatch"},showlabel:{atype:"bool",adefault:true},label:"str"}},destroy:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");$this.removeData("xrui_ctrl")})}};$.fn.xrui_slider=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.xrui_slider")}}}})(jQuery);(function(b){var a={init:function(d){this.each(function(){var l={definition:null,kb:null,changeCB:null,tiedDlgObj:0};b.extend(l,d);var r=b(this).addClass("xrui-subdialog");var f=l.definition;l.kb=dictionary.GetObject(f.tieddialog||(l.tiedDlgObj?l.tiedDlgObj.aID:0));var n=r;if(f.showlabel){var e;if(f.label!=""){e=f.dialog.expandEmbedded(f.label)}else{e=l.kb?l.kb.GetDescription(true):""}var k=b("<div></div>");f.dialog.populateLabel(k,e);k.addClass("ui-controlgroup-label").appendTo(n)}n=b("<div></div>").addClass("ui-controlgroup-controls").appendTo(r);var w=b("<table></table>");w.attr("data-role","table").attr("cellspacing","0").attr("cellpadding","0").attr("border","0").attr("data-mode","reflow").addClass("xrui-subdialog-table").appendTo(n);var p=b("<thead></thead>");p.appendTo(w);var t=b("<tr></tr>");t.appendTo(p);var j=b("<tbody></tbody>");j.appendTo(w);l.kb=dictionary.GetObject(l.definition.tieddialog||(l.tiedDlgObj?l.tiedDlgObj.aID:0));if(l.kb){var h=[];var q;var v=null;if(l.definition.columns){v=[];for(q=0;q<l.definition.columns.length;q++){v.push({att:l.definition.columns[q],isvisible:true})}}else{if(l.kb.aDefinition&&l.kb.aDefinition.instanceatts){v=l.kb.aDefinition.instanceatts}else{if(l.kb.flatProps&&l.kb.flatProps.instanceatts){v=l.kb.flatProps.instanceatts}}}l.atts=v;if(v){for(q=0;q<v.length;q++){if(v[q].isvisible){var g=dictionary.GetObject(v[q].att);if(g){var u=b("<th></th>").addClass("xrui-subdialog-table-header").html(g.GetDescription(true)).appendTo(t);if(q===0){u.css("border-top-left-radius","0.6em")}}}}var m=b("<th></th>");m.addClass("xrui-subdialog-table-header xrui-subdialog-image").html("&nbsp;").appendTo(t)}}r.data("xrui_ctrl",l)});return this},gettied:function(){var e=b(this.get(0));var d=e.data("xrui_ctrl");return d.kb},getSubCtrlLists:function(){return null},populate:function(){this.each(function(){var h=b(this);var y=h.data("xrui_ctrl");var e=y.definition;var l=b("table",h);if(h.length!=1){return}var d=e.dialog.aID;var j;if(e.dialog.definition.tieddialog){j=dictionary.GetObject(e.dialog.definition.tieddialog)}else{j=dictionary.GetObject(d)}var u=(e.parentdlg?dictionary.GetObject(e.parentdlg):j);l=b(".xrui-subdialog-table",h);b("tbody",l).remove();var r=b("<tbody></tbody>");r.appendTo(l);var x,g;var f=null;if(!y.kb){x=b("<tr></tr>").appendTo(r);g=b("<td></td>").attr("colspan",1).addClass("xrui-subdialog-noinstances").text("Empty").appendTo(x)}else{y.kb=dictionary.GetObject(e.tieddialog||(y.tiedDlgObj?y.tiedDlgObj.aID:0));var k=[];var v,q;f=u.GetDialogInstObject(y.kb.aID);if(y.atts){if(f){if(f.dialogs.length==0){x=b("<tr></tr>");x.appendTo(r);g=b("<td></td>").attr("colspan",y.atts.length+1).addClass("xrui-subdialog-noinstances").text("Empty").appendTo(x)}else{for(v=0;v<f.dialogs.length;v++){x=b("<tr></tr>").attr("idx",v).appendTo(r);var m=false;for(q=0;q<y.atts.length;q++){if(y.atts[q].isvisible){m=true;var t=f.dialogs[v].GetDialogInstObject(y.atts[q].att);var p;switch(t.aType){case TYPE_DATE:p=t.GetValueAsString(true);break;case TYPE_LIST:case TYPE_BOOLEAN:p=t.GetValueAsString(false,true);break;default:p=t.GetValueAsString()}if(y.kb.aType==TYPE_LIST){if(!f.dialogs[v].isFull()){p="<span class='ui-icon ui-icon-alert' style='float: left; margin-right: 4px;'></span>"+p}}g=b("<td></td>");g.addClass("xrui-subdialog-table-td").html(p);x.append(g)}}g=b("<td></td>").addClass("xrui-subdialog-table-td xrui-subdialog-image").appendTo(x);if(m){var n=b("<a></a>");n.attr("title","Edit Dialog Instance").attr("data-role","button").attr("data-icon","gear").attr("data-inline",true).attr("data-mini",true).html(y.definition.dialog.expandEmbedded(y.definition.editbtntext)).click(function(A){A.preventDefault();var o=parseInt(b(this).parent().parent().attr("idx"),10);var z=y.definition.parentdlg;if(!z){z=y.definition.dialog.definition.tieddialog}y.definition.dialog.subdialogedit(y.definition.tieddialog,z,o)}).button().appendTo(g);if(e.readonly){n.addClass("ui-disabled")}n=b("<a></a>");n.attr("title","Remove Dialog Instance").attr("data-role","button").attr("data-icon","delete").attr("data-inline",true).attr("data-mini",true).html(y.definition.dialog.expandEmbedded(y.definition.delbtntext)).click(function(A){A.preventDefault();var o=parseInt(b(this).parent().parent().attr("idx"),10);var z=y.definition.parentdlg;if(!z){z=y.definition.dialog.definition.tieddialog}y.definition.dialog.subdialogdelete(y.definition.tieddialog,z,o)}).button().appendTo(g);if(e.readonly){n.addClass("ui-disabled")}}}}}}}x=b("<tr></tr>").appendTo(r);g=b("<td></td>").attr("colspan",(y.atts?y.atts.length+1:1)).addClass("xrui-subdialog-addcell").appendTo(x);var w=b("<a></a>").attr("title","Add New Dialog Instance").attr("data-role","button").attr("data-icon","plus").attr("data-inline",true).addClass("xrui-subdialog-addbutton").html(y.definition.dialog.expandEmbedded(y.definition.addbtntext)).click(function(z){z.preventDefault();if(!h.is(":disabled")){var o=y.definition.parentdlg;if(!o){o=y.definition.dialog.definition.tieddialog}y.definition.dialog.subdialogadd(y.definition.tieddialog,o)}}).button().appendTo(g);if(f&&f.dialogs&&f.dialogs.length<y.definition.maxinstances&&!e.readonly){b(".xrui-subdialog-addbutton",h).removeClass("ui-disabled")}else{b(".xrui-subdialog-addbutton",h).addClass("ui-disabled")}if(e.invalid){h.addClass("xrui-subdialog-invalid")}else{h.removeClass("xrui-subdialog-invalid")}if(e.visible){h.show()}else{h.hide()}});return this},isvalid:function(){var d=true;this.each(function(){var j=b(this);var h=j.data("xrui_ctrl");var f=h.definition;var k=dictionary.GetObject(f.dialog.aID);var g=(f.parentdlg?dictionary.GetObject(f.parentdlg):k);var e=g.GetDialogInstObject(f.tieddialog);if(e&&e.dialogs){d=(e.dialogs.length>=f.mininstances)&&(e.dialogs.length<=f.maxinstances)}else{d=f.mininstances==0}});return d},focus:function(){var d=b(this.get(0));if(d.length!=1){return false}if(d.is(":visible")){d.focus();return true}return false},destroy:function(){return this.each(function(){var e=b(this);var d=e.data("xrui_ctrl");e.removeData("xrui_ctrl")})}};b.fn.xrui_subdialog=function(d){if(a[d]){return a[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){return a.init.apply(this,arguments)}else{b.error("Method "+d+" does not exist on jQuery.xrui_subdialog")}}}})(jQuery);(function(b){var a={init:function(d){this.each(function(){var j={definition:null,changeCB:null,firsttime:true};b.extend(j,d);var p=b(this);var f=j.definition;var l=j.definition.dialog.expandEmbedded(f.caption);var r=b("<ul></ul>");r.addClass("xrui-tabsheet-pagetitle").css("width",f.captionwidth+"px").appendTo(p);if(l!=""){f.activesheet++;var q=b("<li></li>");q.addClass("xrui-tabsheet-title").html(l).appendTo(r)}var o,k,n;var e=0;for(o=0;o<f.tabsheets.length;o++){f.tabsheets[o].tab=f;k=f.tabsheets[o];n=b("<li></li>").attr("idx",o);b("<span class='xrui-tabsheet-pagetitle-text'></span>").appendTo(n);if(f.tabsheets[o].controls.length==0){n.addClass("xrui-tabsheet-pagetitle-blank")}else{if(f.showmarkers){b("<div class='xrui-tabsheet-pagetitle-image'></div>").prependTo(n)}n.click(function(){var t=b(".xrui-tabsheet-pagetitle li");var u=b(".xrui-tabsheet-contents li");u.hide();t.removeClass("current");b(u[b(this).attr("idx")]).show();b(this).addClass("current");f.activesheet=b(this).attr("idx")+1})}n.appendTo(r);f.tabsheets[o].$cap=n}var g=b("<ul></ul>");g.addClass("xrui-tabsheet-contents").appendTo(p);for(o=0;o<f.tabsheets.length;o++){k=f.tabsheets[o];n=b("<li></li>");n.appendTo(g);var m=b("<div></div>");m.appendTo(n);f.dialog.renderCtrls(f.tabsheets[o].controls,m,f.tabsheets[o])}var h=b("<div></div>");h.addClass("xrui-tabsheet-footer").appendTo(p);p.addClass("xrui-tabsheet");if(f.tabno>0){p.attr("tabindex",f.tabno)}p.data("xrui_ctrl",j)});return this},gettied:function(){return null},getSubCtrlLists:function(){var d=[];this.each(function(){var g=b(this);var f=g.data("xrui_ctrl");if(!f){return}var e=f.definition;for(var h=0;h<e.tabsheets.length;h++){d.push(e.tabsheets[h])}});return d},populate:function(){this.each(function(){var h=b(this);var g=h.data("xrui_ctrl");var f=g.definition;f.dialog.validate(true);for(var j=0;j<f.tabsheets.length;j++){var d=f.dialog.expandEmbedded(f.tabsheets[j].caption);b(".xrui-tabsheet-pagetitle-text",f.tabsheets[j].$cap).html(d);var e=b(".xrui-tabsheet-pagetitle-image",f.tabsheets[j].$cap);if(f.tabsheets[j].isvisible){e.removeClass("xrui-tabsheet-pagetitle-invalidsel");e.removeClass("xrui-tabsheet-pagetitle-invalid");e.removeClass("xrui-tabsheet-pagetitle-valid");if(f.tabsheets[j].invalidsel){e.addClass("xrui-tabsheet-pagetitle-invalidsel")}else{if(f.tabsheets[j].invalid){e.addClass("xrui-tabsheet-pagetitle-invalid")}else{e.addClass("xrui-tabsheet-pagetitle-valid")}}}else{if(f.activesheet>f.tabsheets.length){f.activesheet=1}b("ul > li:eq("+j+")").addClass("xrui-tabsheet-page-hide")}f.dialog.populateCtrls(f.tabsheets[j].controls)}if(g.firsttime){g.firsttime=false;b("ul li:eq("+(f.activesheet-1)+")",h).click()}});return this},focus:function(){var d=false;this.each(function(){var g=b(this);var f=g.data("xrui_ctrl");var e=f.definition;d=(b(".ui-btn-active",g).length>0)});return d},destroy:function(){this.each(function(){var e=b(this);var d=e.data("xrui_ctrl");e.removeData("xrui_ctrl")})}};b.fn.xrui_tabsheet=function(d){if(a[d]){return a[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){return a.init.apply(this,arguments)}else{b.error("Method "+d+" does not exist on jQuery.xrui_tabsheet")}}}})(jQuery);(function($){var methods={init:function(options){this.each(function(){var data={definition:null,kb:null,changeCB:null,tiedDlgObj:0,multiline:false,currentVal:""};$.extend(data,options);var $this=$(this);var aCntrl=data.definition;$this.addClass("xrui-textedit");var $txt=null;data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));var $fieldset=$("<fieldset></fieldset>");$fieldset.attr("data-role","controlgroup").appendTo($this);if(aCntrl.showlabel){var aDescr;if(aCntrl.label!==""){aDescr=aCntrl.dialog.expandEmbedded(aCntrl.label)}else{aDescr=data.kb?data.kb.GetDescription(true):""}var $legend=$("<legend></legend>");aCntrl.dialog.populateLabel($legend,aDescr);$legend.appendTo($fieldset)}else{$this.addClass("xrui-nocaption")}if(data.kb){if(data.kb.flatProps.multiline){data.multiline=true;$txt=$("<textarea></textarea>")}if(data.kb.flatProps.ispassword){$txt=$("<input type='password'></input>")}}if($txt==null){$txt=$("<input type='text'></input>")}$txt.attr("id","Text_input").attr("name","Text_input").keypress(function(e){return !data.definition.readonly}).keydown(function(e){if(data.definition.readonly){e.preventDefault()}}).keyup(function(e){if(data.definition.readonly){e.preventDefault()}});if(aCntrl.jqmattributes){var a=aCntrl.jqmattributes;if(a.substr(0,1)=="'"){a=eval(a)}try{a=JSON.parse("{"+a+"}");$txt.attr(a)}catch(e){}}$txt.appendTo($fieldset);var cName="";cName=(aCntrl.cssclassname?aCntrl.cssclassname.name:"");if(cName.substr(0,1)=="'"){cName=eval(cName)}if(cName.length>0){$this.addClass(cName)}if(aCntrl.cssclassname&&aCntrl.cssclassname.dowysiwyg&&!appSettings.noStyleProps){if(!aCntrl.applydialogfont){$this.css(aCntrl.dialog.fontToStyleObj(aCntrl.font))}}if(data.kb){if(!data.kb.flatProps.allowblank){$this.addClass("xrkb-obligatory");$("<div class='xrkb-obligatory-marker'></div>").appendTo($fieldset)}var aMask=data.kb.flatProps.inputmask;if(aMask&&(aMask!=="")&&!data.multiline){if(aMask.substr(0,1)=="'"){aMask=eval(aMask)}$("input",$this).mask(aMask)}$txt.change(function(ev){if(data.currentVal!=$txt.val()){if($.isFunction(data.changeCB)){data.currentVal=$txt.val();data.changeCB(data.definition)}}}).keydown(function(event){if(event.which==13&&!data.multiline){event.preventDefault();if(data.currentVal!=$txt.val()){data.currentVal=$txt.val();data.changeCB(data.definition)}aCntrl.dialog.progressOnCR(data.definition)}});data.$helpDiv=data.definition.dialog.renderHelp($this,data.kb)}if(aCntrl.tabno>0){$this.attr("tabindex",aCntrl.tabno)}$this.data("xrui_ctrl",data);$this.xrui_textedit("_setSelectedIDfromDictionary");$this.trigger("create")});return this},gettied:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");return data.kb},getSubCtrlLists:function(){return null},populate:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");var aCntrl=data.definition;var $txt=$("input,textarea",$this);if($txt.length!=1){return}if(data.kb){data.kb=dictionary.GetObject(aCntrl.tieditem||(data.tiedDlgObj?data.tiedDlgObj.aID:0));var aVal=data.kb.GetValue();$txt.val(aVal);data.currentVal=aVal;if(!data.kb.flatProps.isvisible){$this.hide();if(data.$helpDiv){data.$helpDiv.hide()}}else{$this.show();if(data.$helpDiv){data.$helpDiv.show()}}if(!data.kb.flatProps.isenabled){$txt.textinput("disable")}else{$txt.textinput("enable")}}if(aCntrl.invalid){$txt.addClass("xrui-textedit-invalid")}else{$txt.removeClass("xrui-textedit-invalid")}});return this},_setSelectedIDfromDictionary:function(){this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");if(data.kb){data.currentVal=data.kb.GetValue()}});return this},setselection:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");if(data.kb){var v=data.currentVal;if(v===""){v=PSEUDO_VALUE_EMPTY}data.kb.SetValue(v);replayStack.Add(data.definition.dialog.aID,REPLAY_CHANGEEVENT,data.kb.aID,v)}})},isvalid:function(){var valid=true;this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");if(data.kb){if(!data.kb.flatProps.allowblank&&data.kb.flatProps.isvisible&&data.kb.flatProps.isenabled){if(!data.currentVal){valid=false}}}});return valid},focus:function(){var $this=$(this.get(0));var data=$this.data("xrui_ctrl");var $txt=$("input,textarea",$this);if($txt.length!=1){return false}if($txt.is(":visible")){var s=$txt.val();$txt.val("").focus().val(s);return true}return false},designtime:function(){return{cssclassname:{atype:"css",displayname:"swatch"},jqmattributes:"str",readonly:{atype:"bool",adefault:false},label:"str",showlabel:{atype:"bool",adefault:true},tieditem:{atype:"tied",accepted:[TYPE_TEXT]}}},destroy:function(){return this.each(function(){var $this=$(this);var data=$this.data("xrui_ctrl");$this.removeData("xrui_ctrl")})}};$.fn.xrui_textedit=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.xrui_textedit")}}}})(jQuery);(function(b){var a={init:function(d){this.each(function(){var h={definition:null,kb:null,changeCB:null,tiedDlgObj:0,selectedID:0};b.extend(h,d);var k=b(this);var f=h.definition;h.kb=dictionary.GetObject(f.tieditem||(h.tiedDlgObj?h.tiedDlgObj.aID:0));var g=(h.kb?h.kb.GetDescription(true):"Description");if(h.kb){var l=b("<fieldset></fieldset>");l.addClass("ui-select").attr("data-role","controlgroup").attr("data-type","horizontal").appendTo(k);if(!h.kb.flatProps.allowblank){k.addClass("xrkb-obligatory");b("<div class='xrkb-obligatory-marker'></div>").appendTo(l)}if(f.showlabel){var j=b("<legend></legend>");f.dialog.populateLabel(j,g);j.appendTo(l)}if(!h.kb.isMultiSel){var e=b("<label></label>");e.text(g).appendTo(l)}h.$helpDiv=h.definition.dialog.renderHelp(k,h.kb)}if(f.tabno>0){k.attr("tabindex",f.tabno)}k.data("xrui_ctrl",h)});b(this).xrui_ticklistbox("_setSelectedIDfromDictionary");return this},gettied:function(){var e=b(this.get(0));var d=e.data("xrui_ctrl");return d.kb},getSubCtrlLists:function(){return null},populate:function(){this.each(function(){var k=b(this);var h=k.data("xrui_ctrl");var g=h.definition;var f=b("fieldset",k);if(f.length!=1){return}if(h.clicked){return}f.empty();if(h.kb){h.kb=dictionary.GetObject(g.tieditem||(h.tiedDlgObj?h.tiedDlgObj.aID:0));if(g.showlabel){var j=b("<legend></legend>");j.text(h.kb.GetDescription(true)).appendTo(f)}for(var l=0;l<h.kb.aValues.length;l++){f.append(b("<input></input>").attr("name",g.aName+"_rd").attr("id",g.aName+"_rd"+l).attr("type",(h.kb.isMultiSel?"checkbox":"radio")).attr("value",h.kb.aValues[l].aID).attr("data-theme",g.cssclassname.name).change(function(o){if(b.isFunction(h.changeCB)){var m=parseInt(o.currentTarget.value);if(h.kb.isMultiSel){var p=h.kb.GetValue();if(b(o.currentTarget).attr("checked")){if(jQuery.inArray(m,p)<0){p.push(m)}}else{var n=jQuery.inArray(m,p);if(n>=0){p.splice(n,1)}}h.selectedID=p}else{h.selectedID=m}h.clicked=true;h.changeCB(h.definition);h.clicked=false}}));var e=b("<label></label>");e.attr("for",g.aName+"_rd"+l).text(h.kb.GetValueDescr(l)).appendTo(f)}var d=h.kb.GetValue();if(d){f.val(d)}if(!h.kb.flatProps.isvisible){k.hide();if(h.$helpDiv){h.$helpDiv.hide()}}else{k.show();if(h.$helpDiv){h.$helpDiv.show()}}if(!h.kb.flatProps.isenabled){f.addClass("ui-state-disabled");f.attr("disabled","disabled")}else{f.removeClass("ui-state-disabled");f.removeAttr("disabled")}}if(g.invalid){f.addClass("xrui-ticklistbox-invalid")}else{f.removeClass("xrui-ticklistbox-invalid")}});return this},_setSelectedIDfromDictionary:function(){this.each(function(){var f=b(this);var e=f.data("xrui_ctrl");if(e.kb){var d=e.kb.GetValue();if(b.isArray(d)){if(d.length>0){e.selectedID=d}else{e.selectedID=0}}else{e.selectedID=d}}});return this},setselection:function(){return this.each(function(){var e=b(this);var d=e.data("xrui_ctrl");if(d.kb){replayStack.Add(d.definition.dialog.aID,REPLAY_CHANGEEVENT,d.kb.aID,d.selectedID)}})},isvalid:function(){var d=true;this.each(function(){var f=b(this);var e=f.data("xrui_ctrl");d=e.definition.dialog.isValueValid(e.kb,e.selectedID)});return d},focus:function(){var e=b(this.get(0));var d=b("fieldset",e);if(d.length!=1){return false}if(d.is(":visible")){d.focus();return true}return false},destroy:function(){return this.each(function(){var e=b(this);var d=e.data("xrui_ctrl");e.removeData("xrui_ctrl")})}};b.fn.xrui_ticklistbox=function(d){if(a[d]){return a[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){return a.init.apply(this,arguments)}else{b.error("Method "+d+" does not exist on jQuery.xrui_ticklistbox")}}}})(jQuery);