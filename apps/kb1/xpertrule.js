/*!
 * XpertRule(R) Decision Author Chat Engine
 * Copyright (c) 2017 XpertRule Software Limited
 *             www.xpertrule.com
 */
var NODEJS=true;var module={exports:[]};var global=[];var chat_mode="browser";var xrkb_include_folder="";var utterance="";ObjectExtend=function(d,a){function b(){}b.prototype=a.prototype;d.prototype=new b();d.prototype.constructor=d;d.baseConstructor=a;d.superClass=a.prototype};var NODEJS=false;if(typeof module!=="undefined"&&module.exports){NODEJS=true}var isIE,isChrome;if(!NODEJS){isIE=document.all;isChrome=navigator.userAgent.toLowerCase().indexOf("chrome")>-1}else{isIE=isChrome=false}var isChromeDesktop=false;(function(){if(!NODEJS){var a=navigator.userAgent.toLowerCase();isChromeDesktop=((a.indexOf("chrome")>=0)||(a.indexOf("firefox")>=0))&&(a.indexOf("mobile")==-1)}})();var STRING_END_MESSAGE;var TYPE_LIST=1;var TYPE_NUMERIC=2;var TYPE_DATE=3;var TYPE_BOOLEAN=4;var TYPE_PROCEDURE=5;var TYPE_REPORT=6;var TYPE_DIALOG=7;var TYPE_VARIABLE=8;var TYPE_CTABLE=9;var TYPE_TEXT=10;var TYPE_HIERARCHY=11;var TYPE_TXTPROCESSOR=12;var TYPE_CATEGORY=13;var TYPE_MLIST=99;var TYPE_VARIABLE_NUM_ARRAY=100;var TYPE_VARIABLE_STR_ARRAY=101;var TYPE_WIZZARD=102;var NODETYPE_LEAF=1;var NODETYPE_SPLIT=2;var NODETYPE_INLINE=3;var NODETYPE_LABEL=4;var NODETYPE_PROC=5;var NODETYPE_PAGE=6;var NODETYPE_LEAFJUMP=7;var NODETYPE_LEAFPROC=8;var NODETYPE_SEQUENCE=9;var NODETYPE_BRANCH=10;var CASE_ALL=0;var CASE_VALUES=1;var CASE_VALUE=2;var CASE_ATTCOMP=3;var CASE_SET_VALUES=4;var CASE_SET_VALUE=5;var CASE_DESCRIPTION=6;var CASE_DUMMY=99;var VARTYPE_NUM=1;var VARTYPE_STR=2;var REPLAY_SET=1;var REPLAY_OK=2;var REPLAY_MACRO=3;var REPLAY_CHANGEEVENT=4;var REPLAY_EXIT=5;var REPLAY_CANEXIT=6;var REPLAY_UI=7;var REPLAY_JSONSET=8;var REPLAY_SYSTEMSET=9;var REPLAY_UI_STOP=10;var REPLAY_OK_WITHVALIDATION=11;var REPLAY_RESTARTPOS=12;var REPLAY_SUBDIALOGEVENT=13;var REPLAY_SETDIALOGPROP=14;var REPLAY_CAPTUREDATT=15;var REPLAY_FORMTREESTART=16;var REPLAY_FORMTREESET=17;var REPLAY_OBJRETURN=18;var REPLAY_ADHOC=19;var REPLAY_CRITICALDONE=20;var REPLAY_GROUPSET=21;var REPLAY_SETFULL=22;var REPLAY_SETPROP=23;var REPLAY_SUBDIALOGADD=1;var REPLAY_SUBDIALOGEDIT=2;var REPLAY_SUBDIALOGDEL=3;var REPLAYPOP_HANDLED=1;var REPLAYPOP_CURRENT=2;var REPLAYPOP_STOP=3;var PASSBACK_PAUSE=1;var PASSBACK_ERROR=2;var PASSBACK_END=3;var PASSBACK_DEBUG=4;var PASSBACK_WAIT=5;var PASSBACK_PAUSETREEPAGE=6;var PASSBACK_LOOP=7;var PASSBACK_LOADIFRAME=8;var PASSBACK_DIALOG=9;var PASSBACK_PAUSECMD=10;var CONTROL_LABEL=1;var CONTROL_BUTTON=2;var CONTROL_LISTBOX=3;var CONTROL_NUMERIC=4;var CONTROL_IMAGE=5;var CONTROL_ARRAYEDIT=6;var CONTROL_CHECKBOX=7;var CONTROL_RADIOBTN=8;var CONTROL_ARRAYLIST=9;var CONTROL_HOTSPOT=10;var CONTROL_GRID=11;var CONTROL_DATE=12;var CONTROL_TABSHEET=13;var CONTROL_IFRAME=14;var CONTROL_SUBDIALOG=15;var CONTROL_TEXTEDIT=16;var CONTROL_COLUMNS=17;var CONTROL_JQMBREAK=18;var CONTROL_FILEUPLOAD=19;var CONTROL_FRAME=20;var EVENT_UPDATE=1;var EVENT_CAPTURE=2;var EVENT_LEAVE=3;var EVENT_HIERARCHYENTER=4;var EVENT_HIERARCHYEXIT=5;var EVENT_POSTRULES=6;var TREE_PROP_FLAT=1;var TREE_PROP_VALUE=2;var PSEUDO_VALUE_EMPTY="__XR__EMPTY__";var DEFAULT_PREVIOUSANSWERSTEXT="Previous Answers";var ADHOC_DIALOG_PSEUDOID=-9999;var EMPTY_LEAF=-999999;var BACK_TIMEOUT_MS=350;var OK_TEXT="Continue";if(isIE){OK_TEXT="   "+OK_TEXT+"   "}var TY_AV=0;var TY_SV=1;var TY_MV=2;var TY_NT=3;var TY_IA=4;var TY_AT=5;var SETOP_ADD=1;var SETOP_DEL=2;var VALID_UNKNOWN=0;var VALID_TRUE=1;var VALID_FALSE=2;var VALID_NEWFALSE=3;var VALID_NEWTRUE=4;var COMP_EQ=0;var COMP_NE=1;var COMP_LT=2;var COMP_LE=3;var COMP_GT=4;var COMP_GE=5;var PROP_NONE=0;var PROP_FLAT=1;var PROP_VALUE=2;var ALTLIST_SELECTION="<span class='selected_marker'>(selected)</span>";var CL_NONE="na";var LOR_NONE=0;var LOR_ATT=1;var LOR_TASK=2;var xrkb_engine_version={major:11,minor:1,build:2};var uidiv=null;var activeDialogStack=[];var dialog_offset_x=0;var dialog_offset_y=0;var popupReportObject=null;var popupReportText="";var capturedAtts=[];var capturingAtts=true;var lineOfReasoning=[];var baseDialogs=[];var tickTime=0;var XRdocVars=[];var autoRun=true;var wrapperOptions={};var customStartup=false;var performedGo=false;var isMobile=false;var appEmbedded=false;var currentDlg=null;var modalDlg=null;var jsAjax=false;var jsAjaxSessionID=0;var delayedGoTimer=null;var msgFlashDiv=null;var msgFlashDivTimer=null;var isEditor=false;var xrkb_func_args=[];var lastErr=null;function isSmartTv(){if(NODEJS){return false}return window.hasOwnProperty("smartTv")}function getVersionAsString(){return JSON.stringify(xrkb_engine_version)}function ConvertForDisplay(e,d,b){if((e===null)||(e===undefined)){return""}var a=typeof e;if(a=="number"){e=e.toString()}else{if((a=="object")&&(e instanceof Date)){e=Cmd_DateToStr(e)}else{if(a!="string"){e=""+e}else{if(e=="__(none)"){e=""}}}}if(e===""){return e}if(b){return e}e=e.replace(/&/g,"&amp;");e=e.replace(/</g,"&lt;");e=e.replace(/>/g,"&gt;");e=e.replace(/"/g,"&quot;");e=e.replace(/\x0d|\x0a/g,"<br>");if(d){e=e.replace(/\s/g,"&nbsp;")}return e}function IsAlreadyCapturedDlg(b){for(var a=0;a<capturedAtts.length;a++){if((typeof capturedAtts[a]=="object")&&capturedAtts[a].hasOwnProperty("instID")&&(capturedAtts[a].instID==b)){return true}}return false}function AppendCapturedAtt(b){if(!capturingAtts){return}for(var a=0;a<capturedAtts.length;a++){if(capturedAtts[a]==b){break}}if(a>=capturedAtts.length){capturedAtts[capturedAtts.length]=b}lineOfReasoning.push({atype:LOR_ATT,id:b})}function CreateElement2(a,f,e,d){var b=document.createElement(a);b.id=f;if(e!==undefined){b.innerHTML=e}if(!d){d=document.body}d.appendChild(b);return b}function getTranslation(a,b){if(typeof(lang)=="undefined"){return b}if(!lang.hasOwnProperty(a)){return b}return lang[a]}function GetTickCount(){var a=new Date();return a.getTime()}function inferenceIssue(b,a,d){this.aState=b;this.aValue=(a!==undefined?a:"");if((b!=PASSBACK_DEBUG)&&!d){d=""}this.aExtra=d}inferenceIssue.prototype.toString=function(){return"Inference Issue : "+this.aState+" : "+this.aValue+" : "+this.aExtra};function IsjQueryMissingMethodException(a){if(typeof a=="object"&&a.message&&a.message.indexOf("does not exist")!=-1){return true}if(typeof a=="string"&&a.indexOf("does not exist")!=-1){return true}return false}function softError(a){if(stk_isValid()){console.log("Warning from "+stk_toString())}console.log((!stk_isValid()?"Warning: ":"")+a)}function hardError(a){throw new inferenceIssue(PASSBACK_ERROR,a)}var htmlDialogCallBacks={list:[],add:function(a,d,b){if(!$.isFunction(d)){throw"Must pass a function"}this.list.push({id:a,callback:d,type:b})},reset:function(){this.list.splice(0,this.list.length)},find:function(a,b){for(var d=0;d<this.list.length;d++){if((this.list[d].id==a)&&(this.list[d].type==b)){return this.list[d]}}return null},onRender:function(a){var b=this.find(a,"onrender");if(!b){return}setTimeout(function(){b.callback()},1)},onPopulate:function(a){var b=this.find(a,"onpopulate");if(!b){return}b.callback()}};function URLparam(b,a){this.aName=b;this.aValue=a}function URLparams(){this.aParams=[];this.site="";this.postIdent=0;this.postData=null}URLparams.prototype.Add=function(d,a){var b=new URLparam(d,a);this.aParams[this.aParams.length]=b};URLparams.prototype.Clear=function(){this.aParams=[]};URLparams.prototype.Get=function(b){for(var a=0;a<this.aParams.length;a++){if(this.aParams[a].aName==b){return this.aParams[a].aValue}}return""};URLparams.prototype.toString=function(d){var a="";for(var b=0;b<this.aParams.length;b++){if((a.length>0)||d){a+="&"}a+=escape(this.aParams[b].aName)+"="+escape(this.aParams[b].aValue)}return a};URLparams.prototype.Setup=function(){this.Clear();var d=document.location.href;var b=d.split("?");var f,e;this.site=b[0];if(b.length==2){b=b[1].split("&");for(var g=0;g<b.length;g++){f=b[g].split("=");if(f.length==2){e=decodeURIComponent(f[0]);aVal=decodeURIComponent(f[1]);if(e.toLowerCase()=="bm"){replayStack.UnSerialize(aVal)}else{if(e.toLowerCase()=="autorun"){if(aVal.toLowerCase()=="false"){autoRun=false}}else{if(e.toLowerCase()=="post"){this.postIdent=parseInt(aVal,10);autoRun=false}else{this.Add(e,aVal)}}}}}}};URLparams.prototype.Populate=function(){for(var b=0;b<this.aParams.length;b++){Cmd_SetValueAsStr(this.aParams[b].aName,this.aParams[b].aValue)}if(this.postData){for(var a in this.postData){Cmd_SetValueAsStr(a,this.postData[a])}}};function CachedCookie(d,b,a){this.aName=d;this.aValue=b;this.aExpireHours=a}function CookieCache(){this.cookies=[]}CookieCache.prototype.Clear=function(){this.cookies=[]};CookieCache.prototype.Add=function(e,b,a){var d=this.Get(e);if(d){d.aValue=b;d.aExpireHours=a}else{d=new CachedCookie(e,b,a);this.cookies[this.cookies.length]=d}};CookieCache.prototype.Get=function(b){for(var a=0;a<this.cookies.length;a++){if(this.cookies[a].aName==b){return this.cookies[a]}}return null};CookieCache.prototype.Write=function(){var b;for(var d=0;d<this.cookies.length;d++){b="";if(this.cookies[d].aExpireHours){var a=new Date();a.setHours(a.getHours()+this.cookies[d].aExpireHours);b=";expires="+a.toUTCString()}document.cookie=this.cookies[d].aName+"="+escape(this.cookies[d].aValue)+b}};var urlParams=new URLparams();var cookieCache=new CookieCache();var authorUsrID=0;function EncodeForDoubleQuotes(b){var a="";for(var d=0;d<b.length;d++){if((b.charAt(d)=='"')||(b.charAt(d)=="\\")){a+="\\"+b.charAt(d)}else{if(b.charCodeAt(d)==13){a+="\\n"}else{if(b.charCodeAt(d)==10){a+="\\r"}else{if(b.charCodeAt(d)==9){a+="\\t"}else{if(b.charCodeAt(d)>=32){a+=b.charAt(d)}}}}}}return a}function ElementToStr(b){if(typeof(b)=="undefined"){return""}else{if(typeof(b)=="boolean"){return b?"true":"false"}else{if(typeof(b)=="number"){return b+""}else{if($.isArray(b)){return ArrayToStr(b)}else{if($.isFunction(b)){hardError("ElementToStr : Cannot encode a function!");return}else{if(typeof(b)=="string"){var a="'";for(var d=0;d<b.length;d++){if((b.charAt(d)=="'")||(b.charAt(d)==",")||(b.charAt(d)=="\\")){a+="\\"}a+=b.charAt(d)}a+="'";return a}else{hardError("ElementToStr : Unsupported type ["+typeof(b)+"]");return}}}}}}}function ArrayToStr(b){var d="";for(var e=0;e<b.length;e++){d+=(d.length>0?",":"")+ElementToStr(b[e])}return"["+d+"]"}function HasSessionID(){if(wrapperOptions.nodejs){return false}var d=false;var a=document.cookie.split(";");for(var b=0;(b<a.length)&&!d;b++){var e=a[b];while(e.charAt(0)==" "){e=e.substring(1,e.length)}if(e.indexOf("saas_session")===0){d=true}}return d}function InferenceEnd(){if(currentDlg){currentDlg.free();currentDlg=null}if(HasSessionID()){document.getElementById("xrback").src="end.php"}if((typeof xrBootstrap!="undefined")&&$.isPlainObject(xrBootstrap)){if(xrBootstrap.endCBpage){document.getElementById("xrback").src=xrBootstrap.endCBpage}}}function StartTick(){var a=new Date();tickTime=a.getTime()}function TestTick(){if(wrapperOptions.nodejs){working=false;return true}if(document.cookie==""){working=false;return true}var d=document.cookie.split("=");if(d[0]!="saas_session"){working=false;return true}var a=new Date();if(a.getTime()-tickTime>=60000){StartTick();if(HasSessionID()){working=false;var b="../../../watchdog.php";loadXMLDoc(b,"postData","GET",0);return false}else{alert("Server Timed out!!! - Start Again")}}else{return true}}function SetUserID(a){authorUsrID=a}function RipToChar(a,f){var d=0;var b=false;var e=0;while(d<a.length){if(a.charAt(d)=="'"){if(b){if(a.charAt(d-1)!="\\"){b=false}}else{b=!b}}else{if((a.charAt(d)=="[")&&!b){e++}else{if((a.charAt(d)=="]")&&!b){e--}else{if((a.charAt(d)==f)&&(e==0)&&!b){return{head:a.substr(0,d),tail:a.substr(d+1)}}}}}d++}return{head:a,tail:""}}function setCookie(d,b,e,a){cookieCache.Add(b,e,a)}function getCookie(d,b){var e=cookieCache.Get(b);if(e){return e.aValue}if(document.cookie.length>0){var f=document.cookie.indexOf(b+"=");if(f!=-1){f=f+b.length+1;var a=document.cookie.indexOf(";",f);if(a==-1){a=document.cookie.length}return unescape(document.cookie.substring(f,a))}return""}return""}function SimpleObjectToString(b){var a="";for(var d in b){a+=d+": "+b[d]+"\n"}a+="["+b.toString()+"]";return a}function RoundDP(b,e){if(e>0){var a=1;for(var d=0;d<e;d++){a*=10}return Math.round(b*a)/a}return b}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F"};function escapeHtml(a){return String(a).replace(/[&<>"'\/]/g,function(b){return entityMap[b]})}var xrEmbedTst=/{.*?}/g;function LabelDecode(t,b,n){t=ResourceDecode(t);if(t.indexOf("{")<0){return t}var j,h,r,e;var u="";var l=0;var a=false;while(j=xrEmbedTst.exec(t)){u+=t.substring(l,j.index);l=j.index+j[0].length;var q=j[0].substr(1,j[0].length-2);if(q.toLowerCase()=="__project"){q=appSettings.description?appSettings.description:"";if(q.length==0){q=appSettings.title}u+=q}else{if((q.substr(0,2)=="__")&&(q.substr(0,3)!="___")){h=q.indexOf("|");if(h>=0){r=q.substr(h+1);q=q.substr(0,h);e=_dgo(parseInt(r,10));if(e){q=e.aName+"."+q.substr(2)}}else{if(b){q=b.aName+"."+q.substr(2)}}}var f=true;var d,g;var k=q.indexOf(":");if(k>=0){var m=q.substr(k+1).toLowerCase();q=q.substr(0,k);if(m=="noescape"){f=false}else{k=m.indexOf(":");if(k>0){d=parseInt(m.substr(0,k),10);g=parseInt(m.substr(k+1),10)}else{g=parseInt(m,10)}}}var p=Cmd_GetValue(q,undefined,g);if(f&&n){p=escapeHtml(p)}u+=p}a=true}u+=t.substr(l);if((t.indexOf("{")>=0)&&a){u=LabelDecode(u,b,n)}return u}var xrResEmbedTst=/{{.*?}}/g;function ResourceDecode(d){if(d.indexOf("{")<0){return d}var b;var a="";var e=0;while(b=xrResEmbedTst.exec(d)){a+=d.substring(e,b.index);e=b.index+b[0].length;if(isEditor&&xrkb_resources){a+=xrkb_resources.getResourceURL(b[0].substr(2,b[0].length-4))}else{a+=xrkb_include_folder+"assets/"+b[0].substr(2,b[0].length-4)}}a+=d.substr(e);return a}function Handle2(a){if(typeof a!="string"){return a}else{if(a.substr(0,1)!="~"){return a}else{return Handle(a.substr(1,a.length-1))}}}function IsEqual(b,a){if(b.length!=a.length){return false}for(var d=0;d<b.length;d++){if($.inArray(b[d],a)==-1){return false}}return true}function IsIn(a,b){return $.inArray(a,b)>-1}function SubSet(b,a){if((b.length==0)&&(a.length>0)){return false}for(var d=0;d<b.length;d++){if($.inArray(b[d],a)==-1){return false}}return true}function SuperSet(b,a){for(var d=0;d<a.length;d++){if($.inArray(a[d],b)==-1){return false}}return true}function Intersect(b,a){for(var d=0;d<b.length;d++){if($.inArray(b[d],a)>=0){return true}}return false}var _0x7f92=["\x6C\x65\x6E\x67\x74\x68","","\x75\x6E\x64\x65\x66\x69\x6E\x65\x64","\x65\x78\x70\x6F\x72\x74\x73","\x6E\x6F\x64\x65\x6B\x65\x79","\x68\x61\x73\x4F\x77\x6E\x50\x72\x6F\x70\x65\x72\x74\x79","\x74\x6F\x55\x70\x70\x65\x72\x43\x61\x73\x65","\x68\x6F\x73\x74","\x58\x59\x5A\x5A\x59","\x63\x68\x61\x72\x43\x6F\x64\x65\x41\x74","\x73\x75\x62\x73\x74\x72","\x66\x72\x6F\x6D\x43\x68\x61\x72\x43\x6F\x64\x65","\x62\x6F\x62"];function Handle(l){if(l[_0x7f92[0]]==0){return _0x7f92[1]}var k;if(typeof module!==_0x7f92[2]&&module[_0x7f92[3]]){if(!appSettings[_0x7f92[5]](_0x7f92[4])){return l}k=appSettings[_0x7f92[4]]}else{k=location[_0x7f92[7]][_0x7f92[6]]()}if(k[_0x7f92[0]]==0){k=_0x7f92[8]}var h=56295;var f;for(f=0;f<k[_0x7f92[0]];f++){h=h^k[_0x7f92[9]](f)}h=(h&65535);var e;for(f=0;f<5;f++){e=((h&1)<<15);h=((h>>1)|e)}var d=_0x7f92[1];for(var b=0,a=0;b<l[_0x7f92[0]];b+=3,a++){var j=k[_0x7f92[9]](a%k[_0x7f92[0]]);var g=parseInt(l[_0x7f92[10]](b,3),16);d+=String[_0x7f92[11]](j<=g?g-j:(g+256)-j)}return d}function Dictionary(){this.aDictionary=[];this.aReplay=[];this.scannedForStaticData=false;this.hackedMinusOneObject=null;this.aNameLookup=null}Dictionary.prototype.Add=function(a){if((this.aDictionary.length==0)||(a.aID>this.aDictionary[this.aDictionary.length-1].aID)){this.aDictionary.push(a)}else{for(var b=0;b<this.aDictionary.length;b++){if(this.aDictionary[b].aID>a.aID){break}}this.aDictionary.splice(b,0,a)}};Dictionary.prototype.GetObjectData=function(a){if(!a){return a}return a.GetInstanceRef()};Dictionary.prototype.indexOf=function(d){var b=0;var a=this.aDictionary.length-1;if(a>=0){var e;do{e=Math.floor((a-b)/2)+b;if(this.aDictionary[e].aID==d){return e}else{if(this.aDictionary[e].aID<d){b=e+1}else{a=e-1}}}while(b<=a)}return -1};Dictionary.prototype.GetObject=function(b,a){if(typeof b=="string"){return this.GetObjectByName(b)}if(b==-1){return this.hackedMinusOneObject}var d=this.indexOf(b);if(d==-1){return null}if(a){return this.aDictionary[d]}else{return this.GetObjectData(this.aDictionary[d])}};Dictionary.prototype.indexOfByName=function(e){var d;if(this.aNameLookup){var b=0;var a=this.aNameLookup.length-1;if(a>=0){do{d=Math.floor((a-b)/2)+b;if(this.aNameLookup[d].nm==e){return this.aNameLookup[d].idx}else{if(this.aNameLookup[d].nm<e){b=d+1}else{a=d-1}}}while(b<=a)}}else{for(d=0;d<this.aDictionary.length;d++){if(this.aDictionary[d].aName==e){return d}}}return -1};Dictionary.prototype.GetObjectByName=function(f,a,b){var e;if(a){f=f.toLowerCase();for(e=0;e<this.aDictionary.length;e++){var d=this.aDictionary[e].aName;if(a){d=d.toLowerCase()}if(d==f){return this.GetObjectData(this.aDictionary[e])}}}else{e=this.indexOfByName(f);if(e>=0){return this.GetObjectData(this.aDictionary[e])}}if(b){hardError("Unknown object name ["+f+"]");return}return null};Dictionary.prototype.findObject=function(b){var a;if(typeof b=="number"){a=this.GetObject(b)}else{a=this.GetObjectByName(b)}return a};Dictionary.prototype.ClearPrompts=function(){for(var a=0;a<this.aDictionary.length;a++){this.aDictionary[a].Evaluate(this.GetObjectData(this.aDictionary[a]))}};Dictionary.prototype.ResetInstanceRefs=function(){for(var a=0;a<this.aDictionary.length;a++){this.aDictionary[a].ResetInstanceRef();this.aDictionary[a].hitCount=0}};Dictionary.prototype.PopulateConstraintDomains=function(){var d,b,a;for(d=0;d<this.aDictionary.length;d++){if(this.aDictionary[d] instanceof DictionaryObject_Constr){for(b=0;b<this.aDictionary[d].aObjectList.length;b++){a=this.GetObjectData(this.GetObject(this.aDictionary[d].aObjectList[b]));a.constraintDomain=this.aDictionary[d].aID}}}};Dictionary.prototype.ClearDlgExportFlags=function(){this.dlgExportCnt=0;for(var a=0;a<this.aDictionary.length;a++){this.aDictionary[a].exportID=0}};Dictionary.prototype.Clear=function(a){var d,b;if(!this.scannedForStaticData){for(d=0;d<appSettings.staticItems.length;d++){b=this.GetObjectData(_dgo(appSettings.staticItems[d]));if(b){b.staticData=true}}this.scannedForStaticData=true}for(d=0;d<this.aDictionary.length;d++){b=this.GetObjectData(this.aDictionary[d]);b.Reset();if(b.staticData){b.Evaluate()}else{b.Clear(a)}}};Dictionary.prototype.ClearAll=function(){for(var b=0;b<this.aDictionary.length;b++){var a=this.aDictionary[b];if((a.aType==TYPE_LIST)||(a.aType==TYPE_NUMERIC)||(a.aType==TYPE_DATE)||(a.aType==TYPE_BOOLEAN)||(a.aType==TYPE_TEXT)||(a.aType==TYPE_DIALOG)){a.Clear(true);a.createAttInstances()}}};Dictionary.prototype.EvaluateAll=function(){for(var b=0;b<this.aDictionary.length;b++){var a=this.aDictionary[b];if((a.aType==TYPE_LIST)||(a.aType==TYPE_NUMERIC)||(a.aType==TYPE_DATE)||(a.aType==TYPE_BOOLEAN)||(a.aType==TYPE_TEXT)){a.Evaluate()}}};Dictionary.prototype.populated=function(){var b,a;for(b=0;b<this.aDictionary.length;b++){a=this.aDictionary[b];if(a.aType==TYPE_DIALOG){a.createAttInstances(0)}else{if(a.aType==TYPE_HIERARCHY){a.SetupObjectRefs()}}}if(NODEJS||!window.hasOwnProperty("xrkb")){this.aNameLookup=[];for(b=0;b<this.aDictionary.length;b++){this.aNameLookup.push({nm:this.aDictionary[b].aName,idx:b})}this.aNameLookup.sort(function(e,d){if(e.nm<d.nm){return -1}else{if(e.nm>d.nm){return 1}else{return 0}}})}if($.isFunction(dictionaryPopulatedCB)){dictionaryPopulatedCB()}};var adHocObjectID=9877;Dictionary.prototype.LoadXml=function(a){if(a.length===0){return}var d=replayStack.PopReplay(adHocObjectID);if(d==REPLAYPOP_HANDLED){return true}else{if(d==REPLAYPOP_CURRENT){var b=$.get(a,function(e){$(e).find("list-entity").each(function(){var f=$(this);var g=f.attr("name");var h=dictionary.GetObject(g);if(h){f.find("row").each(function(){var k=$(this);var j=k.find("key-value value").text();h.SetValue(j);k.find("characteristic").each(function(){var p=h.aName;var m=$(this);var n=m.attr("name");var o=m.attr("type");var l=m.text();h.SetValueProp(n,-1,l)})})}})},"xml");b.success(function(){replayStack.Add(adHocObjectID,REPLAY_OK);Go()}).error(function(){alert("Error in reading file ["+a+"]");replayStack.Add(adHocObjectID,REPLAY_OK);Go();return false}).complete(function(){});throw new inferenceIssue(PASSBACK_WAIT)}else{hardError("Unknown replay pop return ["+d+"]");return}}};Dictionary.prototype.toObject=function(){var a=[];for(var b=0;b<this.aDictionary.length;b++){a.push(this.aDictionary[b].toObject())}return a};Dictionary.prototype.populateFromObject=function(d){var b=$.isArray(d);if(b){this.aDictionary=[]}else{d=[d]}var f,e,a;for(f=0;f<d.length;f++){e=null;a=d[f].aName;if(!appSettings.encrypted){a="~"+a}switch(d[f].aType){case TYPE_CATEGORY:e=new DictionaryObject_Cat(d[f].aID,a,d[f].objInfo);dictionary.Add(e);break;case TYPE_BOOLEAN:e=new DictionaryObject_Bool(d[f].aID,a,d[f].objInfo);dictionary.Add(e);PopulateObject(d[f].aID,d[f].flatProps,d[f].tree,d[f].values);break;case TYPE_LIST:e=new DictionaryObject_List(d[f].aID,a,d[f].objInfo,d[f].isMultiSel);dictionary.Add(e);PopulateObject(d[f].aID,d[f].flatProps,d[f].tree,d[f].values);break;case TYPE_DATE:e=new DictionaryObject_Date(d[f].aID,a,d[f].objInfo);dictionary.Add(e);PopulateObject(d[f].aID,d[f].flatProps,d[f].tree,d[f].values);break;case TYPE_NUMERIC:e=new DictionaryObject_Num(d[f].aID,a,d[f].objInfo,d[f].aDecPlaces);dictionary.Add(e);PopulateObject(d[f].aID,d[f].flatProps,d[f].tree,d[f].values);break;case TYPE_TEXT:e=new DictionaryObject_Text(d[f].aID,a,d[f].objInfo,d[f].aLength);dictionary.Add(e);PopulateObject(d[f].aID,d[f].flatProps,d[f].tree,d[f].values);break;case TYPE_VARIABLE:e=new DictionaryObject_Var(d[f].aID,a,d[f].objInfo,d[f].varType,d[f].aDecPlacesOrLength,d[f].dim1,d[f].dim2,d[f].initData,d[f].description);dictionary.Add(e);break;case TYPE_PROCEDURE:e=new DictionaryObject_Proc(d[f].aID,a,d[f].objInfo);dictionary.Add(e);PopulateProc(d[f].aID,d[f].aCode);break;case TYPE_DIALOG:e=new DictionaryObject_Dlg(d[f].aID,a,d[f].objInfo);dictionary.Add(e);PopulateDialog(d[f].aID,d[f].loadedDefinition,d[f].formRules);break;case TYPE_TXTPROCESSOR:e=new DictionaryObject_TxtProc(d[f].aID,a,d[f].objInfo);dictionary.Add(e);PopulateTextProcessor(d[f].aID,d[f].aData);break;case TYPE_REPORT:e=new DictionaryObject_Report(d[f].aID,a,d[f].objInfo);dictionary.Add(e);PopulateReport(d[f].aID,d[f].aProps,d[f].aText,null);break;case TYPE_CTABLE:e=new DictionaryObject_Constr(d[f].aID,d[f].objs,d[f].objInfo);dictionary.Add(e);PopulateCTable(d[f].aID,d[f].tables,d[f].procs);break}if(e&&d[f].hasOwnProperty("events")){e.events=d[f].events}if(e&&d[f].hasOwnProperty("dmInfo")){e.dmInfo=d[f].dmInfo}if(e&&d[f].hasOwnProperty("_classPrivs")){e._classPrivs=d[f]._classPrivs}}if(b){this.populated()}};var dictionary=new Dictionary();var dictionaryPopulatedCB=null;function _dgo(){return dictionary.GetObject.apply(dictionary,arguments)}function _dgobn(){return dictionary.GetObjectByName.apply(dictionary,arguments)}function ReplayObject(d,a,f,b,e){this.pauseID=d;this.aOperation=a;this.aObjectID=f;this.aValue=b;this.aExtra=e}function ReplayStack(){this.aReplay=[];this.replayPos=0;this.replayPassedUIs=0;this.currentPosition=0;this.timeoutHandle=null;this.onFormTree=false}ReplayStack.prototype.CriticalSection=function(a,d){var e={};var b=this.PopReplay(0,false,e);if(b==REPLAYPOP_HANDLED){if($.isFunction(d)){d(e.val)}}else{if(b==REPLAYPOP_CURRENT){a(this);throw new inferenceIssue(PASSBACK_WAIT)}else{hardError("Unknown replay pop return ["+b+"]");return}}};ReplayStack.prototype.CriticalDone=function(a){var b={val:a};this.Add(0,REPLAY_OBJRETURN,0,0,b);this.Add(0,REPLAY_CRITICALDONE);Go()};ReplayStack.prototype.Initialize=function(){this.aReplay=[];this.replayPos=0;this.replayPassedUIs=0;this.currentPosition=0;this.timeoutHandle=null;this.onFormTree=false};ReplayStack.prototype.Add=function(l,d,j,e,k){var a;if(this.onFormTree&&(d==REPLAY_FORMTREESET)){var h=this.aReplay[this.aReplay.length-1];if((h.aOperation==REPLAY_FORMTREESET)&&(h.aObjectID==j)&&(h.aValue!==undefined)&&(e==undefined)){return}}if(this.onFormTree&&(d==REPLAY_CHANGEEVENT)){d=REPLAY_FORMTREESET;for(var g=this.aReplay.length-1;g>=0;g--){if((this.aReplay[g].pauseID==l)&&(this.aReplay[g].aOperation==REPLAY_FORMTREESTART)){break}}if(g>=0){do{g++}while((g<this.aReplay.length)&&((this.aReplay[g].aOperation!=REPLAY_FORMTREESET)||(this.aReplay[g].aObjectID!=j)));if(g>=this.aReplay.length){a=new ReplayObject(l,d,j,e,k);this.aReplay.splice(g,0,a)}else{if($.isArray(this.aReplay[g].aValue)&&$.isArray(e)){for(var b=0;b<e.length;b++){if(e[b]<0){var f=$.inArray(-e[b],this.aReplay[g].aValue);if(f>=0){this.aReplay[g].aValue.splice(f,1)}}else{if($.inArray(e[b],this.aReplay[g].aValue)==-1){this.aReplay[g].aValue.push(e[b])}}}}else{this.aReplay[g].aValue=e}}return}}if($.isArray(e)&&(e.length==1)&&(e[0]<0)){return}a=new ReplayObject(l,d,j,e,k);this.aReplay.push(a)};ReplayStack.prototype.Reset=function(a){if(this.timeoutHandle){window.clearTimeout(this.timeoutHandle);this.timeoutHandle=null}this.onFormTree=false;this.replayPos=0;this.replayPassedUIs=0;if(a){this.aReplay=[];this.currentPosition=0}};ReplayStack.prototype.Debug=function(){var a="";for(var b=0;b<this.aReplay.length;b++){if(a.length>0){a+=","}a+=this.aReplay[b].aOperation}return a};ReplayStack.prototype.simpleBack=function(){var a=this.aReplay.length-1;do{while(a>=0&&this.aReplay[a].aOperation!=REPLAY_OK){a--}if((a<=0)||(this.aReplay[a-1].aOperation==REPLAY_SET)){break}a--}while(true);if(a>=0){this.aReplay.splice(a,this.aReplay.length-a)}else{this.aReplay=[]}};ReplayStack.prototype.CheckBookmark=function(e){var h;var b=typeof e=="number";if(b){h=e}else{if(e){h=this.currentPosition-1}else{if((appEmbedded)&&(isMobile)){return}var d;if(isIE){d=document.getElementById("xrback").contentWindow.document.body.innerHTML}else{d=document.location.href}var l=d.split("#");if(l.length!=2){h=0}else{h=parseInt(l[1],10)}h++}}if((h<this.currentPosition)||b){if(jsAjax&&!wrapperOptions.nodejs){Go(undefined,{action:"BACK",screenno:h});return}var f=0;for(var k=0;(k<this.aReplay.length)&&(f<h);k++){if(this.aReplay[k].aOperation==REPLAY_UI){f++}}if(k>0){this.aReplay[k-1].aOperation=REPLAY_UI_STOP}while(k<this.aReplay.length){if((this.aReplay[k].aOperation!=REPLAY_CHANGEEVENT)&&(this.aReplay[k].aOperation!=REPLAY_SETDIALOGPROP)&&(this.aReplay[k].aOperation!=REPLAY_MACRO)&&(this.aReplay[k].aOperation!=REPLAY_SET)&&(this.aReplay[k].aOperation!=REPLAY_OBJRETURN)&&(this.aReplay[k].aOperation!=REPLAY_CRITICALDONE)&&(this.aReplay[k].aOperation!=REPLAY_CANEXIT)&&(this.aReplay[k].aOperation!=REPLAY_OK_WITHVALIDATION)&&(this.aReplay[k].aOperation!=REPLAY_SETFULL)){break}else{k++}}k++;if(k===0){k++}var j;do{j=k;if(k>1){if((this.aReplay[k-2].aOperation==REPLAY_OK_WITHVALIDATION)||(this.aReplay[k-2].aOperation==REPLAY_CANEXIT)){k--}}}while(k<j);this.aReplay.length=k-1;Go();return}if((!appEmbedded||!isMobile)&&!wrapperOptions.nodejs){var g=this;g.timeoutHandle=window.setTimeout(function(){g.CheckBookmark()},BACK_TIMEOUT_MS)}};ReplayStack.prototype.RestartRevert=function(a){var b;if(a){for(b=this.aReplay.length-1;b>=0;b--){if(this.aReplay[b].aOperation==REPLAY_RESTARTPOS){break}}}else{for(b=0;b<this.aReplay.length;b++){if(this.aReplay[b].aOperation==REPLAY_RESTARTPOS){break}}}if(b>=this.aReplay.length){b=0}if(b<this.aReplay.length){this.aReplay.length=b;throw new inferenceIssue(PASSBACK_LOOP)}};ReplayStack.prototype.SetBookmark=function(g){this.currentPosition=g;if(g>0){g--}if(!appEmbedded||!isMobile){if(isIE){var f=document.getElementById("xrback").contentWindow.document;var e="";if(f&&f.body){e=f.body.innerHTML}var d=e;var b=d.split("#");d=b[0]+"#"+g;if(d!=e){f.open();f.write(d);f.close()}}else{if((document.location.hash)||(g!=0)){document.location.hash=g}}this.timeoutHandle=window.setTimeout("replayStack.CheckBookmark()",BACK_TIMEOUT_MS)}};ReplayStack.prototype.LastOperationWasValidatedOK=function(){if(this.replayPos>0){if(this.replayPos==this.aReplay.length){if(this.aReplay[this.replayPos-1].aOperation==REPLAY_OK_WITHVALIDATION){return true}}}return false};ReplayStack.prototype.RenderingUI=function(a){for(var b=this.replayPos-1;b>=0;b--){if(this.aReplay[b].aOperation==REPLAY_UI_STOP){this.aReplay[b].aOperation=REPLAY_UI;return}}this.Add(a,REPLAY_UI);this.replayPassedUIs++};var BKMK_RECORD_DELIM="*'";var BKMK_KEY_DELIM="+";ReplayStack.prototype.Serialize=function(){var a=false;for(var d=this.aReplay.length-1;(d>=0)&&!a;d--){if(this.aReplay[d].aOperation==REPLAY_UI){a=true}}if(!a){d=this.aReplay.length-1}var b="";for(var e=0;e<=d;e++){if(b.length>0){b+=BKMK_RECORD_DELIM}b+="p"+ElementToStr(this.aReplay[e].pauseID)+BKMK_KEY_DELIM+"a"+ElementToStr(this.aReplay[e].aOperation);switch(this.aReplay[e].aOperation){case REPLAY_SET:case REPLAY_JSONSET:case REPLAY_MACRO:case REPLAY_SETFULL:b+=BKMK_KEY_DELIM+"o"+ElementToStr(this.aReplay[e].aObjectID)+BKMK_KEY_DELIM+"v"+ElementToStr(this.aReplay[e].aValue);break;case REPLAY_SYSTEMSET:b+=BKMK_KEY_DELIM+"e"+ElementToStr(this.aReplay[e].aExtra)+BKMK_KEY_DELIM+"v"+ElementToStr(this.aReplay[e].aValue);break;case REPLAY_CHANGEEVENT:b+=BKMK_KEY_DELIM+"o"+ElementToStr(this.aReplay[e].aObjectID)+BKMK_KEY_DELIM+"v"+ElementToStr(this.aReplay[e].aValue)+BKMK_KEY_DELIM+"e"+ElementToStr(this.aReplay[e].aExtra);break;case REPLAY_CANEXIT:b+=BKMK_KEY_DELIM+"o"+this.aReplay[e].aObjectID;break}}return b};ReplayStack.prototype.UnSerialize=function(aStream){this.Reset(true);var o,el,pr;var pauseID,aOperation,aObjectID,aValue,aExtra,v;while(aStream.length>0){o=RipToChar(aStream,BKMK_RECORD_DELIM);aStream=o.tail;el=o.head;o=null;pauseID=0;aOperation=0;aObjectID=undefined;aValue=undefined;aExtra=undefined;while(el.length>0){o=RipToChar(el,BKMK_KEY_DELIM);el=o.tail;pr=o.head;o=null;if(pr.length<2){v=undefined}else{v=eval(pr.substr(1))}switch(pr.substr(0,1)){case"p":pauseID=v;break;case"a":aOperation=v;break;case"o":aObjectID=v;break;case"v":aValue=v;break;case"e":aExtra=v;break;default:hardError("Invalid Serialization : Unknown key ["+pr.substr(0,1)+"]");return}}if(aOperation==0){hardError("Invalid Serialization : No Operation");return}this.aReplay[this.aReplay.length]=new ReplayObject(pauseID,aOperation,aObjectID,aValue,aExtra)}};ReplayStack.prototype.formTreeSet=function(f){var h;if(f.flatProps&&f.flatProps.tieddialog){h=_dgo(f.flatProps.tieddialog)}else{if(f.aType==TYPE_DIALOG){h=f}}var j;if(h&&(h.aObjectList.length>0)){if((h.aObjectList.length==1)&&(h.aObjectList[0]==-1)){j=[f.aID]}else{j=h.aObjectList.slice(0)}}else{j=[f.aID]}var e=this.replayPos+2;while(e<this.aReplay.length){var d=this.aReplay[e];if((d.aOperation==REPLAY_FORMTREESET)&&($.inArray(d.aObjectID,j)>=0)){var b=d.pauseID;var a=d.aObjectID;var g=dictionary.GetObject(d.aObjectID);if(g){if(d.aValue){j.splice($.inArray(d.aObjectID,j),1);if((g instanceof DictionaryObject_Var)&&(d.aExtra!=null)&&!$.isFunction(d.aExtra)){g.SetValue(d.aValue,d.aExtra.dim1,d.aExtra.dim2)}else{if((g.aType==TYPE_LIST)&&(g.isMultiSel)&&(d.aExtra)){g.SetMultiValue(d.aValue,d.aExtra)}else{g.SetValue(d.aValue)}g.FireEvent(EVENT_UPDATE);if($.isFunction(d.aExtra)){d.aExtra(d)}}}else{if((g.aType==TYPE_REPORT)||(g.aType==TYPE_DIALOG)){j.splice($.inArray(d.aObjectID,j),1)}}}if(j.length==0){return true}}e++}return false};ReplayStack.prototype.formTreeSkip=function(){var f=this.replayPos+1;while(f<this.aReplay.length){var e=this.aReplay[f];if(e.aOperation==REPLAY_UI){this.replayPassedUIs++}else{if(e.aOperation==REPLAY_SUBDIALOGEVENT){var g=f;f++;var d=1;while(f<this.aReplay.length){var a=this.aReplay[f];if(a.aOperation==REPLAY_OK){this.replayPos=g;var b=this.aReplay.splice(f+1,this.aReplay.length-f-1);this.PopReplay(this.aReplay[this.replayPos].pauseID);for(var h=0;h<b.length;h++){this.aReplay.push(b[h])}break}f++}}else{if(e.aOperation!=REPLAY_FORMTREESET){this.replayPos=f;return}}}f++}this.replayPos=Math.min(f,this.aReplay.length)};ReplayStack.prototype.formTreeShow=function(a){this.PopReplay(a,false)};ReplayStack.prototype.isFirstDialog=function(){var a=0;for(var b=0;b<this.aReplay.length;b++){if(this.aReplay[b].aOperation==REPLAY_UI){a++;if(a>1){return false}}}return true};ReplayStack.prototype.PopReplay=function(pauseID,leaveOKonStack,adHokObj){var aState=REPLAYPOP_CURRENT;var o,ex,p,replayObj,aInst;do{if(this.replayPos>=this.aReplay.length){return aState}var aReplayRec=this.aReplay[this.replayPos];if((pauseID==0)&&(aReplayRec.pauseID!=0)){return REPLAYPOP_HANDLED}else{if(aReplayRec.aOperation==REPLAY_SET){o=dictionary.GetObject(aReplayRec.aObjectID);if(o==null){hardError("Unknown object in replay stack");return}else{o.SetValue(aReplayRec.aValue)}this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_SETPROP){o=dictionary.GetObject(aReplayRec.aObjectID);if(o==null){hardError("Unknown object in replay stack");return}else{o.prop(aReplayRec.aExtra,aReplayRec.aValue)}this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_SETFULL){o=dictionary.GetObject(aReplayRec.aObjectID);if(o==null){hardError("Unknown object in replay stack");return}else{o.promptFor=false}this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_OBJRETURN){if(adHokObj){ex=aReplayRec.aExtra;for(p in ex){adHokObj[p]=ex[p]}}this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_GROUPSET){hardError("Misplaced procedure protection in replay stack");return}else{if(aReplayRec.aOperation==REPLAY_SETDIALOGPROP){o=dictionary.GetObject(aReplayRec.aObjectID);if(o==null){hardError("Unknown object in replay stack");return}else{if(o.aType==TYPE_DIALOG){var a=aReplayRec.aExtra.split(".");if(a.length==2){o.SetDialogControlValue(a[0],a[1],aReplayRec.aValue)}else{if(a.length==3){var ct=o.findControl(a[0]);ct.tabsheets[parseInt(a[1],10)-1][a[2]]=aReplayRec.aValue}}}}this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_JSONSET){o=dictionary.GetObject(aReplayRec.aObjectID);if(o==null){hardError("Unknown object in replay stack");return}eval(o.aName+"="+aReplayRec.aValue);this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_SYSTEMSET){eval(aReplayRec.aExtra+"="+aReplayRec.aValue);this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_OK){if(leaveOKonStack===true){return aState}this.replayPos+=1;return REPLAYPOP_HANDLED}else{if(aReplayRec.aOperation==REPLAY_CRITICALDONE){this.replayPos+=1;return REPLAYPOP_HANDLED}else{if(aReplayRec.aOperation==REPLAY_OK_WITHVALIDATION){this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_FORMTREESTART){this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_FORMTREESET){this.replayPos+=1}else{if((aReplayRec.aOperation==REPLAY_UI)||(aReplayRec.aOperation==REPLAY_UI_STOP)){this.replayPos++;this.replayPassedUIs++}else{if(aReplayRec.aOperation==REPLAY_EXIT){throw new inferenceIssue(PASSBACK_END,false)}else{if(aReplayRec.aOperation==REPLAY_MACRO){var doOK=(aReplayRec.aValue=="ok");var canExitProc=aReplayRec.aExtra;var oID=aReplayRec.aObjectID;var aParam=undefined;if($.isPlainObject(oID)){aParam=oID.param;oID=oID.id}o=dictionary.GetObject(oID);this.replayPos+=1;if(o==null){hardError("Unknown macro in replay stack");return}else{if(aParam!==undefined){o.Run(aParam)}else{o.Run()}if(doOK){if(this.replayPos==this.aReplay.length){if(canExitProc){this.Add(pauseID,REPLAY_CANEXIT,canExitProc)}else{this.Add(pauseID,REPLAY_OK_WITHVALIDATION)}}}}}else{if(aReplayRec.aOperation==REPLAY_CHANGEEVENT){replayObj=this.aReplay[this.replayPos];var aPauseID=replayObj.pauseID;var attID=replayObj.aObjectID;o=dictionary.GetObject(replayObj.aObjectID);this.replayPos+=1;if(o==null){hardError("Unknown object in replay stack");return}else{if((o instanceof DictionaryObject_Var)&&(replayObj.aExtra!=null)&&!$.isFunction(replayObj.aExtra)){o.SetValue(replayObj.aValue,replayObj.aExtra.dim1,replayObj.aExtra.dim2)}else{if(((o.aType==TYPE_LIST)||(o.aType==TYPE_NUMERIC)||(o.aType==TYPE_DATE)||(o.aType==TYPE_BOOLEAN)||(o.aType==TYPE_TEXT))&&replayObj.aExtra&&replayObj.aExtra.flatprop){o.SetFlatProp(replayObj.aExtra.flatprop,replayObj.aValue)}else{if(o.aType==TYPE_DIALOG){aInst=o.GetDialogInstObject(replayObj.aExtra);aInst.selectedIndex=replayObj.aValue}else{if((o.aType==TYPE_LIST)&&(o.isMultiSel)&&(replayObj.aExtra)){o.SetMultiValue(replayObj.aValue,replayObj.aExtra)}else{o.SetValue(replayObj.aValue)}o.FireEvent(EVENT_UPDATE);if($.isFunction(replayObj.aExtra)){replayObj.aExtra(replayObj)}}}}}}else{if(aReplayRec.aOperation==REPLAY_CANEXIT){if(!aReplayRec.aObjectID){this.replayPos+=1;return REPLAYPOP_HANDLED}else{o=dictionary.GetObject(aReplayRec.aObjectID);this.replayPos+=1;if(o==null){hardError("Unknown canexit procedure in replay stack");return}else{var d=_dgo(aReplayRec.pauseID);o.Run(d);if(this.replayPos==this.aReplay.length){if((o.lastReturn==undefined)||o.lastReturn){if($.isFunction(aReplayRec.aValue)){aReplayRec.aValue(o.lastReturn)}if(o.lastReturn==1){if(currentDlg&&currentDlg.timeoutTimer){window.clearTimeout(currentDlg.timeoutTimer);currentDlg.timeoutTimer=false}this.Add(pauseID,REPLAY_OK);_hb.nx(function(){Go()});throw new inferenceIssue(PASSBACK_WAIT)}else{if(o.lastReturn==2){this.Add(pauseID,REPLAY_OK_WITHVALIDATION)}}}else{if($.isFunction(aReplayRec.aValue)){aReplayRec.aValue(o.lastReturn)}}}}}}else{if(aReplayRec.aOperation==REPLAY_ADHOC){replayObj=this.aReplay[this.replayPos];this.replayPos+=1;if((replayObj.aExtra!=null)&&$.isFunction(replayObj.aExtra)){replayObj.aExtra()}}else{if(aReplayRec.aOperation==REPLAY_RESTARTPOS){this.replayPos+=1;return REPLAYPOP_HANDLED}else{if(aReplayRec.aOperation==REPLAY_CAPTUREDATT){AppendCapturedAtt(aReplayRec.aObjectID);this.replayPos+=1}else{if(aReplayRec.aOperation==REPLAY_SUBDIALOGEVENT){var action=aReplayRec.aObjectID;var ctrlID=aReplayRec.aValue;var aIndex=aReplayRec.aExtra;var dlgID=aReplayRec.pauseID;if(typeof aIndex=="object"){dlgID=aIndex.parentDlg;aIndex=aIndex.aIndex}var dlg=_dgo(dlgID);this.replayPos+=1;if(dlg){var tiedID=0;if(ctrlID>=0){var ctrl=dlg.GetControlByID(ctrlID);if(ctrl){tiedID=ctrl.tieddialog}}else{tiedID=-ctrlID}var l,subcap;if(tiedID){switch(action){case REPLAY_SUBDIALOGADD:aIndex=dlg.addSubDlgInstance(tiedID);l=capturedAtts.length;aInst=dlg.GetDialogInstObject(tiedID);aInst.selectedIndex=aIndex+1;if(!dlg.runSubDlgInstance(tiedID,aIndex)){return REPLAYPOP_HANDLED}if(capturingAtts){subcap=capturedAtts.slice(l);capturedAtts=capturedAtts.slice(0,l);if(!IsAlreadyCapturedDlg(tiedID)){capturedAtts.push({dlg:dlg,instID:tiedID,cap:subcap})}}break;case REPLAY_SUBDIALOGEDIT:l=capturedAtts.length;if(!dlg.runSubDlgInstance(tiedID,aIndex)){return REPLAYPOP_HANDLED}if(capturingAtts){subcap=capturedAtts.slice(l);capturedAtts=capturedAtts.slice(0,l);if(!IsAlreadyCapturedDlg(tiedID)){capturedAtts.push({dlg:dlg,instID:tiedID,cap:subcap})}}break;case REPLAY_SUBDIALOGDEL:dlg.delSubDlgInstance(tiedID,aIndex);if(capturingAtts){subcap=[];if(dlg.aDefinition.instanceatts){for(var iac=0;iac<dlg.aDefinition.instanceatts.length;iac++){subcap.push(dlg.aDefinition.instanceatts[iac].att)}}capturedAtts.push({dlg:dlg,instID:tiedID,cap:subcap})}break}}}}else{hardError("Unknown operation in replay stack");return}}}}}}}}}}}}}}}}}}}}}}}}while(true)};var replayStack=new ReplayStack();function BackSetup(){if(document.getElementById("xrback")){return}var a;a=CreateElement2("iframe","xrback");$(a).hide().css("position","absolute")}function Cmd_Do(b,d,a){var e;if(typeof d=="number"){e=dictionary.GetObject(d)}else{e=dictionary.GetObjectByName(d)}if(e==null){hardError("Unknow object ["+d+"] in DO command in procedure ["+dictionary.GetObject(b.aID).aName+"]");return}return e.Run(a)}function Cmd_Debug(d,b,g,f,a){var e=replayStack.PopReplay(d.aID);if(e==REPLAYPOP_HANDLED){return true}else{if(e==REPLAYPOP_CURRENT){if(b==undefined){b=""}if(typeof(b)!="string"){b=b.toString()}if(!NODEJS){b+="_|_";if(g){b+=g}b+="_|_";if(f){b+=f}b+="_|_";if(a){b+="HTML"}}throw new inferenceIssue(PASSBACK_DEBUG,d.aID,b)}else{hardError("Unknown replay pop return ["+e+"]");return}}}function Cmd_GetValue(f,k,p){var m="";var a="";var b;if(typeof f=="number"){b=_dgo(f)}else{if(f.toLowerCase()=="___report"){return Dialog_GetLineOfReasoning()}if(f.toLowerCase()=="___debug"){return Dialog_GetDebug()}var h=f.indexOf(".");if(h!=-1){m=f.substr(h+1);f=f.substr(0,h)}h=f.indexOf("[");if(h!=-1){a=f.substr(h+1);f=f.substr(0,h);if(a.substr(a.length-1)=="]"){a=a.substr(0,a.length-1)}else{a=""}}b=_dgobn(f)}if(b==null){if(k){hardError("Unknown object referenced in command ["+f+"]");return}return""}else{if(b.aType==TYPE_VARIABLE){if(a.length>0){var j=null;var g=null;var e=a.split(",");j=e[0];g=e[1];return b.GetValue(j,g)}return b.GetValue(1,1)}else{if(a.length>0){var d=parseInt(a,10);if(isNaN(d)){var l=b.NameToID(a);if(l!=0){d=b.ValueIDtoIndex(l)}else{return("Invalid value index : "+b.aName+"["+a+"]")}}else{if((d<0)||(d>=b.GetNvalues())){return("Invalid value index : "+b.aName+"["+d+"]")}}if(!isNaN(d)){if(m.length==0){return b.IDtoName(b.aValues[d].aID)}var q=b.GetValueProp(m,d+1);if(q==null){return("Invalid value prop : "+b.aName+"[]."+m)}return q}}if(m.length>0){var n;n=b.GetFlatProp(m);if(n!=null){return n}n=b.GetProp(m);if(n!=null){return n}}if(b.aType==TYPE_DATE){return b.GetValueAsString(true)}else{if(b.aType==TYPE_NUMERIC){return b.GetValueAsString(typeof p=="number"?p:"force")}else{return b.GetValueAsString()}}}}}function Cmd_SetValueAsStr(g,j,b){var l=null;var h=null;var m="";var k=g.indexOf(".");if(k!=-1){m=g.substr(k+1);g=g.substr(0,k)}var e=g.indexOf("[");if(e!=-1){var d=g.indexOf("]");var f=g.substring(e+1,d).split(",");g=g.substring(0,e);l=f[0];h=f[1]}var a=_dgobn(g);if(a){if(typeof j=="number"){return a.SetValue(j,l,h)}else{if((j==PSEUDO_VALUE_EMPTY)&&(a.aType!=TYPE_VARIABLE)){a.Clear()}else{if(m.length>0){return(a.SetProp(m,j,-1))}if(a.aType==TYPE_VARIABLE){return a.SetValueAsString(j,l,h)}else{return a.SetValueAsString(j,",",b)}}}}}function Cmd_AddMultiVal(g,f,e){var h;if(typeof(g)=="number"){h=dictionary.GetObject(g)}else{h=dictionary.GetObjectByName(g)}if(h==null){return false}if(e){h.Clear()}var d=h.GetValue();var b;if(typeof(f)=="number"){b=f}else{b=h.NameToID(f)}if(b!=0){d[d.length]=b;h.SetValue(d)}return true}function Cmd_DelMultiVal(g,f){var h;if(typeof(g)=="number"){h=dictionary.GetObject(g)}else{h=dictionary.GetObjectByName(g)}if(h==null){return false}var e=h.GetValue();var d;if(typeof(f)=="number"){d=f}else{d=h.NameToID(f)}var b=[];for(var j=0;j<e.length;j++){if(e[j]!=d){b[b.length]=e[j]}}h.SetValue(b);return true}function IsNumber(a){return(a!=null)&&!isNaN(a)&&(a!="")}function PadUp(d,a){var b=d.toString();while(b.length<a){b="0"+b}return b}function UnPad(a){while((a.length>1)&&(a.substr(0,1)=="0")){a=a.substr(1)}return a}function Cmd_EncodeDate(g,b,f){var a=new Date(Date.UTC(g,b-1,f));var e=a.getTime();e=e/86400000;return e}function strftime(f,e,b,d){var a=f.toLowerCase();a=a.replace(/yyyy/,d);a=a.replace(/mm/,PadUp(b+1,2));a=a.replace(/m/,PadUp(b+1,2));a=a.replace(/dd/,PadUp(e,2));a=a.replace(/d/,PadUp(e,2));return a}function Cmd_DateToStr(g,a){var e=function(j){var h;if(j instanceof Date){h=j}else{if(typeof(j)!="number"){return"**/**/****"}if(j==0){return"**/**/****"}h=new Date(j*86400000)}return strftime(appSettings.dateFormat,h.getDate(),h.getMonth(),h.getFullYear())};if(a){var f={};var b=replayStack.PopReplay(0,false,f);if(b==REPLAYPOP_HANDLED){return f.val}else{if(b==REPLAYPOP_CURRENT){f.val=e(g);replayStack.Add(0,REPLAY_OBJRETURN,0,0,f);replayStack.Add(0,REPLAY_CRITICALDONE);throw new inferenceIssue(PASSBACK_LOOP)}else{hardError("Unknown replay pop return ["+b+"]");return}}}else{return e(g)}}function Cmd_StrToDate(f){if((f.length!=10)&&(f.length!=8)&&(f.length!=6)){return -1}var h,b,g;if((f.indexOf("/")==-1)&&(f.indexOf("-")!=-1)){h=f.substring(0,4);b=f.substring(5,7);g=f.substring(8)}else{if((f.indexOf("/")==-1)&&(f.indexOf("-")==-1)){h=f.substr(0,4);b=f.substr(4,2);g=f.substr(6,2)}else{if(appSettings.dateFormat.toLowerCase().charAt(0)=="d"){g=parseInt(UnPad(f.substr(0,2)),10);b=parseInt(UnPad(f.substr(3,2)),10);h=parseInt(f.substr(6,4),10)}else{if(appSettings.dateFormat.toLowerCase().charAt(0)=="m"){g=parseInt(UnPad(f.substr(3,2)),10);b=parseInt(UnPad(f.substr(0,2)),10);h=parseInt(f.substr(6,4),10)}else{g=parseInt(UnPad(f.substr(8,2)),10);b=parseInt(UnPad(f.substr(5,2)),10);h=parseInt(f.substr(0,4),10)}}}}if(isNaN(g)||(g<1)||(g>31)||isNaN(b)||(b<1)||(b>12)||isNaN(h)){return -1}if(h<100){if(h<20){h+=1900}else{h+=2000}}var a=new Date(Date.UTC(h,b-1,g,0,0,0));var e=a.getTime();e=e/86400000;return e}function Cmd_IsReplaying(a){var b=replayStack.PopReplay(a.aID);if(b==REPLAYPOP_HANDLED){return true}else{if(b==REPLAYPOP_CURRENT){return false}else{hardError("Unknown replay pop return ["+b+"]");return}}}function Cmd_EndReplayProtection(a){replayStack.Add(a.aID,REPLAY_CRITICALDONE);throw new inferenceIssue(PASSBACK_LOOP)}function Cmd_NumFix(a){if(a>0){return Math.floor(a)}else{return Math.ceil(a)}}function Cmd_IntFormat(b,m){b+="";m+="";var d;var a=b.length;var g=m.length;var f=b.indexOf(".");var k=m.indexOf(".");if(f==-1){f=a}if(k==-1){k=g}var e="";var j=k-f;if(j>0){for(d=0;d<j;d++){e+=" "}b=e+b}else{if(j<0){for(d=j;d<0;d++){e+=" "}m=e+m}}a=b.length;g=m.length;e="";j=g-a;if(j>0){for(d=0;d<j;d++){e+=" "}b=b.substr(0,a)+e+b.substr(a,b.length)}else{if(j<0){b=b.substr(0,g);b=b.replace(/^\s+/,"")}}e="";d=m.length;m=m.replace(/^\s+/,"");g=m.length;if((m.charAt(0)=="#")&&(d!=g)){for(d=0;d<k;d++){if(m.charAt(d)==","){e=m.substr(0,d+1);while(e.length<=a){e+=e}m=e+m;g=m.length;e="";break}}}j=b.length-1;for(d=g-1;d>=0;d--){if(j<0){break}var h=b.charAt(j);var l=m.charAt(d);if(((l=="#")||(l==","))&&(h==" ")){continue}if(l=="0"){if(h=="#"){e=l+e}else{e=h+e;j--}}else{if(l=="%"){e="00"+e}else{if(l==","){e=","+e}else{e=h+e;j--}}}}if(j>=0){e=b.substr(0,j+1)+e}return e}function Cmd_Pad(b,a){b+="";while(b.length<a){b+=" "}return b}function Cmd_Trim(a){a+="";return a.replace(/^\s+|\s+$/g,"")}function Cmd_LTrim(a){a+="";return a.replace(/^\s+/,"")}function Cmd_RTrim(a){a+="";return a.replace(/\s+$/,"")}function Cmd_StrFormat(d,o){var e,a,l;var k,n;var f="";var j=false;var g=false;var m=false;d+="";var b=d.length;var h=0;for(e=0;e<o.length;e++){n=o.charAt(e);if((n=="&")||(n=="@")){h++;continue}if(n=="!"){m=true}else{if(n=="<"){g=true}else{if(n==">"){j=true}}}}a=0;l=h-b;if(l>0){for(e=0;e<l;e++){if(m){d+="\n"}else{d="\n"+d}}b=b+l}else{if((l<0)&&(!m)){a=-l}}for(e=0;e<o.length;e++){n=o.charAt(e);if((n=="&")||(n=="@")){if(a<b){k=d.charAt(a++)}else{k="\n"}if(n=="&"){if(k!="\n"){f+=k}}else{if(k=="\n"){k=" "}f+=k}}}if(j){return f.toUpperCase()}else{if(g){return f.toLowerCase()}else{return f}}}function Cmd_ToHexString(a){var d=new Number(a);var b=d.toString(16);return b.toUpperCase()}function Cmd_Sign(a){if(a>0){return 1}if(a<0){return -1}return 0}function Cmd_Decode_Date(b){if(b instanceof Date){return b}b=Math.floor(b*86400000);var a=new Date(b);return a}function getLocalDateTime(){var f=new Date();var e=Math.round(f.getTimezoneOffset()/60);var a=e*60*60*1000;var b=f.getTime()-a;b=Math.floor(b/(24*60*60*1000))*(24*60*60*1000);f.setTime(b);return f}function daysDiff(b,a){return Math.floor((a.getTime()-b.getTime())/(24*60*60*1000))}function daysAdd(b,a){return new Date(b.getTime()+(a*(24*60*60*1000)))}function Cmd_GetDate(a){if(a==1){return Math.floor(new Date().getTime()/86400000)}else{if(a==2){return Math.floor(getLocalDateTime().getTime()/86400000)}else{hardError("Unknown date/time mode["+a+"]");return}}}function Cmd_GetTime(b){var a;if(b==1){a=new Date().getTime()}else{if(b==2){a=getLocalDateTime().getTime()}else{hardError("Unknown date/time mode["+b+"]");return}}var e=Math.floor(a/86400000)*86400000;return(a-e)/86400000}function Cmd_GetNow(a){if(a==1){return new Date().getTime()/86400000}else{if(a==2){return getLocalDateTime().getTime()/86400000}else{hardError("Unknown date/time mode["+a+"]");return}}}function Cmd_Encode_Time(f,b,e){var a=new Date(1970,0,1,f,b,e);var d=a.getTime();d=d/86400000;return d}function Cmd_StrTime(b){var g={};var f=replayStack.PopReplay(0,false,g);if(f==REPLAYPOP_HANDLED){return g.val}else{if(f==REPLAYPOP_CURRENT){if(!(b instanceof Date)){b=Math.floor(b*86400000)}var a=new Date(b);var e="";var d=a.getUTCHours();if(d==0){d=12;e="AM"}else{if(d<12){e="AM"}else{if(d==12){e="PM"}else{e="PM";d=d-12}}}g.val=PadUp(d,2)+":"+PadUp(a.getUTCMinutes(),2)+":"+PadUp(a.getUTCSeconds(),2)+" "+e;replayStack.Add(0,REPLAY_OBJRETURN,0,0,g);replayStack.Add(0,REPLAY_CRITICALDONE);throw new inferenceIssue(PASSBACK_LOOP)}else{hardError("Unknown replay pop return ["+f+"]");return}}}function cmd_Frac(a){return Math.abs(a)-Math.floor(Math.abs(a))}function Cmd_GetValidVals(f,e){var g=dictionary.GetObject(f);if(g!=null){var b=g.GetAllValidValues();if(b!=null){for(var d=0;d<b.length;d++){e[d+1][1]=b[d]}}}}function Cmd_GetSelected(b,a){var d;if(typeof(b)=="number"){d=dictionary.GetObject(b)}else{d=dictionary.GetObjectByName(b)}if(d!=null){if(d.IsValueIndexSelected(a-1)){return true}}return false}function Cmd_GetSelectedStr(b,a){var d;if(typeof(b)=="number"){d=dictionary.GetObject(b)}else{d=dictionary.GetObjectByName(b)}if(d!=null){if(d.IsValueIndexSelected(a-1)){return"TRUE"}}return"FALSE"}function Cmd_GetValid(b,a){var d;if(typeof(b)=="number"){d=dictionary.GetObject(b)}else{d=dictionary.GetObjectByName(b)}if(d!=null){if(d.IsValueIndexValid(a-1)){return true}}return false}function Cmd_GetValidStr(b,a){var d;if(typeof(b)=="number"){d=dictionary.GetObject(b)}else{d=dictionary.GetObjectByName(b)}if(d!=null){if(d.IsValueIndexValid(a-1)){return"TRUE"}}return"FALSE"}function Cmd_DBcall(f,b,e,a,d){var g=replayStack.PopReplay(f.aID);if(g==REPLAYPOP_HANDLED){return true}else{if(g==REPLAYPOP_CURRENT){ServerCall(f.aID,"method=DB&id="+b+"&sql="+escape(e)+"&varname="+a+"&varid="+d+"&pauseid="+f.aID);return false}else{hardError("Unknown replay pop return ["+g+"]");return}}}var phoneProcObjID;function Cmd_URLfetch(x,k,l,d,e){var m={};var q=replayStack.PopReplay(x.aID,false,m);if(q==REPLAYPOP_HANDLED){if(l){return true}else{return m}}else{if(q==REPLAYPOP_CURRENT){if(l&&(l!="")){_dgobn(l).staticData=true}var p="";if(d){p+="&varok="+d}if(e){p+="&data="+encodeURIComponent(e)}var j,z,y,w;var u=NODEJS;if(appSettings.chatMode&&(typeof chat_mode=="string")&&(chat_mode=="browser")){u=false}if(u){Cmd_nodeURLfetch(x,k,l,d,e)}else{if(false){phoneProcObjID=x.aID;if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))||(navigator.userAgent.match(/iPad/i))){var f="fake$URLFetch";j="";z=k.split("?");y=null;if(z&&(z.length>0)){k=z[0];j=z[1];if(k&&j){y=j.split("&")}}f+="$"+k+"$";if(y){for(w=0;w<y.length;w++){f+=y[w]+"&"}}f+="$varname="+(l?l:"");f+="$varok="+(d?d:"");f+="$"+(e?encodeURIComponent(e):"");window.location=f}else{var g="<method>";g+="<name>URLFetch</name>";j="";z=k.split("?");y=null;if(z.length>0){k=z[0];j+=z[1];y=j.split("&")}g+="<param>"+k+"</param>";if(y){for(w=0;w<y.length;w++){g+="<param>"+y[w]+"</param>"}}g+="<param>varname="+(l?l:"")+"</param>";g+="<param>varok="+(d?d:"")+"</param>";g+="<param>"+(e?encodeURIComponent(e):"")+"</param>";g+="</method>";if(navigator.appVersion.indexOf("Win")!=-1){if(!$.isFunction(window.external.Notify)){hardError("This deployment is designed to be used by Expert Advisor");return}window.external.Notify(g)}else{alert(g)}}throw new inferenceIssue(PASSBACK_WAIT,x.aID)}else{xpertrule.disableUI();if(false){j="";z=k.split("?");if(z.length>1){k=z[0];j="?"+z[1]}if(!l){l=""}ServerCall(x.aID,"method=URLFETCH&url="+escape(k+j)+"&varname="+l+p)}else{var v=function(b){xpertrule.enableUI();var a;if(l){a=_dgobn(l);if(a){replayStack.Add(adHocObjectID,REPLAY_SET,a.aID,b.ok?b.data:b.error)}}if(d){a=_dgobn(d);if(a){if(phoneProcObjID){adHocObjectID=phoneProcObjID}replayStack.Add(adHocObjectID,REPLAY_SET,a.aID,b.ok?1:2)}}replayStack.Add(adHocObjectID,REPLAY_OBJRETURN,undefined,undefined,{data:b.data,success:b.ok});if(phoneProcObjID){replayStack.Add(phoneProcObjID,REPLAY_CRITICALDONE);Go()}else{replayStack.Add(x.aID,REPLAY_OK);Go()}};if(appEmbedded){var t={url:k,type:e?"POST":"GET",success:function(a){v({ok:true,data:a})},error:function(a,b){v({ok:false,data:"",error:b})},timeout:10000};if(e){t.data=e}$.ajax(t)}else{var h={method:"URLFETCH2",url:k};if(e){h.data=e}$.ajax({url:"xrkb/ajax.php",type:"POST",data:h,dataType:"json",success:function(a){v(a)},error:function(a,b){v({ok:false,data:"",error:b})},timeout:10000})}}throw new inferenceIssue(PASSBACK_WAIT)}}return false}else{hardError("Unknown replay pop return ["+q+"]");return}}}function Cmd_URLfetch_back(g,f,d,a){xpertrule.enableUI();f=unescape(f);var e;if(g!=""){e=dictionary.GetObjectByName(g);if(e){replayStack.Add(adHocObjectID,REPLAY_SET,e.aID,f)}}if(d!=""){e=dictionary.GetObjectByName(d);if(e){var b=a?1:2;if(phoneProcObjID){adHocObjectID=phoneProcObjID}replayStack.Add(adHocObjectID,REPLAY_SET,e.aID,b)}}replayStack.Add(adHocObjectID,REPLAY_OBJRETURN,undefined,undefined,{data:f,success:a});if(phoneProcObjID){replayStack.Add(phoneProcObjID,REPLAY_CRITICALDONE);Go()}}function Cmd_SendMail(e,b,d,a){var f=replayStack.PopReplay(e.aID);if(f==REPLAYPOP_HANDLED){return true}else{if(f==REPLAYPOP_CURRENT){ServerCall(e.aID,"method=SENDMAIL&addr="+escape(b)+"&subj="+escape(d)+"&body="+escape(a));return false}else{hardError("Unknown replay pop return ["+f+"]");return}}}function Cmd_SendMail_back(a,b){if(!a){alert("Error sending email : "+b)}}function HandleChars(a){if(typeof a=="string"){a=a.replace(/&/g,"&amp;");a=a.replace(/"/g,"&quot;");a=a.replace(/'/g,"&apos;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;")}return a}function HandleChars2(a){if(typeof a=="string"){a=a.replace(/]]>/g,"]]]><![CDATA[]>")}return a}function Phone_EncodeData_Back(b){if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))||(navigator.userAgent.match(/iPad/i))){window.location="fake$EncodeDataBack$"+escape(b)}else{var a="<method><name>EncodeDataBack</name><param>"+escape(b)+"</param></method>";alert(a)}}function Cmd_Phone_EncodeData(){var a;var b=dictionary.GetObjectByName("finished",true);if(b&&(b.aType==TYPE_PROCEDURE)){a=b.Run()}else{a=Cmd_EncodeData([],true,"",true)}Phone_EncodeData_Back(a)}function appGetData(d){var j,h,f;var e=[];if(typeof d=="string"){if(d!=""){e=$.parseJSON(d);if($.isArray(e)){for(var g=e.length-1;g>=0;g--){if(e[g]==""){e[g]=-1}else{h=_dgo(e[g]);if(h){e[g]=h.aID}else{e.splice(g,1)}}}}else{e=[]}}else{}}if(e.length==0){if($.isPlainObject(appSettings.dataset_msg)&&$.isArray(appSettings.dataset_msg.outputs)){for(j=0;j<appSettings.dataset_msg.outputs.length;j++){h=_dgo(appSettings.dataset_msg.outputs[j]);if(h){e.push(h.aID)}}}}if(e.length==0){f="{'_message':'no input array and no outputs set in dataset wizaed'}"}else{var b=xpertrule.getValuesToObject(e);f=JSON.stringify(b)}Phone_EncodeData_Back(f)}function Cmd_EncodeData(f,d,p,h,b){var B=false;var w=false;if(typeof h=="boolean"){B=h}else{if(h>0){B=true;if(h>=2){w=true}}}if(b==undefined){b="  "}if(f.length===0){f=capturedAtts.slice()}else{var t=$.inArray(-1,f);if(t>=0){f.splice(t,1);for(t=0;t<capturedAtts.length;t++){if($.inArray(capturedAtts[t],f)==-1){f.push(capturedAtts[t])}}}}var k,x,l,j,n;if(d){if(p==undefined){p="cud"}else{if(p==""){p="data";dictionary.ClearDlgExportFlags()}else{if(p=="__TTV"){p=""}}}k="";if(p.length>0){k+="<?xml version='1.0' encoding='ISO-8859-1' ?>\n<"+p+">\n"}for(x=0;x<f.length;x++){if(typeof f[x]=="object"){var e=_dgo(f[x].dlg.aID).GetDialogInstObject(f[x].instID);if(e.hasOwnProperty("dialogs")){var y=dictionary.GetObject(f[x].instID);var r=dictionary.GetObject(f[x].instID,true);y.exportID=++dictionary.dlgExportCnt;k+=b+"<instances dlgid='"+y.exportID+"'>\n";for(l=0;l<e.dialogs.length;l++){var m="";if(f[x].dlg.aType==TYPE_DIALOG){m=HandleChars(f[x].dlg.loadedDefinition.description)}k+=b+"  <instance dlg='"+f[x].dlg.aName+"' description='"+m+"' sub='"+y.aName+"'>\n";var a=e.dialogs[l];r.PushInstanceRef(a);e.current=l+1;a.assignAttInstancesToDictinary(true);k+=Cmd_EncodeData(y.aObjectList,d,"__TTV",B,b+"    ");a.revertAttInstancesToDictinary(true);r.PopInstanceRef();e.current=0;k+=b+"  </instance>\n"}k+=b+"</instances>\n"}else{k+=Cmd_EncodeData(f[x].cap,d,"__TTV",B,b)}continue}else{n=_dgo(f[x])}if(n&&n.flatProps&&n.flatProps.ispassword){n=null}if(n){if(B){k+=b+"<"+n.aName}else{k+=b+"<item name='"+n.aName+"'"}var q="";var z=(B?"":"'");if(n.isFull()){if(B){switch(n.aType){case TYPE_BOOLEAN:q+=z+n.GetValueAsString()+z;break;default:q+=GetValueForXML(n)}}else{switch(n.aType){case TYPE_LIST:j=n.GetValueAsString(true);if(j instanceof Array){q+=z+ArrayToStr(j)+z}else{q+=ElementToStr(j)}break;case TYPE_BOOLEAN:q+=z+n.GetValueAsString()+z;break;case TYPE_NUMERIC:q+=z+n.GetValueAsString()+z;break;case TYPE_DATE:q+=z+n.GetValueAsString(true)+z;break;case TYPE_VARIABLE:q+=z+"("+n.GetValue()+")"+z;break;case TYPE_TEXT:q+=z+n.GetValue()+z;break}}}else{q+=z+PSEUDO_VALUE_EMPTY+z}var u="";if(n.flatProps&&n.flatProps._xmlexport&&!w){for(l=0;l<n.flatProps._xmlexport.length;l++){u+=" "+n.flatProps._xmlexport[l]+"='"+HandleChars(n.flatProps[n.flatProps._xmlexport[l]])+"'"}}if(n.aValueProps&&n.aValueProps.general&&n.aValueProps.general._xmlexport&&!w){for(l=0;l<n.aValueProps.general._xmlexport.length;l++){j=n.GetValueProp(n.aValueProps.general._xmlexport[l],-1);u+=" "+n.aValueProps.general._xmlexport[l]+"='"+HandleChars(j!=null?j:"")+"'"}}if(B){var g=(q.match(/\s/)!=null)&&(q.match(/CDATA/)==null);k+=u+">"+(g?"<![CDATA[":"")+q+(g?"]]>":"")+"</"+n.aName+">\n"}else{k+=" value="+q+u+"/>\n"}if(n.aType==TYPE_LIST){if(n.flatProps&&(n.flatProps.selectionmode=="Tree Dialog")){var A=n.GetTreeDialogCaptureList();k+=Cmd_EncodeData(A,d,"__TTV",B,b)}}}}if(p.length>0){k+="</"+p+">\n"}}else{k="";for(x=0;x<f.length;x++){n=dictionary.GetObject(f[x]);if(n){if(k.length>0){k+=","}k+=n.aName+"=";if(n.isFull()){switch(n.aType){case TYPE_LIST:case TYPE_BOOLEAN:j=n.GetValueAsString(true);if(j instanceof Array){j=ArrayToStr(j)}else{j=ElementToStr(j)}k+=j;break;case TYPE_NUMERIC:case TYPE_DATE:k+=n.GetValue();break;case TYPE_VARIABLE:case TYPE_TEXT:k+=n.GetValueAsJSON();break}}}}}return k}function XMLtoStr(a){if(window.ActiveXObject){return a.get(0).xml}return new XMLSerializer().serializeToString(a.get(0))}function Cmd_EncodeData_Extend(e,d,h,k,l){l=$.trim(l);if(l.substr(0,5).toLowerCase()=="<?xml"){if(l.substr(l.length-7,7)=="</data>"){l=l.substr(0,l.length-7)}else{l=""}}else{l=""}var n=Cmd_EncodeData(e,d,h,k,undefined);var a,b;if(l.length>0){var j=n.match(/<data>[\s\S]*<\/data>/im);if(j){j=j[0].substr(6,j[0].length-13);do{a=j.indexOf("<");if(a>=0){b=j.indexOf(">");if(b>=0){var m=j.substr(a+1,b-a-1);var g=m;if(g.indexOf(" ")>=0){g=g.substr(0,g.indexOf(" "))}j=j.substr(b+1);if(m.substr(m.length-1,1)!="/"){a=j.indexOf("</"+g+">");if(a>=0){var f=j.substr(0,a);j=j.substr(a+g.length+3);a=l.indexOf("<"+(g=="instances"?m+">":g));if(a>=0){b=l.indexOf("</"+g+">");if(b>=0){l=l.substr(0,a)+"<"+m+">"+f+"</"+g+">"+l.substr(b+g.length+3)}}else{a=0;l+="<"+m+">"+f+"</"+g+">\n"}}}}}}while(a>=0)}n=l+"</data>"}return n}function RipString(b,g){var e=b[0];var d="";var f=false;for(var h=0;h<e.length;h++){if(e.charAt(h)=="\\"){h++;if(g&&((e.charAt(h)=="'")||(e.charAt(h)=="\\"))){d+="\\"}d+=e.charAt(h)}else{if(e.charAt(h)=="'"){d+=e.charAt(h);if(!f){f=true}else{b[0]=e.substr(h+1);b[1]=d;return}}else{d+=e.charAt(h)}}}b[0]="";b[1]="''"}function RipNumber(b){var e=b[0];var d="";for(var f=0;f<e.length;f++){if(((e.charCodeAt(f)>=48)&&(e.charCodeAt(f)<=57))||(e.charAt(f)==".")||(e.charAt(f)=="-")){d+=e.charAt(f)}else{b[0]=e.substr(f);b[1]=d;return}}b[0]="";b[1]=d}function RipArray(d){var f=d[0];var e="";var g=0;for(var h=0;h<f.length;h++){if(f.charAt(h)=="'"){var b=[f.substr(h),""];RipString(b,true);e+=b[1];f=b[0];h=-1}else{if(f.charAt(h)=="["){g++;e+=f.charAt(h)}else{if(f.charAt(h)=="]"){g--;e+=f.charAt(h);if(g<=0){d[0]=f.substr(h+1);d[1]=e;return}}else{e+=f.charAt(h)}}}}d[0]="";d[1]=e}function DecodeDataFromNode(u,z,h,b){if(z.nodeType!=1){return}var d=z.nodeName;var w,y,A;if(d=="instances"){w=z.childNodes;for(y=0;y<w.length;y++){A=w[y];if(A.nodeType==1){DecodeDataFromNode(u,A,h,b)}}}else{if(d=="instance"){var e=z.attributes.getNamedItem("dlg");if(!e){hardError("@DecodeData input message : dlg attribute missing from instance tag");return}e=e.value;var r=z.attributes.getNamedItem("sub");if(!r){hardError("@DecodeData input message : sub attribute missing from instance tag");return}r=r.value;var C=dictionary.GetObjectByName(e);if(!C){hardError("@DecodeData input message : Unknown object name ["+e+"]");return}var g=dictionary.GetObjectByName(r);if(!g){hardError("@DecodeData input message : Unknown object name ["+r+"]");return}var a=((C.aType==TYPE_LIST)&&C.flatProps&&(C.flatProps.selectionmode=="Tree Dialog"));if((C.aType!=TYPE_DIALOG)&&!a){hardError("@DecodeData input message : Dialog expected ["+e+"]");return}var m=C.addSubDlgInstance(g.aID);if(m==-1){hardError("@DecodeData input message : Unknown sub-dialog name ["+C.aName+"."+g.aName+"]");return}var l=C.GetDialogInstObject(g.aID).dialogs;var q=l[m];C=dictionary.GetObject(q.aID,true);C.PushInstanceRef(q);q.assignAttInstancesToDictinary();w=z.childNodes;for(y=0;y<w.length;y++){A=w[y];if(A.nodeType==1){if(A.nodeName=="instance"||A.nodeName=="instances"){DecodeDataFromNode(q,A,h,b)}else{var t=dictionary.GetObjectByName(A.nodeName,true);if(!t){hardError("@DecodeData input message : Unknown dialog attribute name ["+A.nodeName+"]");return}if(t.aID==q.aID){SetValueFromXML(t,A)}else{var f=q.GetDialogInstObject(t.aID);if(!f){hardError("@DecodeData input message : Dialog does not contain instance of ["+A.nodeName+"]");return}SetValueFromXML(t,A)}}}}q.revertAttInstancesToDictinary();C.PopInstanceRef()}else{var k=dictionary.GetObjectByName(d,true);if(!k){throw new inferenceIssue(PASSBACK_ERROR,"@DecodeData input message : Unknown object name ["+d+"]",d)}var p=true;if(b){if(b!=k.aID){p=false}}if(p){if(!h&&k.flatProps){for(var B=0;B<z.attributes.length;B++){y=z.attributes.item(B);w=y.name;if(k.flatProps[w]!==undefined){var j=y.value;switch(typeof k.flatProps[w]){case ("number"):k.flatProps[w]=parseFloat(j);break;case ("string"):k.flatProps[w]=j;break;case ("boolean"):k.flatProps[w]=(j.toLowerCase()=="true");break}replayProtection.set(k,true)}}}var x=z.attributes.getNamedItem("dim");if(x){x="["+x.value+"]"}SetValueFromXML(k,z,x)}}}}function Cmd_DecodeDataXML(l,p,b,f){if(l.length===0){return}var r,j=null;try{r=$.parseXML(l)}catch(m){j="XML parser exception";if(m.hasOwnProperty("message")){j+=" : "+m.message}else{if(typeof m=="string"){j+=" : "+m}}}if(!j&&(!r||!r.documentElement||r.documentElement.nodeName=="parsererror")){j=(!r||!r.documentElement?"No Parser":r.documentElement.textContent)}if(j){if(p!=0){if(p==-1){return j}dictionary.GetObject(p).SetValue(j);return}else{hardError("@DecodeDataXML input message : Parse Error\n\n"+j);return}}var d="";var h=r.documentElement.childNodes;for(var k=0;k<h.length;k++){var g=h[k];if(g.nodeType==1){try{DecodeDataFromNode(null,g,f,b)}catch(m){if(p!=0){var q="";q=m.aValue;var o=q.split(":",2);if(o.length>=2){q=o[1]}o=q.split("[",2);if(o.length>=2){q=$.trim(o[0])}g.setAttribute("error",q);q=g.xml?g.xml:(new XMLSerializer()).serializeToString(g);d+=q+"\n"}}}}if(p!=0){if(d.length>0){d="<?xml version='1.0' encoding='ISO-8859-1' ?>\n<errors>\n"+d+"</errors>"}if(p==-1){return d}dictionary.GetObject(p).SetValue(d)}}function Cmd_DecodeData(aStr,xmlFlag,errObjID,singleObjID){if(xmlFlag){return Cmd_DecodeDataXML(aStr,errObjID,singleObjID)}var i=0;var s="";var o=null;var v=null;var a=[];var errStr="";if(aStr==undefined){return}while(aStr.length>0){i=aStr.indexOf("=");if(i==-1){hardError("= expected in DecodeData string ["+aStr+"]");return}s=aStr.substr(0,i);o=dictionary.GetObjectByName(s);if(!o){if(errStr.length>0){errStr+=" , "}errStr+=s}s=aStr.substr(i+1);a=[s,""];var ty="";if((s.charAt(0)==",")||(s.length==0)){ty="blank"}else{if(s.charAt(0)=="'"){RipString(a);s=a[0];v=a[1];if((v.charAt(v.length-1)!="'")||(v.length<2)){hardError("Unterminated string in DecodeData ["+aStr.substr(i+1)+"]");return}v=v.substr(1,v.length-2);ty="string"}else{if(s.charAt(0)=="["){RipArray(a);s=a[0];v=a[1];ty="array"}else{if(isNaN(Number(a[0]))){i=a[0].indexOf(",");if(i==-1){s="";v=a[0]}else{s=a[0].substr(i);v=a[0].substr(0,i)}ty="string"}else{RipNumber(a);s=a[0];v=a[1];if(!IsNumber(v)){hardError("Not a number ["+s+"]");return}if(v.indexOf(".")==-1){v=parseInt(v,10)}else{v=parseFloat(v)}if((o.aType==TYPE_LIST)||(o.aType==TYPE_BOOLEAN)||(o.aType==TYPE_TEXT)){ty="string"}else{ty="number"}}}}}if(o){if((singleObjID==0)||(singleObjID==o.aID)){if(ty==="blank"){o.Clear()}else{if((o.aType==TYPE_LIST)||(o.aType==TYPE_BOOLEAN)){if(ty==="string"){if(v===""){v=PSEUDO_VALUE_EMPTY}o.SetValueAsString(v,",",true)}else{o.SetValue(eval(v))}}else{if((o.aType==TYPE_NUMERIC)||(o.aType==TYPE_DATE)||(o.aType==TYPE_TEXT)){o.SetValue(v)}else{if(o.aType==TYPE_VARIABLE){o.SetValueAsJSON(v)}}}}}}if(s.charAt(0)==","){aStr=s.substr(1)}else{aStr=""}}if(errStr.length>0){if(errObjID!=0){if(errObjID==-1){return errStr}dictionary.GetObject(errObjID).SetValue(errStr)}else{hardError("Unknown object(s) in DecodeData string ["+errStr+"]");return}}}function Cmd_RunMode(){if(appEmbedded){return 7}else{if(appSettings.chatMode){if(typeof chat_mode=="string"&&(chat_mode=="browser")){return 10}else{return 11}}else{if(NODEJS){if(appSettings.f9){return 9}else{return 8}}else{if((document.location.protocol=="http:")||(document.location.protocol=="https:")){if(appSettings.f9){return 5}else{return 6}}else{return 5}}}}}function IntToHex(e,a,d){var b=Cmd_ToHexString(e);if(d){while(b.length<a){b+="0"}}else{while(b.length<a){b="0"+b}}return b}function Cmd_RGB(e,d,a){return IntToHex(e,2)+IntToHex(d,2)+IntToHex(a,2)}function addslashes(a){a=a.replace(/\'/g,"\\'");a=a.replace(/\"/g,'\\"');a=a.replace(/\\/g,"\\\\");a=a.replace(/\0/g,"\\0");return a}function stripslashes(a){a=a.replace(/\\'/g,"'");a=a.replace(/\\"/g,'"');a=a.replace(/\\\\/g,"\\");a=a.replace(/\\0/g,"\0");return a}function Cmd_XMLfetch(b,a,e){var d=replayStack.PopReplay(b.aID);if(d==REPLAYPOP_HANDLED){return true}else{if(d==REPLAYPOP_CURRENT){ServerCall(b.aID,"method=XMLFETCH&url="+escape(a)+"&varok="+e);return false}else{hardError("Unknown replay pop return ["+d+"]");return}}}function Cmd_XMLdb(b,a,e,g,f){var d=replayStack.PopReplay(b.aID);if(d==REPLAYPOP_HANDLED){return true}else{if(d==REPLAYPOP_CURRENT){ServerCall(b.aID,"method=XMLDB&file="+escape(a)+"&assign="+escape(g)+"&query="+escape(e)+"&varok="+f);return false}else{hardError("Unknown replay pop return ["+d+"]");return}}}function Cmd_XMLfetch_back(d,b){var a=dictionary.GetObjectByName(d);if(a){replayStack.Add(adHocObjectID,REPLAY_SET,a.aID,b)}}function Cmd_XRdoc(k,b,g,j){var a=replayStack.PopReplay(k.aID);if(a==REPLAYPOP_HANDLED){a=replayStack.PopReplay(k.aID);if(a==REPLAYPOP_HANDLED){return true}else{if(a==REPLAYPOP_CURRENT){var d="";var f="";var l;for(l=0;l<XRdocVars.length;l++){var n=XRdocVars[l];try{var m=Cmd_GetValue($.trim(n),true);n=n.replace(/\./g,"__");n=n.replace(/\[/g,"___");n=n.replace(/\]/g,"____");n=n.replace(/\ /g,"_____");d=d+"&"+n+"="+escape(m)}catch(h){if(f!=""){f+=","}f+=n}}if(f!=""){f="&errParam="+f}if(typeof j!="string"){j="DOCX"}else{j=j.toUpperCase()}if((j!="PDF")&&(j!="DOCX")){hardError("Unsupported return document type ["+j+"]");return}ServerCall(k.aID,"method=DOC&fname="+escape(b)+"&retURL="+escape(g)+d+f+"&doctype="+j);return false}else{hardError("Unknown replay pop return ["+a+"]");return}}}else{if(a==REPLAYPOP_CURRENT){ServerCall(k.aID,"method=DOCVARS&fname="+escape(b));return false}else{hardError("Unknown replay pop return ["+a+"]");return}}}function Cmd_XRdoc_vars_back(a){replayStack.Add(adHocObjectID,REPLAY_SYSTEMSET,0,a,"XRdocVars")}function Cmd_XRdoc_back(d,e){var f=dictionary.GetObjectByName(d);if(f){var b=e.split(",");replayStack.Add(adHocObjectID,REPLAY_SET,f.aID,b)}}function Cmd_XRdocpdf(g,j,f,d,b,e){var a=replayStack.PopReplay(g.aID);if(a==REPLAYPOP_HANDLED){return true}else{if(a==REPLAYPOP_CURRENT){b=dictionary.GetObject(b);var k="{";for(var h=1;h<=b.dim1;h++){if(b.GetValue(h,1)!=""){if(h>1){k+=","}k+="'"+b.GetValue(h,1)+"':'"+EncodeForDoubleQuotes(b.GetValue(h,2))+"'"}else{h=b.dim1}}k+="}";ServerCall(g.aID,"method=DOCPDF&uid="+escape(j)+"&pwd="+escape(f)+"&fname="+escape(d)+"&retURL="+escape(e)+"&vars="+escape(k));return false}else{hardError("Unknown replay pop return ["+a+"]");return}}}function Cmd_XRdocpdf_back(a,b){var d=dictionary.GetObjectByName(a);if(d){replayStack.Add(adHocObjectID,REPLAY_SET,d.aID,b)}}function Cmd_Ajax_Err(a){alert(a)}function Cmd_ExtCssFile(b,a){var d=replayStack.PopReplay(b.aID);if(d==REPLAYPOP_HANDLED){return true}else{if(d==REPLAYPOP_CURRENT){Set_ExtCssFile(a);replayStack.Add(b.aID,REPLAY_CRITICALDONE);replayStack.replayPos=replayStack.aReplay.length;return true}else{hardError("Unknown replay pop return ["+d+"]");return}}}function Cmd_ExtJSFile(b,a){var d=replayStack.PopReplay(b.aID);if(d==REPLAYPOP_HANDLED){return true}else{if(d==REPLAYPOP_CURRENT){Set_ExtJSFile(a);replayStack.Add(b.aID,REPLAY_CRITICALDONE);replayStack.replayPos=replayStack.aReplay.length;return true}else{hardError("Unknown replay pop return ["+d+"]");return}}}function Cmd_XMLpost(b,f,a){var d=replayStack.PopReplay(b.aID);if(d==REPLAYPOP_HANDLED){return true}else{if(d==REPLAYPOP_CURRENT){var e=Cmd_EncodeData("",true,"xpertrule");ServerCall(b.aID,"method=XMLPOST&url="+escape(f)+"&dataXML="+escape(e)+"&varok="+a);return false}else{hardError("Unknown replay pop return ["+d+"]");return}}}function Cmd_FireEvent(b,a){if((b!=null)&&a&&(a!="")){if(a=="onupdate"){return b.FireEvent(EVENT_UPDATE)}if(a=="oncapture"){return b.FireEvent(EVENT_CAPTURE)}if(a=="onleave"){return b.FireEvent(EVENT_LEAVE)}}return false}function Cmd_InStr(d,a,e){var b=d.indexOf(a,e)-e+1;if(b<0){b=0}return b}var currentConditionalObj=null;function ConditionalStart(a){var b=replayStack.PopReplay(a.aID);if(b==REPLAYPOP_HANDLED){return false}else{if(b==REPLAYPOP_CURRENT){currentConditionalObj=a;return true}else{hardError("Unknown replay pop return ["+b+"]");return}}}function ConditionalEnd(a){currentConditionalObj=null;replayStack.Add(a.aID,REPLAY_CRITICALDONE);throw new inferenceIssue(PASSBACK_LOOP)}function GetValue(a){if(typeof(a)=="string"){a=dictionary.GetObjectByName(a)}if((a==undefined)||(a==null)){return null}if(a.aType==TYPE_LIST){return a.GetValueAsString()}else{return a.GetValue()}}function SetValue(b,g,f){if(typeof(b)=="string"){b=_dgobn(b)}if(!b){return false}if((typeof(g)=="string")&&((b.aType==TYPE_LIST)||(b.aType==TYPE_BOOLEAN))){var d=g;g=b.NameToID(d);if(g===0){var h="Unknown value ["+d+"] for attribute ["+b.aName+"]";if(f){softError(h)}else{hardError(h);return}}}b.SetValue(g);var a=0;if(currentConditionalObj){a=currentConditionalObj.aID}replayStack.Add(a,REPLAY_SET,b.aID,g);return true}function XR_Continue(){if(!currentConditionalObj){alert("Error : Continue called while not in non-blocking @Pause!")}else{replayStack.Add(currentConditionalObj.aID,REPLAY_OK);currentConditionalObj=null;Go()}}function XR_DlgAction(a){replayStack.Add(currentConditionalObj.aID,a);Go()}function Cmd_Pause(b,h){var d=replayStack.PopReplay(b.aID);if(d==REPLAYPOP_HANDLED){return false}else{if(d==REPLAYPOP_CURRENT){var j=false;var f=true;if(wrapperOptions){if(wrapperOptions.pauseCallback){j=true;currentConditionalObj=b;var a=wrapperOptions.pauseCallback(xpertrule,h);if(a===false){f=false}}}if(f){try{currentConditionalObj=b;window.external.pause(h);j=true}catch(g){}}if(!j){throw new inferenceIssue(PASSBACK_PAUSECMD,h,b.aID)}else{if(f){currentConditionalObj=null;replayStack.Add(b.aID,REPLAY_CRITICALDONE);throw new inferenceIssue(PASSBACK_LOOP)}else{throw new inferenceIssue(PASSBACK_WAIT)}}}else{hardError("Unknown replay pop return ["+d+"]");return}}}function Cmd_checkNumber(b){var e="";var d="-0123456789.";var a="";for(i=0;i<b.length;i++){e=b.charAt(i);if(d.indexOf(e)==-1){return(i+1)}if((e=="-")&&(a.indexOf("-")!=-1)){return(i+1)}if((e==".")&&(a.indexOf(".")!=-1)){return(i+1)}a+=(e)}return(0)}function Cmd_RestartPos(a){var b=replayStack.PopReplay(a.aID);if(b==REPLAYPOP_HANDLED){return true}else{if(b==REPLAYPOP_CURRENT){replayStack.Add(a.aID,REPLAY_RESTARTPOS);replayStack.replayPos=replayStack.aReplay.length}else{hardError("Unknown replay pop return ["+b+"]");return}}}function Cmd_Restart(b,a){currentDlg=0;replayStack.RestartRevert(a);return false}function GetIndent(a){var d="  ";var b="";for(var e=0;e<a;e++){b+=d}return b}function EscapeForXML(b){var a=ConvertForDisplay(b,false);var d=a.match(/[\s]/)!==null;if(d){a=b}return(d?"<![CDATA[":"")+a+(d?"]]>":"")}function GetValueForXML(g,e){var d="";switch(g.aType){case TYPE_DATE:d=g.GetValueAsString("YYYYMMDD");break;case TYPE_LIST:d=g.GetValueAsString(g.isMultiSel?"|":undefined);break;case TYPE_BOOLEAN:d=g.GetValueAsString(true);break;case TYPE_VARIABLE:d=g.GetValueAsJSON();break;case TYPE_NUMERIC:d=g.GetValueAsString(undefined,false);break;default:d=g.GetValueAsString()}d=EscapeForXML(d);if(e){var f;var b="";if(g.flatProps&&g.flatProps._xmlexport){for(f=0;f<g.flatProps._xmlexport.length;f++){b+=" "+g.flatProps._xmlexport[f]+"='"+HandleChars(g.flatProps[g.flatProps._xmlexport[f]])+"'"}}if(g.aValueProps&&g.aValueProps.general&&g.aValueProps.general._xmlexport){for(f=0;f<g.aValueProps.general._xmlexport.length;f++){var a=g.GetValueProp(g.aValueProps.general._xmlexport[f],-1);b+=" "+g.aValueProps.general._xmlexport[f]+"='"+HandleChars(a!==null?a:"")+"'"}}d="<"+g.aName+b+">"+d+"</"+g.aName+">"}return d}function BuildDialogMsg(j,d){var h;var g=GetIndent(d);var b=g+"<"+j.aName+">\n";var k=GetIndent(d+1);if(j.aDefinition.instanceatts){for(h=0;h<j.aDefinition.instanceatts.length;h++){var a=dictionary.GetObject(j.aDefinition.instanceatts[h].att);var f=j.GetDialogInstObject(j.aDefinition.instanceatts[h].att);if(a.aType==TYPE_DIALOG){for(var e=0;e<f.dialogs.length;e++){b+=BuildDialogMsg(f.dialogs[e],d+1)}}else{b+=k+GetValueForXML(f,true)+"\n"}}}b+=g+"</"+j.aName+">\n";return b}function Cmd_DialogInstanceData(f,b){if(!$.isArray(b)){if(b){b=[b]}else{b=[]}}if(b.length===0){b=baseDialogs}var e="<?xml version='1.0'?>\n";var a=0;e+="<data>\n";a++;var d;for(var h=0;h<b.length;h++){var g=dictionary.GetObject(b[h]);if(!g){hardError("Unknown dialog ID for @EncodeDialogXML ["+b[h]+"]");return}if(g.aType!=TYPE_DIALOG){e+=GetIndent(a)+"<"+g.aName+">"+GetValueForXML(g)+"</"+g.aName+">\n"}else{e+=BuildDialogMsg(g,a)}}e+="</data>\n";return e}function decodeDateFromYYYYMMDDstring(b,e){var f=parseInt(b.substr(e?8:6,2),10);var a=parseInt(b.substr(e?5:4,2),10);var g=parseInt(b.substr(0,4),10);if(isNaN(f)||(f<1)||(f>31)||isNaN(a)||(a<1)||(a>12)||isNaN(g)){return null}return new Date(Date.UTC(g,a-1,f,0,0,0))}function SetValueFromXML(g,d,f){if(d.childNodes.length>0){var b=d.childNodes[0].nodeValue;switch(g.aType){case TYPE_DATE:var a=decodeDateFromYYYYMMDDstring(b,true);if(a===null){softError("Invalid date ["+b+"]")}else{var e=a.getTime();g.SetValue(e/86400000)}break;case TYPE_VARIABLE:g.SetValueAsJSON(b);break;case TYPE_LIST:if(g.isMultiSel){g.SetValueAsString(b,"|");break}default:Cmd_SetValueAsStr(g.aName+(f?f:""),b,true)}}else{if(!f){Cmd_SetValueAsStr(g.aName,PSEUDO_VALUE_EMPTY)}}}function ExtractDialogMsg(h,b){if(b.nodeType!=1){return}var k=b.nodeName;var j=dictionary.GetObjectByName(k,true);if(!j){hardError("@DecodeDialogXML input message : Unknown object name ["+k+"]");return}if((j.aType!=TYPE_DIALOG)&&(!h)){SetValueFromXML(j,b);return}if(j.aType!=TYPE_DIALOG){hardError("@DecodeDialogXML input message : Dialog expected ["+k+"]");return}if(h!==null){var l=h.addSubDlgInstance(j.aID);if(l==-1){hardError("@DecodeDialogXML input message : Unknown sub-dialog name ["+h.aName+"."+k+"]");return}dlgArr=h.GetDialogInstObject(j.aID).dialogs;j=dlgArr[l];h.PushInstanceRef(j)}else{j.clearSubDlgInstances()}j.assignAttInstancesToDictinary();var d=b.childNodes;for(var g=0;g<d.length;g++){var e=d[g];if(e.nodeType==1){var a=dictionary.GetObjectByName(e.nodeName,true);if(!a){softError("@DecodeDialogXML input message : Unknown dialog attribute name ["+e.nodeName+"]");continue}if(a.aType==TYPE_DIALOG){ExtractDialogMsg(j,e)}else{var f=j.GetDialogInstObject(a.aID);if(!f){softError("@DecodeDialogXML input message : Dialog does not contain instance of ["+e.nodeName+"]");continue}SetValueFromXML(a,e)}}}j.revertAttInstancesToDictinary();if(h!==null){h.PopInstanceRef()}}function Cmd_SetDialogInstanceData(b,k){var f,d=null;try{f=$.parseXML(k)}catch(g){d="XML parser exception";if(typeof g=="string"){d+=" : "+g}}if(!d&&(!f||!f.documentElement||f.documentElement.nodeName=="parsererror")){d=(!f||!f.documentElement?"No Parser":f.documentElement.textContent)}if(d){hardError("@DecodeDialogXML input message : Parse Error\n\n"+d);return}if(f.documentElement.nodeName=="data"){var j=f.documentElement.childNodes;for(var a=0;a<j.length;a++){var h=j[a];if(h.nodeType==1){ExtractDialogMsg(null,h)}}}else{ExtractDialogMsg(null,f.documentElement)}}function Cmd_PopupURL(b,e,d){var a=replayStack.PopReplay(0);if(a==REPLAYPOP_HANDLED){return true}else{if(a==REPLAYPOP_CURRENT){var f=window.open(b,"_blank",d);if(!f){hardError("Popup failed to open (maybe a popup blocker?)");return}if(e){f.document.title=e}if(window.focus){f.focus()}}else{hardError("Unknown replay pop return ["+a+"]");return}}}function Cmd_Redirect(a){window.location=a}var currentPhoneResultID=0;var currentPhoneResultType="string";var android_msg="";var MAX_ANDROID_LENGTH=2000;function Cmd_Phone(f,j,k,g){if(!appEmbedded&&(navigator.appVersion.indexOf("Win")!=-1)){if(!window.external){return}if(!$.isFunction(window.external.Notify)){return}}var h={};var a=replayStack.PopReplay(f.aID,false,h);if(a==REPLAYPOP_HANDLED){if(k==-1){return h.result}else{return true}}else{if(a==REPLAYPOP_CURRENT){adHocObjectID=f.aID;currentPhoneResultID=k;currentPhoneResultType="string";var b;if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))||(navigator.userAgent.match(/iPad/i))){var e="fake$"+j+"";for(b=0;b<g.length;b++){e+="$"+escape(g[b])}window.location=e}else{var d="<method>";d+="<name>"+j+"</name>";for(b=0;b<g.length;b++){d+="<param><![CDATA["+HandleChars2(g[b])+"]]></param>"}d+="</method>";if(navigator.appVersion.indexOf("Win")!=-1){if(!$.isFunction(window.external.Notify)){hardError("This deployment is designed to be used by Expert Advisor");return}window.external.Notify(d)}else{if(d.length<MAX_ANDROID_LENGTH){alert(d)}else{android_msg=d;Cmd_Phone_more()}}}throw new inferenceIssue(PASSBACK_WAIT,f.aID)}else{hardError("Unknown replay pop return ["+a+"]");return}}}function Cmd_Phone_more(){var a;if(android_msg.length<MAX_ANDROID_LENGTH){a="0"+android_msg;android_msg=""}else{a="1"+android_msg.substr(0,MAX_ANDROID_LENGTH);android_msg=android_msg.substr(MAX_ANDROID_LENGTH)}alert(a)}function Cmd_Phone_back(b){if(currentPhoneResultID!==0){b=b.replace(/\+/g," ");var a=unescape(b)+"";if(currentPhoneResultType=="boolean"){a=(a.toLowerCase()=="true")}if(currentPhoneResultID==-1){replayStack.Add(adHocObjectID,REPLAY_OBJRETURN,0,0,{result:a})}else{replayStack.Add(adHocObjectID,REPLAY_SET,currentPhoneResultID,a)}}replayStack.Add(adHocObjectID,REPLAY_CRITICALDONE);Go()}function Cmd_PhoneFeature(e,h,a){var g="PhoneFeature";if(navigator.appVersion.indexOf("Win")!=-1){if(!window.external||!$.isFunction(window.external.Notify)){dictionary.GetObject(a).SetValueAsBool(false);return}}var f=replayStack.PopReplay(e.aID);var j={};f=replayStack.PopReplay(e.aID,false,j);if(f==REPLAYPOP_HANDLED){if(a==-1){return j.result}else{return true}}else{if(f==REPLAYPOP_CURRENT){adHocObjectID=e.aID;currentPhoneResultID=a;currentPhoneResultType="boolean";if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))||(navigator.userAgent.match(/iPad/i))){var d="fake$"+g+"$"+h;window.location=d}else{var b="<method><name>"+g+"</name><param>"+h+"</param></method>";if(navigator.appVersion.indexOf("Win")!=-1){if(!$.isFunction(window.external.Notify)){hardError("This deployment is designed to be used by Expert Advisor");return}window.external.Notify(b)}else{alert(b)}}throw new inferenceIssue(PASSBACK_WAIT,e.aID)}else{hardError("Unknown replay pop return ["+f+"]");return}}}function Cmd_GetDeviceMetric(a){switch(a.toUpperCase()){case ("SCREEN_HEIGHT"):return $(window).height();case ("SCREEN_WIDTH"):return $(window).width()}return 0}function Cmd_Regex(g,f,h,e){var a=new RegExp(f,h);if(typeof e=="number"){var d=0;var b=dictionary.GetObject(e);var j,k;do{j=a.exec(g);if(j){k=j[0]}else{k=""}b.SetValue(k,++d,1);if(!a.global){j=false}}while(j)}else{return a.test(g)}}function Cmd_Split(d,f,h,e){var b=d.split(f);var g=dictionary.GetObject(h);g.SetValue(b);if(e){g=dictionary.GetObject(e);if(g){g.SetValue(b.length)}}return(b.length)}function Cmd_GetFlatNProp(b,a){return b.GetFlatProp(a)}function Cmd_GetFlatSProp(b,a){return b.GetFlatProp(a)}function Cmd_GetValNProp(b,a){return b.GetValueProp(a)}function Cmd_GetValSProp(b,a){return b.GetValueProp(a)}function Cmd_SetFlatNProp(d,a,b){return d.SetFlatProp(a,b)}function Cmd_SetFlatSProp(d,a,b){return d.SetFlatProp(a,b)}function Cmd_Rollup(k,f,e){var g=dictionary.GetObject(k);if(!g){return 0}var l=parseInt(e);var b,h;var a=function(o,q){var n=0;for(var u=0;u<o.length;u++){var p=o[u];if(p.selected()){if(q){var t=p.item;var m=t.GetValue();if(m&&((t.aType==TYPE_LIST)||(t.aType==TYPE_BOOLEAN))){if($.isArray(m)){for(var r=0;r<m.length;r++){b=t.ValueIDtoIndex(m[r]);h=0;if(t.aValues[b].hasOwnProperty(f)){h=t.aValues[b][f]}if((l==0)&&t.aValues[b].hasOwnProperty(e)){h*=t.aValues[b][e]}n+=h}}else{b=t.ValueIDtoIndex(m);h=0;if(t.aValues[b].hasOwnProperty(f)){h=t.aValues[b][f]}if((l==0)&&t.aValues[b].hasOwnProperty(e)){h*=t.aValues[b][e]}n+=h}}}if(p.children){n+=a(p.children,true)}}}return n};if(g.aType==TYPE_HIERARCHY){return a(g.tree,true)}else{var j=hierarchy.current();if(!j){return 0}var d=j.findNodeByObjId(k);if(!d){return 0}return a(d,false)}}function GetUncaptured(e){function f(h){var g,o,j,r,l;var p=[];var k=null;switch(h.aType){case NODETYPE_INLINE:g=dictionary.GetObject(h.aAttribute);if(g){k=g.GetValue();if(!k){p.push(g)}r=f(h.aSubTree);if($.isArray(r)){for(l in r){p.push(r[l])}}}break;case NODETYPE_SPLIT:g=dictionary.GetObject(h.aAttribute);if(g){p=[];if(!h.aProp){k=g.GetValue()}else{switch(h.aProp.aType){case TREE_PROP_FLAT:k=g.GetFlatProp(h.aProp.aName);break;case TREE_PROP_VALUE:k=g.GetProp(h.aProp.aID);break}if(typeof k=="boolean"){k=k?1:2}}var q=false;if(k){for(o=0;o<h.aBranches.length;o++){if(h.aBranches[o].aAttribute){var m=dictionary.GetObject(h.aBranches[o].aAttribute);if(!m){break}var n=m.GetValue();if(!n){break}if((g.aType==TYPE_LIST)||(g.aType==TYPE_BOOLEAN)){j=g.NameToID(m.GetValueAsString());if(j){h.aBranches[o].aValues=[j]}}else{h.aBranches[o].aThreshold=n}}if((g.aType==TYPE_LIST)&&g.isMultiSel){if(o>0){q=true}else{switch(h.aBranches[o].aComparitor){case"SUB":for(j=0;j<k.length;j++){if(!IsValueInBranch(h.aBranches[o],k[j])){break}}q=(j==k.length);break;case"SUP":for(j=0;j<h.aBranches[o].aValues.length;j++){if(!g.IsValueSelected(h.aBranches[o].aValues[j])){break}}q=(j==h.aBranches[o].aValues.length);break;case"INT":for(j=0;j<k.length;j++){if(IsValueInBranch(h.aBranches[o],k[j])){q=true;break}}break;case"=":if(k.length==h.aBranches[o].aValues.length){for(j=0;j<k.length;j++){if(!IsValueInBranch(h.aBranches[o],k[j])){break}}q=(j==k.length)}break;default:hardError("Unknown tree multi-sel list comparitor ["+h.aBranches[o].aComparitor+"] for attribute ["+g.aName+"] on tree ["+this.aName+"]");return}}}else{if((g.aType==TYPE_LIST)||(g.aType==TYPE_BOOLEAN)||(g.aType==TYPE_TEXT)){q=IsValueInBranch(h.aBranches[o],k);if(h.aBranches[o].aComparitor=="<>"){q=!q}}else{if((g.aType==TYPE_NUMERIC)||(g.aType==TYPE_DATE)){if(h.aProp){q=IsValueInBranch(h.aBranches[o],k)}else{switch(h.aBranches[o].aComparitor){case"<":if(k<h.aBranches[o].aThreshold){q=true}break;case">=":if(k>=h.aBranches[o].aThreshold){q=true}break;case"<=":if(k<=h.aBranches[o].aThreshold){q=true}break;case">":if(k>h.aBranches[o].aThreshold){q=true}break;case"=":if(k==h.aBranches[o].aThreshold){q=true}break;case"<>":if(k!=h.aBranches[o].aThreshold){q=true}break;default:hardError("Unknown tree numeric comparitor ["+h.aBranches[o].aComparitor+"] for attribute ["+g.aName+"] on tree ["+this.aName+"]");return}}}else{hardError("Unknown tree split type for attribute ["+g.aName+"] on tree ["+this.aName+"]");return}}}if(q){r=f(h.aBranches[o].aSubTree);if($.isArray(r)){for(l in r){p.push(r[l])}}break}}}else{p.push(g)}if(!q){for(o=0;o<h.aBranches.length;o++){r=f(h.aBranches[o].aSubTree);if($.isArray(r)){for(l in r){p.push(r[l])}}}}}break;default:if(h.aSubTree){r=f(h.aSubTree);if($.isArray(r)){for(l in r){p.push(r[l])}}}}return p}var b=[];if(e.aTree){var d=f(e.aTree);if($.isArray(d)){for(var a in d){if($.inArray(d[a].aName,d)==-1){b.push(d[a].aName)}}}}return b}var req=null;var adHocObjectID=0;function loadXMLDoc(b,f,h,g){if(adHocObjectID){return}adHocObjectID=g;var a=false;if(window.XMLHttpRequest){req=new XMLHttpRequest();req.onreadystatechange=processReqChange;try{req.open(h,b,true);req.setRequestHeader("Content-Type","application/x-www-form-urlencoded");if(h=="POST"){}req.send(f);a=true}catch(d){req=null;a=false}}if(!a){if(window.ActiveXObject){req=new ActiveXObject("Microsoft.XMLHTTP");if(req){document.onmousedown=DisableClick;req.onreadystatechange=processReqChange;req.open(h,b,true);req.setRequestHeader("Content-Type","application/x-www-form-urlencoded");if(h=="POST"){req.setRequestHeader("Content-length",f.length);req.setRequestHeader("Connection","close")}req.send(f)}}}}function processReqChange(){if(!req){return}if(req.readyState==4){if(req.status==200){if(req.responseText.length>0){eval(req.responseText)}ServerCalled();if(window.ActiveXObject){document.onmousedown=null}return true}else{if((req.status==0)&&(req.responseText)){if(req.responseText.length>0){eval(req.responseText)}if(window.ActiveXObject){document.onmousedown=null}return true}else{alert("Error retrieving data from server! ["+req.status+"]");return false}}}}function DemandLoad(g,e,h){var d="objects/id_"+g+".js";if(true){var a=document.getElementsByTagName("head")[0];var b=document.createElement("script");b.type="text/javascript";b.src=d;a.appendChild(b)}else{loadXMLDoc(d,"","GET")}if(!h){throw new inferenceIssue(PASSBACK_WAIT,g)}}function PopulateObject(e,d,b,a){if(typeof d=="boolean"){throw"This is a legacy knowledge base from a version which is un-importable"}var f=dictionary.GetObject(e,true);if(f==null){alert("AJAX callback unknown object ID ["+e+"]")}else{f.Populate(d,b,a)}}function PopulateBayes(b,a){var d=dictionary.GetObject(b);if(d==null){alert("AJAX callback unknown object ID ["+b+"]")}else{d.PopulateBayes(a)}}function PopulateProc(b,a){var d=dictionary.GetObject(b);if(d==null){alert("AJAX callback unknown object ID ["+b+"]")}else{if(!a){a=d.aName+"()"}d.Populate(a)}}function PopulateTextProcessor(b,a){var d=dictionary.GetObject(b);if(d==null){alert("AJAX callback unknown object ID ["+b+"]")}else{if(a){d.Populate(a)}else{d.Populate(d.aName+"()")}}}function PopulateReport(e,b,d,a){var f=dictionary.GetObject(e);if(f==null){alert("AJAX callback unknown object ID ["+e+"]")}else{if(!d){d=f.aName+"()"}f.Populate(b,d,a)}}function PopulateHierarchy(b,a){var d=dictionary.GetObject(b);if(d==null){alert("AJAX callback unknown object ID ["+b+"]")}else{d.Populate(a)}}function PopulateDialog(b,a,e){var d=dictionary.GetObject(b);if(d==null){alert("AJAX callback unknown object ID ["+b+"]")}else{d.Populate(a,e)}}function PopulateCTable(d,b,a){var e=dictionary.GetObject(d);if(e==null){alert("AJAX callback unknown object ID ["+d+"]")}else{e.Populate(b,a)}}function ServerCall(objectID,postData){$.ajax({async:true,data:postData,dataType:"html",success:function(r){if(r.length>0){eval(r)}if(objectID){replayStack.Add(objectID,REPLAY_OK)}Go()},timeout:30000,type:"POST",url:"ajax.php"})}function ServerCalled(a){if(!a){if(adHocObjectID==0){return}a=adHocObjectID;adHocObjectID=0}if(a){replayStack.Add(a,REPLAY_OK)}Go()}function DictionaryObject(d,e,a,b){this.aID=d;this.aName=(e.substring(0,1)=="~"?e.substring(1):Handle(e));this.aType=a;this.objInfo=b;this.flatProps=null;this.props=null;this.aText=this.aName;this.aTree=null;this.aExamples=null;this.aPolicyRules=null;this.loaded=false;this.loadedFlatProps=null;this.staticData=false;this.promptFor=true;this.isDataFull=false;this.instancePtr=null;this.encounteredOnHierarchy=false;this.hasSequenceNode=false;this.hitCount=0;this.bayesian=null;this.treeDialog=[];this.treeDialogHidden=[];this.treeDialogInitialStates=[];this.constraintDomain=0;this._hintprops=["aType","aName","val([newValue])","clear();","run();","isEmpty()","props","prop(controlPropName[, newValue])","nValues","value([valueIndex])","inst(valuePropName[, valueIndex[, newValue]])","clearInstances();","addInstance(newValueName[, newValueProperties]);","addInstances(newValueArray);","delInstance(valueIndex);","parentObj();"]}DictionaryObject.prototype.PushInstanceRef=function(a){if(this.instancePtr==null){this.instancePtr=[a]}else{this.instancePtr.unshift(a)}};DictionaryObject.prototype.GetInstanceRef=function(){if(this.instancePtr!=null){return this.instancePtr[0]}return this};DictionaryObject.prototype.ResetInstanceRef=function(){this.instancePtr=null;if(this.flatProps&&this.flatProps.instanceatts){for(var b=0;b<this.flatProps.instanceatts.length;b++){var a=dictionary.GetObject(this.flatProps.instanceatts[b].att,true);if(a){if((a.aType==TYPE_DIALOG)||(a.flatProps&&a.flatProps.instanceatts)){this.flatProps.instanceatts[b].data={current:0,dialogs:[]}}}}}};DictionaryObject.prototype.PopInstanceRef=function(){if(this.instancePtr==null){return null}var a=this.instancePtr.shift();if(this.instancePtr.length==0){this.instancePtr=null}return a};var lastInst=0;DictionaryObject.prototype.createAttInstances=function(){if(this.flatProps&&this.flatProps.instanceatts){for(var d=0;d<this.flatProps.instanceatts.length;d++){var b=dictionary.GetObject(this.flatProps.instanceatts[d].att);if(b){var a=null;if(b.aType==TYPE_DIALOG){a={current:0,dialogs:[]}}else{if(b.flatProps&&b.flatProps.instanceatts){a={current:0,dialogs:[]}}else{if(this.isSubDialog){a=$.extend(true,{},b);a.aasInstanceNo=lastInst++;a.Clear(true);a.ResetInstanceRef()}else{a=null}}}this.flatProps.instanceatts[d].data=a}}}};DictionaryObject.prototype.GetDialogInstObject=function(a){if(this.flatProps&&this.flatProps.instanceatts){for(var b=0;b<this.flatProps.instanceatts.length;b++){if(this.flatProps.instanceatts[b].att==a){if(this.flatProps.instanceatts[b].data!=null){return this.flatProps.instanceatts[b].data}else{return dictionary.GetObject(a)}}}}return null};DictionaryObject.prototype.assignAttInstancesToDictinary=function(){if(this.flatProps&&this.flatProps.instanceatts&&this.isSubDialog){for(var d=0;d<this.flatProps.instanceatts.length;d++){var a=this.flatProps.instanceatts[d].data;if(a){var b=dictionary.GetObject(this.flatProps.instanceatts[d].att,true);if(b){b.PushInstanceRef(a)}}}}};DictionaryObject.prototype.revertAttInstancesToDictinary=function(){if(this.flatProps&&this.flatProps.instanceatts){for(var b=0;b<this.flatProps.instanceatts.length;b++){var a=dictionary.GetObject(this.flatProps.instanceatts[b].att,true);if(a){a.PopInstanceRef()}}}};DictionaryObject.prototype.addSubDlgInstance=function(d){var a=this.GetDialogInstObject(d);if(!aIns){return -1}var e=dictionary.GetObject(d,true);var b=$.extend(true,{},e);b.isSubDialog=true;b.createAttInstances();a.dialogs[a.dialogs.length]=b;return a.dialogs.length-1};DictionaryObject.prototype.runSubDlgInstance=function(e,d){var b=this.GetDialogInstObject(e);if(!b){return null}if((d<0)||(d>=b.dialogs.length)){hardError("Sub dialog instance index out of bounds ["+d+"] for "+this.aName+".?");return}var a=b.dialogs[d];b.current=d+1;var f=dictionary.GetObject(e,true);f.PushInstanceRef(a);if(a.Run()){f.PopInstanceRef();b.current=0;return true}return false};DictionaryObject.prototype.delSubDlgInstance=function(d,b){var a=this.GetDialogInstObject(d);if(!a){return null}if((b<0)||(b>=a.dialogs.length)){hardError("Sub dialog instance index out of bounds ["+b+"] for "+this.aName+".?");return}a.dialogs=a.dialogs.slice(0,b).concat(a.dialogs.slice(b+1));if(this.flatProps&&this.flatProps.instanceatts){for(var e=0;e<this.flatProps.instanceatts.length;e++){if(this.flatProps.instanceatts[e].att==d){this.flatProps.instanceatts[e].data=a}}}};DictionaryObject.prototype.Evaluate=function(){this.promptFor=true};DictionaryObject.prototype.SetPromptFor=function(a){this.promptFor=a};DictionaryObject.prototype.Reset=function(){if(this.loadedFlatProps){this.flatProps=$.extend(true,{},this.loadedFlatProps)}this.props=this.flatProps};DictionaryObject.prototype.GetDescription=function(d){var a=this.flatProps?this.flatProps:(this.props?this.props:null);if(a&&(typeof a.description=="string")){if(a.description.length>0){var b=a.description;b=LabelDecode(b,this,false);return b}}else{if(this.description&&(this.description.length>0)){return this.description}else{if(this.aDefinition&&this.aDefinition.description&&(this.aDefinition.description.length>0)){return this.aDefinition.description}}}if(d){return this.aName}return""};DictionaryObject.prototype.Clear=function(){this.isDataFull=false;this.Evaluate()};DictionaryObject.prototype.clear=function(){this.Clear();return this};DictionaryObject.prototype.evaluate=function(){this.Evaluate();return this};DictionaryObject.prototype.isFull=function(){return this.isDataFull};DictionaryObject.prototype.TypeAsStr=function(){switch(this.aType){case TYPE_LIST:return"List";case TYPE_NUMERIC:return"Numeric";case TYPE_BOOLEAN:return"Boolean";case TYPE_DATE:return"Date";case TYPE_PROCEDURE:return"Procedure";case TYPE_REPORT:return"Report";case TYPE_DIALOG:return"Dialog";case TYPE_VARIABLE:return"Variable";case TYPE_TEXT:return"Text";default:return"Unknown"}};DictionaryObject.prototype.toString=function(){this.Load();return"Name: "+this.aName+"\nId: "+this.aID+"\nType: "+this.TypeAsStr(this)};DictionaryObject.prototype.Populate=function(h,g){this.loaded=true;if(h&&h.hasOwnProperty("pid")&&h.pid){var f=dictionary.GetObject(h.pid);var d;if(f){d=$.extend(true,{},f.loadedFlatProps)}else{d={}}for(var j in h){d[j]=h[j]}h=d}for(var j in h){if(j.substr(0,1)=="~"){var b=Handle2(j);h[b]=h[j];delete h[j];if(typeof h[b]=="string"){h[b]=Handle2(h[b])}}}this.flatProps=h;this.props=this.flatProps;if(h){this.loadedFlatProps=$.extend(true,{},h)}var a=false;if(g){if(g.version){if(g.version==1){this.aExamples=g.examples;this.aTree=g.tree;this.aPolicyRules=g.policyRules}a=true}}if(!a){if(g){if(g.cases){this.aExamples=g}if(g.dOutcome){this.aPolicyRules=g}}if(!this.aExamples&&!this.aPolicyRules){this.aTree=g}}if(this.aTree){function e(l){if(l.aType==NODETYPE_SEQUENCE){return true}if($.isArray(l.aBranches)){for(var k=0;k<l.aBranches.length;k++){if(l.aBranches[k].aSubTree){if(e(l.aBranches[k].aSubTree)){return true}}}}return false}this.hasSequenceNode=e(this.aTree)}else{this.hasSequenceNode=false}};DictionaryObject.prototype.toObject=function(){var a={aID:this.aID,aName:this.aName,aType:this.aType,objInfo:this.objInfo};if((this.aType==TYPE_LIST)||(this.aType==TYPE_NUMERIC)||(this.aType==TYPE_DATE)||(this.aType==TYPE_BOOLEAN)||(this.aType==TYPE_TEXT)){a.flatProps=this.flatProps;a.tree={version:1,examples:this.aExamples,policyRules:this.aPolicyRules,tree:this.aTree}}if(this.hasOwnProperty("aValues")){a.aValues=this.aValues.slice(0);for(var b=0;b<a.aValues.length;b++){a.aValues[b]=$.extend(true,{},a.aValues[b]);delete a.aValues[b].id;delete a.aValues[b].aText;delete a.aValues[b].valid;delete a.aValues[b].evalid}}if(this.hasOwnProperty("aValues")&&this.hasOwnProperty("aValueProps")){a.values={values:this.aValues,props:this.aValueProps}}if(isEditor){if(this.aTree){xrkb_tree.eachNode(this,true,function(d){if($.isPlainObject(d.draw)){delete d.draw}})}}if(this.hasOwnProperty("events")){a.events=this.events}if(this.hasOwnProperty("_classPrivs")){a._classPrivs=this._classPrivs}return a};DictionaryObject.prototype.PopulateBayes=function(a){this.bayesian=a};DictionaryObject.prototype.Load=function(){this.Populate(null);return true};DictionaryObject.prototype.GetValue=function(){return null};DictionaryObject.prototype.SetValue=function(){replayProtection.set(this);this.Load();this.promptFor=false;this.isDataFull=true};DictionaryObject.prototype.GetFlatProp=function(b){this.Load();var a=b.toLowerCase();if(a=="isempty"){return this.IsEmpty()}if(a=="treedialog"){return this.TreeDialogAsXML()}if(this.flatProps){if(this.flatProps.hasOwnProperty(b)){return this.flatProps[b]}if(this.flatProps.hasOwnProperty(a)){return this.flatProps[a]}}return null};DictionaryObject.prototype.SetFlatProp=function(a,b){if(this.GetFlatProp(a)!=null){a=a.toLowerCase();if(a=="isempty"){hardError("Cannot assign to read only property : "+this.aName+"."+a);return}if(typeof(b)=="string"){if(typeof this.flatProps[a]=="boolean"){b=(b.toLowerCase()=="true")}else{if(typeof this.flatProps[a]=="number"){b=parseFloat(b)}}}this.flatProps[a]=b;return true}return false};DictionaryObject.prototype.GetProp=function(d,a){this.Load();if(typeof d=="string"){var b=this.GetFlatProp(d);if(b){return b}if((this.aType==TYPE_LIST)||(this.aType==TYPE_BOOLEAN)){if(a==null){a=-1}return this.GetValueProp(d,a)}}else{if(a==null){a=-1}return this.GetValueProp(d,a)}return null};DictionaryObject.prototype.SetProp=function(b,d,a){if(this.SetFlatProp(b,d)){return true}if(this.aType==TYPE_LIST){if(a==null){a=-1}return this.SetValuePropIndex(b,a,d)}return false};DictionaryObject.prototype.SetValueAsString=function(){};DictionaryObject.prototype.GetValueAsString=function(){return""};DictionaryObject.prototype.GetValueProp=function(){return null};DictionaryObject.prototype.findValueProp=function(a){if(this.aValueProps){for(var b=0;b<this.aValueProps.list.length;b++){if(this.aValueProps.list[b].aID==a){return this.aValueProps.list[b]}}}return null};DictionaryObject.prototype.getDisplayOrder=function(){var a=[];var d=0;var e,b;do{b=10000;for(e=0;e<this.aValueProps.list.length;e++){if((this.aValueProps.list[e].display>d)&&(this.aValueProps.list[e].display<b)){b=this.aValueProps.list[e].display}}if(b<10000){for(e=0;e<this.aValueProps.list.length;e++){if(this.aValueProps.list[e].display==b){a.push(e)}}d=b}}while(b!=10000);for(e=0;e<this.aValueProps.list.length;e++){if(this.aValueProps.list[e].display==-1){a.push(e)}}if(a.length==0){a.push(0)}return a};DictionaryObject.prototype.IsEmpty=function(a){if(this.isDataFull){return false}else{if(a&&this.flatProps&&this.flatProps.defaultmode=="UseDefault"){return false}}return true};DictionaryObject.prototype.isEmpty=function(a){return this.IsEmpty(a)};DictionaryObject.prototype.IsEmptyAsString=function(){if(this.IsEmpty()){return"True"}return"False"};function IsValueInBranch(a,b){if(a.aValues){for(var d=0;d<a.aValues.length;d++){if(a.aValues[d]==b){return true}}}return false}function DoTreeReport(d,e,a){var b=replayStack.PopReplay(d);if(b==REPLAYPOP_HANDLED){return true}else{if(b==REPLAYPOP_CURRENT){throw new inferenceIssue(PASSBACK_PAUSETREEPAGE,a,d)}else{if(b==REPLAYPOP_STOP){return false}}}hardError("Unknown replay pop return ["+b+"]");return}function IDtoNode(a,b){if(a.aID==b){return a}else{switch(a.aType){case NODETYPE_INLINE:case NODETYPE_PAGE:case NODETYPE_LABEL:return IDtoNode(a.aSubTree,b);case NODETYPE_PROC:if($.isPlainObject(a.aSubTree)){return IDtoNode(a.aSubTree,b)}if(!$.isArray(a.aBranches)){return null}case NODETYPE_SPLIT:case NODETYPE_SEQUENCE:for(var e=0;e<a.aBranches.length;e++){var d=IDtoNode(a.aBranches[e].aSubTree,b);if(d){return d}}}}return null}DictionaryObject.prototype.AssignViaSelectionRule=function(d,e){this.Load();if(!this.flatProps){return false}if(!this.flatProps.selectionrule){return false}if(!this.flatProps.selectionrule.mode){return false}var b=true;for(var j=0;(j<this.flatProps.selectionrule.rules.length)&&b;j++){var g=dictionary.GetObject(this.flatProps.selectionrule.rules[j].att);if(g&&g.IsEmpty()){replayStack.formTreeSet(g)}if(g){if(g.IsEmpty()){if(e){d.ExtendTreeDialog(g);return true}else{if(!g.Run()){return false}}}if(e){if($.inArray(g.aID,d.treeDialogInitialStates)>-1){d.ExtendTreeDialog(g)}}switch(g.aType){case TYPE_LIST:var a=g.GetValue();if($.isArray(a)){b=false}else{var f=false;for(var h=0;h<this.flatProps.selectionrule.rules[j].val.length;h++){if(this.flatProps.selectionrule.rules[j].val[h]==a){f=true;break}}if(!f){b=false}}break;case TYPE_BOOLEAN:if(g.GetValueAsBool()!=this.flatProps.selectionrule.rules[j].val){b=false}break}}}if(this.flatProps.selectionrule.mode!="include"){b=!b}if(!b){if((this.aType==TYPE_BOOLEAN)&&!this.flatProps.selectionrule.failvalueid){this.SetValueAsBool(false)}else{if(this.flatProps.selectionrule.failvalueid){this.SetValue(this.flatProps.selectionrule.failvalueid)}}return true}return false};DictionaryObject.prototype.InitTreeDialog=function(){this.treeDialog.splice(0,this.treeDialog.length);this.treeDialogHidden.splice(0,this.treeDialogHidden.length)};DictionaryObject.prototype.ExtendTreeDialog=function(b,a){var d;if(b==undefined){d=undefined}else{d=$.extend(true,{},b)}if(a){this.treeDialogHidden.push(d)}else{this.treeDialog.push(d)}};DictionaryObject.prototype.RenderTreeDialog=function(a){if(this.flatProps.grouppreviousanswers!=""){replayStack.formTreeShow(this.aID);treeDialogs.Render(this,this.treeDialog);throw new inferenceIssue(PASSBACK_WAIT)}else{var b=replayStack.PopReplay(this.aID);if(b==REPLAYPOP_HANDLED){return true}else{if(b==REPLAYPOP_CURRENT){treeDialogs.Render(this,this.treeDialog);throw new inferenceIssue(PASSBACK_WAIT)}else{if(b==REPLAYPOP_STOP){return false}else{hardError("Unknown replay pop return ["+b+"]");return}}}}};DictionaryObject.prototype.GoTree=function(aTree,aParams,aNode,asDialog,passedIncompleteObj,onlyBuild,moreSequences,passedSeq){if(asDialog===undefined){asDialog=false}if(moreSequences===undefined){moreSequences=false}if(passedSeq===undefined){passedSeq=false}var c,cc,aAttribute,assignedViaSelRule,o,aBranch,res;switch(aNode.aType){case NODETYPE_LEAF:var setLeaf=false;if(!passedIncompleteObj.value&&!onlyBuild){if(aTree.isFull()){aTree.flatProps.previousvalue=aTree.val()}if(aTree.dmInfo&&$.isPlainObject(aNode.stats)){switch(aTree.aType){case TYPE_LIST:var domFq=0;var fq=0;for(c=0;c<aNode.stats.values.length;c++){fq+=aNode.stats.values[c].freq}for(c=0;c<aNode.stats.values.length;c++){aTree.aValues[aTree.ValueIDtoIndex(aNode.stats.values[c].aID)].prob=(fq==0?0:aNode.stats.values[c].freq/fq);if(aNode.stats.values[c].aID==aTree.aValues[0].aID){domFq=aNode.stats.values[c].freq}}var selValIdx;var domProb=(fq==0?0:domFq/fq);if(aTree.dmInfo.settings.hasOwnProperty("autoThreshold")){if(domProb>=aTree.dmInfo.settings.autoThreshold){selValIdx=0}else{selValIdx=1}}else{selValIdx=0}aTree.SetValue(aTree.aValues[selValIdx].aID);aTree.flatProps.prob=aTree.aValues[selValIdx].prob;break;case TYPE_NUMERIC:case TYPE_DATE:aTree.SetValue(aNode.stats.avg);aTree.flatProps.stddev=aNode.stats.stddev;break}if(aParams&&aParams.isFuzzy){aNode.fuzzyMv=aParams.fuzzyMv}}else{if(aNode.aStats){for(c=0;c<aNode.aStats.vals.length;c++){aTree.aValues[aTree.ValueIDtoIndex(aNode.aStats.vals[c].vid)].prob=aNode.aStats.vals[c].prob}}if(aNode.aOutcome!=EMPTY_LEAF){if(aTree.isMultiSel){var vals=asDialog?aTree.GetValue():[];if($.isArray(aNode.aOutcome)){for(c=0;c<aNode.aOutcome.length;c++){if($.inArray(aNode.aOutcome[c],vals)==-1){vals.push(aNode.aOutcome[c])}}}else{if($.inArray(aNode.aOutcome,vals)<0){vals.push(aNode.aOutcome)}}aTree.SetMultiValue(vals,SETOP_ADD)}else{aTree.SetValue(aNode.aOutcome)}setLeaf=true}else{if(aTree.isMultiSel){if(!asDialog&&!passedSeq){aTree.Clear()}aTree.SetPromptFor(false)}else{if(aTree.isFull()){aTree.SetPromptFor(false)}}}}aTree.flatProps.leafid=aNode.aID}if(asDialog){if((aTree.aID==this.aID)&&(!moreSequences||setLeaf)){if(this.flatProps.grouppreviousanswers==""){this.ExtendTreeDialog(undefined);if(!onlyBuild){this.RenderTreeDialog(aAttribute)}}if(!onlyBuild){for(c=0;c<this.treeDialogInitialStates.length;c++){var captured=false;for(cc=0;cc<this.treeDialog.length&&!captured;cc++){if(this.treeDialog[cc]&&(this.treeDialogInitialStates[c]==this.treeDialog[cc].aID)){captured=true}}for(cc=0;cc<this.treeDialogHidden.length&&!captured;cc++){if(this.treeDialogHidden[cc]&&(this.treeDialogInitialStates[c]==this.treeDialogHidden[cc].aID)){captured=true}}if(!captured){o=dictionary.GetObject(this.treeDialogInitialStates[c]);if(!o.IsEmpty()){o.Clear()}}}}}}break;case NODETYPE_LEAFPROC:eval(aNode.aFunction+"()");if(!this.isFull()){hardError("Leaf expression does not assign an outcome ["+this.aName+"]");return}break;case NODETYPE_LEAFJUMP:var n=IDtoNode(aTree.aTree,aNode.aJump);if(!n){hardError("Unknown Label jump on tree ["+this.aName+"]");return}if(!this.GoTree(aTree,aParams,n,asDialog,passedIncompleteObj,onlyBuild,moreSequences,passedSeq)){return false}break;case NODETYPE_INLINE:aAttribute=_dgo(aNode.aAttribute);if(aAttribute==null){hardError("Unknown Attribute ["+aNode.aAttribute+"] on tree ["+this.aName+"]");return}else{if(asDialog){if(aAttribute.aType==TYPE_DIALOG){if(!aAttribute.Load()){return false}this.ExtendTreeDialog(aAttribute);for(c=0;c<aAttribute.aObjectList.length;c++){o=_dgo(aAttribute.aObjectList[c]);if(o){if(!onlyBuild){replayStack.formTreeSet(o)}}}if(!replayStack.formTreeSet(aAttribute)&&(this.flatProps.grouppreviousanswers!="")&&!onlyBuild){this.RenderTreeDialog(aAttribute);return false}}else{if(aAttribute.aType==TYPE_REPORT){this.ExtendTreeDialog(aAttribute);if(!replayStack.formTreeSet(aAttribute)&&(this.flatProps.grouppreviousanswers!="")){if(!onlyBuild){this.RenderTreeDialog(aAttribute)}return false}}else{assignedViaSelRule=false;var calledTree=false;if(((aAttribute.aType==TYPE_LIST)||(aAttribute.aType==TYPE_BOOLEAN)||(aAttribute.aType==TYPE_NUMERIC)||(aAttribute.aType==TYPE_DATE)||(aAttribute.aType==TYPE_TEXT))&&aAttribute.aTree){if(!onlyBuild){aAttribute.Clear()}if(!this.GoTree(aAttribute,aParams,aAttribute.aTree,asDialog,{value:false},onlyBuild,false,false)){return false}calledTree=true}else{assignedViaSelRule=aAttribute.AssignViaSelectionRule(this,asDialog);if(((aAttribute.flatProps==null)||(aAttribute.flatProps.showontreedialog!==false))&&!assignedViaSelRule){this.ExtendTreeDialog(aAttribute)}if(aAttribute.flatProps&&!aAttribute.flatProps.showontreedialog){this.ExtendTreeDialog(aAttribute,true)}}if(!aAttribute.isFull()&&!replayStack.formTreeSet(aAttribute)&&!onlyBuild&&!assignedViaSelRule){aAttribute.FireEvent(EVENT_CAPTURE)}if(!aAttribute.isFull()&&!assignedViaSelRule&&!calledTree){if(!replayStack.formTreeSet(aAttribute)&&(this.flatProps.grouppreviousanswers!="")){if(!onlyBuild){this.RenderTreeDialog(aAttribute)}return false}if(!aAttribute.isFull()&&aAttribute.flatProps&&!aAttribute.flatProps.allowblank){passedIncompleteObj.value=true}}else{if(!onlyBuild){aAttribute.FireEvent(EVENT_LEAVE)}}}}}else{if(aParams&&aParams.exitOnEmpty){if($.isFunction(aAttribute.isFull)&&!aAttribute.isFull()&&!aAttribute.aTree&&!aAttribute.aExamples){if(!onlyBuild){aTree.Clear()}return true}}if($.isFunction(aAttribute.Run)){aAttribute.Run(aAttribute.aType==TYPE_PROCEDURE?undefined:aParams)}if(aParams&&aParams.exitOnEmpty){if($.isFunction(aAttribute.isFull)&&!aAttribute.isFull()){if(!onlyBuild){aTree.Clear()}return true}}}if(!this.GoTree(aTree,aParams,aNode.aSubTree,asDialog,passedIncompleteObj,onlyBuild,moreSequences,passedSeq)){return false}}break;case NODETYPE_PAGE:if(!DoTreeReport(this.aID,aNode.aID,aNode.aFunction)){return false}if(!this.GoTree(aTree,aParams,aNode.aSubTree,asDialog,passedIncompleteObj,onlyBuild,moreSequences,passedSeq)){return false}break;case NODETYPE_LABEL:if(!this.GoTree(aTree,aParams,aNode.aSubTree,asDialog,passedIncompleteObj,onlyBuild,moreSequences,passedSeq)){return false}break;case NODETYPE_PROC:try{var called=false;if(wrapperOptions.nodejs&&!isEditor){if($.isFunction(global[aNode.aFunction])){global[aNode.aFunction].apply(this);called=true}}else{if($.isFunction(window[aNode.aFunction])){window[aNode.aFunction].apply(this);called=true}}if(!called){res=eval("(function(){var cmdObj=_dgo("+aTree.aID+");\n"+aNode.aFunction+"\n})()")}}catch(e){if(!(e instanceof inferenceIssue)){hardError("An error was encountered!\n\nObject: "+this.aName+"\nLocation: Tree Procedure"+(lastErr?"\nLine "+lastErr.ln+"\nCommand: "+lastErr.cmd:"")+"\n\n"+e);return}else{throw e}}if($.isPlainObject(aNode.aSubTree)){if(!this.GoTree(aTree,aParams,aNode.aSubTree,asDialog,passedIncompleteObj,onlyBuild,moreSequences,passedSeq)){return false}break}if(!$.isArray(aNode.aBranches)){hardError("Invalid command node on tree ["+this.aName+"]")}if(typeof res!="number"){hardError("Branching command node does not return a value on tree ["+this.aName+"]")}case NODETYPE_SPLIT:aAttribute=aNode.aType==NODETYPE_PROC?{aType:TYPE_NUMERIC,aName:"Tree Proc"}:_dgo(aNode.aAttribute);if(aAttribute!=null){if(asDialog){var extended=false;assignedViaSelRule=false;if(((aAttribute.aType==TYPE_LIST)||(aAttribute.aType==TYPE_BOOLEAN))&&aAttribute.aTree){aAttribute.Clear();if(!this.GoTree(aAttribute,aParams,aAttribute.aTree,asDialog,{value:false},onlyBuild,false,false)){return false}}else{assignedViaSelRule=aAttribute.AssignViaSelectionRule(this,asDialog);if(((aAttribute.flatProps==null)||(aAttribute.flatProps.showontreedialog!==false))&&!assignedViaSelRule){if(aAttribute.flatProps.showontreedialog===false){aAttribute.flatProps.showontreedialog=true;aAttribute.loadedFlatProps.showontreedialog=true}extended=true;this.ExtendTreeDialog(aAttribute)}}if(!aAttribute.isFull()&&!replayStack.formTreeSet(aAttribute)&&!onlyBuild){aAttribute.FireEvent(EVENT_CAPTURE)}if(!aAttribute.isFull()){if(!replayStack.formTreeSet(aAttribute)){if(onlyBuild){return false}if(!this.RenderTreeDialog(aAttribute)){return false}if((this.flatProps.grouppreviousanswers=="")||!aAttribute.isFull()){return false}if(!extended){this.ExtendTreeDialog(aAttribute)}}else{if(extended&&(aAttribute.flatProps.showontreedialog===false)){alert("remove")}if(onlyBuild){return false}}}if(aAttribute.flatProps&&!aAttribute.flatProps.showontreedialog){this.ExtendTreeDialog(aAttribute,true)}if(!onlyBuild){aAttribute.FireEvent(EVENT_LEAVE)}}else{if(!$.isPlainObject(aNode.aProp)||(aNode.aProp.aName!="isempty")){if(aParams&&aParams.exitOnEmpty){if($.isFunction(aAttribute.isFull)&&!aAttribute.isFull()&&!aAttribute.aTree&&!aAttribute.aExamples){if(!onlyBuild){aTree.Clear()}return true}}if($.isFunction(aAttribute.isFull)&&!aAttribute.isFull()){for(c=0;c<aNode.aBranches.length;c++){if(aNode.aBranches[c].includeNulls){return this.GoTree(aTree,aParams,aNode.aBranches[c].aSubTree,asDialog,passedIncompleteObj,onlyBuild,moreSequences,passedSeq)}}}if($.isFunction(aAttribute.Run)&&!aAttribute.Run(aParams)){return false}if(aParams&&aParams.exitOnEmpty){if($.isFunction(aAttribute.isFull)&&!aAttribute.isFull()){if(!onlyBuild){aTree.Clear()}return true}}}}var attType=aAttribute.aType;if((attType==TYPE_LIST)&&aAttribute.isMultiSel){attType=TYPE_MLIST}var aValue=null;if(aNode.aProp){switch(aNode.aProp.aType){case TREE_PROP_FLAT:aValue=aAttribute.GetFlatProp(aNode.aProp.aName);break;case TREE_PROP_VALUE:var pr=aAttribute.findValueProp(aNode.aProp.aID);aValue=aAttribute.GetProp(aNode.aProp.aID);if(pr){switch(pr.aType){case"int":case"float":case"date":attType=TYPE_NUMERIC;break;case"bool":attType=TYPE_BOOLEAN;break}}break;default:hardError("Unknwon split property type ["+aNode.aProp.aType+"] on tree ["+this.aName+"]");return}if(typeof aValue=="boolean"){aValue=aValue?1:2}}else{aValue=aNode.aType==NODETYPE_PROC?res:aAttribute.GetValue()}if(aValue==null){hardError("Attribute ["+aAttribute.aName+"] has no value for split on tree ["+this.aName+"]");return}var aAttribute2;if((aNode.aBranches.length==2)&&aNode.aBranches[0].aAttribute){var aAttribute2=_dgo(aNode.aBranches[0].aAttribute);if(aAttribute2==null){hardError("Unknown object in object split on tree ["+this.aName+"]");return}if(!aAttribute2.Run()){return false}}var found=false;for(c=0;c<aNode.aBranches.length;c++){aBranch=aNode.aBranches[c];if(aBranch.aAttribute){aAttribute2=_dgo(aBranch.aAttribute);var aValue2;if(aBranch.aProp){switch(aBranch.aProp.aType){case TREE_PROP_FLAT:aValue2=aAttribute2.GetFlatProp(aBranch.aProp.aName);break;case TREE_PROP_VALUE:aValue2=aAttribute2.GetProp(aBranch.aProp.aID);break;default:hardError("Unknwon split property type ["+aBranch.aProp.aType+"] on tree ["+this.aName+"]");return}if(typeof aValue2=="boolean"){aValue2=aValue2?1:2}}else{aValue2=aAttribute2.GetValue()}if(aValue2==null){hardError("Attribute ["+aAttribute2.aName+"] has no value for (object) split on tree ["+this.aName+"]");return}aBranch=$.extend(false,{},aBranch);if((attType==TYPE_LIST)||(attType==TYPE_BOOLEAN)){cc=aAttribute.NameToID(aAttribute2.GetValueAsString());if(cc!==0){aBranch.aValues=[cc]}}else{aBranch.aThreshold=aValue2}}if(attType==TYPE_MLIST){if(c>0){found=true}else{switch(aBranch.aComparitor){case"SUB":for(cc=0;cc<aValue.length;cc++){if(!IsValueInBranch(aBranch,aValue[cc])){break}}found=(cc==aValue.length);break;case"SUP":for(cc=0;cc<aBranch.aValues.length;cc++){if(!aAttribute.IsValueSelected(aBranch.aValues[cc])){break}}found=(cc==aBranch.aValues.length);break;case"INT":for(cc=0;cc<aValue.length;cc++){if(IsValueInBranch(aBranch,aValue[cc])){found=true;break}}break;case"=":if(aValue.length==aBranch.aValues.length){for(cc=0;cc<aValue.length;cc++){if(!IsValueInBranch(aBranch,aValue[cc])){break}}found=(cc==aValue.length)}break;default:hardError("Unknown tree multi-sel list comparitor ["+aNode.aBranches[c].aComparitor+"] for attribute ["+aAttribute.aName+"] on tree ["+this.aName+"]");return}}}else{if((attType==TYPE_LIST)||(attType==TYPE_BOOLEAN)||(attType==TYPE_TEXT)){if(aBranch.hasOwnProperty("allValues")&&aBranch.allValues){found=true}else{found=IsValueInBranch(aBranch,aValue);if(aBranch.aComparitor=="<>"){found=!found}}}else{if((attType==TYPE_NUMERIC)||(attType==TYPE_DATE)){var oldMv;if(aParams&&aParams.isFuzzy){var aOtherBranch=aNode.aBranches[c==0?1:0];if(!aBranch.hasOwnProperty("avg")||!aOtherBranch.hasOwnProperty("avg")){hardError("Missing average value for split ["+aAttribute.aName+"] on fuzzy tree ["+this.aName+"]")}var a;if(!aBranch.hasOwnProperty("avg2")){var a=aBranch.avg;if(a<aBranch.aThreshold){aBranch.avg2=aBranch.aThreshold-((aBranch.aThreshold-a)/2)}else{aBranch.avg2=aBranch.aThreshold+((a-aBranch.aThreshold)/2)}}if(!aOtherBranch.hasOwnProperty("avg2")){var a=aOtherBranch.avg;if(a<aOtherBranch.aThreshold){aOtherBranch.avg2=aOtherBranch.aThreshold-((aOtherBranch.aThreshold-a)/2)}else{aOtherBranch.avg2=aOtherBranch.aThreshold+((a-aOtherBranch.aThreshold)/2)}}var mv;if(aBranch.aComparitor=="<"){if(aValue<aBranch.aThreshold){mv=1-((0.5/(aBranch.aThreshold-aBranch.avg2))*(aValue-aBranch.avg2))}else{mv=0.5-((0.5/(aOtherBranch.avg2-aBranch.aThreshold))*(aValue-aBranch.aThreshold))}}else{if(aValue<aBranch.aThreshold){mv=0+((0.5/(aBranch.aThreshold-aOtherBranch.avg2))*(aValue-aOtherBranch.avg2))}else{mv=0.5+((0.5/(aBranch.avg2-aBranch.aThreshold))*(aValue-aBranch.aThreshold))}}if(mv<0){mv=0}else{if(mv>1){mv=1}}oldMv=aParams.fuzzyMv;if(mv<aParams.fuzzyMv){aParams.fuzzyMv=mv}}else{if(aBranch.hasOwnProperty("allValues")&&aBranch.allValues){found=true}else{if(aBranch.hasOwnProperty("aValues")&&aBranch.aValues){found=(aValue==aBranch.aValues[0])}else{switch(aBranch.aComparitor){case"<":if(aValue<aBranch.aThreshold){found=true}break;case">=":if(aValue>=aBranch.aThreshold){found=true}break;case"<=":if(aValue<=aBranch.aThreshold){found=true}break;case">":if(aValue>aBranch.aThreshold){found=true}break;case"=":if(aValue==aBranch.aThreshold){found=true}break;case"<>":if(aValue!=aBranch.aThreshold){found=true}break;case"RNG":if((aValue>=aBranch.aThreshold)&&(aValue<=(aBranch.hasOwnProperty("aThreshold2")?aBranch.aThreshold2:aBranch.aThreshold))){found=true}break;case"RNG2":if((aValue>aBranch.aThreshold)&&(aValue<=(aBranch.hasOwnProperty("aThreshold2")?aBranch.aThreshold2:aBranch.aThreshold))){found=true}break;case"RNG3":if((aValue>=aBranch.aThreshold)&&(aValue<(aBranch.hasOwnProperty("aThreshold2")?aBranch.aThreshold2:aBranch.aThreshold))){found=true}break;case"RNG4":if((aValue>aBranch.aThreshold)&&(aValue<(aBranch.hasOwnProperty("aThreshold2")?aBranch.aThreshold2:aBranch.aThreshold))){found=true}break;case"NRNG":if((aValue<aBranch.aThreshold)||(aValue>(aBranch.hasOwnProperty("aThreshold2")?aBranch.aThreshold2:aBranch.aThreshold))){found=true}break;case"NRNG2":if((aValue<=aBranch.aThreshold)||(aValue>(aBranch.hasOwnProperty("aThreshold2")?aBranch.aThreshold2:aBranch.aThreshold))){found=true}break;case"NRNG3":if((aValue<aBranch.aThreshold)||(aValue>=(aBranch.hasOwnProperty("aThreshold2")?aBranch.aThreshold2:aBranch.aThreshold))){found=true}break;case"NRNG4":if((aValue<=aBranch.aThreshold)||(aValue>=(aBranch.hasOwnProperty("aThreshold2")?aBranch.aThreshold2:aBranch.aThreshold))){found=true}break;default:hardError("Unknown tree numeric comparitor ["+aBranch.aComparitor+"] for attribute ["+aAttribute.aName+"] on tree ["+this.aName+"]");return}}}}}else{hardError("Unknown tree split type for attribute ["+aAttribute.aName+"] on tree ["+this.aName+"]");return}}}if(found||(aParams&&aParams.isFuzzy)){if(!this.GoTree(aTree,aParams,aBranch.aSubTree,asDialog,passedIncompleteObj,onlyBuild,moreSequences,passedSeq)){return false}if(!aParams||!aParams.isFuzzy){break}else{aParams.fuzzyMv=oldMv}}}if(!found&&(!aParams||!aParams.isFuzzy)){hardError("Uncovered value ["+aValue+"] for attribute ["+aAttribute.aName+"] on tree ["+this.aName+"]");return}}else{hardError("Unknown Attribute ["+aNode.aAttribute+"] on tree ["+this.aName+"]");return}break;case NODETYPE_SEQUENCE:o=$.extend(true,{},passedIncompleteObj);for(c=0;c<aNode.aBranches.length;c++){if(!this.GoTree(aTree,aParams,aNode.aBranches[c].aSubTree,asDialog,o,onlyBuild,moreSequences||(c<aNode.aBranches.length-1),true)){return false}if(aTree.isFull()&&!aTree.isMultiSel&&!onlyBuild){break}}passedIncompleteObj.value=o.value;break;default:hardError("Unknown Node Type ["+aNode.aType+"] on tree ["+this.aName+"]");return}return true};DictionaryObject.prototype.GetTreeDialogCaptureList=function(){var a=this.treeDialog.slice();this.treeDialog=[];this.GoTree(this,null,this.aTree,true,{value:false},true,false,false);var f=[];for(var e=0;e<this.treeDialog.length;e++){if(this.treeDialog[e]!=undefined){if(this.treeDialog[e].aType==TYPE_DIALOG){for(var d=0;d<this.treeDialog[e].aDefinition.instanceatts.length;d++){var b=this.treeDialog[e].aDefinition.instanceatts[d].att;f.push({dlg:this.treeDialog[e],instID:b,cap:[b]})}}else{if($.inArray(this.treeDialog[e].aID,f)==-1){f.push(this.treeDialog[e].aID)}}}}this.treeDialog=a;return f};DictionaryObject.prototype.DoCell=function(aCell,multiValArr,aParams){function isValueInCell(aCell,vID){for(var c=0;c<aCell.values.length;c++){if(aCell.values[c]==vID){return true}}return false}var o,c,cc;switch(aCell.aType){case CASE_ALL:case CASE_DUMMY:case CASE_DESCRIPTION:return true;case CASE_VALUE:o=dictionary.GetObject(aCell.aID);if(!o){return false}if(!o.isFull()){if(aParams.exitOnEmpty){return false}if(!o.Run()){return false}}switch(aCell.aComparitor){case"<":return(o.GetValue()<aCell.value);case"<=":return(o.GetValue()<=aCell.value);case"=":return(o.GetValue()==aCell.value);case"<>":return(o.GetValue()!=aCell.value);case">":return(o.GetValue()>aCell.value);case">=":return(o.GetValue()>=aCell.value);case"RNG":return((o.GetValue()>=aCell.value)&&(o.GetValue()<=aCell.value2));case"RNG2":return((o.GetValue()>aCell.value)&&(o.GetValue()<=aCell.value2));case"RNG3":return((o.GetValue()>=aCell.value)&&(o.GetValue()<aCell.value2));case"RNG4":return((o.GetValue()>aCell.value)&&(o.GetValue()<aCell.value2));default:hardError("Unknown comparitor in cell ["+aCell.aComparitor+"] in cases ["+this.aName+"]");return}case CASE_VALUES:o=_dgo(aCell.aID);if(!o){return false}if(!o.isFull()){if(!o.Run(aParams)){return false}}var vID=o.GetValue();if(o.isMultiSel){var found=false;switch(aCell.aComparitor){case"SUB":case"NSUB":for(cc=0;cc<vID.length;cc++){if(!isValueInCell(aCell,vID[cc])){break}}found=(cc==vID.length);break;case"SUP":case"NSUP":for(cc=0;cc<aCell.values.length;cc++){if(!o.IsValueSelected(aCell.values[cc])){break}}found=(cc==aCell.values.length);break;case"INT":case"NINT":for(cc=0;cc<vID.length;cc++){if(isValueInCell(aCell,vID[cc])){found=true;break}}break;case"=":case"<>":if(vID.length==aCell.values.length){for(cc=0;cc<vID.length;cc++){if(!isValueInCell(aCell,vID[cc])){break}}found=(cc==vID.length)}break}switch(aCell.aComparitor){case"NSUB":case"NSUP":case"NINT":case"<>":found=!found;break}return found}else{for(cc=0;cc<aCell.values.length;cc++){if(vID==aCell.values[cc]){return(aCell.aComparitor=="=")||!aCell.hasOwnProperty("aComparitor")}}return aCell.aComparitor=="<>"}case CASE_ATTCOMP:o=dictionary.GetObject(aCell.aID);if(!o){return false}if(!o.isFull()){if(aParams.exitOnEmpty){return false}if(!o.Run()){return false}}var o2=dictionary.GetObject(aCell.aObjectID);if(!o2){return false}if(!o2.isFull()){if(aParams.exitOnEmpty){return false}if(!o2.Run()){return false}}var v1,v2;if((o.aType==TYPE_LIST)||(o.aType==TYPE_BOOLEAN)){v1=o.GetValueAsString()}else{v1=o.GetValue()}if((o2.aType==TYPE_LIST)||(o2.aType==TYPE_BOOLEAN)){v2=o2.GetValueAsString()}else{v2=o2.GetValue()}switch(aCell.aComparitor){case"<":return(v1<v2);case"<=":return(v1<=v2);case"=":return(v1==v2);case"<>":return(v1!=v2);case">":return(v1>v2);case">=":return(v1>=v2);case"RNG":case"RNG2":case"RNG3":case"RNG4":var o3=dictionary.GetObject(aCell.aObjectID2);if(!o3){return false}if(!o3.isFull()){if(aParams.exitOnEmpty){return false}if(!o3.Run()){return false}}var v3=o3.GetValue();return((v1>=v2)&&(v1<=v3));default:hardError("Unknown comparitor in cell ["+aCell.aComparitor+"] in cases ["+this.aName+"]");return}case CASE_SET_VALUES:if(multiValArr){for(c=0;c<aCell.values.length;c++){multiValArr[multiValArr.length]=aCell.values[c]}}else{if(aCell.values.length==0){this.Clear()}else{if(aCell.values.length==1){this.SetValue(aCell.values[0])}else{if(!this.isMultiSel){hardError("Cannot assign multi-values to outcome in cases ["+this.aName+"]");return}else{this.SetValue(aCell.values)}}}}if(aCell.cmds){eval(aCell.cmds)}break;case CASE_SET_VALUE:this.SetValue(aCell.value);if(aCell.cmds){eval(aCell.cmds)}break;default:hardError("Unknown Cell Type ["+aCell.aType+"] in cases ["+this.aName+"]");return}return true};DictionaryObject.prototype.GoExamples=function(b,d){var g=null;var l=0;var f=0;var j=-1;var e=[];var k;for(var a=0;a<b.cases.length;a++){g=b.cases[a];var h=false;for(k=0;k<g.length;k++){if((g[k].aType==CASE_DESCRIPTION)&&(g[k].disabled)){h=true}}if(h){continue}l=0;for(k=0;k<g.length;k++){if((g[k].aType==CASE_ALL)||(g[k].aType==CASE_DUMMY)){l++}else{if((g[k].aType==CASE_VALUES)||(g[k].aType==CASE_VALUE)||(g[k].aType==CASE_ATTCOMP)){if(!this.DoCell(g[k],undefined,d)){break}}else{if((this.isMultiSel)&&(g[k].aType==CASE_SET_VALUES)){this.DoCell(g[k],e,d)}}}}if((k==g.length)&&(!this.isMultiSel)){if((l<f)||(j==-1)){j=a;f=l}}}if(this.isMultiSel){this.SetValue(e)}else{if(j==-1){if(d.exitOnEmpty){return true}hardError("No matching cases in ["+this.aName+"]");return}g=b.cases[j];for(k=0;k<g.length;k++){if((g[k].aType==CASE_SET_VALUES)||(g[k].aType==CASE_SET_VALUE)){this.DoCell(g[k],undefined,d);break}}}return true};DictionaryObject.prototype.GoLookup=function(b){var l,j,g;var k=this.GetValue();var e=false;for(var a=0;(a<b.cases.length)&&!e;a++){g=b.cases[a];for(l=0;l<g.length;l++){if((g[l].aType==CASE_SET_VALUE)||(g[l].aType==CASE_SET_VALUES)){var f=false;if(g[l].aType==CASE_SET_VALUE){f=(g[l].value==k)}else{for(var h=0;h<g[l].values.length;h++){if(g[l].values[h]==k){f=true;break}}}if(f){e=true;for(j=0;j<g.length;j++){var d=_dgo(g[j].aID);if((g[j].aType==CASE_ALL)||(g[j].aType==CASE_DUMMY)){d.Clear()}else{if(g[j].aType==CASE_VALUES){if(d.isMultiSel){d.SetValue(g[j].values)}else{if(g[j].values.length!=1){hardError("Multiple values found in cell column ["+d.aName+"] row ["+a+"] in lookup table ["+this.aName+"]");return}d.val(g[j].values[0])}}else{if(g[j].aType==CASE_VALUE){d.val(g[j].value)}}}}}break}}}if(!e){hardError("Uncovered value ["+this.val()+"] in lookup table ["+this.aName+"]");return}return true};DictionaryObject.prototype.GoRule=function(e){var k;if(e.aObjectID){var d=dictionary.GetObject(e.aObjectID);if(!d.RunNoDynamicChk()){return false}var g=d.GetValue();var b=null;if(e.att){b=dictionary.GetObject(e.att);if(!b.RunNoDynamicChk()){return false}}var j=false;if((d.aType==TYPE_LIST)||(d.aType==TYPE_BOOLEAN)){if(b){j=(d.GetValueAsString()==b.GetValueAsString())}else{for(k=0;(k<e.values.length)&&!j;k++){if(e.values[k]==g){j=true}}}if((!j&&(e.aComparitor=="="))||(j&&(e.aComparitor=="<>"))){return false}}else{if((d.aType==TYPE_NUMERIC)||(d.aType==TYPE_DATE)||(d.aType==TYPE_TEXT)){var h;if(b){h=b.GetValue()}else{h=e.value}switch(e.aComparitor){case"<":j=(g<h);break;case"<=":j=(g<=h);break;case"=":j=(g==h);break;case"<>":j=(g!=h);break;case">":j=(g>h);break;case">=":j=(g>=h);break;default:hardError("Unknown comparitor in policy rule ["+e.aComparitor+"] in object ["+this.aName+"]");return}if(!j){return false}}}}if(e.operator){if(e.operator=="or"){result=false}else{if(e.operator=="and"){result=true}else{hardError("Unknown sub-clause type in policy rule ["+e.operator+"] in object ["+this.aName+"]");return}}for(k=0;k<e.aRules.length;k++){var f=this.GoRule(e.aRules[k]);if((e.operator=="or")&&f){result=true;break}else{if((e.operator=="and")&&!f){result=false;break}}}if(!result){return false}}return true};DictionaryObject.prototype.GoPolicyRules=function(e){for(var f=0;f<e.atts.length;f++){var d=dictionary.GetObject(e.atts[f]);if(!d){hardError("Unknown object ["+e.atts[f]+"] on policy rule ["+this.aName+"]");return}d.Load();var b=false;if(d.flatProps){b=d.flatProps.isdynamic}if(b){d.promptFor=true}}if(this.GoRule(e)){this.SetValueAsBool(e.dOutcome)}else{this.SetValueAsBool(!e.dOutcome)}return true};DictionaryObject.prototype.FireEvent=function(aEventType,self){if(!self){self=this}var s="";if((this.aType==TYPE_LIST)||(this.aType==TYPE_NUMERIC)||(this.aType==TYPE_DATE)||(this.aType==TYPE_BOOLEAN)||(this.aType==TYPE_TEXT)){switch(aEventType){case EVENT_UPDATE:s="OnUpdate";break;case EVENT_CAPTURE:s="OnCapture";break;case EVENT_LEAVE:s="OnLeave";break;case EVENT_HIERARCHYENTER:s="OnHierarchyEnter";break;case EVENT_HIERARCHYEXIT:s="OnHierarchyExit";break;case EVENT_POSTRULES:s="OnPostRules";break}}if(s.length==0){return false}try{var executed=false;var o;if(this.events&&$.isPlainObject(this.events)&&this.events[s]&&(typeof this.events[s]=="string")&&(this.events[s].length>0)){eval("(function(){"+this.events[s]+"\n})();");executed=true}else{if(this.events&&$.isPlainObject(this.events)&&this.events[s]&&(typeof this.events[s]=="number")&&(this.events[s]!=0)){o=_dgo(this.events[s]);if(o){o.Run(this);executed=true}}else{s="obj"+this.aID+s;if(!wrapperOptions.nodejs){if($.isFunction(window[s])){window[s]();executed=true}}else{var fn;try{fn=eval(s)}catch(e){fn=null}if($.isFunction(fn)){fn();executed=true}}}}if(!executed){o=this.parentObj();if(o){return o.FireEvent(aEventType,self)}}}catch(e){if(!(e instanceof inferenceIssue)){hardError("An error was encountered!\n\nObject: "+this.aName+"\nEvent: "+s+(lastErr?"\nLine "+lastErr.ln+"\nCommand: "+lastErr.cmd:"")+"\n\n"+e);return}else{throw e}}return true};DictionaryObject.prototype.StoreInitialStates=function(){this.treeDialogInitialStates=[];if(this.flatProps&&this.flatProps.instanceatts){for(var b=0;b<this.flatProps.instanceatts.length;b++){var a=dictionary.GetObject(this.flatProps.instanceatts[b].att);if($.isFunction(a.IsEmpty)&&a.IsEmpty()){this.treeDialogInitialStates.push(a.aID)}}}};DictionaryObject.prototype._defuzzify=function(){var a=[];function b(h){if(h.aType==NODETYPE_LEAF){a.push({avg:h.stats.avg,mv:h.fuzzyMv})}if($.isArray(h.aBranches)){for(var g=0;g<h.aBranches.length;g++){b(h.aBranches[g].aSubTree)}}}b(this.aTree);var e=0;var d=0;for(var f=0;f<a.length;f++){e+=a[f].avg*a[f].mv;d+=a[f].mv}return d!=0?e/d:0};DictionaryObject.prototype.RunNoDynamicChk=function(e){if(!this.Load()){return false}var h=false;var k=false;if(e){if(e.hasOwnProperty("fromHierarchy")){k=e.fromHierarchy}if(e.hasOwnProperty("exitOnEmpty")){h=e.exitOnEmpty}}var j=true;if(k){this.FireEvent(EVENT_HIERARCHYENTER);if(!this.isKnowledgeSelectableHierarchy()){j=(this.isSelectedForHierarchy(true)&&(this.aType!=TYPE_BOOLEAN))}}var l=(this.flatProps.selectionmode=="Lookup");if(this.promptFor){this.FireEvent(EVENT_CAPTURE);if(j&&this.promptFor){var f=0;var g=(this.flatProps&&(this.flatProps.selectionmode=="Tree Dialog"));if(!g){if(this.promptFor&&this.flatProps&&this.flatProps.tieddialog&&(this.flatProps.selectionmode!="Decision")){f=this.flatProps.tieddialog}if(!f&&this.promptFor&&this.flatProps&&this.flatProps.tieddialog&&!this.aTree){f=this.flatProps.tieddialog}if(!f&&this.promptFor&&this.tieddialog){f=this.tieddialog}if(!f&&this.promptFor&&(this.aType==TYPE_VARIABLE)&&(appSettings.varTemplate)){f=appSettings.varTemplate}}if(f&&!this.aTree&&!this.aExamples){aObj=_dgo(f);if(!aObj.RunAsTied(this)){return false}}else{var d={exitOnEmpty:h,isFuzzy:$.isPlainObject(this.dmInfo)&&this.dmInfo.settings.isFuzzy};if(d.isFuzzy){d.fuzzyMv=1}if(this.aTree!=null){if(this.hasSequenceNode){this.clear()}if(g){this.assignAttInstancesToDictinary();AppendCapturedAtt(this.aID);var m=capturingAtts;capturingAtts=false;this.Clear();this.StoreInitialStates();if(this.flatProps.grouppreviousanswers==""){replayStack.PopReplay(this.aID,true)}else{if((replayStack.aReplay.length>0)&&(replayStack.replayPos==replayStack.aReplay.length)){if(replayStack.aReplay[replayStack.aReplay.length-1].aOperation!=REPLAY_FORMTREESTART){replayStack.Add(this.aID,REPLAY_FORMTREESTART)}}replayStack.onFormTree=true}this.InitTreeDialog();this.GoTree(this,null,this.aTree,true,{value:false},false,false,false);this.revertAttInstancesToDictinary();if(this.flatProps.grouppreviousanswers!=""){capturingAtts=false;replayStack.formTreeSkip()}replayStack.onFormTree=false;capturingAtts=m}else{if(!this.GoTree(this,d,this.aTree,false,{value:false},false,false,false)){return false}lineOfReasoning.push({atype:LOR_TASK,id:this.aID});if(d.isFuzzy){this.val(this._defuzzify())}this.FireEvent(EVENT_POSTRULES)}}else{if((this.aExamples!=null)&&!l){if(!this.GoExamples(this.aExamples,d)){return false}lineOfReasoning.push({atype:LOR_TASK,id:this.aID});this.FireEvent(EVENT_POSTRULES)}}if(this.aPolicyRules!=null){if(!this.GoPolicyRules(this.aPolicyRules)){return false}lineOfReasoning.push({atype:LOR_TASK,id:this.aID});this.FireEvent(EVENT_POSTRULES)}if(this.promptFor&&!g&&!h){if(f&&(this.aTree||this.aExamples)){aObj=_dgo(f);if(!aObj.RunAsTied(this)){return false}}else{this.hitCount++;switch(this.aType){case TYPE_LIST:case TYPE_NUMERIC:case TYPE_BOOLEAN:case TYPE_DATE:case TYPE_VARIABLE:case TYPE_TEXT:AppendCapturedAtt(this.aID);break}var a=replayStack.PopReplay(this.aID);if(a==REPLAYPOP_HANDLED){}else{if(a==REPLAYPOP_CURRENT){throw new inferenceIssue(PASSBACK_PAUSE,this.aID)}else{if(a==REPLAYPOP_STOP){return false}else{hardError("Unknown replay pop return ["+a+"]");return}}}}}}}this.FireEvent(EVENT_LEAVE)}if(l){if(this.GetValue()==0){hardError("Attempt to run lookup table on ["+this.aName+"] but no current value");return}if(!this.GoLookup(this.aExamples)){return false}}if(k){var b=this.isSelectedForHierarchy(false);if((this.aType==TYPE_BOOLEAN)&&!this.isFull()){this.val(b)}if(!b){return true}if($.isArray(e.hierChildren)){if(!e.hierObj.GoTree(e.hierChildren,e.hierParams)){return false}}this.FireEvent(EVENT_HIERARCHYEXIT)}return true};DictionaryObject.prototype.Run=function(b){if(!this.Load()){return false}var a=this.flatProps?this.flatProps.isdynamic:false;if(a){this.promptFor=true}return this.RunNoDynamicChk(b)};DictionaryObject.prototype.run=function(){return this.Run(arguments)};DictionaryObject.prototype.runBayes=function(){if(!this.bayesian){hardError("No bayesian probabilities for object ["+this.aName+"]");return}var b,h,a,f,d,e,g;for(h=0;h<this.bayesian.atts.length;h++){if(!this.bayesian.atts[h].item){this.bayesian.atts[h].item=dictionary.GetObject(this.bayesian.atts[h].id)}}for(h=0;h<this.aValues.length;h++){this.aValues[h].prob=this.bayesian.outcome.probs[h]}for(a=0;a<this.bayesian.atts.length;a++){b=this.bayesian.atts[a].item;if(!b.IsEmpty()){for(f=0;f<this.aValues.length;f++){d=this.bayesian.atts[a].outs[f];if((b.aType==TYPE_LIST)||(b.aType==TYPE_BOOLEAN)){g=b.GetValue();g=b.ValueIDtoIndex(g);if(d.vals[g].idx!=g+1){hardError("Mismatched index");return}this.aValues[f].prob*=d.vals[g].prob}else{g=b.GetValue();for(vc=0;vc<d.vals.length;vc++){if(d.vals[vc].hasOwnProperty("ge")&&(g<d.vals[vc].ge)){continue}if(d.vals[vc].hasOwnProperty("lt")&&(g>=d.vals[vc].lt)){continue}this.aValues[f].prob*=d.vals[vc].prob;break}}}}}e=0;for(h=0;h<this.aValues.length;h++){e+=this.aValues[h].prob}for(h=0;h<this.aValues.length;h++){this.aValues[h].prob/=e}};DictionaryObject.prototype.prop=function(d,b,a){if(this.aType==TYPE_DIALOG){if(a===undefined){return this.GetDialogControlValue(d,b)}else{return this.SetDialogControlValue(d,b,a)}}if(!this.flatProps){return null}d=d.toLowerCase();if(d=="decplaces"){if(b==undefined){return this.aDecPlaces}else{this.aDecPlaces=b;return}}if(this.flatProps.hasOwnProperty(d)==undefined){return null}if(b==undefined){if($.isPlainObject(this.flatProps[d])){return this.flatProps[d].val}else{return this.flatProps[d]}}if(!this.flatProps.hasOwnProperty(d)){hardError("Object Property ["+this.aName+"."+d+"] does not exist");return null}if($.isPlainObject(this.flatProps[d])){if(typeof this.flatProps[d].val!=typeof b){hardError("Attempt to set property ["+this.aName+"."+d+"] to incorrect type ["+(typeof b)+"]");return null}this.flatProps[d].val=b}else{if(typeof this.flatProps[d]!=typeof b){hardError("Attempt to set property ["+this.aName+"."+d+"] to incorrect type ["+(typeof b)+"]");return null}this.flatProps[d]=b}return this};DictionaryObject.prototype.parentObj=function(){if(this.flatProps&&this.flatProps.hasOwnProperty("pid")){return _dgo(this.flatProps.pid)}else{return null}};DictionaryObject.prototype.value=function(a){if(!$.isArray(this.aValues)){return null}if(a==undefined){return this.aValues}if((a<1)||(a>this.aValues.length)){hardError("Instance index out of bounds. "+this.aName+"["+a+"]");return}return this.aValues[a-1]};DictionaryObject.prototype.inst=function(e,b,d){if(!this.aValueProps){return null}if(!b){var a=this.GetValue();if(!a){hardError("Object ["+this.aName+"] does not have a value");return}if($.isArray(a)){hardError("Object ["+this.aName+"] is a multi-select");return}b=this.ValueIDtoIndex(a)}else{b--}if((b<0)||(b>=this.aValues.length)){hardError("Instance index out of bounds. "+this.aName+"."+e+"["+(b+1)+"]");return}e=e.toLowerCase();switch(e){case"selected":case"valid":case"visible":break;default:var f;for(f=0;f<this.aValueProps.list.length;f++){if(this.aValueProps.list[f].aName.toLowerCase()==e){break}}if(f>=this.aValueProps.list.length){hardError("Unknown instance property ["+this.aName+"."+e+"]");return}e=this.aValueProps.list[f].aName}if(d==undefined){return this.aValues[b][e]}if(typeof this.aValues[b][e]!=typeof d){hardError("Attempt to set instance property ["+e+"] of type ["+typeof this.aValues[b][e]+"] to incorrect type ["+(typeof d)+"]");return}this.aValues[b][e]=d;return this};DictionaryObject.prototype.instProp=function(b){var a=this.instProps();if(!a){return null}if(typeof b=="string"){for(var d=0;d<a.length;d++){if(a[d].realName==b){b=d;break}}if(d==a.length){b=-1}}else{b--}if((b<0)||(b>=a.length)){return}return a[b]};DictionaryObject.prototype.instProps=function(){if(!this.aValueProps){return null}return this.aValueProps.list};DictionaryObject.prototype.isSelectedForHierarchy=function(a){if(!this.flatProps){return true}if(!this.flatProps.hasOwnProperty("isselected")){return true}if(this.flatProps.isselected=="Knowledge"){if(this.isEmpty()){return a}if(this.aType==TYPE_BOOLEAN){return this.val()}else{if((this.aType==TYPE_LIST)&&(this.isMultiSel)){return this.val().length>0}}return true}return this.flatProps.isselected=="Yes"};DictionaryObject.prototype.isKnowledgeSelectableHierarchy=function(){if(!this.flatProps){return false}if(!this.flatProps.hasOwnProperty("isselected")){return false}return this.flatProps.isselected=="Knowledge"};DictionaryObject.prototype.GetValuesForHelper=function(){if((this.aType!=TYPE_LIST)&&(this.aType!=TYPE_BOOLEAN)){return null}if(!this.Load(this)){return null}var a=[];for(var b=0;b<this.aValues.length;b++){a[a.length]={id:this.aValues[b].aID,text:this.aValues[b].aName}}return a};DictionaryObject.prototype.TreeDialogAsXML=function(){var b=[];for(var d=0;d<this.treeDialog.length;d++){if(this.treeDialog[d]){b.push(this.treeDialog[d].aID)}}return Cmd_EncodeData(b,true,"",true)};DictionaryObject.prototype.GetBaseClassName=function(){this.Load();var a=this.parentObj();if(a){return a.aName}else{return""}};DictionaryObject.prototype.patchLookupTable=function(){if((this.aType==TYPE_LIST)||(this.aType==TYPE_NUMERIC)||(this.aType==TYPE_DATE)||(this.aType==TYPE_BOOLEAN)||(this.aType==TYPE_TEXT)){if(this.flatProps.selectionmode=="Lookup"){var h,g,f,d,a,e,b;if((this.aType==TYPE_LIST)||(this.aType==TYPE_BOOLEAN)){for(h=0;h<this.aValues.length;h++){a=this.IndextoValueID(h);d=false;for(g=0;(g<this.aExamples.cases.length)&&!d;g++){e=this.aExamples.cases[g];for(f=0;f<e.length;f++){if(e[f].aType==CASE_SET_VALUES){if($.inArray(a,e[f].values)>=0){d=true;break}}}}if(!d){b=[];for(g=0;g<this.aExamples.atts.length;g++){b.push({aID:$.isPlainObject(this.aExamples.atts[g])?this.aExamples.atts[g].id:this.aExamples.atts[g],aType:CASE_ALL})}b.push({aID:this.aID,aType:CASE_SET_VALUES,values:[a]});this.aExamples.cases.push(b)}}for(h=this.aExamples.cases.length-1;h>=0;h--){e=this.aExamples.cases[h];for(g=0;g<e.length;g++){if(e[g].aType==CASE_SET_VALUES){for(f=e[g].values.length-1;f>=0;f--){if(this.ValueIDtoIndex(e[g].values[f])==-1){e[g].values.splice(f,1)}}if(e[g].values.length==0){this.aExamples.cases.splice(h,1)}}}}}else{b=[];for(g=0;g<this.aExamples.atts.length;g++){b.push({aID:$.isPlainObject(this.aExamples.atts[g])?this.aExamples.atts[g].id:this.aExamples.atts[g],aType:CASE_ALL})}b.push({aID:this.aID,aType:CASE_SET_VALUES,values:[a]});this.aExamples.cases.push(b)}}}};DictionaryObject.prototype.getLeafInfo=function(m){var n=this;var a={attributes:[]};var j=this.dmInfo;function e(p){var f=[];for(var r=0;r<j.fields.length;r++){if(j.fields[r].name==p){if(j.fields[r].type=="text"){for(var q=0;q<j.fields[r].values.length;q++){if(!j.fields[r].values[q].otherwise){f.push(j.fields[r].values[q].name)}}}break}}return f}function b(p,f){if(p.aID==f){return true}switch(p.aType){case NODETYPE_INLINE:case NODETYPE_LABEL:return b(p.aSubTree,f);case NODETYPE_PROC:if($.isPlainObject(p.aSubTree)){return b(p.aSubTree,f)}if(!$.isArray(p.aBranches)){return false}case NODETYPE_SPLIT:case NODETYPE_SEQUENCE:for(var q=0;q<p.aBranches.length;q++){if(b(p.aBranches[q].aSubTree,f)){return true}}}return false}function h(f){if(j){for(var q=0;q<j.fields.length;q++){if(j.fields[q].name==f){if(j.fields[q].type=="text"){for(var p=0;p<j.fields[q].values.length;p++){if(j.fields[q].values[p].otherwise){return j.fields[q].values[p].name}}}break}}return"otherwise"}else{return null}}function o(q){if(q.aID==m){return q}if(q.aType==NODETYPE_SPLIT){for(var y=0;y<q.aBranches.length;y++){if(b(q.aBranches[y].aSubTree,m)){var C=q.aBranches[y];var p=_dgo(q.aAttribute);var r,w,A,D,u,z,t;for(r=0;r<a.attributes.length;r++){if(a.attributes[r].name==p.aName){break}}A=r<a.attributes.length;if(A){w=a.attributes[r]}else{w={name:p.aName}}if(j){for(r=0;r<j.fields.length;r++){if(j.fields[r].name==p.aName){D=j.fields[r];if(p.aType!=TYPE_LIST){if((D.hasOwnProperty("manual_min")&&(D.manual_min>D.min))||(D.hasOwnProperty("manual_max")&&(D.manual_max<D.max))){z=true}u=D.avg}break}}}switch(p.aType){case TYPE_LIST:w.type="text";var x=h(p.aName);w.values=[];for(r=0;r<C.aValues.length;r++){var B=p.IDtoName(C.aValues[r]);if(B==x){B=e(p.aName)}w.values.push(B)}break;case TYPE_NUMERIC:w.type="num";if(z){t=false;switch(C.aComparitor){case">=":t=(C.aThreshold<=u);break;case"<":t=(C.aThreshold>u);break}if(!w.hasOwnProperty("outliers")||w.outliers){w.outliers=t}}switch(C.aComparitor){case">=":w.ge=C.aThreshold;if(D.hasOwnProperty("manual_max")&&!w.hasOwnProperty("lt")){w.lt=D.manual_max}break;case"<":w.lt=C.aThreshold;if(D.hasOwnProperty("manual_min")&&!w.hasOwnProperty("ge")){w.ge=D.manual_min}break}if(C.includeNulls){w.include_nulls=true}break;case TYPE_DATE:w.type="datetime";switch(C.aComparitor){case">=":w.ge=Math.floor(C.aThreshold*86400);break;case"<":w.lt=Math.floor(C.aThreshold*86400);break}break}if(!A){a.attributes.push(w)}return o(C.aSubTree)}}}return null}var k=o(this.aTree);if(k){a.tree=this.aName;switch(this.aType){case TYPE_LIST:case TYPE_BOOLEAN:a.type="text";break;case TYPE_NUMERIC:a.type="num";break;case TYPE_DATE:a.type="date";break}var g;if(k.hasOwnProperty("stats")){a.stats=k.stats;if($.isArray(k.stats.values)){var l=k.stats.values;a.stats.values=[];for(g=0;g<l.length;g++){a.stats.values.push({name:this.IDtoName(l[g].aID),frequency:l[g].freq})}}}else{if(k.aOutcome!=EMPTY_LEAF){if(this.isMultiSel){a.value=[];if($.isArray(k.aOutcome)){for(g=0;g<k.aOutcome.length;g++){a.value.push(this.IDtoName(k.aOutcome[g]))}}else{a.value.push(this.IDtoName(aNode.aOutcome))}}else{if(this.aType==TYPE_LIST){a.value=this.IDtoName(k.aOutcome)}else{a.value=k.aOutcome}}}}for(g=0;g<a.attributes.length;g++){switch(a.attributes[g].type){case"text":break;case"num":case"datetime":var d={};if(a.attributes[g].hasOwnProperty("ge")){d.ge=a.attributes[g].ge;delete a.attributes[g].ge}if(a.attributes[g].hasOwnProperty("lt")){d.lt=a.attributes[g].lt;delete a.attributes[g].lt}if(a.attributes[g].hasOwnProperty("include_nulls")){d.include_nulls=a.attributes[g].include_nulls;delete a.attributes[g].include_nulls}a.attributes[g].values=[d];if(a.attributes[g].outliers){}if(a.attributes[g].outliers){for(cc=0;cc<j.fields.length;cc++){if(j.fields[cc].name==a.attributes[g].name){if(j.fields[cc].hasOwnProperty("manual_min")){d={lt:j.fields[cc].manual_min};a.attributes[g].values.push(d)}if(j.fields[cc].hasOwnProperty("manual_max")){d={ge:j.fields[cc].manual_max};a.attributes[g].values.push(d)}break}}}if(a.attributes[g].hasOwnProperty("outliers")){delete a.attributes[g].outliers}break}}a.path=[];for(g=0;g<a.attributes.length;g++){}if(this.flatProps.hasOwnProperty("previousvalue")){a.actual=this.flatProps.previousvalue}a.path=a.attributes;delete a.attributes}return a};function DictionaryObject_List(d,e,b,a){DictionaryObject_List.baseConstructor.call(this,d,e,TYPE_LIST,b);this.aValues=null;this.aValueProps=null;this.nValues=0;this.currentValueID=0;this.isMultiSel=a;this.loadedValues=null;this.dmInfo=null;this._hintprops.push("build(seperator, finalSeperator)")}ObjectExtend(DictionaryObject_List,DictionaryObject);DictionaryObject_List.prototype.Reset=function(){if(this.loadedValues){this.aValues=$.extend(true,[],this.loadedValues);this.nValues=this.aValues.length}DictionaryObject_List.superClass.Reset.call(this)};DictionaryObject_List.prototype.Clear=function(a){var b;if(this.aValues){for(b=0;b<this.aValues.length;b++){this.aValues[b].visible=true;this.aValues[b].valid=true;if(this.isMultiSel){this.aValues[b].selected=false}}}if(!this.isMultiSel){this.currentValueID=0}DictionaryObject_List.superClass.Clear.call(this);if(this.flatProps&&a){if(this.flatProps.defaultmode=="SetDefault"){this.SetValueAsString(this.flatProps._default)}}};DictionaryObject_List.prototype.Populate=function(e,d,j){var h,g,a;for(h=0;h<j.props.list.length;h++){j.props.list[h].aName=Handle2(j.props.list[h].aName);j.props.list[h].realName=Handle2(j.props.list[h].realName)}this.aValues=j.values;this.aValueProps=j.props;for(h=0;h<this.aValues.length;h++){a=this.aValues[h];a.idx=h;a.id=this.aValues[h].aID;a.selected=false;a.valid=true;for(var f in a){if(f.substr(0,1)=="~"){var b=Handle2(f);a[b]=a[f];delete a[f];if(typeof a[b]=="string"){a[b]=Handle2(a[b])}}}a.aText=this.GetValueDescr(h);a.evalid=VALID_UNKNOWN;a.visible=true}this.nValues=this.aValues.length;this.loadedValues=this.aValues.slice();DictionaryObject_List.superClass.Populate.call(this,e,d)};DictionaryObject_List.prototype.toObject=function(){var a=DictionaryObject_List.superClass.toObject.call(this);a.isMultiSel=this.isMultiSel;if(this.dmInfo){a.dmInfo=this.dmInfo}return a};DictionaryObject_List.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID,true);return false}return true};DictionaryObject_List.prototype.toString=function(){var a=DictionaryObject_List.superClass.toString.call(this);for(var b=0;b<this.aValues.length;b++){a+="\nid :"+this.aValues[b].aID+" , name :"+this.aValues[b].aName+" , text :"+this.aValues[b].aText}return a};DictionaryObject_List.prototype.GetValue=function(){if(!this.Load(this)){return null}if(this.isMultiSel){var b=[];for(var e=0;e<this.aValues.length;e++){if(this.aValues[e].selected){b.push(this.aValues[e].aID)}}if((b.length===0)&&(this.flatProps.defaultmode=="UseDefault")){var d=this.NameToID(this.flatProps._default);if(d!=0){b[b.length]=d}}return b}else{if(this.currentValueID===0){if(this.flatProps.defaultmode=="UseDefault"){return this.NameToID(this.flatProps._default)}return 0}}return this.currentValueID};DictionaryObject_List.prototype.GetValueProp=function(d,b){if(!this.Load(this)){return null}if(this.aValueProps==null){return null}if(b===undefined){b=-1}var a=null;if(this.isMultiSel&&$.isArray(b)){if(b.length>0){a=b}}else{if(b!=-1){a=this.aValues[b-1].aID}}if(a==null){a=this.GetValue()}if(this.isMultiSel&&$.isArray(a)){if(a.length===0){return null}}else{if((a==null)||(a==0)){return null}}var f=(typeof d=="string"?d.toLowerCase()=="value":false);var g;for(g=0;g<this.aValueProps.list.length;g++){if((this.aValueProps.list[g].aName==d)||(this.aValueProps.list[g].aID==d)||(f&&this.aValueProps.list[g].aID==-2)){break}}if(g<this.aValueProps.list.length){if(a instanceof Array){var e="";for(cc=0;cc<a.length;cc++){if(e.length>0){e+=", "}e+=this.IDtoName(a[cc],this.aValueProps.list[g].aName)}return e}return this.IDtoName(a,this.aValueProps.list[g].aName)}return null};DictionaryObject_List.prototype.GetValueAsString=function(e,b){var a=this.GetValue();if(this.isMultiSel){var d,f;if(e===true){d=[];for(f=0;f<this.aValues.length;f++){if(this.aValues[f].selected){d[d.length]=this.IDtoName(this.aValues[f].aID,b)}}}else{d="";for(f=0;f<a.length;f++){if(f>0){if(typeof e=="string"){d+=e}else{d+=", "}}d+=this.IDtoName(a[f],b)}}return d}else{if(a==0){return""}}return this.IDtoName(a,b)};DictionaryObject_List.prototype.SetValue=function(b){if(b==PSEUDO_VALUE_EMPTY){this.Clear()}else{if(this.isMultiSel){if(!$.isArray(b)){b=[b]}var e;for(e=0;e<b.length;e++){if(typeof b[e]=="string"){b[e]=this.NameToID(b[e])}}for(var d=0;d<this.aValues.length;d++){var a=false;for(e=0;(e<b.length)&&!a;e++){a=b[e]==this.aValues[d].aID}this.aValues[d].selected=a}}else{if(typeof b=="string"){return this.SetValueAsString(b)}else{this.currentValueID=b}}DictionaryObject_List.superClass.SetValue.call(this)}};DictionaryObject_List.prototype.SetMultiValue=function(d,b){if(!this.isMultiSel){return}for(var e=0;e<this.aValues.length;e++){var a;if($.isArray(d)){a=$.inArray(this.aValues[e].aID,d)>=0}else{a=this.aValues[e].aID==d}if(a){if(b==SETOP_ADD){this.aValues[e].selected=true}else{if(b==SETOP_DEL){this.aValues[e].selected=false}}}}DictionaryObject_List.superClass.SetValue.call(this)};DictionaryObject_List.prototype.SetValueAsString=function(a,e,f){if(!a||(a==PSEUDO_VALUE_EMPTY)){this.Clear()}else{var g="Unknown instance value ["+a+"] for object ["+this.aName+"]";var b;if(this.isMultiSel){if($.isArray(a)){b=a.slice(0)}else{if(typeof e!="string"){e=","}b=a.split(e)}for(var h=0;h<b.length;h++){var d=this.NameToID($.trim(b[h]));if(d==0){if(f){softError(g);return false}hardError(g);return}b[h]=d}}else{b=this.NameToID(a);if(b==0){if(f){softError(g);return false}hardError(g);return}}this.SetValue(b);DictionaryObject_List.superClass.SetValueAsString.call(this)}return true};DictionaryObject_List.prototype.ShowValue=function(a){if(a==0){for(var b=0;b<this.aValues.length;b++){this.aValues[b].visible=true}}else{this.aValues[this.ValueIDtoIndex(a)].visible=true}};DictionaryObject_List.prototype.HideValue=function(a){if(a==0){for(var b=0;b<this.aValues.length;b++){this.aValues[b].visible=false}}else{this.aValues[this.ValueIDtoIndex(a)].visible=false}};DictionaryObject_List.prototype.IDtoText=function(a){return this.GetValueDescr(this.ValueIDtoIndex(a))};DictionaryObject_List.prototype.IDtoName=function(b,a){this.Load(this);var d=this.ValueIDtoIndex(b);if(d==-1){return""}if(a===true){return this.GetValueDescr(d)}else{if(a){return this.aValues[d][a]}}return this.aValues[d].aName};DictionaryObject_List.prototype.NameToID=function(d,a){if(this.Load(this)){if(a){d=d.toLowerCase()}for(var b=0;b<this.aValues.length;b++){if((a&&(this.aValues[b].aName.toLowerCase()==d))||(this.aValues[b].aName==d)){return this.aValues[b].aID}}}return 0};DictionaryObject_List.prototype.ValueIDtoIndex=function(a){if(this.Load(this)){for(var b=0;b<this.aValues.length;b++){if(this.aValues[b].aID==a){return b}}}return -1};DictionaryObject_List.prototype.IndextoValueID=function(a){if(this.Load(this)){if((a>=0)&&(a<this.aValues.length)){return this.aValues[a].aID}}return -1};DictionaryObject_List.prototype.GetNvalues=function(){if(this.Load(this)){return this.aValues.length}return 0};DictionaryObject_List.prototype.GetValueDescr=function(b){if(!this.aValueProps){return""}if((b<0)||(b>=this.aValues.length)){softError("GetValueDescr index out of bounds "+this.aName+" ["+b+"]");return""}var a="";var d=this.aValueProps.general.descriptionprop;if(d&&this.aValues[b].hasOwnProperty(d)){a=this.aValues[b][d]}if(a===""){a=this.aValues[b].aName}return a};DictionaryObject_List.prototype.SetValueProp=function(b,a,d){if(!this.Load(this)){return false}if(this.aValueProps==null){return false}if(a==-1){a=this.GetValue()}if(this.isMultiSel){if(a.length===0){return false}}else{if(a==0){return false}}for(var f=0;f<this.aValueProps.list.length;f++){if((this.aValueProps.list[f].aName==b)||(this.aValueProps.list[f].aID==b)){break}}if(f<this.aValueProps.list.length){for(var e=0;e<this.aValues.length;e++){if(this.aValues[e].aID==a){this.aValues[e][this.aValueProps.list[f].aName]=d;return true}}}return false};DictionaryObject_List.prototype.SetValuePropIndex=function(a,b,d){if(!this.Load(this)){return false}b--;if(this.aValueProps==null){return false}if(b<0){b=this.ValueIDtoIndex(this.GetValue())}if(this.isMultiSel){if(b.length==0){return false}}else{if(b<0||b>=this.aValues.length){return false}}for(var e=0;e<this.aValueProps.list.length;e++){if((this.aValueProps.list[e].aID==a)||(this.aValueProps.list[e].aName==a)){break}}if(e<this.aValueProps.list.length){if(typeof(this.aValues[b][this.aValueProps.list[e].aName])=="boolean"){if(typeof(d)=="string"){this.aValues[b][this.aValueProps.list[e].aName]=(d.toUpperCase()=="TRUE")}else{this.aValues[b][this.aValueProps.list[e].aName]=(d==1)}}else{this.aValues[b][this.aValueProps.list[e].aName]=d;this.aValues[b].aText=this.GetValueDescr(b)}return true}return false};DictionaryObject_List.prototype.IsValueSelected=function(a){var b=this.GetValue();if(this.isMultiSel){if(typeof a!="number"){a=this.NameToID(a)}for(var d=0;d<b.length;d++){if(b[d]==a){return true}}return false}return b==a};DictionaryObject_List.prototype.IsValueIndexSelected=function(a){if(!this.Load(this)){return false}if((a>=0)&&(a<this.aValues.length)){if(!this.isMultiSel){return this.aValues[a].aID==this.GetValue()}return this.aValues[a].selected}return false};DictionaryObject_List.prototype.IsValueValid=function(a){return this.IsValueIndexValid(this.ValueIDtoIndex(a))};DictionaryObject_List.prototype.IsValueIndexValid=function(a){if(!this.Load(this)){return false}if((a>=0)&&(a<this.aValues.length)){return this.aValues[a].valid}return true};DictionaryObject_List.prototype.IsValueHidden=function(a){return this.IsValueIndexHidden(this.ValueIDtoIndex(a))};DictionaryObject_List.prototype.IsValueIndexHidden=function(a){if(this.flatProps.hasOwnProperty("hiddenvaluesprop")&&(this.flatProps.hiddenvaluesprop!="")&&(a>=0)&&(a<this.aValues.length)){return this.aValues[a][this.flatProps.hiddenvaluesprop]===true}return false};DictionaryObject_List.prototype.UnknownInvalids=function(){var a;for(a=0;a<this.aValues.length;a++){this.aValues[a].evalid=VALID_UNKNOWN}};DictionaryObject_List.prototype.ResolveInvalids=function(){for(var a=0;a<this.aValues.length;a++){this.aValues[a].valid=this.aValues[a].evalid!=VALID_FALSE}};DictionaryObject_List.prototype.GetValueValidity=function(a){return this.aValues[a].evalid};DictionaryObject_List.prototype.SetValueValidity=function(a,b){this.aValues[a].evalid=b};DictionaryObject_List.prototype.GetOldValueValidity=function(a){return this.aValues[a].ovalid};DictionaryObject_List.prototype.SaveValidity=function(){for(var a=0;a<this.aValues.length;a++){this.aValues[a].ovalid=this.aValues[a].evalid}};DictionaryObject_List.prototype.ClearInvalid=function(){for(var a=0;a<this.aValues.length;a++){this.aValues[a].valid=true}};DictionaryObject_List.prototype.Exclude=function(d){if(this.Load(this)){if(d==""){this.ClearInvalid()}else{var a=d.split(",");for(var b=0;b<a.length;b++){for(var e=0;e<this.aValues.length;e++){if(this.aValues[e].aName==a[b]){this.aValues[e].valid=false;break}}}}}};DictionaryObject_List.prototype.GetAllValidValues=function(){if(this.Load(this)){var b=[];for(var d=0;d<this.aValues.length;d++){if(this.aValues[d].valid){b[b.length]=this.aValues[d].aName}}return b}return null};DictionaryObject_List.prototype.GetAllInValidValues=function(){if(this.Load(this)){var b=[];for(var d=0;d<this.aValues.length;d++){if(!this.aValues[d].valid){b[b.length]=this.aValues[d].aID}}return(b)}return(null)};DictionaryObject_List.prototype.SetValueInValid=function(a){if(this.Load(this)){if(a){for(var d=0;d<a.length;d++){for(var b=0;b<this.aValues.length;b++){if(this.aValues[b].aID==a[d]){this.aValues[b].valid=false;break}}}}}};DictionaryObject_List.prototype.GetNvalid=function(){var a=0;if(this.Load(this)){for(var b=0;b<this.aValues.length;b++){if(this.aValues[b].valid){a++}}}return a};DictionaryObject_List.prototype.GetNselected=function(){var a=0;if(this.Load(this)){if(this.isMultiSel){for(var b=0;b<this.aValues.length;b++){if(this.aValues[b].selected){a++}}}else{if(this.currentValueID!==0){a++}}}return a};DictionaryObject_List.prototype.GetSelectedIndex=function(){var a;if(this.isMultiSel){for(a=0;a<this.aValues.length;a++){if(this.aValues[a].selected&&this.aValues[a].valid){return a+1}}}else{for(a=0;a<this.aValues.length;a++){if(this.aValues[a].aID==this.currentValueID){return a+1}}}return 0};DictionaryObject_List.prototype.AddInstance=function(k,g){this.Load(this);var h;if(this.NameToID(k)!=0){softError("AddInstance: Duplicate value name ["+k+"]");return}var f=0;var n;do{f++;n=(this.ValueIDtoIndex(f)!=-1)}while(n);var m={aID:f,id:f,aName:k,selected:false,valid:true,visible:true};for(h=0;h<this.aValueProps.list.length;h++){if(this.aValueProps.list[h].aID>0){switch(this.aValueProps.list[h].aType){case"str":m[this.aValueProps.list[h].aName]="";break;case"int":m[this.aValueProps.list[h].aName]=0;break;case"float":m[this.aValueProps.list[h].aName]=0;break;case"bool":m[this.aValueProps.list[h].aName]=false;break;case"date":m[this.aValueProps.list[h].aName]=0;break;case"enum":m[this.aValueProps.list[h].aName]="(none)";break}}}if($.isPlainObject(g)){for(var a in g){var d=g[a];if((a!="_name")&&(d!==null)){var l=a.toLowerCase();for(h=0;h<this.aValueProps.list.length;h++){if(this.aValueProps.list[h].aName.toLowerCase()==l){break}}if(h>=this.aValueProps.list.length){softError("addInstance: Unknown instance property ["+a+"] for object ["+this.aName+"]")}else{var j=true;switch(this.aValueProps.list[h].aType){case"enum":if(d!="(none)"){for(var e=0;e<this.aValueProps.list[h].enums.length;e++){if(this.aValueProps.list[h].enums[e].name==d){break}}if(e>=this.aValueProps.list[h].enums.length){softError("addInstance: Unknown list instance property value ["+d+"] for object ["+this.aName+"."+a+"]");j=false}}break;case"str":if(typeof d!="string"){d=""+d}break;case"int":if(typeof d!="number"){d=parseInt(d,10)}break;case"float":if(typeof d!="number"){d=parseFloat(d)}break;case"bool":if(typeof d=="string"){if(d.toLowerCase()=="true"){d=true}else{if(d.toLowerCase()=="false"){d=false}else{softError("addInstance: Invalid boolean instance property value (string) ["+d+"] for object ["+this.aName+"."+a+"]");j=false}}}else{if(typeof d!="boolean"){softError("addInstance: Invalid boolean instance property value ["+d+"] for object ["+this.aName+"."+a+"]");j=false}}break;case"date":if(typeof d!="string"){softError("addInstance: Invalid date instance property value ["+d+"] for object ["+this.aName+"."+a+"]. Should be YYYYMMDD string");j=false}else{var b=decodeDateFromYYYYMMDDstring(d,false);if(b===null){softError("addInstance: Invalid date instance property value ["+d+"] for object ["+this.aName+"."+a+"]. Should be YYYYMMDD string");j=false}else{d=b.getTime()/86400000}}break}if(j){m[this.aValueProps.list[h].aName]=d}}}}}this.aValues.push(m);this.nValues=this.aValues.length;this.aValues[this.nValues-1].aText=this.GetValueDescr(this.nValues-1);replayProtection.set(this,true);return this.nValues};DictionaryObject_List.prototype.DelInstance=function(a){if(this.Load(this)){var b=this.aValues[a-1].aID;this.aValues.splice(a-1,1);this.nValues=this.aValues.length;if(this.currentValueID==b){this.Clear()}replayProtection.set(this,true)}};DictionaryObject_List.prototype.ClearInstances=function(){if(this.Load(this)){this.aValues=[];this.nValues=this.aValues.length;this.Clear();replayProtection.set(this,true)}};DictionaryObject_List.prototype.addInstance=function(b,a){return this.AddInstance(b,a)};DictionaryObject_List.prototype.addInstances=function(a){if(!$.isArray(a)){throw"Array expected"}for(var b=0;b<a.length;b++){if(!a[b].hasOwnProperty("_name")){softError("addInstances: Value name property [_name] missing for instance ["+b+"] on object ["+this.aName+"]")}else{this.AddInstance(a[b]._name,a[b])}}};DictionaryObject_List.prototype.delInstance=function(a){this.DelInstance(a)};DictionaryObject_List.prototype.clearInstances=function(){this.ClearInstances()};DictionaryObject_List.prototype.encodeInstances=function(){var b=[];var h,g,f,a,e;for(h=0;h<this.aValues.length;h++){a=this.aValues[h];f={_name:a.aName};for(g=0;g<this.aValueProps.list.length;g++){if(this.aValueProps.list[g].aID>0){switch(this.aValueProps.list[g].aType){case"date":e=new Date(a[this.aValueProps.list[g].aName]*86400000);f[this.aValueProps.list[g].aName]=strftime("yyyymmdd",e.getDate(),e.getMonth(),e.getFullYear());break;default:f[this.aValueProps.list[g].aName]=a[this.aValueProps.list[g].aName]}}}b.push(f)}return b};DictionaryObject_List.prototype.build=function(d,f){if(!this.isMultiSel){return this.val()}if(d==undefined){d=", "}if(f==undefined){f=d}var b=[];var g;for(g=0;g<this.aValues.length;g++){if(this.aValues[g].selected){b.push(this.aValues[g].aID)}}var e="";for(g=0;g<b.length;g++){e+=(g>0?g<b.length-1?d:f:"")+this.IDtoName(b[g],false)}return e};DictionaryObject_List.prototype.val=function(b,a){if(b===undefined){return this.GetValueAsString(true,false)}else{if(typeof b=="number"||$.isArray(b)){this.SetValue(b);return this}else{this.SetValueAsString(b,undefined,a);return this}}};function DictionaryObject_Num(d,e,b,a){DictionaryObject_Num.baseConstructor.call(this,d,e,TYPE_NUMERIC,b);this.aDecPlaces=a;this.currentValue=0;this.valid=true;this.evalid=null;this.ovalid=null;this.dmInfo=null;this._hintprops=["aType","aName","aDecPlaces","val([newValue])","clear();","run();","isEmpty()","props","prop(controlPropName[, newValue])"]}ObjectExtend(DictionaryObject_Num,DictionaryObject);DictionaryObject_Num.prototype.Reset=function(){DictionaryObject_Num.superClass.Reset.call(this)};DictionaryObject_Num.prototype.Clear=function(a){this.currentValue=0;this.valid=true;DictionaryObject_Num.superClass.Clear.call(this);if(this.flatProps&&a){if(this.flatProps.defaultmode=="SetDefault"){this.SetValue(this.flatProps._default)}}};DictionaryObject_Num.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID,true);return false}else{return true}};DictionaryObject_Num.prototype.Populate=function(b,a){DictionaryObject_Num.superClass.Populate.call(this,b,a)};DictionaryObject_Num.prototype.toObject=function(){var a=DictionaryObject_Num.superClass.toObject.call(this);a.aDecPlaces=this.aDecPlaces;if(this.dmInfo){a.dmInfo=this.dmInfo}return a};DictionaryObject_Num.prototype.toString=function(){return DictionaryObject_Num.superClass.toString.call(this)+"\nDec Places: "+this.aDecPlaces};DictionaryObject_Num.prototype.GetValue=function(){if(!this.Load(this)){return null}if(!this.isDataFull){if(this.flatProps.defaultmode=="UseDefault"){return this.flatProps._default}return null}return this.currentValue};DictionaryObject_Num.prototype.SetValue=function(a){if((a==PSEUDO_VALUE_EMPTY)||(a===null)){this.Clear()}else{if(typeof a=="string"){if(a.length==0){this.Clear()}else{if(isNaN(a)){hardError("Trying to assign a non-numeric value ["+a+"] to a numeric object ["+this.aName+"]")}else{var b=parseFloat(a);if(isNaN(b)){hardError("Trying to assign a non-numeric value ["+a+"] to a numeric object ["+this.aName+"]")}a=b}}}else{if(a instanceof Date){a=a.getTime()/86400000}}if(!appSettings.hasOwnProperty("maxNumPrecis")||appSettings.maxNumPrecis){this.currentValue=a}else{this.currentValue=RoundDP(a,this.aDecPlaces)}DictionaryObject_Num.superClass.SetValue.call(this)}};DictionaryObject_Num.prototype.SetValueAsString=function(a){this.SetValue(parseFloat(a))};DictionaryObject_Num.prototype.GetValueAsString=function(a,d){if(d==undefined){d=true}var b=this.GetValue();if(typeof b=="number"){var e;if((appSettings.hasOwnProperty("maxNumPrecis")&&!appSettings.maxNumPrecis&&(a==undefined))||(a=="force")){e=b.toFixed(this.aDecPlaces)}else{if(typeof a=="number"){e=b.toFixed(a)}else{e=b.toString()}}if(appSettings.decSeparator&&(appSettings.decSeparator!=".")&&d){e=e.replace(".",appSettings.decSeparator)}return e}else{return""}};DictionaryObject_Num.prototype.val=function(a){if(a===undefined){return this.GetValue()}else{this.SetValue(a);return this}};DictionaryObject_Num.prototype.UnknownInvalids=function(){this.evalid=VALID_UNKNOWN};DictionaryObject_Num.prototype.ResolveInvalids=function(){this.valid=(this.evalid!=VALID_FALSE)};DictionaryObject_Num.prototype.GetValueValidity=function(a){return this.evalid};DictionaryObject_Num.prototype.SetValueValidity=function(a,b){this.evalid=b};DictionaryObject_Num.prototype.GetOldValueValidity=function(a){return this.ovalid};DictionaryObject_Num.prototype.SaveValidity=function(){this.ovalid=this.evalid};function DictionaryObject_Date(f,g,d){DictionaryObject_Date.baseConstructor.call(this,f,g,TYPE_DATE,d);var e=new Date();var a=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()));var b=a.getTime();this.currentValue=b/86400000;this.dmInfo=null;this._hintprops=["aType","aName","val([newValue])","clear();","run();","isEmpty()","props","prop(controlPropName[, newValue])"]}ObjectExtend(DictionaryObject_Date,DictionaryObject);DictionaryObject_Date.prototype.Reset=function(){DictionaryObject_Date.superClass.Reset.call(this)};DictionaryObject_Date.prototype.Clear=function(a){this.currentValue=0;DictionaryObject_Date.superClass.Clear.call(this);if(this.flatProps&&a){if(this.flatProps.defaultmode=="SetDefault"){this.SetValue(this.flatProps._default)}}};DictionaryObject_Date.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID,true);return false}return true};DictionaryObject_Date.prototype.Populate=function(b,a){DictionaryObject_Date.superClass.Populate.call(this,b,a)};DictionaryObject_Date.prototype.toObject=function(){var a=DictionaryObject_Date.superClass.toObject.call(this);if(this.dmInfo){a.dmInfo=this.dmInfo}return a};DictionaryObject_Date.prototype.toString=function(){return(DictionaryObject_Date.superClass.toString.call(this))};DictionaryObject_Date.prototype.GetValue=function(){if(!this.Load(this)){return null}if(!this.isDataFull){if(this.flatProps.defaultmode=="UseDefault"){return this.flatProps._default}}return this.currentValue};DictionaryObject_Date.prototype.SetValue=function(a){if(a==PSEUDO_VALUE_EMPTY){this.Clear()}else{if(typeof a=="string"){var b=Cmd_StrToDate(a);if(b==-1){this.Clear();return}a=b}this.currentValue=a;DictionaryObject_Date.superClass.SetValue.call(this)}};DictionaryObject_Date.prototype.GetValueAsString=function(d){var b=this.GetValue();if(d===true){return Cmd_DateToStr(b)}else{if(d=="YYYYMMDD"){var a=new Date(b*86400000);return strftime("yyyy-MM-dd",a.getDate(),a.getMonth(),a.getFullYear())}}return b.toString()};DictionaryObject_Date.prototype.SetValueAsString=function(a){this.SetValue(Cmd_StrToDate(a))};DictionaryObject_Date.prototype.val=function(a){if(a===undefined){if(!this.isFull()){return null}else{return new Date(this.GetValue()*86400000)}}else{if(a instanceof Date){this.SetValue(a.getTime()/86400000)}else{this.SetValue(a)}return this}};function DictionaryObject_Bool(b,d,a){DictionaryObject_Bool.baseConstructor.call(this,b,d,TYPE_BOOLEAN,a);this.aValues=null;this.aValueProps=null;this.nValues=2;this.currentValueID=0}ObjectExtend(DictionaryObject_Bool,DictionaryObject);DictionaryObject_Bool.prototype.Reset=function(){DictionaryObject_Bool.superClass.Reset.call(this)};DictionaryObject_Bool.prototype.Clear=function(a){if(!this.Load(this)){return}this.currentValueID=0;DictionaryObject_Bool.superClass.Clear.call(this);if(this.flatProps&&a){if(this.flatProps.defaultmode=="SetDefault"){this.SetValueAsBool(this.flatProps._default)}}};DictionaryObject_Bool.prototype.Populate=function(e,d,j){var h,g,a;for(h=0;h<j.props.list.length;h++){j.props.list[h].aName=Handle2(j.props.list[h].aName);j.props.list[h].realName=Handle2(j.props.list[h].realName)}this.aValues=j.values;this.aValueProps=j.props;for(h=0;h<this.aValues.length;h++){a=this.aValues[h];a.idx=h;a.valid=true;for(var f in a){if(f.substr(0,1)=="~"){var b=Handle2(f);a[b]=a[f];delete a[f];if(typeof a[b]=="string"){a[b]=Handle2(a[b])}}}a.aText=this.GetValueDescr(h);a.evalid=VALID_UNKNOWN}DictionaryObject_Bool.superClass.Populate.call(this,e,d)};DictionaryObject_Bool.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID,true);return false}else{return true}};DictionaryObject_Bool.prototype.toString=function(){var a=DictionaryObject_Bool.superClass.toString.call(this);for(var b=0;b<this.aValues.length;b++){a+="\nid :"+this.aValues[b].aID+" , name :"+this.aValues[b].aName+" , text :"+this.aValues[b].aText}return a};DictionaryObject_Bool.prototype.GetValue=function(){if(!this.Load(this)){return 0}if(this.currentValueID===0){if(this.flatProps.defaultmode=="UseDefault"){if(this.flatProps._default){return 1}return 2}return 0}return this.currentValueID};DictionaryObject_Bool.prototype.GetValueProp=function(b,a){if(!this.Load(this)){return null}if(this.aValueProps===null){return null}if(a===undefined){a=-1}if(a==-1){a=this.GetValue()}if(a===0){return null}for(var d=0;d<this.aValueProps.list.length;d++){if((this.aValueProps.list[d].aName==b)||(this.aValueProps.list[d].aID==b)){break}}if(d<this.aValueProps.list.length){return this.IDtoName(a,this.aValueProps.list[d].aName)}return null};DictionaryObject_Bool.prototype.GetValueAsString=function(d,b){var a=this.GetValue();if(a===0){return""}else{if(d){return(a==1?"TRUE":"FALSE")}}return this.IDtoName(a,b)};DictionaryObject_Bool.prototype.SetValue=function(a){if(a==PSEUDO_VALUE_EMPTY){this.Clear()}else{if(typeof a=="boolean"){this.SetValueAsBool(a)}else{if(typeof a=="string"){return this.SetValueAsString(a)}else{this.currentValueID=a;DictionaryObject_Bool.superClass.SetValue.call(this)}}}};DictionaryObject_Bool.prototype.SetValueAsString=function(a){if(!this.Load(this)){return null}if(a==PSEUDO_VALUE_EMPTY){this.Clear()}else{var b=this.NameToID(a);if(b!==0){this.SetValue(b)}else{if(a.toUpperCase()=="TRUE"){this.SetValue(1)}else{if(a.toUpperCase()=="FALSE"){this.SetValue(2)}else{hardError("Unknown boolean object value ["+a+"]");return}}}DictionaryObject_Bool.superClass.SetValueAsString.call(this)}};DictionaryObject_Bool.prototype.IDtoText=function(a){var b=this.ValueIDtoIndex(a);if(b>=0){return this.GetValueDescr(b)}return""};DictionaryObject_Bool.prototype.IDtoName=function(d,b){var e=this.ValueIDtoIndex(d);if(e>=0){var a="";if(b===true){a=this.GetValueDescr(e)}else{if(b){a=this.aValues[e][b]}else{a=this.aValues[e].aName}}return a}return""};DictionaryObject_Bool.prototype.NameToID=function(b){if(this.Load(this)){for(var a=0;a<this.aValues.length;a++){if(this.aValues[a].aName==b){return this.aValues[a].aID}}}return 0};DictionaryObject_Bool.prototype.GetNvalues=function(){if(this.Load(this)){return this.aValues.length}return 0};DictionaryObject_Bool.prototype.GetValueDescr=function(b){if(!this.aValueProps){return""}if((b<0)||(b>=this.aValues.length)){softError("GetValueDescr index out of bounds "+this.aName+" ["+b+"]");return""}var a="";var d=this.aValueProps.general.descriptionprop;if(d&&this.aValues[b].hasOwnProperty(d)){a=this.aValues[b][d]}if(a==""){a=this.aValues[b].aName}return a};DictionaryObject_Bool.prototype.SetValueProp=function(b,a,d){if(!this.Load(this)){return}if(this.aValueProps==null){return}if(a==-1){a=this.GetValue()}if(a===0){return}for(var f=0;f<this.aValueProps.list.length;f++){if(this.aValueProps.list[f].aID==b){break}}if(f<this.aValueProps.list.length){var e=this.ValueIDtoIndex(a);if(e>=0){this.aValues[e][this.aValueProps.list[f].aName]=d}}};DictionaryObject_Bool.prototype.GetValueAsBool=function(){var a=this.GetValue();if(a==1){return true}else{if(a==2){return false}}return null};DictionaryObject_Bool.prototype.SetValueAsBool=function(a){s=typeof(a);if(s=="string"){this.SetValueAsString(a)}else{if(s=="number"){if(a==1){this.SetValue(1)}else{this.SetValue(2)}}else{if(a){this.SetValue(1)}else{this.SetValue(2)}}}};DictionaryObject_Bool.prototype.IsValueSelected=function(a){return this.GetValue()==a};DictionaryObject_Bool.prototype.IsValueIndexSelected=function(a){if((a>=0)&&(a<this.aValues.length)){return this.aValues[a].aID==this.currentValueID}return false};DictionaryObject_Bool.prototype.IsValueValid=function(a){return this.IsValueIndexValid(this.ValueIDtoIndex(a))};DictionaryObject_Bool.prototype.IsOtherValueValid=function(){if(!this.Load(this)){return true}for(var a=0;a<this.aValues.length;a++){if(this.aValues[a].aID!=this.currentValueID){if(this.aValues[a].valid){return true}}}return false};DictionaryObject_Bool.prototype.IsValueIndexValid=function(a){if((a>=0)&&(a<this.aValues.length)){return this.aValues[a].valid}return true};DictionaryObject_Bool.prototype.ValueIDtoIndex=function(a){if(this.Load(this)){for(var b=0;b<this.aValues.length;b++){if(this.aValues[b].aID==a){return b}}}return -1};DictionaryObject_Bool.prototype.IndextoValueID=function(a){if(this.Load(this)){if((a>=0)&&(a<this.aValues.length)){return this.aValues[a].aID}}return -1};DictionaryObject_Bool.prototype.val=function(a){if(a===undefined){if(appSettings.treatBoolsAsList){return this.GetValueAsString()}else{return this.GetValueAsBool()}}else{this.SetValueAsBool(a);return this}};DictionaryObject_Bool.prototype.UnknownInvalids=function(){for(var a=0;a<this.aValues.length;a++){this.aValues[a].evalid=VALID_UNKNOWN}};DictionaryObject_Bool.prototype.ResolveInvalids=function(){for(var a=0;a<this.aValues.length;a++){this.aValues[a].valid=(this.aValues[a].evalid!=VALID_FALSE)}};DictionaryObject_Bool.prototype.GetValueValidity=function(a){return this.aValues[a].evalid};DictionaryObject_Bool.prototype.SetValueValidity=function(a,b){this.aValues[a].evalid=b};DictionaryObject_Bool.prototype.GetOldValueValidity=function(a){return this.aValues[a].ovalid};DictionaryObject_Bool.prototype.SaveValidity=function(){for(var a=0;a<this.aValues.length;a++){this.aValues[a].ovalid=this.aValues[a].evalid}};DictionaryObject_Bool.prototype.GetAllInValidValues=function(){if(this.Load(this)){var b=[];for(var d=0;d<this.aValues.length;d++){if(!this.aValues[d].valid){b[b.length]=this.aValues[d].aID}}return(b)}return(null)};DictionaryObject_Bool.prototype.SetValueInValid=function(a){if(this.Load(this)){if(a){for(var d=0;d<a.length;d++){for(var b=0;b<this.aValues.length;b++){if(this.aValues[b].aID==a[d]){this.aValues[b].valid=false;break}}}}}};DictionaryObject_Bool.prototype.ClearInvalid=function(){for(var a=0;a<this.aValues.length;a++){this.aValues[a].valid=true}};DictionaryObject_Bool.prototype.GetNselected=function(){if(this.IsEmpty()){return 0}return 1};DictionaryObject_Bool.prototype.GetNvalid=function(){var a=0;for(var b=0;b<this.aValues.length;b++){if(this.aValues[b].valid){a++}}return a};DictionaryObject_Bool.prototype.GetSelectedIndex=function(){return this.ValueIDtoIndex(this.currentValueID)+1};function DictionaryObject_Text(d,e,b,a){DictionaryObject_Text.baseConstructor.call(this,d,e,TYPE_TEXT,b);this.aLength=a;this.currentValue="";this._hintprops=["aType","aName","val([newValue])","clear();","run();","isEmpty()","props","prop(controlPropName[, newValue])"]}ObjectExtend(DictionaryObject_Text,DictionaryObject);DictionaryObject_Text.prototype.Reset=function(){DictionaryObject_Text.superClass.Reset.call(this)};DictionaryObject_Text.prototype.Clear=function(a){this.currentValue="";DictionaryObject_Text.superClass.Clear.call(this);if(this.flatProps&&a){if(this.flatProps.defaultmode=="SetDefault"){if((this.aLength>0)&&(this.flatProps._default.length>this.aLength)){this.SetValue(this.flatProps._default.substring(0,this.aLength))}else{this.SetValue(this.flatProps._default)}}}};DictionaryObject_Text.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID,true);return false}else{return true}};DictionaryObject_Text.prototype.Populate=function(b,a){DictionaryObject_Text.superClass.Populate.call(this,b,a)};DictionaryObject_Text.prototype.toObject=function(){var a=DictionaryObject_Text.superClass.toObject.call(this);a.aLength=this.aLength;return a};DictionaryObject_Text.prototype.GetValue=function(){if(!this.Load(this)){return null}if(!this.isDataFull){if(this.flatProps.defaultmode=="UseDefault"){if((this.aLength>0)&&(this.flatProps._default.length>this.aLength)){return this.flatProps._default.substring(0,this.aLength)}else{return this.flatProps._default}}}return this.currentValue};DictionaryObject_Text.prototype.GetValueAsString=function(){return this.GetValue()};DictionaryObject_Text.prototype.GetValueAsJSON=function(){var a=this.GetValue();a=ElementToStr(a);return a};DictionaryObject_Text.prototype.SetValue=function(a){if(a==PSEUDO_VALUE_EMPTY){this.Clear()}else{if(typeof a=="number"){a=a.toString()}else{if(typeof a=="boolean"){a=a?"true":"false"}else{if(typeof a!="string"){a=""}}}if((this.aLength>0)&&(a.length>this.aLength)){this.currentValue=a.substring(0,this.aLength)}else{this.currentValue=a}DictionaryObject_Text.superClass.SetValue.call(this)}};DictionaryObject_Text.prototype.SetValueAsString=function(a){this.SetValue(a)};DictionaryObject_Text.prototype.val=function(a){if(a===undefined){return this.GetValue()}else{this.SetValue(a);return this}};function DictionaryObject_TxtProc(b,d,a){DictionaryObject_TxtProc.baseConstructor.call(this,b,d,TYPE_TXTPROCESSOR,a);this.aCode=null;this.aData=null;this.message="";this.loaded=false}ObjectExtend(DictionaryObject_TxtProc,DictionaryObject);DictionaryObject_TxtProc.prototype.toString=function(){var a=DictionaryObject_TxtProc.superClass.toString.call(this);a+="\ncode :"+this.aCode;return a};DictionaryObject_TxtProc.prototype.toObject=function(){var a=DictionaryObject_TxtProc.superClass.toObject.call(this);a.aData=this.aData;return a};DictionaryObject_TxtProc.prototype.Clear=function(a){if(!this.Load(this)){return null}this.message="";DictionaryObject_TxtProc.superClass.Clear.call(this)};DictionaryObject_TxtProc.prototype.Populate=function(a){this.aCode="";this.aData=null;if($.isPlainObject(a)){this.aData=a}else{if((a!="")&&(a!=null)){this.aCode=a}}DictionaryObject_TxtProc.superClass.Populate.call(this,null)};DictionaryObject_TxtProc.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID,true);return false}else{return true}};DictionaryObject_TxtProc.prototype.SetValue=function(a){this.message=a};DictionaryObject_TxtProc.prototype.GetValue=function(b){var a=this.message;if(b){a=a.replace("'","")}return a};DictionaryObject_TxtProc.prototype.val=function(a){if(a===undefined){return this.GetValue()}else{this.SetValue(a);return this}};DictionaryObject_TxtProc.prototype.atts=function(){var b=[];var e,a,d;for(e=0;e<this.aData.atts.length;e++){a=this.aData.atts[e];d=_dgo(a.aID);if(d){b.push(d)}}return b};DictionaryObject_TxtProc.prototype.Run=function(){if(!this.Load()){return false}if(this.aData){var c,att,o;for(c=0;c<this.aData.atts.length;c++){att=this.aData.atts[c];o=_dgo(att.aID);if(o){switch(o.aType){case TYPE_LIST:o.Clear();break;case TYPE_BOOLEAN:o.SetValueAsBool(false);break}}}var doMatch=function(match,aVal){var re=new RegExp(match,"i");return re.test(aVal)};var aVal=this.GetValue(true);for(c=0;c<this.aData.atts.length;c++){att=this.aData.atts[c];o=_dgo(att.aID);if(o){switch(o.aType){case TYPE_LIST:var vls=o.isMultiSel?[]:PSEUDO_VALUE_EMPTY;for(var v=0;v<att.vals.length;v++){if(doMatch(att.vals[v].match,aVal)){if(o.isMultiSel){vls.push(att.vals[v].aID)}else{vls=att.vals[v].aID;break}}}o.SetValue(vls);break;case TYPE_BOOLEAN:if(doMatch(att.match,aVal)){o.SetValueAsBool(true)}break}}}}else{if(this.aCode){eval(this.aCode)}}return true};DictionaryObject_TxtProc.prototype.run=DictionaryObject_TxtProc.prototype.Run;function DictionaryObject_Var(f,k,h,a,b,e,d,g,j){DictionaryObject_Var.baseConstructor.call(this,f,k,TYPE_VARIABLE,h);this.varType=a;if(this.varType==VARTYPE_NUM){this.aDecPlaces=b}else{this.aStrLength=b}this.dim1=e;this.dim2=d;this.initData=g;if(j&&(j.length>0)){this.description=j}this.tieddialog=0;this.data=null;this._hintprops=["aType","aName","val()","clear();","run();","elementVal(index1[, index2][, newValue])"]}ObjectExtend(DictionaryObject_Var,DictionaryObject);DictionaryObject_Var.prototype.Clear=function(a){DictionaryObject_Var.superClass.Clear.call(this);if($.isArray(this.initData)){if(this.dim1==1){this.data=this.initData.slice(0)}else{this.data=$.extend(true,[],this.initData)}}else{this.data=this.initData}if(a!=undefined){if(((this.varType==VARTYPE_NUM)&&(typeof a=="number"))||((this.varType==VARTYPE_STR)&&(typeof a=="string"))){if(!$.isArray(this.data)){this.data=a}else{for(var d=0;d<this.data.length;d++){if(!$.isArray(this.data[d])){this.data[d]=a}else{for(var b=0;b<this.data[d].length;b++){this.data[d][b]=a}}}}}}};DictionaryObject_Var.prototype.toString=function(){var d=DictionaryObject_Var.superClass.toString.call(this)+"\nType: "+this.varType+"\n";if(this.varType==VARTYPE_NUM){d+="Dec Places: "+this.aDecPlaces}else{d+="Str Length: "+this.aStrLength}d+="\nDimensions: "+this.dim1+","+this.dim2+"\n";var b,a;if(this.dim2!=1){for(b=1;b<=this.dim1;b++){if(b>1){d+=", "}d+="[";for(a=1;a<=this.dim2;a++){if(a>1){d+=", "}d+=this.data[b][a]}d+="]"}}else{if(this.dim1!=1){for(b=1;b<=this.dim1;b++){if(b>1){d+=", "}d+=this.data[b]}}else{d+=this.data}}return d};DictionaryObject_Var.prototype.toObject=function(){var a=DictionaryObject_Var.superClass.toObject.call(this);a.aLength=this.aLength;a.varType=this.varType;if(this.varType==VARTYPE_NUM){a.aDecPlacesOrLength=this.aDecPlaces}else{a.aDecPlacesOrLength=this.aStrLength}a.dim1=this.dim1;a.dim2=this.dim2;a.initData=this.initData;a.description=this.description;return a};DictionaryObject_Var.prototype.isFull=function(){return true};DictionaryObject_Var.prototype.GetValue=function(d,b){if(this.data==null){return null}if(d==null){d=1}if(b==null){b=1}var a="";if(this.dim2!=1){a=this.data[d][b]}else{if(this.dim1!=1){a=this.data[d]}else{a=this.data}}if(this.varType==VARTYPE_NUM){a=parseFloat(a.toFixed(this.aDecPlaces))}return a};DictionaryObject_Var.prototype.SetValue=function(b,e,d){if(b==PSEUDO_VALUE_EMPTY){if((e==null)&&(d==null)){this.Clear();return}if(this.varType==VARTYPE_STR){b=""}else{b=0}}if($.isArray(b)){var a;for(var f=0;(f<this.dim1)&&(f<b.length);f++){a=b[f];if(this.varType==VARTYPE_STR){if(this.aStrLength>0){a=a.substring(0,this.aStrLength)}}else{if(!appSettings.maxNumPrecis){a=RoundDP(a,this.aDecPlaces)}a=Number(a)}if(this.dim2!=1){this.data[f+1][1]=a}else{if(this.dim1!=1){this.data[f+1]=a}else{this.data=a}}}}else{if(this.varType==VARTYPE_STR){b=""+b;if((this.aStrLength>0)&&(b.length>this.aStrLength)){b=b.substring(0,this.aStrLength)}}else{if(!appSettings.maxNumPrecis){b=RoundDP(b,this.aDecPlaces)}b=Number(b)}if(e==null){e=1}if(d==null){d=1}if(this.dim2!=1){this.data[e][d]=b}else{if(this.dim1!=1){this.data[e]=b}else{this.data=b}}}DictionaryObject_Var.superClass.SetValue.call(this)};DictionaryObject_Var.prototype.SetValueAsString=function(a,d,b){this.SetValue(a,d,b)};DictionaryObject_Var.prototype.GetValueAsString=function(d,b){var a=this.GetValue(d,b);if((this.varType==VARTYPE_NUM)&&(typeof(a)=="number")){a=a.toFixed(this.aDecPlaces).toString()}return a};DictionaryObject_Var.prototype.GetValueAsJSON=function(){var d=this.data;if($.isArray(d)){var b=d.slice();b.splice(0,1);d=ArrayToStr(b)}else{d=ElementToStr(d)}return d};DictionaryObject_Var.prototype.SetValueAsJSON=function(aValue){var firstchr=aValue.substr(0,1);if((this.varType==VARTYPE_STR)&&(firstchr!="[")&&(aValue!=PSEUDO_VALUE_EMPTY)){if(firstchr!="'"&&firstchr!='"'){aValue=aValue.replace(/\'/g,"\\'");aValue="'"+aValue+"'"}if(this.aStrLength>0){aValue=aValue+".substring(0,"+this.aStrLength+")"}}if(aValue==PSEUDO_VALUE_EMPTY){this.Clear()}else{this.data=eval(aValue)}if(aValue.substr(0,1)=="["){this.data.splice(0,0,0)}};DictionaryObject_Var.prototype.val=function(b){if(b===undefined){return this.data}else{if((this.dim1==1)&&(this.dim2==1)){this.SetValue(b)}else{if(!$.isArray(b)){hardError("Must specify an array to [val] set method");return}if((b.length==1)&&!$.isArray(b[0])){hardError("First element of array must be an array");return}if((b.length==1)&&(b[0].length<=1)){hardError("First element of array must be at lease a 2 element array");return}var e,a;var d=0;for(e=0;e<b.length;e++){if(!$.isArray(b[e])){a=1}else{a=b[e].length}if(a>d){d=a}}this.dim1=b.length;this.dim2=d;this.data=b.slice(0);this.data.splice(0,0,0);for(e=1;e<this.data.length;e++){if(!$.isArray(this.data[e])){this.data[e]=[0,this.data[e]]}else{this.data[e].unshift(0)}if(this.data[e].length!=this.dim2+1){this.data[e].length=this.dim2+1}}}}};DictionaryObject_Var.prototype.elementVal=function(d,b,a){if((a===undefined)&&(this.dim2==1)){if((this.dim1==1)&&(this.dim2==1)&&(b===undefined)){a=d;d=1;b=1}else{a=b;b=1}}if(a===undefined){return this.GetValue(d,b)}else{return this.SetValue(a,d,b)}};DictionaryObject_Var.prototype.val2=DictionaryObject_Var.prototype.elementVal;function DictionaryObject_Proc(b,d,a){DictionaryObject_Proc.baseConstructor.call(this,b,d,TYPE_PROCEDURE,a);this.aCode=null;this.lastReturn=null;this.loaded=false;this._hintprops=["aType","aName","run();"]}ObjectExtend(DictionaryObject_Proc,DictionaryObject);DictionaryObject_Proc.prototype.toString=function(){var a=DictionaryObject_Proc.superClass.toString.call(this);a+="\ncode :"+this.aCode;return a};DictionaryObject_Proc.prototype.Populate=function(a){if((a!="")&&(a!=null)){this.aCode=a}else{this.aCode=""}DictionaryObject_Proc.superClass.Populate.call(this,null)};DictionaryObject_Proc.prototype.toObject=function(){var a=DictionaryObject_Proc.superClass.toObject.call(this);a.aCode=this.aCode;return a};DictionaryObject_Proc.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID,true);return false}else{return true}};var rsProtected=false;var replayProtection={groups:[],reset:function(){this.groups=[];rsProtected=false},enter:function(){this.groups.push({rsLen:replayStack.replayPos,objs:[]})},exit:function(g,f){if(this.groups.length==0){hardError("Replay protection exit without enter");return}var e;var d=this.groups.pop();for(e=d.rsLen;e<replayStack.aReplay.length;e++){if(replayStack.aReplay[e].aOperation==REPLAY_UI){return}}replayStack.aReplay.splice(d.rsLen,replayStack.aReplay.length-d.rsLen);if(!$.isPlainObject(f)){f={}}f.items=[];for(e=0;e<d.objs.length;e++){var b={id:d.objs[e].aObject.aID};if(d.objs[e].fullStore&&((d.objs[e].aObject.aType==TYPE_LIST)||(d.objs[e].aObject.aType==TYPE_BOOLEAN)||(d.objs[e].aObject.aType==TYPE_NUMERIC)||(d.objs[e].aObject.aType==TYPE_DATE)||(d.objs[e].aObject.aType==TYPE_TEXT))){b.obj=$.extend(true,{},d.objs[e].aObject)}var a=d.objs[e].aObject.val();if($.isArray(a)){a=$.extend(true,[],a)}b.v=a;f.items.push(b)}replayStack.Add(g,REPLAY_GROUPSET,0,0,f);replayStack.replayPos=replayStack.aReplay.length},set:function(a,b){if(this.groups.length>0){if(!b){b=false}var d=this.groups[this.groups.length-1].objs;for(var e=0;e<d.length;e++){if(d[e].aObject.aID==a.aID){if(!d[e].fullStore&&b){d[e].fullStore=true}return}}d.push({aObject:a,fullStore:b})}}};var aIndent=0;DictionaryObject_Proc.prototype.Run2=function(rsProtected,args){aIndent++;if(rsProtected){replayProtection.enter()}var s=this.aCode;if(s.substr(s.length-2)=="()"){s=s.substr(0,s.length-2)}try{if(wrapperOptions.nodejs){var fn;try{if(s.indexOf("(")==-1){fn=eval(s)}else{xrkb_func_args=Array.prototype.slice.call(args);s="(function(){var params = xrkb_func_args;\n"+s+"\n})()";fn=eval(s)}}catch(e){throw e}if($.isFunction(fn)){this.lastReturn=fn.apply(this,args)}else{this.lastReturn=fn}}else{if($.isFunction(window[s])){this.lastReturn=window[s].apply(this,args)}else{xrkb_func_args=Array.prototype.slice.call(args);s="(function(){var params = xrkb_func_args; "+s+"\n})()";this.lastReturn=eval(s)}}}catch(e){aIndent--;if(!(e instanceof inferenceIssue)){hardError("An error was encountered!\n\nProcedure: "+this.aName+(lastErr?"\nLine "+lastErr.ln+"\nCommand: "+lastErr.cmd:"")+"\n\n"+e);return}else{throw e}}if(rsProtected){replayProtection.exit(this.aID,{lastReturn:this.lastReturn})}aIndent--};DictionaryObject_Proc.prototype.Run=function(){this.lastReturn=null;if(!this.Load()){return false}if(rsProtected){if((replayStack.replayPos<replayStack.aReplay.length)&&(replayStack.aReplay[replayStack.replayPos].aOperation==REPLAY_GROUPSET)&&(replayStack.aReplay[replayStack.replayPos].pauseID==this.aID)){var a=replayStack.aReplay[replayStack.replayPos];for(var d=0;d<a.aExtra.items.length;d++){var b=_dgo(a.aExtra.items[d].id);if(b){if(a.aExtra.items[d].obj){if(b.aValues){b.aValues=$.extend(true,[],a.aExtra.items[d].obj.aValues)}if(b.flatProps){b.flatProps=$.extend(true,{},a.aExtra.items[d].obj.flatProps)}}b.val(a.aExtra.items[d].v)}}replayStack.replayPos+=1;this.lastReturn=a.aExtra.lastReturn}else{this.Run2(true,arguments)}}else{this.Run2(false,arguments)}if(this.lastReturn==undefined){return true}else{return this.lastReturn}};DictionaryObject_Proc.prototype.run=function(){return this.Run.apply(this,arguments)};function DictionaryObject_Report(b,d,a){DictionaryObject_Report.baseConstructor.call(this,b,d,TYPE_REPORT,a);this.aText=null;this.aDisplay="";this.aProps=null;this.objList=null;this.loaded=false}ObjectExtend(DictionaryObject_Report,DictionaryObject);DictionaryObject_Report.prototype.Clear=function(){this.aDisplay="";DictionaryObject_Report.superClass.Clear.call(this)};DictionaryObject_Report.prototype.toString=function(){var a=DictionaryObject_Report.superClass.toString.call(this);a+="\ntext :"+this.aText;return a};DictionaryObject_Report.prototype.Populate=function(b,d,a){if((d!="")&&(d!=null)){this.aText=d;this.objList=a}else{this.aText=""}this.aProps=b;DictionaryObject_Report.superClass.Populate.call(this,null,null)};DictionaryObject_Report.prototype.toObject=function(){var a=DictionaryObject_Report.superClass.toObject.call(this);a.aText=this.aText;a.aProps=this.aProps;return a};DictionaryObject_Report.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID,true);return false}else{return true}};DictionaryObject_Report.prototype.GetText=function(b){if(!this.Load()){return false}else{if((this.aDisplay=="")&&b){if((this.aText.lastIndexOf("()")==this.aText.length-2)&&!wrapperOptions.nodejs){var a=this.aText.substr(0,this.aText.length-2);if($.isFunction(window[a])){this.aDisplay=window[a]()}}if(this.aDisplay==""){this.aDisplay=_expandEmbedded(this.aText,true)}}return this.aDisplay}};DictionaryObject_Report.prototype.GetObjList=function(){if(!this.Load(this)){return null}return this.objList};DictionaryObject_Report.prototype.Run=function(){if(!this.Load()){return false}else{var a=replayStack.PopReplay(this.aID);if(a==REPLAYPOP_HANDLED){return true}else{if(a==REPLAYPOP_CURRENT){this.aDisplay=_expandEmbedded(this.aText,true);throw new inferenceIssue(PASSBACK_PAUSE,this.aID)}else{hardError("Unknown replay pop return ["+a+"]");return}}}};DictionaryObject_Report.prototype.ReportPropValue=function(b,a){if(!this.Load()){return false}else{if(this.aProps){if(a){this.aProps[b]=a}else{return this.aProps[b]}}}};var lastDialogInstanceID=0;function DictionaryObject_Dlg(b,d,a){DictionaryObject_Dlg.baseConstructor.call(this,b,d,TYPE_DIALOG,a);this.loadedDefinition=null;this.formRules=null;this.aDefinition=null;this.aObjectList=[];this.aEmbeddedList=[];this.aPropList=[];this.aBoolCheckBoxList=null;this.isSubDialog=false;this.currentTiedObj=null;this.dialogUI=null;this.loaded=false;this.dirty=false;this._hintprops=["aType","aName","findControl(controlName)","run();"]}ObjectExtend(DictionaryObject_Dlg,DictionaryObject);DictionaryObject_Dlg.prototype.Clear=function(a){if(this.aDefinition&&this.aDefinition.instanceatts){for(var b=0;b<this.aDefinition.instanceatts.length;b++){if(this.aDefinition.instanceatts[b].data){delete this.aDefinition.instanceatts[b].data}}}};DictionaryObject_Dlg.prototype.Reset=function(){DictionaryObject_Dlg.superClass.Reset.call(this);if(this.dirty){this.aDefinition=$.extend(true,{},this.loadedDefinition);this.dirty=false}};DictionaryObject_Dlg.prototype.toString=function(){var a=DictionaryObject_Dlg.superClass.toString.call(this);a+="\ndefinition :"+this.aDefinition;return a};DictionaryObject_Dlg.prototype.createAttInstances=function(){if(this.aDefinition){if(this.aDefinition.instanceatts){if(this.aDefinition.instanceatts.length>0){for(var d=0;d<this.aDefinition.instanceatts.length;d++){if(!this.aDefinition.instanceatts[d].data){var b=_dgo(this.aDefinition.instanceatts[d].att);if(b){var a=null;if(b.aType==TYPE_DIALOG){a={current:0,dialogs:[]}}else{if(b.flatProps&&b.flatProps.instanceatts){a={current:0,dialogs:[]}}else{if(this.isSubDialog){a=$.extend(true,{},b);a.Clear();a.ResetInstanceRef()}else{a=null}}}this.aDefinition.instanceatts[d].data=a}}}}}}return true};DictionaryObject_Dlg.prototype.ResetInstanceRef=function(){DictionaryObject_Dlg.superClass.ResetInstanceRef.call(this);if(this.aDefinition){if(this.aDefinition.instanceatts){for(var b=0;b<this.aDefinition.instanceatts.length;b++){var a=_dgo(this.aDefinition.instanceatts[b].att,true);if(a){if((a.aType==TYPE_DIALOG)||(a.flatProps&&a.flatProps.instanceatts)){this.aDefinition.instanceatts[b].data={current:0,dialogs:[]}}}}}}};DictionaryObject_Dlg.prototype.assignAttInstancesToDictinary=function(){if(this.aDefinition.instanceatts&&this.isSubDialog){for(var d=0;d<this.aDefinition.instanceatts.length;d++){var a=this.aDefinition.instanceatts[d].data;if(a){var b=_dgo(this.aDefinition.instanceatts[d].att,true);if(b.aType!=TYPE_DIALOG){b.PushInstanceRef(a)}}}}};DictionaryObject_Dlg.prototype.revertAttInstancesToDictinary=function(){if(this.aDefinition.instanceatts){for(var b=0;b<this.aDefinition.instanceatts.length;b++){var a=_dgo(this.aDefinition.instanceatts[b].att,true);if(a){if(a.aType!=TYPE_DIALOG){a.PopInstanceRef()}}}}};DictionaryObject_Dlg.prototype.GetDialogInstObject=function(a){if(this.aDefinition.instanceatts){for(var b=0;b<this.aDefinition.instanceatts.length;b++){if(this.aDefinition.instanceatts[b].att==a){if(this.aDefinition.instanceatts[b].data!=null){return this.aDefinition.instanceatts[b].data}else{return dictionary.GetObject(a)}}}}return null};DictionaryObject_Dlg.prototype.GetDialogInstObjectByName=function(f,a){if(a){f=f.toLowerCase()}if(this.aDefinition.instanceatts){for(var e=0;e<this.aDefinition.instanceatts.length;e++){var d=dictionary.GetObject(this.aDefinition.instanceatts[e].att);if(d){var b=d.aName;if(a){b=b.toLowerCase()}if(b==f){if(this.aDefinition.instanceatts[e].data!=null){return this.aDefinition.instanceatts[e].data}else{return dictionary.GetObjectByName(f,a)}}}}}return null};DictionaryObject_Dlg.prototype.clearSubDlgInstances=function(){if(this.aDefinition.instanceatts){for(var a=0;a<this.aDefinition.instanceatts.length;a++){if(this.aDefinition.instanceatts[a].data!=null){this.aDefinition.instanceatts[a].data.dialogs=[]}}}};DictionaryObject_Dlg.prototype.addSubDlgInstance=function(d){if(!this.Load(this)){return null}var a=this.GetDialogInstObject(d);if(!a){return -1}var e=dictionary.GetObject(d,true);var b=$.extend(true,{},e);b.isSubDialog=true;b.createAttInstances();a.dialogs[a.dialogs.length]=b;return a.dialogs.length-1};DictionaryObject_Dlg.prototype.runSubDlgInstance=function(f,d){var b=this.GetDialogInstObject(f);if(!b){return null}if((d<0)||(d>=b.dialogs.length)){hardError("Sub dialog instance index out of bounds ["+d+"] for "+this.aName);return}var a=b.dialogs[d];b.current=d+1;var g=_dgo(f,true);g.PushInstanceRef(a);var e=replayStack.onFormTree;replayStack.onFormTree=false;if(a.Run()){g.PopInstanceRef();b.current=0;replayStack.onFormTree=e;return true}else{return false}};DictionaryObject_Dlg.prototype.delSubDlgInstance=function(d,b){var a=this.GetDialogInstObject(d);if(!a){return null}if((b<0)||(b>=a.dialogs.length)){hardError("Sub dialog instance index out of bounds ["+b+"] for "+this.aName);return}a.dialogs=a.dialogs.slice(0,b).concat(a.dialogs.slice(b+1));for(var e=0;e<this.aDefinition.instanceatts.length;e++){if(this.aDefinition.instanceatts[e].att==d){this.aDefinition.instanceatts[e].data=a}}};DictionaryObject_Dlg.prototype.GetDialogAttribData=function(a,e,d){var b=this.GetDialogInstObject(a);if(!b){hardError("Can not locate Attribute ID ["+a+"] for "+this.aName);return}if(typeof d=="string"){switch(d.toLowerCase()){case"count":return b.dialogs.length;case"current":return b.current}}else{if(e==0){return b.GetValueAsString()}else{e--;if((e<0)||(e>=b.dialogs.length)){hardError("Sub dialog instance index out of bounds ["+e+"] for "+this.aName);return}for(c=0;c<b.dialogs[e].aDefinition.instanceatts.length;c++){if(b.dialogs[e].aDefinition.instanceatts[c].isvisible&&(b.dialogs[e].aDefinition.instanceatts[c].att==d)){var f=b.dialogs[e].GetDialogInstObject(d);return f.GetValueAsString()}}}}return null};function AddObject(a,b){if(b){for(var d=0;d<a.length;d++){if(a[d]==b){return}}a[a.length]=b}}DictionaryObject_Dlg.prototype.BuildObjectList=function(a){switch(a.aType){case CONTROL_LISTBOX:AddObject(this.aObjectList,a.tieditem);break;case CONTROL_NUMERIC:AddObject(this.aObjectList,a.tieditem);break;case CONTROL_ARRAYEDIT:AddObject(this.aObjectList,a.tieditem);break;case CONTROL_CHECKBOX:AddObject(this.aObjectList,a.tieditem);break;case CONTROL_RADIOBTN:AddObject(this.aObjectList,a.tieditem);break;case CONTROL_ARRAYLIST:AddObject(this.aObjectList,a.tieditem);AddObject(this.aObjectList,a.indexvariable);break;case CONTROL_HOTSPOT:AddObject(this.aObjectList,a.tieditem);break;case CONTROL_GRID:AddObject(this.aObjectList,a.tieditem);break;case CONTROL_DATE:AddObject(this.aObjectList,a.tieditem);break;case CONTROL_TABSHEET:for(var d=0;d<a.tabsheets;d++){for(var b=0;b<a.tabsheets[d].controls.length;b++){this.BuildObjectList(a.tabsheets[d].controls[b])}}break;case CONTROL_FRAME:AddObject(this.aObjectList,a.tieditem);break}};DictionaryObject_Dlg.prototype.BuildEmbList=function(a){var d=this;function b(m,l){if(l){var k=/dictionary\.GetObject\((.*?)\)/g;var j=k.exec(l);if(j){var h={cntrl:a?a.aName:"",prop:m,value:l};d.aPropList.push(h);do{var g=parseInt(j[1],10);if(g&&$.inArray(g,d.aEmbeddedList)==-1){d.aEmbeddedList.push(g)}}while(j=k.exec(l))}}}var f,e;if(!a){b("caption",this.aDefinition.caption);b("bkgndimage",this.aDefinition.bkgndimage);for(f=0;f<this.aDefinition.controls.length;f++){this.BuildEmbList(this.aDefinition.controls[f])}}else{if(a.hasOwnProperty("caption")){b("caption",a.caption)}if(a.hasOwnProperty("imagepath")){b("imagepath",a.imagepath)}if(a.hasOwnProperty("tabsheets")){for(f=0;f<a.tabsheets.length;f++){for(e=0;e<a.tabsheets[f].controls.length;e++){this.BuildEmbList(a.tabsheets[f].controls[e])}}}}};DictionaryObject_Dlg.prototype.StaticCaptions=function(aCtrlList){for(var c=0;c<aCtrlList.length;c++){if(aCtrlList[c].hasOwnProperty("caption")){var s=aCtrlList[c].caption;if((s.substr(0,1)=="'")&&(s.substr(s.length-1,1)=="'")){s=s.substr(1,s.length-2);if(s.indexOf("'")==-1){if(s.indexOf("\\")>=0){s=eval("'"+s+"'")}aCtrlList[c].caption=s}}}if($.isArray(aCtrlList[c].tabsheets)){for(var cc=0;cc<aCtrlList[c].tabsheets.length;cc++){this.StaticCaptions(aCtrlList[c].tabsheets[cc].controls)}}if($.isArray(aCtrlList[c].controls)){this.StaticCaptions(aCtrlList[c].controls)}}};DictionaryObject_Dlg.prototype.Populate=function(a,d){this.StaticCaptions(a.controls);this.loadedDefinition=a;this.formRules=(d?d:null);this.aDefinition=$.extend(true,{},this.loadedDefinition);this.dirty=false;DictionaryObject_Dlg.superClass.Populate.call(this,null);this.aObjectList=[];if($.isArray(this.aDefinition.usage)){this.aObjectList=this.aDefinition.usage}else{for(var b=0;b<this.aDefinition.controls.length;b++){this.BuildObjectList(this.aDefinition.controls[b])}}this.BuildEmbList();this.createAttInstances(0)};DictionaryObject_Dlg.prototype.toObject=function(){var a=DictionaryObject_Dlg.superClass.toObject.call(this);a.loadedDefinition=this.loadedDefinition;a.formRules=this.formRules;return a};DictionaryObject_Dlg.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID);return false}else{return true}};DictionaryObject_Dlg.prototype.GetControlByName=function(h,e){if(e==null){e=this.aDefinition.controls}h=h.toLowerCase();var d;for(var g=0;g<e.length;g++){if(e[g].aName.toLowerCase()==h){return e[g]}if($.isArray(e[g].tabsheets)){for(var f=0;f<e[g].tabsheets.length;f++){d=this.GetControlByName(h,e[g].tabsheets[f].controls);if(d!=null){return d}}}if($.isArray(e[g].controls)){d=this.GetControlByName(h,e[g].controls);if(d!=null){return d}}if(e[g].aType=="container"){var b=dgo(this.aDefinition.pid);if(b){var a=b.GetControlByName(h,null);if(a){return a}}}}return null};DictionaryObject_Dlg.prototype.findCtrlParent=function(b){var a=function(e){var g,f,d;for(g=0;g<e.length;g++){if(e[g].aID==b){return{list:e,idx:g}}if($.isArray(e[g].tabsheets)){for(f=0;f<e[g].tabsheets.length;f++){d=a(e[g].tabsheets[f].controls);if(d){return d}}}if($.isArray(e[g].controls)){d=a(e[g].controls);if(d){return d}}}return null};return a(this.aDefinition.controls)};DictionaryObject_Dlg.prototype.GetControlByID=function(b,d){if(d==null){d=this.aDefinition.controls}var a;for(var f=0;f<d.length;f++){if(d[f].aID==b){return d[f]}if($.isArray(d[f].tabsheets)){for(var e=0;e<d[f].tabsheets.length;e++){a=this.GetControlByID(b,d[f].tabsheets[e].controls);if(a!=null){return a}}}if($.isArray(d[f].controls)){a=this.GetControlByID(b,d[f].controls);if(a!=null){return a}}}return null};DictionaryObject_Dlg.prototype.GetDialogControlValue=function(aCont,propName){var aText="";var aControl=null;if(!this.Load(this)){return aText}if(aCont==""){aCont=null}if(!aCont){aText=this.aDefinition[propName.toLowerCase()]}else{if(typeof aCont=="string"){aControl=this.GetControlByName(aCont.toLowerCase())}else{aControl=this.GetControlByID(aCont)}}if((aText=="")&&(aControl!=null)){aText=aControl[propName.toLowerCase()]}if((typeof aText=="string")&&(aText!="")){if(aText=="''"){return""}if(aText.substr(0,1)=="'"){aText=eval(aText)}}return aText};DictionaryObject_Dlg.prototype.findControl=function(a){return this.GetControlByName(a.toLowerCase())};DictionaryObject_Dlg.prototype.val=function(a,d,b){if(b!=undefined){this.SetDialogControlValue(a,d,b)}else{return this.GetDialogControlValue(a,d)}};DictionaryObject_Dlg.prototype.SetDialogControlValue=function(m,g,e,a,k,l){if(!this.Load(this)){return false}var h=null;if(m==""){m=null}if(!m){this.aDefinition[g]=e;return true}else{if(typeof(m)=="string"){h=this.GetControlByName(m.toLowerCase())}else{h=this.GetControlByID(m)}}if(h==null){hardError("Unknown control ["+m+"] on dialog ["+this.aName+"]");return}if(!h.hasOwnProperty(g)){g=g.toLowerCase()}if(g=="tieditem"){var b=dictionary.GetObjectByName(e);var f=h[g];h[g]=b.aID;if((f!=0)&&(f!=b.aID)){if(rebuildControl(f,h)){if($.isArray(this.aDefinition.usage)){this.aObjectList=this.aDefinition.usage}else{this.aObjectList=[];for(var d=0;d<this.aDefinition.controls.length;d++){this.BuildObjectList(this.aDefinition.controls[d])}}}}}else{if($.isArray(h[g])){if(a){h[g][a-1][k]=e}else{if(l){for(var j=0;j<h[g].length;j++){if(h[g][j].id==l){h[g][j][k]=e;break}}}}}else{h[g]=e}}return true};function SetDefaultControl(f,b){var e;for(var h=0;h<f.length;h++){var d=f[h];if(d.aType=="checkbox"){if(d.controltype!="buttonset"){e=_dgo(d.tieditem);if(e){if(!e.isFull()&&(e.aType==TYPE_BOOLEAN)&&(e.flatProps.defaultmode=="")){e.SetValueAsBool(false)}}}}else{if(d.aType=="slider"){e=_dgo(d.tieditem);if(e){if(!e.isFull()){var a=e.flatProps.minvalue;if(e.flatProps._default&&e.flatProps._default>e.flatProps.minvalue&&e.flatProps._default<=e.flatProps.maxvalue){a=e.flatProps._default}e.SetValue(a)}}}else{e=null;if(b){e=b}else{if(d.hasOwnProperty("tieditem")){e=_dgo(d.tieditem)}}if(e){if(!e.isFull()){if(e.flatProps&&(e.flatProps.defaultmode=="UseDefault")){e.SetValue(e.GetValue())}}}if($.isArray(d.tabsheets)){for(var g=0;g<d.tabsheets.length;g++){SetDefaultControl(d.tabsheets[g].controls)}}else{if($.isArray(d.controls)){SetDefaultControl(d.controls)}}}}}}DictionaryObject_Dlg.prototype.AssignNumSliders=function(a){if((a.aType==CONTROL_NUMERIC)&&(a.style=="horzscroll")){var b=dictionary.GetObject(a.tieditem);if(b&&!b.isFull()){b.SetValue(a.scrollrangemin)}}if($.isArray(a.controls)){for(var d=0;d<a.controls.length;d++){this.AssignNumSliders(a.controls[d])}}};DictionaryObject_Dlg.prototype.InitAttrib=function(){var b,a;for(b=0;b<this.aObjectList.length;b++){if(this.aObjectList[b]!=0){a=dictionary.GetObject(this.aObjectList[b]);if(a&&!a.Load(a)){return false}}}if(this.aDefinition){if(this.aDefinition.instanceatts){for(b=0;b<this.aDefinition.instanceatts.length;b++){a=_dgo(this.aDefinition.instanceatts[b].att);if(a&&!a.Load(a)){return false}}}}if(this.aBoolCheckBoxList){for(b=0;b<this.aBoolCheckBoxList.length;b++){a=dictionary.GetObject(this.aBoolCheckBoxList[b]);if(!a.Load(a)){return false}if((a.aType==TYPE_BOOLEAN)&&(!a.isFull())){a.SetValueAsBool(false)}}}if(isMobile){this.AssignNumSliders(this.aDefinition)}};DictionaryObject_Dlg.prototype.AppendCapturedAtts=function(a){for(var b=0;b<this.aObjectList.length;b++){if(this.aObjectList[b]!=0){AppendCapturedAtt(this.aObjectList[b])}}if(a){AppendCapturedAtt(a.aID)}};DictionaryObject_Dlg.prototype.DoUpdates=function(a){for(var d=0;d<this.aObjectList.length;d++){if(this.aObjectList[d]!=0){var b=_dgo(this.aObjectList[d]);if(b){b.FireEvent(EVENT_UPDATE)}}}if(a){a.FireEvent(EVENT_UPDATE)}};DictionaryObject_Dlg.prototype.RunAsTied=function(l,h){var d;if(!h){h=0}if(!this.isSubDialog){if($.inArray(this.aID,baseDialogs)==-1){baseDialogs.push(this.aID)}}this.currentTiedObj=l;activeDialogStack.push(this.aID);if(!this.Load()){return false}this.assignAttInstancesToDictinary(h);this.InitAttrib();this.AppendCapturedAtts(l);SetDefaultControl(this.aDefinition.controls,l);if(this.aDefinition.initialupdates){this.DoUpdates(l)}if(this.aDefinition.onenter){d=_dgo(this.aDefinition.onenter);if(d){d.Run(this)}}var a=replayStack.PopReplay(this.aID);if(a==REPLAYPOP_HANDLED){if(this.aDefinition.rules){if(currentDlg.aID==this.aID){this.dialogUI=currentDlg;this.aDefinition.rules(false)}}if(this.aDefinition.onexit){d=_dgo(this.aDefinition.onexit);if(d){d.Run(this)}}var e=this.aID+(l?"_"+l.aID:"");var m=$("#xruipage").parent();var g=m.find(".xrkb-htmldlg-body[aID="+e+"]");var k=parseInt(g.attr("idx"),10);g.remove();var b=m.find(".xrkb-htmldlg-body[idx="+k+"]");if(b.length!==0){b.show()}activeDialogStack.length=activeDialogStack.length-1}else{if(a==REPLAYPOP_CURRENT){var j=(!currentDlg||currentDlg.aID!=this.aID||currentDlg.tiedObj!=this.currentTiedObj||this.currentTiedObj===true);if(wrapperOptions.nodejs||wrapperOptions.xrengine){if(j&&!replayStack.LastOperationWasValidatedOK()){replayStack.RenderingUI(this.aID)}if(this.aDefinition&&this.aDefinition.usage&&this.aDefinition.usage.length>0){if(this.aDefinition.usage[0]!=-1){Constrain(this.aDefinition.usage)}}throw new inferenceIssue(PASSBACK_DIALOG,this.aName,{tiedObj:l})}if(j){if(currentDlg){currentDlg.free();currentDlg=undefined}var f={aID:this.aID,tiedObj:l,isFluid:false};ClearUI(this.aID,false,replayStack.LastOperationWasValidatedOK());currentDlg=XRdialog.create($("#xrui"),this.aDefinition,f,this.formRules);currentDlg.render()}this.dialogUI=currentDlg;currentDlg.populate();if(j&&this.aDefinition.onshow){d=_dgo(this.aDefinition.onshow);if(d){d.Run(this)}}if(this.aDefinition.onupdate){d=_dgo(this.aDefinition.onupdate);if(d){d.Run(this)}}throw new inferenceIssue(PASSBACK_WAIT)}else{if(a==REPLAYPOP_STOP){return false}else{hardError("Unknown replay pop return ["+a+"]");return}}}this.revertAttInstancesToDictinary();this.currentTiedObj=null;return true};DictionaryObject_Dlg.prototype.Run=function(a){return this.RunAsTied(null,a)};DictionaryObject_Dlg.prototype.FrameSet=function(a,e,d,b){if(b==null){b=this.aDefinition.controls}for(var h=0;h<b.length;h++){if(b[h].frame==a){if(b[h].hasOwnProperty(e)){b[h][e]=d}else{if(b[h].tieditem){var f=dictionary.GetObject(b[h].tieditem);if(f){switch(e){case"visible":if(f.flatProps&&f.flatProps.hasOwnProperty("isvisible")){f.flatProps.isvisible=d}break;case"enabled":if(f.flatProps&&f.flatProps.hasOwnProperty("isenabled")){f.flatProps.isenabled=d}break;case"allowblank":if(f.flatProps&&f.flatProps.hasOwnProperty("allowblank")){f.flatProps.allowblank=d}break}}}}}if($.isArray(b[h].tabsheets)){for(var g=0;g<b[h].tabsheets.length;g++){this.FrameSet(a,e,d,b[h].tabsheets[g].controls)}}if($.isArray(b[h].controls)){this.FrameSet(a,e,d,b[h].controls)}}};function ValidationCtrl(b,a){this.ctrl=b;this.aValue=a}function FindInvalid(b,a){for(var d=0;d<b.length;d++){if(b[d].ctrl.aID==a){return d}}return -1}function AddInvalid(b,a,d){if(FindInvalid(b,a.aID)==-1){b[b.length]=new ValidationCtrl(a,d)}}function RemoveInvalid(b,a){var d=FindInvalid(b,a);if(d!=-1){b.splice(d,1)}}function ValidatingCtrl(b,a){if(b===true){return true}else{if(b===false){return false}else{if(typeof b!="object"){return false}}}return b.aID==a}DictionaryObject_Dlg.prototype.ValidateControl=function(aControl,validation){if(aControl.aType==CONTROL_TABSHEET){for(var c=0;c<aControl.tabsheets;c++){if(aControl.tabsheets[c].isvisible){for(var cc=0;cc<aControl.tabsheets[c].controls.length;cc++){this.ValidateControl(aControl.tabsheets[c].controls[cc],validation)}}}}else{if(aControl.validation){var procName=aControl.validation;if(procName!=""){var tied=(aControl.tieditem?dictionary.GetObject(aControl.tieditem):this.currentTiedObj);var tiedName=(tied?tied.aName:"");var aValue=eval(procName+"('"+tiedName+"')");if((aValue!=true)&&(aValue!=undefined)){AddInvalid(validation,aControl,aValue)}}}}};DictionaryObject_Dlg.prototype.Validation=function(d){var a=[];if(d){this.ValidateControl(d,a)}else{for(var b=0;b<this.aDefinition.controls.length;b++){this.ValidateControl(this.aDefinition.controls[b],a)}}return a};function Dialog_FindProgressButton(a){for(var b=0;b<a.length;b++){if((a[b].aType=="button")&&((a[b].buttontype=="ok")||(a[b].buttontype=="change"))){return a[b]}}return null}function Dialog_FindNearestButton(a,e){var h,d,f,b;var g=false;for(h=0;h<e.length;h++){if(e[h].aID==a){g=true;break}}if(g){b=Dialog_FindProgressButton(e);return b!=null?b:true}else{for(h=0;h<e.length;h++){if(e[h].hasOwnProperty("tabsheets")){for(d=0;d<e[h].tabsheets.length;d++){f=Dialog_FindNearestButton(a,e[h].tabsheets[d].controls);if(f){if(f===true){b=Dialog_FindProgressButton(e);if(b!=null){f=b}}return f}}}}return false}}function RepopulateDefinitionFromDictionary(b,a){function f(g,j){if($.isPlainObject(g)){for(var d in g){if((typeof d=="string")&&((d=="tab")||(d.substr(0,1)=="$"))){break}if((typeof g[d]=="number")||(typeof g[d]=="boolean")||(typeof g[d]=="string")){j[d]=g[d]}else{if(j.hasOwnProperty(d)){f(g[d],j[d])}}}}else{if($.isArray(g)){for(var h=0;h<g.length;h++){if((typeof g[h]=="number")||(typeof g[h]=="boolean")||(typeof g[h]=="string")){j[h]=g[h]}else{f(g[h],j[h])}}}}}var e=_dgo(b);if(e&&(e.aType==TYPE_DIALOG)){f(e.aDefinition,a)}}function _GetControlByName(f,b){var a;f=f.toLowerCase();for(var e=0;e<b.length;e++){if(b[e].aName.toLowerCase()==f){return b[e]}if($.isArray(b[e].tabsheets)){for(var d=0;d<b[e].tabsheets.length;d++){a=this._GetControlByName(f,b[e].tabsheets[d].controls);if(a!=null){return a}}}if($.isArray(b[e].controls)){a=this._GetControlByName(f,b[e].controls);if(a!=null){return a}}}}function _SetTreeDialogDef(f,e,d,b){var a=this._GetControlByName(e,f.controls);if(a!=null){a[d]=b}}function renameCtrlInFormRules(e,b,a){if(e&&$.isArray(e.items)){for(var g=0;g<e.items.length;g++){var d=e.items[g];var f;for(f=0;f<d.conditions.length;f++){if(d.conditions[f].ctrl==b){d.conditions[f].ctrl=a}}for(f=0;f<d.actions.length;f++){if(d.actions[f].ctrl==b){d.actions[f].ctrl=a}}for(f=0;f<d.elses.length;f++){if(d.elses[f].ctrl==b){d.elses[f].ctrl=a}}}}}function DictionaryObject_Constr(d,b,a){DictionaryObject_Constr.baseConstructor.call(this,d,"~__CTAB",TYPE_CTABLE,a);this.aObjectList=b;this.aTables=null;this.aProcs=null;this.loaded=false}ObjectExtend(DictionaryObject_Constr,DictionaryObject);DictionaryObject_Constr.prototype.toString=function(){var a=DictionaryObject_Constr.superClass.toString.call(this);a+="\nobjects :"+this.aObjectList;a+="\ntables :"+this.aTables;return a};DictionaryObject_Constr.prototype.Populate=function(b,a){this.aTables=b;this.aProcs=a;DictionaryObject_Constr.superClass.Populate.call(this,null)};DictionaryObject_Constr.prototype.LookupObjs=function(){var b;for(var d=0;d<this.aTables.length;d++){this.aTables[d].oatts=[];for(b=0;b<this.aTables[d].atts.length;b++){for(var f=0;f<this.aObjectList.length;f++){if(this.aObjectList[f]==this.aTables[d].atts[b]){this.aTables[d].oatts[b]=dictionary.GetObject(this.aObjectList[f]);break}}}}if(this.aProcs){for(var e=0;e<this.aProcs.length;e++){this.aProcs[e].oatts=[];this.aProcs[e].aObject=dictionary.GetObject(this.aProcs[e].aID);for(b=0;b<this.aProcs[e].atts.length;b++){this.aProcs[e].oatts[b]=dictionary.GetObject(this.aProcs[e].atts[b])}}}};DictionaryObject_Constr.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID);return false}return true};function IsSelOrValid(a,b,d){if(a.aValues.length==0){return false}else{if(a.isFull()&&!d){return a.IsValueIndexSelected(b)}else{if(!a.isFull()&&!d&&(a.aType==TYPE_LIST)&&a.isMultiSel){return false}}}return a.GetValueValidity(b)!=VALID_FALSE}function SetValidity(a,b,e){var d;d=a.GetValueValidity(b);if(((d==VALID_UNKNOWN)||(d==VALID_NEWFALSE)||(d==VALID_TRUE))&&e){a.SetValueValidity(b,VALID_NEWTRUE);return true}else{if(((d==VALID_UNKNOWN)||(d==VALID_TRUE))&&!e){a.SetValueValidity(b,VALID_NEWFALSE);return true}}return false}function ConvertNewValidities(b){var a=false;var e,f,d;if((b.aType==TYPE_LIST)||(b.aType==TYPE_BOOLEAN)){d=b.GetNvalues()}else{d=1}for(var g=0;g<d;g++){e=b.GetValueValidity(g);f=b.GetOldValueValidity(g);if(e==VALID_NEWFALSE){if(f!=VALID_FALSE){b.SetValueValidity(g,VALID_FALSE);a=true}else{b.SetValueValidity(g,f)}}else{if(e==VALID_NEWTRUE){if(f!=VALID_TRUE){b.SetValueValidity(g,VALID_TRUE);a=true}else{b.SetValueValidity(g,f)}}}}return a}function procScan(g,b,e,f,l){var j;if(l>=g.oatts.length){var d=rsProtected;rsProtected=false;var k=g.aObject.Run();rsProtected=d;for(j=0;j<g.oatts.length;j++){if((f[j]>=0)&&(f[j]!==null)){SetValidity(g.oatts[j],f[j],k)}else{if(g.oatts[j].aType==TYPE_NUMERIC){SetValidity(g.oatts[j],-1,k)}}}}else{j=g.oatts[l];if((j.aID!=b)&&((j.aType==TYPE_LIST)||(j.aType==TYPE_BOOLEAN)&&(e[l]!==0))||((j.aType==TYPE_NUMERIC)&&(e[l]!==null))){f[l]=-1;procScan(g,b,e,f,l+1)}else{if(j.aType==TYPE_NUMERIC){f[l]=null;procScan(g,b,e,f,l+1)}else{for(var h=0;h<j.aValues.length;h++){if(j.GetValueValidity(h)!=VALID_FALSE){f[l]=h;j.SetValue(j.aValues[h].aID);procScan(g,b,e,f,l+1)}}}}}}function processConstrProc(d,h){var b,j,g;var e=new Array(d.oatts.length);for(b=0;b<d.oatts.length;b++){e[b]=d.oatts[b].GetValue()}var f=new Array(d.oatts.length);procScan(d,h,e,f,0);for(b=0;b<d.oatts.length;b++){if((e[b]===null)||(e[b]===0)){g=null;if(d.oatts[b].aValues){g=new Array(d.oatts[b].aValues.length);for(j=0;j<d.oatts[b].aValues.length;j++){g[j]=d.oatts[b].aValues[j].valid}}else{g=d.oatts[b].valid}d.oatts[b].SetValue(PSEUDO_VALUE_EMPTY);if(d.oatts[b].aValues){for(j=0;j<d.oatts[b].aValues.length;j++){d.oatts[b].aValues[j].valid=g[j]}}else{d.oatts[b].valid=g}}else{d.oatts[b].SetValue(e[b])}}}function isEmptyLogical(a){if((a.aType!=TYPE_LIST)&&(a.aType!=TYPE_BOOLEAN)){return false}if(!a.IsEmpty()){return false}if((a.aType==TYPE_LIST)&&a.isMultiSel){return false}return true}DictionaryObject_Constr.prototype.Run=function(){if(!this.Load()){return}var y;var B;var x;var d;var m;var D;var h;var l;var j;var k;var p;var u;var C;var b;var f;var E;var q;var g;var z;var A=false;var n;this.LookupObjs();for(B=0;B<this.aObjectList.length;B++){if(this.aObjectList[B]!=0){p=dictionary.GetObject(this.aObjectList[B]);if(!p.Load()){return}if(isEmptyLogical(p)){A=true}if(p.aType==TYPE_NUMERIC){A=true}}}if(A){C=-1}else{C=0}for(;C<this.aObjectList.length;C++){if(C>=0){p=dictionary.GetObject(this.aObjectList[C]);switch(p.aType){case TYPE_LIST:case TYPE_BOOLEAN:if(isEmptyLogical(p)){continue}break;default:continue}}for(B=0;B<this.aObjectList.length;B++){p=dictionary.GetObject(this.aObjectList[B]);if((p.aType==TYPE_LIST)||(p.aType==TYPE_BOOLEAN)||(p.aType==TYPE_NUMERIC)){p.UnknownInvalids()}}do{y=false;for(B=0;B<this.aTables.length;B++){x=this.aTables[B];try{for(D=0;D<x.oatts.length;D++){if((x.oatts[D].aType==TYPE_LIST)||(x.oatts[D].aType==TYPE_BOOLEAN)||(x.oatts[D].aType==TYPE_NUMERIC)){x.oatts[D].SaveValidity()}}n=[];if(x.startinvalid){l=x.oatts[x.oatts.length-1];for(h=0;h<l.aValues.length;h++){n.push(h)}}for(m=0;m<x.rows.length;m++){d=x.rows[m];j=true;for(D=0;j&&(D<x.oatts.length);D++){if(C<0){b=false}else{b=(x.oatts[D].aID==this.aObjectList[C])}switch(d[D].ty){case TY_SV:if(!IsSelOrValid(x.oatts[D],d[D].vl,b)){j=false}break;case TY_MV:for(h=0,k=false;(!k)&&(h<d[D].vl.length);h++){if(IsSelOrValid(x.oatts[D],d[D].vl[h],b)){k=true}}if(!k){j=false}break;case TY_NT:if(x.oatts[D].isFull()){E=x.oatts[D].GetValue();q=d[D].vl;if((x.oatts[D].aType==TYPE_LIST)||(x.oatts[D].aType==TYPE_BOOLEAN)){for(h=0;j&&(h<q.length);h++){z=q[h].vl;switch(q[h].cp){case"<":if(E>=z){j=false}break;case"<=":if(E>z){j=false}break;case">":if(E<=z){j=false}break;case">=":if(E<z){j=false}break;case"=":if(E!=z){j=false}break;case"<>":if(E==z){j=false}break}}}else{if(q[0].at){z=_dgo(q[0].at).val()}else{z=q[0].vl}switch(q[0].cp){case"<":if(E>=z){j=false}break;case"<=":if(E>z){j=false}break;case">":if(E<=z){j=false}break;case">=":if(E<z){j=false}break;case"=":if(E!=z){j=false}break;case"<>":if(E==z){j=false}break}}}break;case TY_AT:hardError("Attribute comparison still in constraint table");return}}if(j){u=d[x.oatts.length];for(D=0;D<x.oatts.length;D++){switch(d[D].ty){case TY_SV:SetValidity(x.oatts[D],d[D].vl,u);break;case TY_MV:for(h=0;h<d[D].vl.length;h++){SetValidity(x.oatts[D],d[D].vl[h],u)}break;case TY_NT:SetValidity(x.oatts[D],0,u);break;case TY_AV:if((x.oatts[D].aType==TYPE_LIST)||(x.oatts[D].aType==TYPE_BOOLEAN)){for(h=x.oatts[D].GetNvalues()-1;h>=0;h--){SetValidity(x.oatts[D],h,u)}}break}}if(x.startinvalid){if(d[x.oatts.length-1].ty==TY_SV){n.splice($.inArray(d[x.oatts.length-1].vl,n),1)}}}else{D--;if(!d[D].hasOwnProperty("jp")){m++}else{if(d[D].jp!=0){m=d[D].jp}else{m=x.rows.length}}m--}}if(x.startinvalid){for(D=0;D<n.length;D++){SetValidity(x.oatts[x.oatts.length-1],n[D],0)}}for(D=0;D<x.oatts.length;D++){if((x.oatts[D].aType==TYPE_LIST)||(x.oatts[D].aType==TYPE_BOOLEAN)||(x.oatts[D].aType==TYPE_NUMERIC)){if(ConvertNewValidities(x.oatts[D])){y=true}}}}catch(w){if(!(w instanceof inferenceIssue)){hardError("An error was encountered in constraint ["+_dgo(x.oid).aName+"]\n\n"+w.message);return}else{throw w}}}if(this.aProcs){for(B=0;B<this.aProcs.length;B++){g=this.aProcs[B];for(D=0;D<g.oatts.length;D++){g.oatts[D].SaveValidity()}if(C<0){b=0}else{b=this.aObjectList[C]}processConstrProc(g,b);for(D=0;D<g.oatts.length;D++){if(ConvertNewValidities(g.oatts[D])){y=true}}}}}while(y);if(C<0){for(B=0;B<this.aObjectList.length;B++){p=dictionary.GetObject(this.aObjectList[B]);if((p.aType==TYPE_NUMERIC)||isEmptyLogical(p)){p.ResolveInvalids()}}}else{p=dictionary.GetObject(this.aObjectList[C]);p.ResolveInvalids()}}};function Constrain(e){var h=[];var g;var d;for(g=0;g<e.length;g++){d=dictionary.GetObject(e[g]);if(((d.aType==TYPE_LIST)||(d.aType==TYPE_BOOLEAN)||(d.aType==TYPE_NUMERIC))&&(d.constraintDomain!=0)){h[h.length]=d}}var b=[];var f;var a;for(g=0;g<h.length;g++){for(f=0,a=false;(!a)&&(f<b.length);f++){if(b[f]==h[g].constraintDomain){a=true}}if(!a){b[b.length]=h[g].constraintDomain}}for(g=0;g<b.length;g++){d=dictionary.GetObject(b[g]);if(!d){return}if(!d.Load()){return}}for(g=0;g<b.length;g++){d=dictionary.GetObject(b[g]);d.Run()}return b.length>0}function DictionaryObject_Hierarchy(b,d,a){DictionaryObject_Hierarchy.baseConstructor.call(this,b,d,TYPE_HIERARCHY,a);this.aDefinition=null;this.loaded=false;this.tree=[]}ObjectExtend(DictionaryObject_Hierarchy,DictionaryObject);DictionaryObject_Hierarchy.prototype.Clear=function(a){var b=function(e){var f;for(var h=0;h<e.length;h++){var d=e[h];f=d.item;if(f){f.Reset();if(f.staticData){f.Evaluate()}else{f.Clear(a)}}if($.isArray(d.local)){for(var g=0;g<d.local.length;g++){f=d.local[g].item;if(f){f.Reset();if(f.staticData){f.Evaluate()}else{f.Clear(a)}}}}if($.isArray(d.children)){b(d.children)}}};b(this.aDefinition.tree);DictionaryObject_Hierarchy.superClass.Clear.call(this)};DictionaryObject_Hierarchy.prototype.SetupObjectRefs=function(){var a=this;var b=function(d){for(var e=0;e<d.length;e++){(function(){var f=d[e];var g;if(f.id){g=dictionary.GetObject(f.id);if(g.aType==TYPE_PROCEDURE){f.baseDictObj=true;f.item=g;f.selected=function(){return false}}else{f.baseDictObj=!g.encounteredOnHierarchy;if(!f.baseDictObj){g=$.extend(true,{},g)}g.encounteredOnHierarchy=true;f.item=g;f.selected=function(){return f.item.isSelectedForHierarchy(false)}}}else{f.item=null;f.selected=function(){return true}}if($.isArray(f.local)){for(var h=0;h<f.local.length;h++){if(f.local[h].id){g=dictionary.GetObject(f.local[h].id);f.local[h].baseDictObj=!g.encounteredOnHierarchy;if(!f.local[h].baseDictObj){g=$.extend(true,{},g)}g.encounteredOnHierarchy=true;f.local[h].item=g}else{f.local[h].item=null}}}if($.isArray(f.children)){b(f.children)}})()}};b(this.aDefinition.tree)};DictionaryObject_Hierarchy.prototype.Populate=function(a){this.aDefinition=a;this.tree=this.aDefinition.tree;DictionaryObject_Hierarchy.superClass.Populate.call(this,null,null)};DictionaryObject_Hierarchy.prototype.Load=function(){if(!this.loaded){DemandLoad(this.aID,true);return false}else{return true}};DictionaryObject_Hierarchy.prototype.findNodeByObjId=function(f,b){if(!b){b=this.aDefinition.tree}for(var e=0;e<b.length;e++){var a=b[e];if(a.id==f){return a}if($.isArray(a.children)){var d=this.findNodeByObjId(f,a.children[e]);if(d){return d}}}return null};DictionaryObject_Hierarchy.prototype.GoTree=function(l,g){var h,j,f;for(var k=0;k<l.length;k++){var e=l[k];if(e.item){var d=e.item;var b=null;if(!e.baseDictObj){b=dictionary.GetObject(d.aID,true);b.PushInstanceRef(d)}if($.isArray(e.local)){for(h=0;h<e.local.length;h++){if(e.local[h].item&&!e.local[h].baseDictObj){j=e.local[h].item;f=dictionary.GetObject(j.aID,true);f.PushInstanceRef(j)}}}if(d.aType==TYPE_PROCEDURE){d.Run(this)}else{var a=$.extend(true,{},g);a.fromHierarchy=true;a.hierChildren=e.children;a.hierObj=this;a.hierParams=g;if(!d.Run(a)){return false}}if(!e.baseDictObj&&b){b.PopInstanceRef()}if($.isArray(e.local)){for(h=0;h<e.local.length;h++){if(e.local[h].item&&!e.local[h].baseDictObj){j=e.local[h].item;f=dictionary.GetObject(j.aID,true);f.PopInstanceRef()}}}}}return true};DictionaryObject_Hierarchy.prototype.toString=function(){return hierarchy.toString(this)};DictionaryObject_Hierarchy.prototype.val=function(){return this.toString()};DictionaryObject_Hierarchy.prototype.clear=function(){hierarchy.clear(this)};DictionaryObject_Hierarchy.prototype.Run=function(b){if(!this.Load()){return false}if(this.aDefinition.settings.exitprompt){if(b==undefined){b={exitOnEmpty:true}}else{if(!b.exitOnEmpty){b.exitOnEmpty=true}}}hierarchy.enter(this);var a=this.GoTree(this.aDefinition.tree,b);hierarchy.leave();return a};var NO_HIER_ERR="No current hierarchy";var hierarchy={_isHierarchy:true,stack:[],reset:function(){this.stack=[]},clear:function(d){var b=d?d:this.current();if(!b){hardError(NO_HIER_ERR);return}var a=function(e){for(var g=0;g<e.length;g++){var f=e[g];if((f.item.aType!=TYPE_HIERARCHY)&&(f.item.aType!=TYPE_PROCEDURE)){f.item.Clear()}if(f.children){a(f.children)}}};a(b.aDefinition.tree)},toString:function(d,f){if(typeof d=="string"){f=d;d=null}var b=d?d:this.current();if(!b){hardError(NO_HIER_ERR);return}if(!f){f="default"}function e(h){var n,m,g;var k="";for(n=0;n<h.length;n++){var j=h[n];if(j.selected()){var l=j.item;if(f=="default"){k+="<"+l.aName+" value='"+l.val()+"'";if(l.flatProps&&$.isArray(l.flatProps._hierexport)){for(m=0;m<l.flatProps._hierexport.length;m++){g=l.flatProps[l.flatProps._hierexport[m]];k+=" "+l.flatProps._hierexport[m]+"='"+HandleChars(g!=null?g:"")+"'"}}if(l.aValueProps&&l.aValueProps.general&&l.aValueProps.general._hierexport){for(m=0;m<l.aValueProps.general._hierexport.length;m++){g=l.GetValueProp(l.aValueProps.general._hierexport[m],-1);k+=" "+l.aValueProps.general._hierexport[m]+"='"+HandleChars(g!=null?g:"")+"'"}}if(j.children){k+=">\n"+e(j.children)+"</"+l.aName+">"}else{k+=" />"}k+="\n"}else{if(f=="legacy"){k+="<node name='"+l.aName+"' hierarchy='"+b.aName+"'>\n";if(l.flatProps&&$.isArray(l.flatProps._hierexport)){for(m=0;m<l.flatProps._hierexport.length;m++){g=l.flatProps[l.flatProps._hierexport[m]];k+="<prop name='"+l.flatProps._hierexport[m]+"' value='"+HandleChars(g!=null?g:"")+"'/>\n"}}k+="<value name='"+l.val()+"'>\n";if(l.aValueProps&&l.aValueProps.general&&l.aValueProps.general._hierexport){for(m=0;m<l.aValueProps.general._hierexport.length;m++){g=l.GetValueProp(l.aValueProps.general._hierexport[m],-1);k+="<prop name='"+l.aValueProps.general._hierexport[m]+"' value='"+HandleChars(g!=null?g:"")+"' />\n"}}k+="</value>\n";if(j.children){k+=e(j.children)}k+="</node>\n"}}}}return k}var a="<?xml version='1.0' encoding='ISO-8859-1'?>\n";if(f=="default"){a+="<"+b.aName+">\n"+e(b.aDefinition.tree)+"</"+b.aName+">"}else{if(f=="legacy"){a+="<log>\n"+e(b.aDefinition.tree)+"</log>"}else{hardError("Invalid hierarchy encoding ["+f+"]");return}}return a},enter:function(a){this.stack.push(a)},leave:function(){if(this.stack.length>1){this.stack.pop()}},current:function(){if(this.stack.length==0){return null}else{return this.stack[this.stack.length-1]}},idxToNode:function(a){var d=this.current();if(!d){hardError(NO_HIER_ERR);return}var f;function b(g){for(var k=0;k<g.length;k++){var j=g[k];if(j.selected()){f++;if(f==a){return j}if(j.children){var h=b(j.children);if(h){return h}}}}return null}f=0;var e=b(d.aDefinition.tree);if(!e){hardError("Hierarchy index is out of bounds ["+a+"]");return}return e},count:function(){var b=this.current();if(!b){hardError(NO_HIER_ERR);return}function a(e){var d=0;for(var g=0;g<e.length;g++){var f=e[g];if(f.selected()){d++;if(f.children){d+=a(f.children)}}}return d}return a(b.aDefinition.tree)}};function DictionaryObject_Cat(b,d,a){DictionaryObject_Cat.baseConstructor.call(this,b,d,TYPE_CATEGORY,a);this.loaded=true}ObjectExtend(DictionaryObject_Cat,DictionaryObject);DictionaryObject_Cat.prototype.toString=function(){return DictionaryObject_Cat.superClass.toString.call(this)};DictionaryObject_Cat.prototype.Clear=function(a){DictionaryObject_Cat.superClass.Clear.call(this)};DictionaryObject_Cat.prototype.Populate=function(){DictionaryObject_Cat.superClass.Populate.call(this,null)};DictionaryObject_Cat.prototype.Load=function(){return true};DictionaryObject_Cat.prototype.getAllowedClasses=function(){if(!this.objInfo.hasOwnProperty("allowed")||this.objInfo.allowall){var d,b;var a=[-TYPE_PROCEDURE,-TYPE_DIALOG,-TYPE_VARIABLE,-TYPE_TXTPROCESSOR,-TYPE_REPORT];for(d=0;d<dictionary.aDictionary.length;d++){b=dictionary.aDictionary[d];if(((b.aType==TYPE_LIST)||(b.aType==TYPE_NUMERIC)||(b.aType==TYPE_BOOLEAN)||(b.aType==TYPE_DATE)||(b.aType==TYPE_TEXT))&&(!b.flatProps.pid)){a.push(b.aID)}}return a}else{if($.isArray(this.objInfo.allowed)){return this.objInfo.allowed}else{return[]}}};var lastElementID=0;function GetNextElementID(){return("TTV-"+(++lastElementID))}function UIsetup(){msgFlashDiv=$("<div></div>").addClass("ui-widget ui-corner-all xrui-message-ovl").appendTo(document.body).html("hello World").hide();$(window).resize(function(){var a=($(window).width()-msgFlashDiv.outerWidth())/2;msgFlashDiv.css("left",(a<0?0:a)+"px")}).trigger("resize")}function ClearUI(dlgID,preview,supressUIadd){var c;if(currentDlg){currentDlg.free()}var aDiv=uidiv;if(aDiv!=null){for(c=aDiv.childNodes.length-1;c>=0;c--){aDiv.removeChild(aDiv.childNodes[c])}}if(isMobile){$("#mobheader").hide()}$("#"+popupIdBkgnd).unbind("click");if(!preview&&!customStartup&&!isEditor){if(!appSettings.noStyleProps){document.body.style.backgroundColor=appSettings.bgColor}document.title=appSettings.title}dialog_offset_y=0;aDiv=document.getElementById("xrui_prev");if(aDiv){for(c=aDiv.childNodes.length-1;c>=0;c--){aDiv.removeChild(aDiv.childNodes[c])}var s="";if(!preview){for(c=0;c<activeDialogStack.length-1;c++){var ss="";if(typeof(activeDialogStack[c])=="number"){var o=dictionary.GetObject(activeDialogStack[c]);if(o.aType==TYPE_DIALOG){ss=eval(o.aDefinition.caption)}else{if(o.aType==TYPE_REPORT){ss=o.aProps.description}}if(ss==""){ss=o.aName}}else{ss=activeDialogStack[c]}s+="<div class='prevdialogtitle'>&nbsp;<img src='"+xrkb_include_folder+"images/application_form.png'>&nbsp;"+ss+"</div>"}}dialog_offset_y+=((activeDialogStack.length-1)*26);if(aDiv){aDiv.innerHTML=s;if(s!=""){MakeVisible(aDiv)}else{MakeInvisible(aDiv)}}}HideDialogPage();currentDlg=null;if(!preview&&!supressUIadd){replayStack.RenderingUI(dlgID)}}function AttachElement2(a,b){if(b==null){b=uidiv}b.appendChild(a)}function AddDiv2(e,k,g,a,j,b,f){var d=document.createElement("div");if(g){d.className=g}d.id=GetNextElementID();if(a&&j&&b&&f){d.style.position="absolute";d.style.left=a+"px";d.style.top=j+"px";d.style.width=b+"px";d.style.height=f+"px";d.style.overflow="hidden"}if(k!==""){spn=document.createElement("span");spn.id=GetNextElementID();spn.innerHTML=k;d.appendChild(spn)}AttachElement2(d,e);return d}var defaultUI={_dialog:{usage:[],helpdoneinlabel:false,left:0,top:0,width:450,height:280,hascaption:true,centered:true,caption:"''+ConvertForDisplay(Dialog_GetTiedDescription(),false,false)+''",color:undefined,onenter:0,onexit:0,oncanexit:0,initialupdates:true,timeout:0,bkgndimage:"",resizable:false,font:{name:"Microsoft Sans Serif",size:13,isBold:false,isItalic:false},cssclassname:{name:"",dowysiwyg:true},controls:[{aID:1,aType:"label",aName:"control_label",left:24,top:8,width:392,height:40,tabno:0,borderstyle:"none",bkgndstyle:"transparent",justification:"left",color:"F0F0F0",textcolor:"000000",bordercolor:"646464",font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},caption:"''+ConvertForDisplay(Dialog_GetTiedDescription(true),false,true)+''",visible:true,ishtml:false,showscroll:false,attachmentobj:0,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},readonly:false},{aID:2,aType:"button",aName:"control_ok",left:248,top:200,width:80,height:40,tabno:0,caption:"'Next'",buttontype:"ok",visible:true,isarea:false,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},allowinvalid:0,allowincomplete:0,exitcheck:true,helpatt:0,helpid:0,macro:0,macroautook:false,briefhow:false,url:"",key:"none",applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},enabled:true},{aID:3,aType:"button",aName:"control_back",left:128,top:200,width:80,height:40,tabno:0,caption:"'Previous'",buttontype:"back",visible:true,isarea:false,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},allowinvalid:0,allowincomplete:0,exitcheck:true,helpatt:0,helpid:0,macro:0,macroautook:false,briefhow:false,url:"",key:"none",applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},enabled:true}],webinfhtmlpage:undefined,instanceatts:[],rules:false},_dialog_list:[{aID:4,aType:"listbox",aName:"control_list",left:150,top:40,width:150,height:120,tabno:0,tieditem:0,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},multiselmin:0,multiselmax:255,multiexcludegrey:false,excludemode:"showinvalid",visible:true,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},validation:"",showsearch:false,emptytext:"",showlabel:false,label:"",helpposition:"'top right'"}],_dialog_dropdown:[{aID:4,aType:"dropdown",aName:"control_list",left:150,top:40,width:150,height:120,tabno:0,tieditem:0,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},multiselmin:0,multiselmax:255,multiexcludegrey:false,excludemode:"showinvalid",visible:true,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},validation:"",showsearch:false,emptytext:"",showlabel:false,label:"",helpposition:"'top right'"}],_dialog_num:[{aID:4,aType:"number",aName:"control_numeric",left:180,top:80,width:90,height:24,tabno:0,tieditem:0,style:"editbox",scrollrangemin:0,scrollrangemax:100,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},visible:true,hasborder:true,color:"FFFFFF",textcolor:"000000",validation:"",applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},readonly:false,showlabel:true,label:""}],_dialog_bool:[{aID:4,aType:"radiobtn",aName:"control_boolean",left:184,top:80,width:72,height:64,tabno:0,tieditem:0,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},multiselmin:0,multiselmax:255,multiexcludegrey:false,excludemode:"showinvalid",visible:true,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},validation:"",showsearch:false,emptytext:"",hascaption:true,helpposition:"'top right'"}],_dialog_bool_mob:[{aID:4,aType:"listbox",aName:"control_boolean",left:150,top:40,width:150,height:120,tabno:0,tieditem:0,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},multiselmin:0,multiselmax:255,multiexcludegrey:false,excludemode:"showinvalid",visible:true,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},validation:"",showsearch:false,emptytext:"",showlabel:false,label:"",helpposition:"'top right'"}],_dialog_date:[{aID:4,aType:"date",aName:"control_date",left:155,top:80,width:140,height:24,tabno:0,tieditem:0,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},visible:true,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},validation:"",jqueryinit:{showOtherMonths:true,selectOtherMonths:true,showOn:"button",buttonImage:((!NODEJS&&window.hasOwnProperty("xrkb_include_folder"))?xrkb_include_folder:"")+"images/calendar.png",buttonImageOnly:true,buttonText:"Click to select date"},showlabel:true,label:""}],_dialog_text:[{aID:4,aType:"textedit",aName:"control_text",left:24,top:80,width:400,height:24,tabno:0,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},tieditem:0,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},validation:"",readonly:false,showlabel:true,label:""}],_dialog_var_num:[{aID:4,aType:"arrayedit",aName:"control_variable",left:180,top:80,width:90,height:24,tabno:0,font:{name:"Microsoft Sans Serif",size:13,isBold:false,isItalic:false},tieditem:0,dim1:1,dim2:1,obligatory:true,ispassword:false,visible:true,multiline:false,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},onchange:0,helptext:"",maskstring:"",controlpropname:undefined,readonly:false,validation:"",showlabel:true,label:""}],_dialog_var_text:[{aID:4,aType:"arrayedit",aName:"control_variable",left:24,top:80,width:400,height:24,tabno:0,font:{name:"Microsoft Sans Serif",size:13,isBold:false,isItalic:false},tieditem:0,dim1:1,dim2:1,obligatory:true,ispassword:false,visible:true,multiline:false,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},onchange:0,helptext:"",maskstring:"",controlpropname:undefined,readonly:false,validation:"",showlabel:true,label:""}],_dialog_report:[{aID:4,aType:"label",aName:"control_report",left:24,top:26,width:400,height:150,tabno:0,borderstyle:"none",bkgndstyle:"transparent",justification:"left",color:"F0F0F0",textcolor:"000000",bordercolor:"646464",font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},caption:"replaced from appSettings",visible:true,ishtml:true,showscroll:true,attachmentobj:0,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true}}],_dialog_final:[{aID:4,aType:"label",aName:"control_final",left:24,top:66,width:392,height:66,tabno:0,borderstyle:"none",bkgndstyle:"transparent",justification:"left",color:"F0F0F0",textcolor:"000000",bordercolor:"646464",font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},caption:"replaced from appSettings",visible:true,ishtml:true,showscroll:false,attachmentobj:0,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true}}],_dialog_arraylist:[{aID:4,aType:"arraylist",aName:"control_arraylist",left:104,top:192,width:64,height:64,tabno:0,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},tieditem:0,indexvariable:0,obligatory:true,style:"listbox",multisel:false,visible:true,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},helptext:"",emptytext:"",validation:"",showlabel:true,label:""}],emptyDialog:function(b){var a=$.extend(true,{},this._dialog);if(!b){a.controls.splice(0,a.controls.length);a.caption="Title Text"}return a},emptyCtrl:function(a){switch(a){case"label":return{aID:0,aType:"label",aName:"",left:24,top:8,width:392,height:40,tabno:0,borderstyle:"none",bkgndstyle:"transparent",justification:"left",color:"F0F0F0",textcolor:"000000",bordercolor:"646464",font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},caption:"Label",visible:true,ishtml:true,showscroll:false,attachmentobj:0,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},readonly:false};case"button":return{aID:0,aType:"button",aName:"",left:248,top:200,width:80,height:40,tabno:0,caption:"'Next'",buttontype:"ok",visible:true,isarea:false,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},allowinvalid:0,allowincomplete:0,exitcheck:true,helpatt:0,helpid:0,macro:0,macroautook:false,briefhow:false,url:"",key:"none",applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},enabled:true};case"columns":return{aID:0,aType:"columns",aName:"",numcolumns:2,autocollapse:false,autocollapsewidth:650,tabsheets:[{isvisible:true,controls:[]},{isvisible:true,controls:[]}]};case"image":return{aID:0,aType:"image",aName:"",left:32,top:168,width:48,height:48,imagepath:"",drawmode:"clipped",visible:true,cssclassname:{name:"",dowysiwyg:true},alttext:"",zoomable:true};case"container":return{aID:0,aType:"container",aName:""};case"panels":return{aID:0,aType:"panels",aName:"",controltype:"panels",showmarkers:true,tabsheets:[{id:1,caption:"Page 1",isvisible:true,showheader:true,initialshrunk:false,cssname:"",contentcssname:"",onchange:0,controls:[]},{id:2,caption:"Page 2",isvisible:true,showheader:true,initialshrunk:false,cssname:"",contentcssname:"",onchange:0,controls:[]}]};default:alert("Unknown control type : "+a)}},emptyControlForObj:function(b,a){var e,d;switch(b.aType){case TYPE_LIST:switch(a){case"dropdown":e=$.extend(true,{},this._dialog_dropdown[0]);break;case"grid":e={aID:0,aType:"grid",aName:"",tabno:0,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},color:"FFFFFF",tieditem:0,hascaption:true,visible:true,dynamicvals:true,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},rowheight:0,validation:"",controltype:"standard",showlabel:true,label:""};break;case"buttonset":e=$.extend(true,{},this._dialog_list[0]);e.aType="buttonset";break;case"imgmap":e={aID:0,aType:"imgmap",aName:"",tabno:0,imagewidth:0,imageheight:0,imagepath:"",cssclassname:{name:"",dowysiwyg:true},alttext:"",tieditem:0,imagemap:[]};break;default:e=$.extend(true,{},this._dialog_list[0])}if(a!="imgmap"){e.showlabel=true}return e;case TYPE_NUMERIC:switch(a){case"slider":e={aID:0,aType:"slider",aName:"",tabno:0,tieditem:0,scrollrangemin:0,scrollrangemax:100,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},cssclassname:{name:"",dowysiwyg:true},showlabel:true,label:""};break;default:e=$.extend(true,{},this._dialog_num[0])}return e;case TYPE_BOOLEAN:switch(a){case"dropdown":e=$.extend(true,{},this._dialog_dropdown[0]);break;case"checkbox":e={aID:0,aType:"checkbox",aName:"",tabno:0,tieditem:0,font:{name:"MS Shell Dlg",size:11,isBold:false,isItalic:false},color:"F0F0F0",textcolor:"000000",caption:"Caption Text",selectablegrey:false,value:0,visible:true,applydialogfont:true,cssclassname:{name:"",dowysiwyg:true},validation:"",showlabel:true,label:"",jqmattributes:""};break;case"buttonset":e=$.extend(true,{},this._dialog_list[0]);e.aType="buttonset";break;case"imgmap":e={aID:0,aType:"imgmap",aName:"",tabno:0,imagewidth:0,imageheight:0,imagepath:"",cssclassname:{name:"",dowysiwyg:true},alttext:"",tieditem:0,imagemap:[]};break;default:e=$.extend(true,{},this._dialog_bool_mob[0])}return e;case TYPE_TEXT:return $.extend(true,{},this._dialog_text[0]);case TYPE_DATE:return $.extend(true,{},this._dialog_date[0]);case TYPE_VARIABLE:e=$.extend(true,{},this._dialog_arraylist[0]);e.showlabel=true;e.style=a;return e;default:return null}},render:function(b,a){var l=this.emptyDialog(true);var g=null;var f=isMobile;var k;if(typeof b=="string"){switch(b){case"final":g=$.extend(true,[],this._dialog_final);l.caption=appSettings.title;f=true;for(k=0;k<g.length;k++){if(g[k].aName=="control_final"){g[k].caption="<img style='vertical-align: middle' width='64' height='64' src='"+xrkb_include_folder+"images/tick.png'> "+a.caption;break}}for(k=0;k<l.controls.length;k++){if(l.controls[k].aName=="control_ok"){l.controls[k].caption="Restart";l.controls[k].buttontype="restart";break}}break}}else{switch(b.aType){case TYPE_LIST:g=$.extend(true,[],this._dialog_list);break;case TYPE_NUMERIC:g=$.extend(true,[],this._dialog_num);break;case TYPE_BOOLEAN:if(!isMobile){g=$.extend(true,[],this._dialog_bool)}else{g=$.extend(true,[],this._dialog_bool_mob)}break;case TYPE_DATE:g=$.extend(true,[],this._dialog_date);break;case TYPE_TEXT:g=$.extend(true,[],this._dialog_text);break;case TYPE_VARIABLE:switch(b.varType){case VARTYPE_NUM:g=$.extend(true,[],this._dialog_var_num);break;default:g=$.extend(true,[],this._dialog_var_text)}break;case TYPE_REPORT:g=$.extend(true,[],this._dialog_report);f=true;for(k=0;k<g.length;k++){if(g[k].aName=="control_report"){g[k].caption=b.GetText(true);break}}l.width=650;var m=l.controls[2].left-l.controls[1].left;l.controls[1].left=(l.width-m-l.controls[2].width)/2;l.controls[2].left=l.controls[1].left+m;var j=$("<div></div>").css({width:(l.width-50)+"px",left:"-10000px",position:"absolute","font-family":"Microsoft Sans Serif","font-size":"13px"}).html(b.GetText(true)).appendTo("body");var e=j.outerHeight(true);j.remove();if(e+156>$(window).height()){e=$(window).height()-156}l.height=l.height-150+e;for(k=0;k<l.controls.length;k++){if(l.controls[k].top>26){l.controls[k].top=l.controls[k].top-150+e}}for(k=0;k<g.length;k++){if(g[k].aName=="control_report"){g[k].height=e;g[k].width=l.width-50;break}}if(b.aProps.timeout){l.timeout=b.aProps.timeout}break}}if(g!=null){for(k=0;k<g.length;k++){l.controls.splice(1+k,0,g[k])}if(f){l.controls.splice(0,1)}}if(replayStack.isFirstDialog()){for(k=0;k<l.controls.length;k++){if(l.controls[k].aName=="control_back"){l.controls[k].enabled=false;break}}}return l}};function RenderObject(a){activeDialogStack[activeDialogStack.length]=a.aID;var e="";var b=null;var d;switch(a.aType){case TYPE_LIST:case TYPE_NUMERIC:case TYPE_BOOLEAN:case TYPE_DATE:case TYPE_TEXT:case TYPE_VARIABLE:case TYPE_REPORT:if(!currentDlg||currentDlg.aID!=a.aID){ClearUI(a.aID,false,replayStack.LastOperationWasValidatedOK());var f=defaultUI.render(a);d={aID:a.aID,tiedObj:a};if(wrapperOptions.nodejs){throw new inferenceIssue(PASSBACK_DIALOG,a.aName)}currentDlg=XRdialog.create($("#xrui"),f,d);currentDlg.render();currentDlg.populate();currentDlg.focus(a.aID)}else{currentDlg.populate()}break;case TYPE_DIALOG:d={aID:a.aID,tiedObj:null};ClearUI(aTask.aID,false,replayStack.LastOperationWasValidatedOK());currentDlg=XRdialog.create($("#xrui"),a.aDefinition,d);currentDlg.render();currentDlg.populate();currentDlg.focus();break;default:alert("Unsupported default capture type")}}function RenderFinal(){var d=appSettings.finalURL;if((d===undefined)||(d===null)){d=""}else{d=d.toUpperCase()}if(d=="RESTART"){replayStack.Initialize();Go();return}var b=false;if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))||(navigator.userAgent.match(/iPad/i))){b=true}if(appEmbedded){if(b){window.location="fake$End"}else{if(navigator.appVersion.indexOf("Win")!=-1){window.external.Notify("<method><name>End</name></method>")}else{alert("<method><name>End</name></method>")}}}else{if(d!=""&&!isEditor){window.location=appSettings.finalURL}else{activeDialogStack[activeDialogStack.length]="Final";if(d!=""){d="Once deployed, the user would be redirected to...<br /><div style='text-align: center; font-weight: bold; color: #a00; margin: 32px 0;'>"+d+"</div>"}else{d=getTranslation("final_text","The End!");if(d===undefined){d="End Of Inference"}}var e=defaultUI.render("final",{caption:d});var a={aID:0,tiedObj:null};if(wrapperOptions.nodejs){throw new inferenceIssue(PASSBACK_DIALOG,"final")}ClearUI(0);currentDlg=XRdialog.create($("#xrui"),e,a);currentDlg.render();currentDlg.populate()}}}function RenderError(b){var a="<img style='vertical-align: middle' width='64' height='64' src='"+xrkb_include_folder+"images/noEntery.png'> "+ConvertForDisplay(b,true);ShowModal(a,"An Error Has Occurred","")}var currentProcID=0;function RenderDebug(h,d,b){currentProcID=h;var g=d.indexOf("_|_");var e="";var f="";var a=false;if(g>=0){f=d.substr(g+3);d=d.substr(0,g);g=f.indexOf("_|_");if(g>=0){e=f.substr(g+3);f=f.substr(0,g)}g=e.indexOf("_|_");if(g>=0){a=(e.substr(g+3).toUpperCase()=="HTML");e=e.substr(0,g)}}if(f.length===0){f="Information"}if(!a){d=ConvertForDisplay(d,true)}if(!b){ShowModal(d,f,e,ModalCallback)}else{return d}}function ModalCallback(){if(currentProcID!=ADHOC_DIALOG_PSEUDOID){DebugOK(currentProcID)}}function RenderTreePage(aFunc,aTreeID){activeDialogStack[activeDialogStack.length]="Tree Web Page";ClearUI(aTreeID);AddDiv2(null,"&nbsp;Tree Page","capturetitle");var s=eval(aFunc+"()")+"<br><br><input type='button' class='capturebutton' value='"+OK_TEXT+"' onclick='DebugOK("+aTreeID+")'>";AddDiv2(null,s,"informationbody")}function SetValue2(b,a){replayStack.Add(b,REPLAY_CHANGEEVENT,b,a,PerformOK);Go()}function PerformOK(b){var a=replayStack.PopReplay(b.pauseID);if(a==REPLAYPOP_HANDLED){return true}else{if(a==REPLAYPOP_CURRENT){replayStack.Add(b.pauseID,REPLAY_OK);replayStack.Add(b.pauseID,REPLAY_OK);throw new inferenceIssue(PASSBACK_LOOP)}else{hardError("Unknown replay pop return ["+a+"]");return}}}function CheckValue(a){var b=document.getElementById("cb"+a);if(b){b.checked=true}}function SetMultiValues(g){var e=dictionary.GetObject(g);var b=[];for(var f=0;f<e.aValues.length;f++){var d=document.getElementById("cb"+e.aValues[f].aID);if(d!=null){if(d.checked){b[b.length]=e.aValues[f].aID}}}if(b.length===0){if(!e.flatProps.allowblank){alert("Please select a value!");return}b=PSEUDO_VALUE_EMPTY}replayStack.Add(g,REPLAY_CHANGEEVENT,g,b,PerformOK);Go()}function SetValueNum(f,a){var e=dictionary.GetObject(f);var d=document.getElementById(a);if(d!=null){var b=$(d).val();if(b.length===0&&e.flatProps.allowblank){b=PSEUDO_VALUE_EMPTY}else{if(b==""||!IsNumber(b)){alert("You must enter a valid value!");document.getElementById(a).focus();return false}b=parseFloat(b)}replayStack.Add(f,REPLAY_CHANGEEVENT,f,b,PerformOK);Go()}}function SetValueDate(g,a){var d=document.getElementById(a);if(d==null){return false}var f=dictionary.GetObject(g);var b=$(d).val();var e;if((b=="**/**/****")&&(f.flatProps.allowblank)){e=PSEUDO_VALUE_EMPTY}else{e=EncodeDate(b);if(isNaN(e)){alert("You must enter a valid value!");document.getElementById(a).focus();return false}}replayStack.Add(g,REPLAY_CHANGEEVENT,g,e,PerformOK);Go()}function DebugOK(a){replayStack.Add(a,REPLAY_CRITICALDONE);Go()}function SetValueVar(f,a){var e=dictionary.GetObject(f);var d=document.getElementById(a);if(d!=null){var b=d.value;if(e.aType==TYPE_TEXT){if((b.length==0)&&(e.flatProps.allowblank)){b=PSEUDO_VALUE_EMPTY}else{if(b==""){alert("You must enter a valid value!");document.getElementById(a).focus();return false}}}replayStack.Add(f,REPLAY_CHANGEEVENT,f,b,PerformOK);Go()}}function PopulatePopupReport(){if(popupReportObject){var a=popupReportObject;popupReportObject=null;return{text:popupReportText,object:a}}return null}function Go(d,l){if(delayedGoTimer){clearTimeout(delayedGoTimer);delayedGoTimer=null}dictionary.Clear(true);dictionary.ResetInstanceRefs();lastDialogInstanceID=0;replayStack.Reset();cookieCache.Clear();if(!wrapperOptions.nodejs&&msgFlashDiv){msgFlashDiv.hide()}hierarchy.reset();activeDialogStack.length=0;capturedAtts.length=0;lineOfReasoning.length=0;capturingAtts=true;baseDialogs.length=0;currentConditionalObj=null;lastErr=null;stk_reset();replayProtection.reset();working=true;performedGo=true;if(jsAjax&&!wrapperOptions.nodejs){var g={session:JSON.stringify(jsAjaxSessionID),replayStack:JSON.stringify(replayStack.aReplay)};if(l){g.options=JSON.stringify(l)}$.ajax({url:"xpertrule.js",type:"POST",dataType:"json",data:g,success:function(v){var w,q,p;replayStack.Initialize();if(!v.hasOwnProperty("state")){alert("Unknown server return code : "+v)}else{if(v.state!="ERROR"){jsAjaxSessionID=v.session;replayStack.replayPassedUIs=v.currentUI;replayStack.SetBookmark(replayStack.replayPassedUIs)}switch(v.state){case"DIALOG":if(v.data){for(w=0;w<v.data.length;w++){p=_dgo(v.data[w].id);if(!p){alert("Unknown object id ["+v.data[w].id+"]");break}if(p.aType==TYPE_VARIABLE){if(v.data[w].val==PSEUDO_VALUE_EMPTY){p.Clear()}else{p.data=v.data[w].val}}else{p.SetValue(v.data[w].val);if(p.aType==TYPE_LIST||p.aType==TYPE_BOOLEAN){p.ClearInvalid();p.SetValueInValid(v.data[w].inv)}}}}if(v.name=="tree_dialog"){if(v.def){q={aID:v.def.taskID,tiedObj:null};ClearUI(v.def.taskID,false,replayStack.LastOperationWasValidatedOK());currentDlg=XRdialog.create($("#xrui"),v.def,q);if(v.props){for(w=0;w<v.props.length;w++){_SetTreeDialogDef(v.def,v.props[w].cntrl,v.props[w].prop,v.props[w].val)}}currentDlg.render()}currentDlg.populate()}else{var n=_dgobn(v.name);if(!n){alert("Unknown dialog ["+v.name+"]");break}if(v.props){for(w=0;w<v.props.length;w++){var e="";var y=v.props[w].prop;var t=null;var r=v.props[w].val;var m=null;e=v.props[w].cntrl;if(e!=""){var x=e.split(".");if(x.length>1){e=x[0];m=x[1];t=y;y="tabsheets"}}n.SetDialogControlValue(e,y,r,null,t,m)}}n.currentTiedObj=v.tied;if(!currentDlg||currentDlg.aID!=n.aID||(n.currentTiedObj&&currentDlg.tiedObj.aID!=n.currentTiedObj)){if(currentDlg){currentDlg.free()}q={aID:n.aID,tiedObj:v.tied?_dgo(v.tied):null};ClearUI(n.aID,false,true);currentDlg=XRdialog.create($("#xrui"),n.aDefinition,q);currentDlg.render();n.dialogUI=currentDlg;if(n.aDefinition.onshow){p=_dgo(n.aDefinition.onshow);if(p){p.Run()}}}currentDlg.populate()}break;case"OBJECT":var u=_dgo(v.name);if(!u){alert("Unknown object ["+v.name+"]");break}if(v.data){for(w=0;w<v.data.length;w++){p=_dgo(v.data[w].id);if(!p){alert("Unknown object id ["+v.data[w].id+"]");break}if(v.data[w].val==PSEUDO_VALUE_EMPTY){continue}if(p.aType==TYPE_VARIABLE){if(v.data[w].val==PSEUDO_VALUE_EMPTY){p.Clear()}else{p.data=v.data[w].val}}else{p.SetValue(v.data[w].val)}}}RenderObject(u);break;case"DEBUG":RenderDebug(v.name,v.message);break;case"END":RenderFinal();break;case"ERROR":alert("An error occured : "+v.description);break;default:alert("Unknown server return state : "+v.state);break}}}});return}try{if(!TestTick()){return}if(appSettings.startObjectID==0){hardError("No start object defined");return}else{urlParams.Populate();if(appEmbedded){var k=Cmd_Phone(0,"Initialize",-1,[]);if(k&&(k.length>0)){try{k=$.parseJSON(k)}catch(j){hardError("Error parsing Initialize JSON ["+k+"] Error = ["+j+"]");return}xpertrule.setValuesWithObject(k)}}else{var a=replayStack.PopReplay(0);if(a==REPLAYPOP_CURRENT){if(wrapperOptions){if(wrapperOptions.startCallback){xpertrule.inStartup=true;wrapperOptions.startCallback(xpertrule);xpertrule.inStartup=false}}if(!wrapperOptions.nodejs){try{window.external.start()}catch(j){}}replayStack.Add(0,REPLAY_OK);_hb.su(function(){Go()});throw new inferenceIssue(PASSBACK_WAIT)}}var b=_dgo(appSettings.startObjectID);if(b==null){hardError("Unknown start object");return}else{b.Run()}}throw new inferenceIssue(PASSBACK_END,true)}catch(j){if(j instanceof inferenceIssue){if(wrapperOptions.nodejs){switch(j.aState){case PASSBACK_LOOP:return Go();case PASSBACK_WAIT:return;case PASSBACK_END:replayStack.RenderingUI(0);break}if($.isFunction(wrapperOptions.callback)){wrapperOptions.callback(j)}return j}switch(j.aState){case PASSBACK_PAUSE:var h=_dgo(j.aValue);RenderObject(h);break;case PASSBACK_ERROR:if($.isFunction(wrapperOptions.errorCallback)){wrapperOptions.errorCallback(xpertrule,j.aValue)}else{RenderError(j.aValue)}break;case PASSBACK_DEBUG:if($.isFunction(wrapperOptions.debugCallback)){wrapperOptions.debugCallback(xpertrule,RenderDebug(j.aValue,j.aExtra,true));DebugOK(j.aValue)}else{RenderDebug(j.aValue,j.aExtra)}break;case PASSBACK_PAUSETREEPAGE:RenderTreePage(j.aValue,j.aExtra);break;case PASSBACK_END:cookieCache.Write();InferenceEnd();_hb.ed();if(wrapperOptions){if(wrapperOptions.endCallback){if(wrapperOptions.endCallback(xpertrule,j.aValue)){break}}}RenderFinal();try{if(!wrapperOptions.nodejs){window.external.complete()}}catch(j){}break;case PASSBACK_WAIT:if($.isFunction(d)){d()}break;case PASSBACK_LOOP:Go();break;case PASSBACK_LOADIFRAME:LoadDialogPage2(j.aValue);break;case PASSBACK_DIALOG:if($.isFunction(wrapperOptions.pauseCallback)){wrapperOptions.pauseCallback(xpertrule,j.aValue);break}default:RenderError("Unknown inference state : ["+j.aState+"]");break}replayStack.SetBookmark(replayStack.replayPassedUIs);return j.aState}else{if(isEditor){throw j}if(wrapperOptions.nodejs){var f=new inferenceIssue(PASSBACK_ERROR,j);if($.isFunction(wrapperOptions.callback)){wrapperOptions.callback(f)}return f}else{if(j.hasOwnProperty("message")){RenderError(j.message)}else{RenderError(j)}return PASSBACK_ERROR}}}}function Set_ExtCssFile(b){if(b!==""){if($("link[rel=stylesheet][href='"+b+"']").size()==0){var a=document.getElementsByTagName("head")[0];var d=document.createElement("link");d.type="text/css";d.rel="stylesheet";d.href=b;d.media="screen";a.appendChild(d)}}}function loadStyleSheet(k,g,j){var h=document.getElementsByTagName("head")[0];var f=document.createElement("link");f.setAttribute("href",k);f.setAttribute("rel","stylesheet");f.setAttribute("type","text/css");f.setAttribute("media","screen");var e,b,a,d;if("sheet" in f){e="sheet";b="cssRules"}else{e="styleSheet";b="rules"}a=setInterval(function(){try{if(f[e]&&(isChrome||(f[e][b]&&(f[e][b].length>0)))){clearInterval(a);clearTimeout(d);g.call(j||window,true,f)}}catch(l){}finally{}},10);d=setTimeout(function(){clearInterval(a);clearTimeout(d);g.call(j||window,false,f)},3000);h.appendChild(f)}function loadLanguage(a,e){var d=setInterval(function(){try{if($.isPlainObject(lang)){clearInterval(d);clearTimeout(b);e(true)}}catch(f){}finally{}},10);var b=setTimeout(function(){clearInterval(d);clearTimeout(b);e(false)},500);Set_ExtJSFile(a)}function Set_ExtJSFile(a){if(a!=""){if($("script[src='"+a+"']").size()==0){var b=document.createElement("script");b.type="text/javascript";b.src=a;b.async=true;document.body.appendChild(b)}}}function XR_Startup(g,f){try{if(isMobile){$.mobile.ajaxEnabled=false}if(!appSettings){return}}catch(h){var d=document.getElementById("xruipage");if(d){d.style.display="none"}d=document.getElementById("loading_div");d.innerHTML="&nbsp;&nbsp;&nbsp;An error has occurred!<br />&nbsp;&nbsp;&nbsp;Please contact the administrator";d.style.color="#F00";return}customStartup=(f!=undefined);var b=f&&f.nodejs;XR_Setup(f);if(!b){if(!window.xrkb_include_folder){window.xrkb_include_folder=""}XR_DOMsetup(g);var a="";if(!isEditor&&appSettings.hasOwnProperty("customcss")&&(typeof appSettings.customcss=="string")){a=$.trim(appSettings.customcss)}if(a==""){a=appSettings.externalCSS}else{a=xrkb_include_folder+"assets/"+a}if(a&&(a!="")){if((a.substr(0,1)!="/")&&wrapperOptions&&wrapperOptions.subFolder){a=wrapperOptions.subFolder+a}loadStyleSheet(a,function(){XR_Startup2(f)})}else{XR_Startup2(f)}}else{XR_Startup2(f)}}function XR_Startup2(d){var b=d&&d.nodejs;if(!b&&!isEditor){if(appSettings.language&&(appSettings.language!="")){var a=appSettings.language;if(a.split(".").pop()=="js"){loadLanguage(xrkb_include_folder+"assets/"+a,XR_Startup3)}else{if(a.substr(0,1)=="_"){XR_Startup3()}else{loadLanguage((appSettings.developer?"localization/":xrkb_include_folder)+"lang_"+a+".js",XR_Startup3)}}}else{XR_Startup3()}}else{XR_Startup3()}}function XR_Startup3(){var b=true;if(!wrapperOptions.nodejs){$("#loading_div").hide().css("position","absolute")}if(isSmartTv()){smartTv.init()}StartTick();if((!customStartup)||(wrapperOptions.processURLparams)){urlParams.Setup()}replayStack.Initialize();dictionary.PopulateConstraintDomains();if(!appSettings.startObjectID){appSettings.startObjectID=parseInt(appSettings.startObject.substring(0,1)=="~"?appSettings.startObject.substring(1):Handle(appSettings.startObject),10)}if(urlParams.postIdent>0){var a=document.createElement("script");a.type="text/javascript";a.src="getdata.php?id="+urlParams.postIdent;$("head",document).append(a)}function d(l,k){function j(m){if(lang&&m!==""&&lang.hasOwnProperty(m)&&lang[m]!==""){return lang[m]}return m}function h(m){var p,o;var n;for(p=0;p<m.length;p++){n=m[p];if(n.tabsheets){for(o=0;o<n.tabsheets.length;o++){h(n.tabsheets[o].controls)}}else{if(n.hasOwnProperty("caption")){n.caption=j(n.caption)}if(n.hasOwnProperty("label")){n.label=j(n.label)}if(n.hasOwnProperty("validation")){n.validation=j(n.validation)}if(n.hasOwnProperty("emptytext")){n.emptytext=j(n.emptytext)}}}}if(l.toLowerCase()=="_xr_lang"){b=false;var g=xrkb_include_folder+"assets/"+k+".json";$.ajax({url:g,dataType:"json",error:function(o,m,n){if(autoRun){Go()}},success:function(p){var u,t,r,q,m;lang=p;for(u=0;u<dictionary.aDictionary.length;u++){q=dictionary.aDictionary[u];switch(q.aType){case TYPE_LIST:case TYPE_NUMERIC:case TYPE_BOOLEAN:case TYPE_DATE:case TYPE_TEXT:for(var n in q.loadedFlatProps){switch(n){case"maxvalue":case"minvalue":case"length":case"aDecPlaces":case"tieddialog":case"isdynamic":case"_default":case"allowblank":case"selectionmode":case"grouppreviousanswers":case"showontreedialog":case"hiddenvaluesprop":case"sortdirection":case"isselected":case"defaultmode":break;case"description":default:key=q.loadedFlatProps[n];if(typeof(key)=="string"){q.loadedFlatProps[n]=j(key)}}}if(q.aValueProps&&q.aValueProps.list){for(t=0;t<q.aValueProps.list.length;t++){if(q.aValueProps.list[t].realName!="Value"){for(r=0;r<q.aValues.length;r++){key=q.aValues[r][q.aValueProps.list[t].realName];if(typeof(key)=="string"){q.aValues[r][q.aValueProps.list[t].realName]=j(key)}}}}}break;case TYPE_DIALOG:q.aDefinition.caption=j(q.aDefinition.caption);h(q.aDefinition.controls);break}}if(autoRun){Go()}}})}}if((typeof appSettings.language=="string")&&(appSettings.language.substr(0,1)=="_")){d("_xr_lang",appSettings.language.substr(1))}else{for(var f=0;f<urlParams.aParams.length;f++){d(urlParams.aParams[f].aName,urlParams.aParams[f].aValue)}}if(urlParams.postData){for(var e in urlParams.postData){d(e,urlParams.postData[e])}}if(autoRun&&b){Go()}}function PostData(a){urlParams.postData=a;Go()}function XR_DOMsetup(a){DialogPagesSetup();ModalSetup();BackSetup();UIsetup();if(!a){a="xrui"}uidiv=document.getElementById(a);if(!uidiv){uidiv=document.getElementById(dlgPageFrameName)}}function getInternetExplorerVersion(){var d=-1;if(!wrapperOptions.nodejs){if(navigator.appName=="Microsoft Internet Explorer"){var a=navigator.userAgent;var b=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(b.exec(a)!=null){d=parseFloat(RegExp.$1)}}}return d}function XR_Setup(b){if(b!=undefined){wrapperOptions=b}else{wrapperOptions={}}var a=getInternetExplorerVersion();if(a>-1&&a<9){alert("You should upgrade your copy of Windows Internet Explorer to the latest version!")}}function Dialog_GetKMName(){var a=appSettings.description?appSettings.description:"";if(a.length==0){return appSettings.title}return a}function Dialog_GetTiedName(a){if(a!=undefined){return a.aName}else{if(currentDlg&&currentDlg.tiedObj){return currentDlg.tiedObj.aName}}return""}function Dialog_GetTiedDescription(b,a){if(b==undefined){b=true}if(a!=undefined){return a.GetDescription(b)}else{if(currentDlg&&currentDlg.tiedObj){return currentDlg.tiedObj.GetDescription(b)}}return""}function Dialog_RenderTiedHelp(b){var a=b;if(typeof a=="number"){a=_dgo(a)}if(!a){return""}if(!a.flatProps){return""}if(!a.flatProps.helptext){return""}if(a.flatProps.helptext==""){return""}if(isMobile){return a.flatProps.helptext}if(currentDlg||jsAjax){return"input_help_aobject__id="+a.aID}return"<span class='input_help' style='display:inline-block;overflow:hidden'>"+a.flatProps.helptext+"</span>"}function Dialog_GetTiedFlatProp(d,b){function a(f){var e=f.GetFlatProp(d);if(e==null){e=f.GetValueProp(d,-1)}return e}if(b){return a(b)}else{if(currentDlg&&currentDlg.tiedObj){return a(currentDlg.tiedObj)}}return""}function Dialog_GetDebug(){function e(g){if((g.aType==TYPE_LIST)||(g.aType==TYPE_BOOLEAN)||(g.aType==TYPE_NUMERIC)||(g.aType==TYPE_DATE)||(g.aType==TYPE_TEXT)){return(g.aTree||g.aExamples)}return false}var f;var d;var b="";var a;a=false;for(f=0;f<capturedAtts.length;f++){d=_dgo(capturedAtts[f]);if(!a){b+="<tr><th colspan='2'>Captured Objects</th></tr>"}b+="<tr><td>"+d.aName+"</td><td>"+ConvertForDisplay(d.val())+"</td></tr>";a=true}a=false;for(f=0;f<dictionary.aDictionary.length;f++){d=dictionary.aDictionary[f];if($.inArray(d.aID,capturedAtts)==-1){if((d.aType==TYPE_LIST)||(d.aType==TYPE_BOOLEAN)||(d.aType==TYPE_NUMERIC)||(d.aType==TYPE_DATE)||(d.aType==TYPE_TEXT)){if(!e(d)&&d.isFull()){if(!a){b+="<tr><th colspan='2'>Assigned Objects</th></tr>"}b+="<tr><td>"+d.aName+"</td><td>"+ConvertForDisplay(d.val())+"</td></tr>";a=true}}}}a=false;for(f=0;f<dictionary.aDictionary.length;f++){d=dictionary.aDictionary[f];if(e(d)&&d.isFull()){if(!a){b+="<tr><th colspan='2'>Knowledge Results</th></tr>"}b+="<tr><td>"+d.aName+"</td><td>"+ConvertForDisplay(d.val())+"</td></tr>";a=true}}b="<table class='dbg_table' cellspacing='0' cellpadding='4px' width='100%'>"+b+"</table>";return b}function Dialog_GetLineOfReasoning(){var f;var e;var a="";var d=LOR_NONE;for(f=0;f<lineOfReasoning.length;f++){e=_dgo(lineOfReasoning[f].id);if(!e.isFull()){continue}var b=ConvertForDisplay(e.aType==TYPE_DATE?e.GetValueAsString(true):e.GetValueAsString());if(lineOfReasoning[f].atype==LOR_ATT){if(d==LOR_NONE){a+="Given that"}else{if(d==LOR_ATT){a+="And"}else{a+="And given that"}}a+=" "+e.aName+" is "+b+"\n"}else{if(d==LOR_NONE){a+="Set"}else{if(d==LOR_ATT){a+="Then"}else{a+="And"}}a+=" "+e.aName+" = "+b+"\n"}d=lineOfReasoning[f].atype}return a}var closeCallback=null;var modalDlg=null;function ShowModal(innerHTML,title,params,callback,cancelCallback){if(isEditor){xrkb.msgbox({body:innerHTML,header:title,ok_callback:callback});return}if((isMobile!=undefined)&&isMobile){var btnText="OK";if(params&&(params.length>0)){try{if(typeof params=="string"){btnText=params}}catch(e){}}var options={mode:"button",headerText:title,headerClose:false,buttonPrompt:"<p class='ui_modal_p'>"+innerHTML+"</p>",width:"92.5%",buttons:{OK:{id:"my_modal_button_id",click:function(){if($.isFunction(callback)){callback()}},value:"test"}}};if(params&&params.showCancelBtn){options.buttons.Cancel={click:function(){if($.isFunction(cancelCallback)){cancelCallback()}},icon:"delete",theme:"c"}}modalDlg=$("<div></div>").simpledialog2(options);$("#my_modal_button_id").find(".ui-btn-text").html(btnText);return}else{$("#modalContent").html(innerHTML);if(title){modalDlg.dialog("option","title",title)}if(params&&(params.length>0)){try{if(typeof params=="string"){$(".ui-button-text").html(params)}else{modalDlg.dialog("option",eval("({"+params+"})"))}}catch(e){}}modalDlg.dialog("open")}closeCallback=$.isFunction(callback)?callback:null}function CloseCallback(){if(closeCallback){closeCallback()}}function HideModal(){if(modalDlg){modalDlg.dialog("close")}CloseCallback()}function ModalSetup(){if(modalDlg){return}if((isMobile!=undefined)&&isMobile){return}else{var a=$(CreateElement2("div","modalWindow","<div id='modalContent'></div>"));modalDlg=a.dialog({width:600,modal:true,autoOpen:false,resizable:false,close:CloseCallback,buttons:{Ok:function(){$(this).dialog("close")}}})}$("#loadingScreen").dialog({autoOpen:false,dialogClass:"loadingScreenWindow",closeOnEscape:false,draggable:false,width:360,minHeight:50,modal:true,buttons:{},resizable:false,open:function(){$("body").css("overflow","hidden")},close:function(){$("body").css("overflow","auto")}})}function waitingDialog(a){$("#loadingScreen").html(a.message&&(a.message!="")?a.message:"Please wait...");$("#loadingScreen").dialog("option","title",a.title&&(a.title!="")?a.title:"Working");$("#loadingScreen").dialog("open")}function isWaitingDialogOpen(){return $("#loadingScreen").dialog("isOpen")}function closeWaitingDialog(){$("#loadingScreen").dialog("close")}var popupId="xrui";var popupIdBkgnd="xrui_bkgnd";function PopupSetup(){if($("#"+popupId).length==0){$("<div id='"+popupId+"'></div>").appendTo("body")}if($("#"+popupIdBkgnd).length==0){$("<div id='"+popupIdBkgnd+"' class='modal-bkgnd'></div>").appendTo("body")}return popupId}function PopupStart(){$("#"+popupIdBkgnd).show()}function PopupEnd(){$("#"+popupIdBkgnd).hide()}var dlgPageFrameName="jframe";function DialogPagesSetup(){$("body").append("<div id='"+dlgPageFrameName+"' style='visibility:hidden; position:absolute; left:0; top:0; right:0; bottom:0' />");$(window).resize()}function HideDialogPage(){$("#"+dlgPageFrameName).css("visibility","hidden")}var treeDialogs={currentDisplay:{taskID:0,lastList:[]},DIALOG_DEF:{hascaption:true,centered:true,caption:"''",width:400,height:240,timeout:0,cssclassname:{name:""},font:{name:"arial",size:12,isBold:false,isItalic:false},controls:[{aID:1,aType:"panels",aName:"tabsheet",left:8,top:8,width:384,height:200,activesheet:1,tabsheets:[],controltype:"panels",showmarkers:false}],instanceatts:[],scrolltop:0},DIALOG_PANEL:{id:1,caption:"''",isvisible:true,showborder:true,showheader:false,collapsable:true,initialshrunk:false,cssname:"",contentcssname:"",controls:[]},DIALOG_LABEL:{aID:2,aType:"label",aName:"label",left:0,top:0,width:372,height:16,tabno:0,borderstyle:"none",bkgndstyle:"transparent",justification:"left",textcolor:"000000",bordercolor:"000000",caption:"''",visible:true,ishtml:false,showscroll:false,cssclassname:{name:""},applydialogfont:true},DIALOG_LISTBOX:{aID:3,aType:"listbox",aName:"logical",left:0,top:24,width:372,height:100,tabno:0,tieditem:0,style:"dropdownlist",excludemode:"showinvalid",visible:true,applydialogfont:true,controltype:"standard",validation:"",showsearch:false,cssclassname:{name:""},emptytext:""},DIALOG_BUTTON:{aID:4,aType:"button",aName:"button",left:0,top:0,width:48,height:26,tabno:0,caption:"'OK'",buttontype:"ok",visible:true,isarea:false,allowinvalid:0,allowincomplete:0,exitcheck:true,key:"none",applydialogfont:true,cssclassname:{name:""},enabled:true},DIALOG_CHECKBOX:{aID:5,aType:"checkbox",aName:"checkbox",left:0,top:24,width:372,height:28,tabno:0,tieditem:0,color:"ECE9D8",textcolor:"000000",caption:"'CheckBox'",selectablegrey:false,value:0,visible:true,applydialogfont:true,controltype:"buttonset",cssclassname:{name:""},validation:""},DIALOG_NUMERIC:{aID:6,aType:"number",aName:"numeric",left:0,top:24,width:372,height:24,tabno:0,tieditem:0,style:"editbox",visible:true,hasborder:true,color:"FFFFFF",textcolor:"000000",applydialogfont:true,cssclassname:{name:""},validation:""},DIALOG_TEXTBOX:{aID:7,aType:"textedit",aName:"text",left:0,top:24,width:372,height:24,tabno:0,tieditem:0,applydialogfont:true,cssclassname:{name:""},validation:""},DIALOG_GRID:{aID:8,aType:"grid",aName:"grid",left:0,top:24,width:372,height:24,tabno:0,tieditem:0,color:"FFFFFF",dynamicvals:true,controltype:"standard",cssclassname:{name:""},validation:""},DIALOG_DROPDOWN:{aID:9,aType:"dropdown",aName:"dropdown",left:0,top:24,width:372,height:120,tabno:0,tieditem:0,emptytext:"",helpposition:"'top right'",label:"",visible:true,applydialogfont:true,controltype:"standard",validation:"",showsearch:false,cssclassname:{name:""},emptytext:""},DIALOG_BUTTONGROUP:{aID:10,aType:"buttonset",aName:"buttonset",left:0,top:24,width:372,height:120,tabno:0,tieditem:0,emptytext:"",helpposition:"'top right'",label:"",visible:true,applydialogfont:true,validation:"",cssclassname:{name:""},emptytext:""},DIALOG_SLIDER:{aID:11,aType:"slider",aName:"slider",left:0,top:24,width:372,height:120,tabno:0,tieditem:0,helpposition:"'top right'",label:"",visible:true,applydialogfont:true,validation:"",cssclassname:{name:""},emptytext:""},DIALOG_DATE:{aID:12,aType:"date",aName:"date",left:155,top:24,width:140,height:24,tabno:0,tieditem:0,helpposition:"'top right'",label:"",visible:true,applydialogfont:true,validation:"",cssclassname:{name:""},emptytext:""},FindMaxID:function(b){var a=0;for(var f=0;f<b.controls.length;f++){if(b.controls[f].aID>a){a=b.controls[f].aID}switch(b.controls[f].aType){case"tabsheet":case"accordian":case"panels":case"columns":for(var e=0;f<b.controls[f].tabsheets;e++){if(b.controls[f].tabsheets[e].id>a){a=b.controls[f].tabsheets[e]}var d=this.FindMaxID(b.controls[f].tabsheets[e]);if(d>a){a=d}}break}}return a},UpdateIDs:function(d,a){for(var g=0;g<d.controls.length;g++){var b=d.controls[g];b.aID=++a.id;var e={orig:b.aName};b.aName="control"+b.aID;e.anew=b.aName;a.renames.push(e);if(b.tabno){b.tabno=0}switch(b.aType){case"tabsheet":case"accordian":case"panels":case"columns":for(var f=0;f<b.tabsheets.length;f++){b.tabsheets[f].id=++a.id;this.UpdateIDs(b.tabsheets[f],a)}break}}},UpdateTiedIDs:function(e,a){var f={doneHelp:false};for(var j=0;j<e.controls.length;j++){var d=e.controls[j];if(d.tieditem==0){d.tieditem=a}function h(k){k=k.replace(/Dialog_GetTiedDescription\((.*?)\)/,"Dialog_GetTiedDescription($1,dictionary.GetObject("+a+"))");k=k.replace(/Dialog_GetTiedName\(\)/,"Dialog_GetTiedName(dictionary.GetObject("+a+"))");k=k.replace(/Dialog_GetTiedFlatProp\((.*?)\)/,"Dialog_GetTiedFlatProp($1,dictionary.GetObject("+a+"))");k=k.replace(/Dialog_GetKMName\(\)/,"Dialog_GetKMName()");if(k.indexOf("Dialog_RenderTiedHelp()")>=0){k=k.replace(/Dialog_RenderTiedHelp\(\)/,"Dialog_RenderTiedHelp(dictionary.GetObject("+a+"))");f.doneHelp=true}k=k.replace(/\{__(.*?)\}/,"{__$1|"+a+"}");return k}if(d.hasOwnProperty("caption")){d.caption=h(d.caption)}if(d.hasOwnProperty("label")){d.label=h(d.label)}switch(d.aType){case"tabsheet":case"accordian":case"panels":case"columns":for(var g=0;g<d.tabsheets.length;g++){var b=this.UpdateTiedIDs(d.tabsheets[g],a);if(b.doneHelp){f.doneHelp=true}}break}}return f},SetTabNos:function(d,a){for(var f=0;f<d.controls.length;f++){var b=d.controls[f];switch(b.aType){case"listbox":case"dropdown":case"linklistbox":case"ticklistbox":case"number":case"checkbox":case"radiobtn":case"date":case"textedit":b.tabno=a++;break;case"tabsheet":case"accordian":case"panels":case"columns":for(var e=0;e<b.tabsheets.length;e++){a=this.SetTabNos(b.tabsheets[e],a)}break}}return a},scanCtrls:function(a,b){if(!$.isArray(a.controls)){return}if(!$.isFunction(b)){return}for(var f=a.controls.length-1;f>=0;f--){var d=a.controls[f];if(b(d)){a.controls.splice(f,1)}else{if((d.aType!="panels")&&$.isArray(d.tabsheets)){for(var e=0;e<d.tabsheets.length;e++){this.scanCtrls(d.tabsheets[e],b)}}}}},TiePanelButtonsAndControls:function(g,a,f,b,e){if(g.flatProps.grouppreviousanswers!=""){var h=[];this.scanCtrls(a,function(j){switch(j.aType){case"label":case"image":case"accordian":case"columns":case"container":case"button":case"panels":case"tabsheet":case"subdialog":return false}h.push(j);return false});if(h.length==0){h.push(b.aID)}var d=false;this.scanCtrls(a,function(j){if((j.aType=="button")&&(j.buttontype=="ok")){d=true;j.buttontype="change";if(f){j.caption=getTranslation("change","Change")}j.doOK=!f;j.changeCtrl=[];if(b&&(b.aType==TYPE_DIALOG)){j.treeDlgDlg=b.aID}for(var k=0;k<h.length;k++){if(typeof h[k]=="object"){j.changeCtrl.push(wrapperOptions.nodejs?h[k].aName:h[k]);h[k].isPrev=true}else{j.changeCtrl.push(wrapperOptions.nodejs?h[k].aName:h[k])}}}else{if((j.aType=="button")&&(j.buttontype=="exit")&&f){return true}}return false});if(!f){this.scanCtrls(e,function(j){if((j.aType=="button")&&(j.buttontype=="ok")){d=true;j.buttontype="change";j.doOK=true;j.changeCtrl=[];if(b&&(b.aType==TYPE_DIALOG)){j.treeDlgDlg=b.aID}for(var k=0;k<h.length;k++){if(typeof h[k]=="object"){j.changeCtrl.push(wrapperOptions.nodejs?h[k].aName:h[k]);h[k].isPrev=true}else{j.changeCtrl.push(wrapperOptions.nodejs?h[k].aName:h[k])}}}})}}},_SetaType:function(a){for(var b=0;b<a.length;b++){if(a[b].aType=="panels"){return a[b]}}return null},_ctrlScan:function(a,b){for(var e=0;e<a.length;e++){if(b(a[e])){return true}if(a[e].aType=="columns"){for(var d=0;d<a[e].tabsheets.length;d++){if(this._ctrlScan(a[e].tabsheets[d].controls,b)){return true}}}}return false},Render:function(a,G){var q=false;var E=a.flatProps.tieddialog;var D=this.DIALOG_DEF;var N;if(E){N=_dgo(E);if(N&&(N.aType==TYPE_DIALOG)){N.Load(N);D=N.loadedDefinition;q=true}}var Q=$.extend(true,{},D);Q.instanceatts=[];if(!q){Q.caption=a.GetDescription(true)}else{N={id:0,renames:[]};this.UpdateIDs(Q,N)}Q.grouppreviousanswers=a.flatProps.grouppreviousanswers;Q.previousanswersreadonly=a.flatProps.previousanswersreadonly;var v=null;var b=null;var S,T;if(appSettings.layout=="positional"){v=this._SetaType(Q.controls);for(S=0;(S<Q.controls.length)&&!b;S++){if((Q.controls[S].aType=="button")&&(Q.controls[S].buttontype=="ok")){b=Q.controls[S]}}T=false;for(S=0;(S<Q.controls.length)&&!T;S++){if((Q.controls[S].aType=="button")&&(Q.controls[S].buttontype=="macro")&&Q.controls[S].macroautook){T=true}}}else{this._ctrlScan(Q.controls,function(o){if((o.aType=="tabsheet")||(o.aType=="panels")){v=o;return true}return false});this._ctrlScan(Q.controls,function(o){if((o.aType=="button")&&(o.buttontype=="ok")){b=o;return true}return false});T=false;this._ctrlScan(Q.controls,function(o){if((o.aType=="button")&&(o.buttontype=="macro")&&o.macroautook){T=o;return true}return false})}if(b){}var n=false;var d=[];var z;var A=undefined;var m=[];if(v){var w=this.DIALOG_PANEL;if(v.tabsheets.length>0){w=v.tabsheets[0];w.isvisible=true;w.showborder=true;w.showheader=false;w.collapsable=true;w.initialshrunk=false}v.tabsheets=[];var x=this.FindMaxID(Q);var e=true;var H,k;for(S=0;S<G.length;S++){z=G[S];if(z){var f=false;for(var C=0;(C<S)&&!f;C++){if(G[C]&&(z.aID==G[C].aID)){f=true}}if(!f){d[d.length]=z.aID;Q.instanceatts.push({att:z.aID,isvisible:true});H=$.extend(true,{},w);H.id=++x;if(a.flatProps.grouppreviousanswers==""){e=false}else{if(!G[G.length-1]&&(S==G.length-2)){e=false}else{if(G[G.length-1]&&(S==G.length-1)){e=false}else{if((z.aType==TYPE_LIST)||(z.aType==TYPE_NUMERIC)||(z.aType==TYPE_DATE)||(z.aType==TYPE_BOOLEAN)||(z.aType==TYPE_TEXT)){if(z.IsEmpty()){}}}}}var y=dictionary.GetObject(z.aID);if(e){H.showheader=true;H.initialshrunk=true;if($.isFunction(xpertrule.previousAnswerCaptionRender)){H.caption=xpertrule.previousAnswerCaptionRender(y)}else{var J;if(y.aType==TYPE_DATE){J=y.GetValueAsString(true)}else{if((y.aType==TYPE_LIST)&&!y.isMultiSel){var K=y.GetValue();if(K>0){K=y.ValueIDtoIndex(K);J=y.aValues[K].aText}else{J=y.GetValueAsString()}}else{J=y.GetValueAsString(null,true)}}H.caption="<div class='prev-ans-att'>"+y.GetDescription(true)+"</div><div class='prev-ans-val'>"+(J?"("+J+")":"")+"</div>"}v.groupInitialCollapsed=true;n=true}else{H.caption=y.GetDescription(true)}if(z.flatProps&&z.flatProps.tieddialog){E=z.flatProps.tieddialog;N=_dgo(E);if(N&&(N.aType==TYPE_DIALOG)){N.Load(N);N=$.extend(true,{},N.loadedDefinition);H.controls=N.controls;if(Q.width<N.width+20){Q.width=N.width+20;v.width=Q.width-16}if(N.onshow){m.push(N.onshow)}N={id:x,renames:[]};this.UpdateIDs(H,N);x=N.id;var L=this.UpdateTiedIDs(H,z.aID);if(L.doneHelp){Q.helpdoneinlabel=true}this.TiePanelButtonsAndControls(a,H,e,z,Q)}}else{if(z.aType==TYPE_DIALOG){z.Load(z);N=$.extend(true,{},z.loadedDefinition);H.controls=N.controls;for(var l=0;l<N.controls.length;l++){N.controls[l].parentdlg=z.aID}if(N.onshow){m.push(N.onshow)}N={id:x,renames:[]};this.UpdateIDs(H,N);if($.isPlainObject(z.formRules)&&$.isArray(z.formRules.items)&&(z.formRules.items.length>0)){newRules=$.extend(true,{},z.formRules);var g;for(g=0;g<N.renames.length;g++){renameCtrlInFormRules(newRules,N.renames[g].orig,N.renames[g].anew)}if(A===undefined){A={items:[]}}for(g=0;g<newRules.items.length;g++){A.items.push(newRules.items[g])}}x=N.id;this.TiePanelButtonsAndControls(a,H,e,z,Q)}else{if(z.aType==TYPE_REPORT){var j=$.extend(true,{},this.DIALOG_LABEL);j.aID=++x;j.aName=j.aName+j.aID;j.width=v.width-10;j.height=100;j.ishtml=true;j.showscroll=true;j.caption=z.GetText(true);H.controls[H.controls.length]=j;this.TiePanelButtonsAndControls(a,H,e,z,Q)}else{if(!isMobile){var O=$.extend(true,{},this.DIALOG_LABEL);O.aID=++x;O.aName=O.aName+O.aID;O.width=v.width-10;O.caption=z.GetDescription(true);H.controls[H.controls.length]=O}k=null;switch(z.aType){case TYPE_LIST:k=$.extend(true,{},this.DIALOG_LISTBOX);k.width=v.width-10;break;case TYPE_BOOLEAN:k=$.extend(true,{},this.DIALOG_CHECKBOX);k.width=v.width-10;break;case TYPE_NUMERIC:k=$.extend(true,{},this.DIALOG_NUMERIC);k.width=v.width-10;break;case TYPE_TEXT:k=$.extend(true,{},this.DIALOG_TEXTBOX);k.width=v.width-10;break}if(k){k.aID=++x;k.aName=k.aName+k.aID;k.tieditem=z.aID;H.controls[H.controls.length]=k}if((a.flatProps.grouppreviousanswers!="")&&!q){var t=$.extend(true,{},this.DIALOG_BUTTON);t.aID=++x;t.aName=t.aName+t.aID;t.top=H.controls[H.controls.length-1].top+24+6;t.left=H.controls[H.controls.length-1].left;t.buttontype="change";if(e){t.caption=getTranslation("change","Change");t.width=Math.floor(t.width*1.5)}t.changeCtrl=[wrapperOptions.nodejs?k.aName:k];t.doOK=!e;k.isPrev=true;H.controls[H.controls.length]=t}this.TiePanelButtonsAndControls(a,H,e,z,Q)}}}if(appSettings.layout=="positional"){this._SetaType(H.controls)}v.tabsheets[v.tabsheets.length]=H}}else{d[d.length]=0;if(b){}else{if(!T){H=$.extend(true,{},this.DIALOG_PANEL);H.id=++x;k=$.extend(true,{},this.DIALOG_BUTTON);k.aID=++x;k.aName=k.aName+k.aID;H.controls[H.controls.length]=k;v.tabsheets[v.tabsheets.length]=H}}}}}this.SetTabNos(Q,1);var B=false;if(currentDlg){B=(currentDlg.aID!=a.aID)||n}var F=0;if(a.aID!=this.currentDisplay.taskID){B=true;Q.scrolltop=0;if(a.aID){N=dictionary.GetObject(a.aID);if(N.scrolltop){Q.scrolltop=N.scrolltop}}}else{if(isMobile){Q.scrolltop=$(document).height()}else{Q.scrolltop=$(window).scrollTop()}if(d.length!=this.currentDisplay.lastList.length){B=true;var R=this.currentDisplay.lastList.length;for(S=this.currentDisplay.lastList.length-1;S>=0;S--){if(this.currentDisplay.lastList[S]!=0){R=S+1;break}}if(R<d.length){F=d[R]}}else{for(S=0;(S<d.length)&&!B;S++){if(d[S]!=this.currentDisplay.lastList[S]){B=true}}}}if(this.currentDisplay.taskID){N=_dgo(this.currentDisplay.taskID);N.scrolltop=$(window).scrollTop()}if(B){if(wrapperOptions.nodejs){Q.taskID=a.aID;var I=[];for(S=0;S<G.length;S++){z=G[S];if(z){I.push(z.aID)}}throw new inferenceIssue(PASSBACK_DIALOG,"tree_dialog",{def:Q,usedIDs:I,taskID:a.aID})}if((a.flatProps.grouppreviousanswers!="")&&(a.flatProps.reversepreviousanswers)&&(v.tabsheets.length>2)){for(var h=0;h<Math.floor(v.tabsheets.length/2);h++){var g=v.tabsheets.length-2-h;var M=v.tabsheets[h];v.tabsheets[h]=v.tabsheets[g];v.tabsheets[g]=M}}var P={aID:a.aID,tiedObj:null};ClearUI(a.aID,false,replayStack.LastOperationWasValidatedOK());currentDlg=XRdialog.create($("#xrui"),Q,P,A);currentDlg.render();currentDlg.populate();currentDlg.focus(F);for(S=0;S<m.length;S++){N=_dgo(m[S]);if(N){N.Run(Q)}}this.currentDisplay.taskID=a.aID;this.currentDisplay.lastList=d}else{if(wrapperOptions.nodejs){throw new inferenceIssue(PASSBACK_DIALOG,"tree_dialog")}currentDlg.populate()}}};var AT_NUM=1;var AT_STR=2;var AT_BOOL=3;var AT_SUB=4;var AT_ADD=5;var AT_MUL=6;var AT_DIV=7;var AT_EQ=8;var AT_NE=9;var AT_LT=10;var AT_LE=11;var AT_GT=12;var AT_GE=13;var AT_AND=14;var AT_OR=15;var AT_NOT=16;var AT_OBJ=17;var AT_DEREF=18;var AT_FUNC=19;var AT_PROP=20;var AT_IN=21;var AT_ARR=22;var AT_SYSOBJ=23;var FUNC_ABS=1;var FUNC_SQRT=2;var FUNC_PI=3;var SYSOBJ_HIER=1;var EVAL_STR=1;var EVAL_NUM=2;var EVAL_BOOL=3;var EVAL_DATE=4;function TokCmd_castToForced(d,a){switch(a){case EVAL_NUM:if(typeof d=="string"){var b=parseFloat(d);if(b){return b}}else{if(typeof d=="boolean"){return d?1:0}else{if(d instanceof Date){return d.getTime()/86400000}}}break;case EVAL_STR:if(typeof d=="number"){return d+""}else{if(typeof d=="boolean"){return d?"true":"false"}else{if(d instanceof Date){return Cmd_DateToStr(d)}}}break;case EVAL_BOOL:if(typeof d=="string"){return d.toUpperCase()=="TRUE"?true:false}else{if(typeof d=="number"){return d!=0}}break}return d}function TokCmd_jsToType(b){var a=typeof b;switch(a){case"string":return EVAL_STR;case"number":return EVAL_NUM;case"boolean":return EVAL_BOOL;default:throw"Cannot convert to type ["+a+"]"}}function TokCmd_GetValueIndex(d,a){var b=0;if(a.idxs){if(a.idxs.length!=1){throw"Too many indexes (only 1 allowed for value index)"}b=TokCmd_Eval(a.idxs[0],EVAL_NUM)-1;if(!d.isMultiSel&&((b<0)||(b>=d.aValues.length))){throw"Attempt to get invalid value index ("+(b+1)+") for ["+d.aName+"]"}}else{b=d.GetValue();if(!d.isMultiSel){if(b==0){throw"Attempt to get current value for ["+d.aName+"] but currently empty"}b=d.ValueIDtoIndex(b)}}return b}function TokCmd_Eval(a,d,l){var q=typeof a;if((q=="string")||(q=="number")||(q=="boolean")||$.isArray(a)){return TokCmd_castToForced(a,d)}if((a.atype==AT_DEREF)&&(l)){var g=$.extend(false,{},a);g.atype=AT_PROP;g.val=TokCmd_Eval(a.val,EVAL_STR).toLowerCase();a=g}var C,G,F,A,u,f,D,e,b,t;switch(a.atype){case AT_NUM:return TokCmd_castToForced(a.val,d);case AT_STR:return TokCmd_castToForced(a.val,d);case AT_BOOL:return TokCmd_castToForced(a.val,d);case AT_ARR:t=[];for(C=0;C<a.prms.length;C++){t.push(TokCmd_Eval(a.prms[C],d,l))}return t;case AT_OBJ:case AT_DEREF:if(l){throw"Cannot have object below object"}if(a.atype==AT_OBJ){l=dictionary.GetObject(a.val)}else{var x=TokCmd_Eval(a.val,EVAL_STR);l=dictionary.GetObjectByName(x);if(!l){throw"Cannot find indirect reference ["+x+"]"}}if(a.idxs){if(l.aType!=TYPE_VARIABLE){throw"Only variables can have an index"}if(a.idxs.length>2){throw"Too many indexes for variable"}G=TokCmd_Eval(a.idxs[0],EVAL_NUM);F=(a.idxs.length>=2)?TokCmd_Eval(a.idxs[1],EVAL_NUM):1;return TokCmd_castToForced(l.GetValue(G,F),d)}else{if(a.sub){return TokCmd_Eval(a.sub,d,l)}else{if(l.aType==TYPE_PROCEDURE){u=[];if(a.prms){for(C=0;C<a.prms.length;C++){u.push(TokCmd_Eval(a.prms[C]))}}A=l.Run.apply(l,u)}else{if((l.aType==TYPE_DATE)&&(d==EVAL_STR)){A=l.GetValueAsString(true)}else{A=l.val()}}return TokCmd_castToForced(A,d)}}break;case AT_SYSOBJ:if(l){throw"Woops 1"}switch(a.val){case SYSOBJ_HIER:if(!a.sub){throw"Woops 2"}l=hierarchy;return TokCmd_Eval(a.sub,d,l);default:throw"Woops 3"}break;case AT_PROP:if(!l){throw"Property reference must be after an object"}if(l._isDialogControl){if(!l.hasOwnProperty(a.val)){if((a.val=="visible")&&l.hasOwnProperty("isvisible")){a.val="isvisible"}else{throw"Control property expected"}}if(a.val=="tabsheets"){if(!$.isArray(a.idxs)){throw"Tabsheet index expected"}if(a.idxs.length!=1){throw"1 tabsheet index expected"}var j=TokCmd_Eval(a.idxs[0],EVAL_NUM);if((j<1)||(j>l.tabsheets.length)){throw"Tabsheet index out of range ["+j+"]"}if(!a.sub){throw"Tabsheet property expected"}l=l.tabsheets[j-1];l._isDialogControl=true;var m=TokCmd_Eval(a.sub,d,l);if(typeof m=="string"){return XRdialog.expandEmbedded(m)}return m}else{if(a.sub){throw"Unexpected property"}var k=l[a.val];if(a.val=="tieditem"){k=_dgo(k);k=k?k.aName:""}return TokCmd_castToForced(k,d)}}if(l._isHierarchy){if(a.val=="item"){if(!a.prms){throw"Parameter expected"}if(a.prms.length!=1){throw"1 parameter expected"}G=TokCmd_Eval(a.prms[0],EVAL_NUM);if(a.sub){return TokCmd_Eval(a.sub,d,l.idxToNode(G).item)}else{l=l.idxToNode(G).item;if((l.aType==TYPE_DATE)&&(d==EVAL_STR)){A=l.GetValueAsString(true)}else{A=l.val()}return TokCmd_castToForced(A,d)}}if(!$.isFunction(l[a.val])){throw"Unknown hierarchy property ["+a.val+"]"}u=[];if(a.prms){for(C=0;C<a.prms.length;C++){u.push(TokCmd_Eval(a.prms[C]))}}return TokCmd_castToForced(l[a.val].apply(l,u),d)}if(l._isDialogInsts){if(a.val=="count"){return TokCmd_castToForced(l.dialogs.length,d)}if(!l.hasOwnProperty(a.val)){if(l.current){f=l.dialogs[l.current-1];return TokCmd_Eval(a,d,f)}throw"Unknown dialog instance property ["+a.val+"]"}return TokCmd_castToForced(l[a.val],d)}if(l._isDialogInst){var w=dictionary.GetObjectByName(a.val,true);if(!w){throw"Unknown dialog instance object ["+a.val+"]"}for(C=0;C<l.aDefinition.instanceatts.length;C++){if(l.aDefinition.instanceatts[C].att==w.aID){var z=l.GetDialogInstObject(w.aID);if(a.sub){if(a.idxs){if(a.idxs.length>1){throw"Too many indexes for variable"}G=TokCmd_Eval(a.idxs[0],EVAL_NUM);if((G<1)||(G>z.dialogs.length)){throw"Sub dialog instance ref out of bounds ["+G+"]"}z=z.dialogs[G-1];z._isDialogInst=true}return TokCmd_Eval(a.sub,d,z)}else{return TokCmd_castToForced(z.val(),d)}}}throw"Object does not exist on dialog instance ["+a.val+"]"}if(l._isValueProp){if(a.val=="description"){return TokCmd_castToForced(l.aDescription,d)}else{if(a.val=="displayorder"){return TokCmd_castToForced(l.display,d)}}throw"Displayorder is expected"}switch(a.val){case"name":return TokCmd_castToForced(l.aName,d);case"baseclass":return TokCmd_castToForced(l.GetBaseClassName(),d);case"multiselect":return TokCmd_castToForced(l.isMultiSel,d);case"default":return TokCmd_castToForced(l.flatProps._default,d);case"hascases":return TokCmd_castToForced(l.aExamples!=null,d);case"hastree":return TokCmd_castToForced(l.aTree!=null,d)}if((l.aType==TYPE_LIST)||(l.aType==TYPE_NUMERIC)||(l.aType==TYPE_DATE)||(l.aType==TYPE_BOOLEAN)||(l.aType==TYPE_TEXT)){if(a.val=="isempty"){return TokCmd_castToForced(l.IsEmpty(true),d)}if(a.val=="nvalid"){return TokCmd_castToForced(l.GetNvalid(),d)}if(a.val=="selectedindex"){return TokCmd_castToForced(l.GetSelectedIndex(),d)}if(a.val=="nvalues"){return TokCmd_castToForced(l.GetNvalues(),d)}if(a.val=="nselected"){return TokCmd_castToForced(l.GetNselected(),d)}if(l.flatProps.hasOwnProperty(a.val)){if(a.idxs){throw"Index not supported for flat props"}return TokCmd_castToForced(l.flatProps[a.val],d)}if(l.aValueProps){if(a.val=="valid"){G=TokCmd_GetValueIndex(l,a);return TokCmd_castToForced(l.IsValueIndexValid(G),d)}if(a.val=="selected"){G=TokCmd_GetValueIndex(l,a);return TokCmd_castToForced(l.IsValueIndexSelected(G),d)}if(a.val=="probability"){G=TokCmd_GetValueIndex(l,a);if((G<0)||(G>=l.aValues.length)){throw"Index out of bounds ["+G+"]"}return TokCmd_castToForced(l.aValues[G].prob,d)}for(C=0;C<l.aValueProps.list.length;C++){if(l.aValueProps.list[C].realName.toLowerCase()==a.val.toLowerCase()){if(a.sub){l.aValueProps.list[C]._isValueProp=true;return TokCmd_Eval(a.sub,d,l.aValueProps.list[C])}else{if(!a.idxs&&!l.isFull()){A=l.val();return TokCmd_castToForced(A,d)}var y=l.aValueProps.list[C].aName;if(false){if(!a.idxs){G=l.GetValueProp(y,-1)}else{G=l.GetValueProp(y,a.idxs)}return TokCmd_castToForced(G,d)}else{G=TokCmd_GetValueIndex(l,a);if(G<0&&l.isMultiSel){return TokCmd_castToForced("",d)}else{return TokCmd_castToForced(l.aValues[G][y],d)}}}}}}}if(l.aType==TYPE_DIALOG){if(l.aDefinition.hasOwnProperty(a.val)){if(a.sub){throw"Unexpected property"}return l.aDefinition[a.val]}var h=l.GetControlByName((l._isDialogParentControl?"parent_dot_":"")+a.val);if(h){if(!a.sub){throw"Control property expected"}h._isDialogControl=true;return TokCmd_Eval(a.sub,d,h)}if(a.val=="parent"){l._isDialogParentControl=true;var E=TokCmd_Eval(a.sub,d,l);delete l._isDialogParentControl;return E}f=l.GetDialogInstObjectByName(a.val,true);if(f){if(a.idxs){if(a.idxs.length>1){throw"Too many indexes for variable"}G=TokCmd_Eval(a.idxs[0],EVAL_NUM);if((G<1)||(G>f.dialogs.length)){throw"Sub dialog instance ref out of bounds ["+G+"]"}f=f.dialogs[G-1];f._isDialogInst=true}else{if(!a.sub){return TokCmd_castToForced(f.val(),d)}f._isDialogInsts=true}return TokCmd_Eval(a.sub,d,f)}}throw"Unknown property ["+a.val+"]";case AT_ADD:case AT_SUB:case AT_MUL:case AT_DIV:if(a.prms.length!=2){throw"Operator requires 2 sides"}D=((a.atype==AT_ADD)||(a.atype==AT_SUB)?undefined:EVAL_NUM);e=TokCmd_castToForced(TokCmd_Eval(a.prms[0],D));b=TokCmd_castToForced(TokCmd_Eval(a.prms[1],D));if($.isArray(e)||$.isArray(b)){if(!$.isArray(e)||!$.isArray(b)){throw"Array operator must contains matching sides"}t=e;switch(a.atype){case AT_ADD:for(C=0;C<b.length;C++){t.push(b[C])}break;case AT_SUB:for(C=0;C<b.length;C++){var B=$.inArray(b[C],t);if(B>=0){t.splice(B,1);continue}}break;default:throw"Invalid array operator ["+a.atype+"]"}}else{switch(a.atype){case AT_ADD:t=e+b;break;case AT_SUB:t=e-b;break;case AT_MUL:t=e*b;break;case AT_DIV:t=e/b;break}}return TokCmd_castToForced(t,d);case AT_IN:if(a.prms.length!=2){throw"Operator requires 2 sides"}e=TokCmd_castToForced(TokCmd_Eval(a.prms[0],EVAL_STR));b=TokCmd_Eval(a.prms[1]);t=$.inArray(e,b)>=0;return TokCmd_castToForced(t,d);case AT_FUNC:switch(a.val){case FUNC_ABS:case FUNC_SQRT:if(a.prms.length!=1){throw"Bad number of arguments #1"}e=TokCmd_Eval(a.prms[0],EVAL_NUM);switch(a.val){case FUNC_ABS:t=Math.abs(e);break;case FUNC_SQRT:t=Math.sqrt(e);break}return TokCmd_castToForced(t,d);case FUNC_PI:if(a.prms.length!==0){throw"Bad number of arguments #2"}return TokCmd_castToForced(Math.PI,d);case FUNC_LEN:if(a.prms.length!==1){throw"Bad number of arguments #3"}e=TokCmd_Eval(a.prms[0],EVAL_STR);t=e.length;return TokCmd_castToForced(t,d)}break;case AT_NOT:if(a.prms.length!=1){throw"Bad number of arguments #4"}e=TokCmd_Eval(a.prms[0],EVAL_BOOL);t=!e;return TokCmd_castToForced(t,d);case AT_AND:case AT_OR:if(a.prms.length<2){throw"Bad number of arguments #5"}t=TokCmd_Eval(a.prms[0],EVAL_BOOL);for(C=1;(C<a.prms.length)&&!(((a.atype==AT_AND)&&!t)||((a.atype==AT_OR)&&t));C++){e=TokCmd_Eval(a.prms[C],EVAL_BOOL);switch(a.atype){case AT_AND:t=t&&e;break;case AT_OR:t=t||e;break}}return TokCmd_castToForced(t,d);case AT_EQ:case AT_NE:case AT_LT:case AT_LE:case AT_GT:case AT_GE:if(a.prms.length!=2){throw"Bad number of arguments #6"}e=TokCmd_Eval(a.prms[0]);b=TokCmd_Eval(a.prms[1]);switch(a.atype){case AT_EQ:t=e==b;break;case AT_NE:t=e!=b;break;case AT_LT:t=e<b;break;case AT_LE:t=e<=b;break;case AT_GT:t=e>b;break;case AT_GE:t=e>=b;break}return TokCmd_castToForced(t,d)}throw"Cannot evaluate atom"}var OBJECTREF_OBJECT=1;var OBJECTREF_ARRAYITEM=2;var OBJECTREF_FLATPROP=3;var OBJECTREF_VALUEPROP=4;var OBJECTREF_DIALOGPROP=5;var OBJECTREF_METHOD=6;var OBJECTREF_USCEVENT=7;var OBJECTREF_VALUEPROPPROP=8;var OBJECTREF_TXTPROCPROP=9;function TokCmd_ObjectRef(b,a,d){this.aType=b;this.aObject=a;this.aExtra=d}function TokCmd_Lookup(j,b,m){var l=typeof b;if((l=="string")||(l=="number")||(l=="boolean")){throw"Invalid object reference"}if((b.atype==AT_DEREF)&&(j)){var f=$.extend(false,{},b);f.atype=AT_PROP;f.val=TokCmd_Eval(b.val,EVAL_STR).toLowerCase();b=f}var w,v,t,e;switch(b.atype){case AT_OBJ:case AT_DEREF:if(j){throw"Invalid object.object reference"}var k="";var a=0;if(b.atype==AT_OBJ){j=dictionary.GetObject(b.val)}else{a=b.val.indexOf("[");if(a>=0){k=b.val.substr(a);b.val=b.val.substr(0,a)}j=dictionary.GetObjectByName(TokCmd_Eval(b.val,EVAL_STR));if(!j){throw"Unknown object in dereference ["+b.val+"]"}}if(b.idxs){if(j.aType!=TYPE_VARIABLE){throw"Only variables can contain a indicies"}if(b.idxs.length>2){throw"Too many indicies for variable"}w=TokCmd_Eval(b.idxs[0],EVAL_NUM);v=(b.idxs.length>=2)?TokCmd_Eval(b.idxs[1],EVAL_NUM):1;return new TokCmd_ObjectRef(OBJECTREF_ARRAYITEM,j,{idx1:w,idx2:v})}else{if(k!=""){if(j.aType!=TYPE_VARIABLE){throw"Only variables can contain a indicies"}if(k.substr(k.length-1)!="]"){throw"Missing close bracket"}k=k.substr(1,k.length-2);a=k.indexOf(",");if(a<0){w=parseInt(k);v=1}else{w=parseInt(k.substr(0,a));v=parseInt(k.substr(a+1))}return new TokCmd_ObjectRef(OBJECTREF_ARRAYITEM,j,{idx1:w,idx2:v})}else{if(b.sub){return TokCmd_Lookup(j,b.sub,j)}else{return new TokCmd_ObjectRef(OBJECTREF_OBJECT,j)}}}return;case AT_PROP:if(j._isDialogControl){if(!j.hasOwnProperty(b.val)){if((b.val=="visible")&&j.hasOwnProperty("isvisible")){b.val="isvisible"}else{throw"Control property expected"}}if(b.val=="tabsheets"){if(!$.isArray(b.idxs)){throw"Tabsheet index expected"}if(b.idxs.length!=1){throw"1 tabsheet index expected"}var h=TokCmd_Eval(b.idxs[0],EVAL_NUM);if((h<1)||(h>j.tabsheets.length)){throw"Tabsheet index out of range ["+h+"]"}if(!b.sub){throw"Tabsheet property expected"}j=j.tabsheets[h-1];j._isDialogControl=true;return TokCmd_Lookup(j,b.sub,m)}else{if(b.sub){throw"Unexpected property"}return new TokCmd_ObjectRef(OBJECTREF_DIALOGPROP,j,{dlg:m,prop:b.val})}}if(j._isValueProp){if(b.val=="displayorder"){return new TokCmd_ObjectRef(OBJECTREF_VALUEPROPPROP,j,{prop:"display"})}if(b.sub){throw"Unknown value property property ["+arom.val+"]"}}if(j._isDialogInsts){if(b.val=="clear"){return new TokCmd_ObjectRef(OBJECTREF_METHOD,j,{aMethod:"clearsubdlginsts"})}if(!j.hasOwnProperty(b.val)){if(j.current){e=j.dialogs[j.current-1];return TokCmd_Lookup(e,b,m)}throw"Unknown dialog instance property ["+b.val+"]"}throw"Invalid dialog instance property ["+b.val+"]"}if(j._isDialogInst){var n=dictionary.GetObjectByName(b.val,true);if(!n){throw"Unknown dialog instance object ["+b.val+"]"}for(t=0;t<j.aDefinition.instanceatts.length;t++){if(j.aDefinition.instanceatts[t].att==n.aID){var q=j.GetDialogInstObject(n.aID);if(b.sub){if(b.idxs){if(b.idxs.length>1){throw"Too many indexes for variable"}w=TokCmd_Eval(b.idxs[0],EVAL_NUM);if((w<1)||(w>q.dialogs.length)){throw"Sub dialog instance ref out of bounds ["+w+"]"}q=q.dialogs[w-1];q._isDialogInst=true}}return TokCmd_Lookup(q,b.sub,m)}}throw"Unknown dialog instance property ["+b.val+"]"}if((j.aType==TYPE_LIST)||(j.aType==TYPE_NUMERIC)||(j.aType==TYPE_DATE)||(j.aType==TYPE_BOOLEAN)||(j.aType==TYPE_TEXT)){if(b.val=="default"){b.val="_default"}if(j.flatProps.hasOwnProperty(b.val)){if(b.idxs){throw"Index not allowed for object.flatprop"}return new TokCmd_ObjectRef(OBJECTREF_FLATPROP,j,{prop:b.val})}if(j.aValueProps){for(t=0;t<j.aValueProps.list.length;t++){if(j.aValueProps.list[t].realName.toLowerCase()==b.val.toLowerCase()){if(b.sub){j.aValueProps.list[t]._isValueProp=true;return TokCmd_Lookup(j.aValueProps.list[t],b.sub,m)}var p=j.aValueProps.list[t].aName;w=TokCmd_GetValueIndex(j,b);return new TokCmd_ObjectRef(OBJECTREF_VALUEPROP,j,{idx:w,prop:p})}}}if(j.aType==TYPE_LIST){switch(b.val){case"delinstance":if(b.prms.length!=1){throw"delinstance requires 1 parameter"}w=TokCmd_castToForced(TokCmd_Eval(b.prms[0],EVAL_NUM));return new TokCmd_ObjectRef(OBJECTREF_METHOD,j,{aMethod:"delinstance",idx:w});case"addinstance":if(b.prms.length!=1){throw"addinstance requires 1 parameter"}var r=TokCmd_castToForced(TokCmd_Eval(b.prms[0],EVAL_STR));return new TokCmd_ObjectRef(OBJECTREF_METHOD,j,{aMethod:"addinstance",valName:r});case"clearinstances":if(b.prms!=undefined){throw"clearinstances requires 0 parameters"}return new TokCmd_ObjectRef(OBJECTREF_METHOD,j,{aMethod:"clearinstances"})}}switch(b.val){case"clear":if(b.prms){throw"clear requires 0 parameters"}return new TokCmd_ObjectRef(OBJECTREF_METHOD,j,{aMethod:"clear"});case"evaluate":if(b.prms){throw"evaluate requires 0 parameters"}return new TokCmd_ObjectRef(OBJECTREF_METHOD,j,{aMethod:"evaluate"});case"oncapture":case"onupdate":case"onleave":case"onhierarchyenter":case"onhierarchyexit":if(b.prms){throw"event requires 0 parameters"}var d;switch(b.val){case"oncapture":d=EVENT_CAPTURE;break;case"onupdate":d=EVENT_UPDATE;break;case"onleave":d=EVENT_LEAVE;break;case"onhierarchyenter":d=EVENT_HIERARCHYENTER;break;case"onhierarchyexit":d=EVENT_HIERARCHYEXIT;break}return new TokCmd_ObjectRef(OBJECTREF_USCEVENT,j,{aEvent:d})}}if(j.aType==TYPE_DIALOG){if(b.val=="doupdates"){return new TokCmd_ObjectRef(OBJECTREF_METHOD,j,{aMethod:"doupdates"})}if(j.aDefinition.hasOwnProperty(b.val)){if(b.sub){throw"Unexpected property"}return new TokCmd_ObjectRef(OBJECTREF_DIALOGPROP,j.aDefinition,{dlg:j,prop:b.val})}var g=j.GetControlByName((j._isDialogParentControl?"parent_dot_":"")+b.val);if(g){if(!b.sub){throw"Control property expected"}g._isDialogControl=true;return TokCmd_Lookup(g,b.sub,j)}if(b.val=="parent"){if(!b.sub){throw"Control name expected"}j._isDialogParentControl=true;var u=TokCmd_Lookup(j,b.sub,j);delete j._isDialogParentControl;return u}e=j.GetDialogInstObjectByName(b.val,true);if(e){if(b.idxs){if(b.idxs.length>1){throw"Too many indexes for variable"}w=TokCmd_Eval(b.idxs[0],EVAL_NUM);if((w<1)||(w>e.dialogs.length)){throw"Sub dialog instance ref out of bounds ["+w+"]"}e=e.dialogs[w-1];e._isDialogInst=true}else{if(!b.sub){return new TokCmd_ObjectRef(OBJECTREF_OBJECT,e)}e._isDialogInsts=true}return TokCmd_Lookup(e,b.sub,e)}}if(j.aType==TYPE_TXTPROCESSOR){if(b.val=="text"){return new TokCmd_ObjectRef(OBJECTREF_TXTPROCPROP,j,{prop:b.val})}}throw"Unknown property ["+b.val+"]";default:throw"Invalid object reference"}}function TokCmd_Set(b,a){switch(b.aType){case OBJECTREF_OBJECT:b.aObject.val(a);break;case OBJECTREF_ARRAYITEM:b.aObject.SetValue(a,b.aExtra.idx1,b.aExtra.idx2);break;case OBJECTREF_FLATPROP:b.aObject.flatProps[b.aExtra.prop]=TokCmd_castToForced(a,TokCmd_jsToType(b.aObject.flatProps[b.aExtra.prop]));replayProtection.set(b.aObject,true);break;case OBJECTREF_VALUEPROP:b.aObject.aValues[b.aExtra.idx][b.aExtra.prop]=TokCmd_castToForced(a,TokCmd_jsToType(b.aObject.aValues[b.aExtra.idx][b.aExtra.prop]));if(b.aExtra.prop==b.aObject.aValueProps.general.descriptionprop){b.aObject.aValues[b.aExtra.idx].aText=b.aObject.GetValueDescr(b.aExtra.idx)}break;case OBJECTREF_DIALOGPROP:b.aObject[b.aExtra.prop]=TokCmd_castToForced(a,TokCmd_jsToType(b.aObject[b.aExtra.prop]));if(b.aExtra.dlg){b.aExtra.dlg.dirty=true}break;case OBJECTREF_VALUEPROPPROP:b.aObject[b.aExtra.prop]=TokCmd_castToForced(a,TokCmd_jsToType(b.aObject[b.aExtra.prop]));break;case OBJECTREF_TXTPROCPROP:b.aObject.val(a);break;default:throw"Expression does not reference an assignable item"}}var OBJECT_TYPE_ERR="Expression does not reference a compatible object";var INDEX_OUT_ERR="Index out of bounds";function TokCmd_TypeCheck(e,b,a,d){if(typeof e!=b){throw"Invalid parameter type passed in @"+a+" command. Expected ["+b+"] but received ["+(typeof e)+"]"+(d?" for parameter ["+d+"]":"")}}var call_stack=[];function stk_reset(){call_stack=[]}function stk_in(a){call_stack.push(a)}function stk_out(){call_stack.splice(call_stack.length-1,1)}function stk_isValid(){return call_stack.length>0}function stk_toString(){var a="[";for(var b=call_stack.length-1;b>=0;b--){a+=(b<call_stack.length-1?" <- ":"")+call_stack[b]}return a+"]"}function FPC(d,b,a){if(typeof d==a){return d}softError("Fixing parameter type for ["+b+"]. Expected ["+a+"] but received ["+(typeof d)+"]");switch(a){case"string":return""+d;case"number":return parseFloat(d);case"boolean":switch(typeof d){case"string":return(d.toLowerCase=="true")||(d.toLowerCase=="yes");case"number":return d>0;default:return false}}}function TokCmd_ArrAssign(b,a){if(b.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if(b.aObject.aType!=TYPE_VARIABLE){throw OBJECT_TYPE_ERR}if(!$.isArray(b.aObject.data)){throw INDEX_OUT_ERR}if(!$.isArray(a)){throw INDEX_OUT_ERR}for(var d=0;d<a.length;d++){if(d>=b.aObject.dim1){throw INDEX_OUT_ERR}if($.isArray(b.aObject.data[d+1])){if($.isArray(a[d])){b.aObject.data[d+1]=a[d].slice(0);b.aObject.data[d+1].splice(0,0,0)}else{b.aObject.data[d+1][1]=a[d]}}else{if($.isArray(a[d])){b.aObject.data[d+1]=a[d][0]}else{b.aObject.data[d+1]=a[d]}}}}function TokCmd_Do(b,a){switch(b.aType){case OBJECTREF_OBJECT:if((b.aObject.aType==TYPE_LIST)||(b.aObject.aType==TYPE_NUMERIC)||(b.aObject.aType==TYPE_DATE)||(b.aObject.aType==TYPE_BOOLEAN)||(b.aObject.aType==TYPE_TEXT)){if(typeof a=="number"){return b.aObject.Run({exitOnEmpty:a==1})}else{return b.aObject.Run()}}else{if(a){return b.aObject.Run.apply(b.aObject,a)}}return b.aObject.run();case OBJECTREF_METHOD:switch(b.aExtra.aMethod){case"delinstance":b.aObject.DelInstance(b.aExtra.idx);return true;case"addinstance":b.aObject.AddInstance(b.aExtra.valName);return true;case"clearinstances":b.aObject.ClearInstances();return true;case"clear":b.aObject.Clear();return true;case"evaluate":b.aObject.Evaluate();return true;case"doupdates":b.aObject.DoUpdates();return true;case"clearsubdlginsts":b.aObject.current=0;b.aObject.selectedIndex=0;b.aObject.dialogs=[];return true;default:throw"Unknown method ["+b.aObject.aName+"."+b.aExtra.aMethod+"]"}break;case OBJECTREF_USCEVENT:b.aObject.FireEvent(b.aExtra.aEvent);return true;default:throw OBJECT_TYPE_ERR}}function TokCmd_Clear(a){if(a.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}a.aObject.Clear()}function TokCmd_Evaluate(a){if(a.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}a.aObject.Evaluate()}function TokCmd_InitArray(b,a){if(!b){throw"TODO: @InitArray on all the arrays"}else{if(b.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}}if(b.aObject.aType!=TYPE_VARIABLE){throw OBJECT_TYPE_ERR}b.aObject.Clear(a)}function TokCmd_ListOp(f,h,e){if(f.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if(f.aObject.aType!=TYPE_LIST){throw OBJECT_TYPE_ERR}if(!f.aObject.isMultiSel){throw OBJECT_TYPE_ERR}var g,b;for(g=0;g<e.length;g++){var a=f.aObject.NameToID(e[g]);if(a===0){throw"Unknown object value ["+e[g]+"] for object ["+f.aObject.aName+"]"}e[g]=a}switch(h){case"SET":f.aObject.SetValue(e);break;case"ADD":b=f.aObject.GetValue();for(g=0;g<e.length;g++){b.push(e[g])}f.aObject.SetValue(b);break;case"DEL":b=f.aObject.GetValue();for(g=0;g<e.length;g++){var d=$.inArray(e[g],b);if(d>=0){b.splice(d,1)}}f.aObject.SetValue(b);break}}function TokCmd_AttribVals(b,a){if(b.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if((b.aObject.aType!=TYPE_LIST)&&(b.aObject.aType!=TYPE_BOOLEAN)){throw OBJECT_TYPE_ERR}if(a.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if(a.aObject.aType!=TYPE_VARIABLE){throw OBJECT_TYPE_ERR}if(a.aObject.varType!=VARTYPE_STR){throw OBJECT_TYPE_ERR}for(var d=0;d<b.aObject.aValues.length;d++){a.aObject.SetValue(b.aObject.aValues[d].aName,d+1)}return b.aObject.aValues.length}function TokCmd_Copy(d,b,a){TokCmd_TypeCheck(d,"string","Copy","Source");return d.substr(b-1,a)}function TokCmd_LogToNum(a){if(a.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if((a.aObject.aType!=TYPE_LIST)&&(a.aObject.aType!=TYPE_BOOLEAN)){throw OBJECT_TYPE_ERR}return a.aObject.ValueIDtoIndex(a.aObject.GetValue())+1}function TokCmd_NumToLog(a,b){if(b.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if((b.aObject.aType!=TYPE_LIST)&&(b.aObject.aType!=TYPE_BOOLEAN)){throw OBJECT_TYPE_ERR}if(a<1){throw INDEX_OUT_ERR}if(a>b.aObject.aValues.length){throw INDEX_OUT_ERR}b.aObject.SetValue(b.aObject.aValues[a-1].aID)}function TokCmd_Pad(a,b){TokCmd_TypeCheck(a,"string","Pad","String");while(a.length<b){a+=" "}return a}function TokCmd_UnPad(a){TokCmd_TypeCheck(a,"string","UnPad","String");return $.trim(a)}function TokCmd_Pos(b,a){TokCmd_TypeCheck(a,"string","Pos","String");return a.indexOf(b)+1}function TokCmd_GetReportText(a){if(a.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if(a.aObject.aType!=TYPE_REPORT){throw OBJECT_TYPE_ERR}return a.aObject.GetText(true)}function TokCmd_Date(a){return Cmd_GetDate(a?a:1)}function TokCmd_DecodeDate(b){var a=Cmd_Decode_Date(b);return{d:a.getUTCDate(),m:a.getUTCMonth()+1,y:a.getUTCFullYear()}}function TokCmd_Time(a){return Cmd_StrTime(Cmd_GetTime(a))}function TokCmd_RunMode(){return Cmd_RunMode()}function TokCmd_Rnd(a){return Math.random()*a}function TokCmd_Frac(a){return cmd_Frac(a)}function TokCmd_Sqr(a){return Math.pow(a,2)}function TokCmd_DecodeData(d,b,a){return{err:Cmd_DecodeData(d,(b=="XML"),-1,0)}}function TokCmd_RefListToIDlist(b){var a=[];if($.isArray(b)){for(var d=0;d<b.length;d++){if(b[d].aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}a.push(b[d].aObject.aID)}}return a}function TokCmd_EncodeData(b,a,g,f){var e="";var h=TokCmd_RefListToIDlist(f);if(a){h.push(-1)}switch(b){case"XML":e=Cmd_EncodeData(h,true,"",true);break;case"XML_EXTEND":var d="";e=Cmd_EncodeData_Extend(h,true,"",true,d);break;case"XML_NOPROPS":e=Cmd_EncodeData(h,true,"","3");break;case"TXT":e=Cmd_EncodeData(h,false,"",false);break}return e}function TokCmd_DecodeDataXML(d,b,e){var a=0;if(e){if(e.aType==OBJECTREF_OBJECT){a=e.aObject.aID}}return{err:Cmd_DecodeDataXML(d,-1,a,b)}}function TokCmd_EncodeDataXML(a,g,e,d){var f=TokCmd_RefListToIDlist(e);var b=a?"3":true;if(g){return Cmd_EncodeData_Extend(f,true,"",b,d)}return Cmd_EncodeData(f,true,"",b)}function TokCmd_Constrain(b,a){if(b.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if(!a){Constrain([b.aObject.aID])}else{replayStack.CriticalSection(function(d){Constrain([b.aObject.aID]);d.CriticalDone()})}}function TokCmd_Val(a){var b={val:parseFloat(a),err:0};if(isNaN(b.val)){b.val=0;b.err=1}return b}function TokCmd_UrlFetch(e,b,a){var d=Cmd_URLfetch(e,b,undefined,undefined,a);return{ret:d.data,ok:d.success}}function TokCmd_Regex(g,d,f,j){if(j.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}var h=new RegExp(d,f);switch(j.aObject.aType){case TYPE_BOOLEAN:j.aObject.SetValueAsBool(h.test(g));break;case TYPE_VARIABLE:if(j.aObject.varType!=VARTYPE_STR){throw OBJECT_TYPE_ERR}var b=0;var a,e;do{a=h.exec(g);if(a){e=a[0]}else{e=""}j.aObject.SetValue(e,++b,1);if(!h.global){a=false}}while(a);break;default:throw OBJECT_TYPE_ERR}}function TokCmd_Split(e,d,f){TokCmd_TypeCheck(e,"string","Split","String");if(f.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if(f.aObject.varType!=VARTYPE_STR){throw OBJECT_TYPE_ERR}var b=e.split(d);if((b.length>1)&&(b[b.length-1].length==0)){b.splice(b.length-1,1)}f.aObject.SetValue(b);return{cnt:b.length}}function TokCmd_Message(a,b){if(msgFlashDivTimer){clearTimeout(msgFlashDivTimer);msgFlashDivTimer=null}if($.trim(a).length===0){msgFlashDiv.hide()}else{msgFlashDiv.html(a).show();if(b){setTimeout(function(){TokCmd_Message("")},b*1000)}}}function TokCmd_HierarchyToStr(b){var a=null;if(b){if(b.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if(b.aObject.varType!=VARTYPE_HIERARCHY){throw OBJECT_TYPE_ERR}a=b.aObject}return hierarchy.toString(a,"legacy")}function TokCmd_NumToStr(b,a){TokCmd_TypeCheck(b,"number","NumToStr","number");TokCmd_TypeCheck(a,"number","NumToStr","decs");return b.toFixed(a).toString()}function TokCmd_EncodeDate(a,e,f){if(arguments.length==0){var b=new Date();return Cmd_EncodeDate(b.getFullYear(),b.getMonth()+1,b.getDate())}else{if(typeof a!="number"){throw"Invalid number type for Day"}if(typeof e!="number"){throw"Invalid number type for Month"}if(typeof f!="number"){throw"Invalid number type for Year"}return Cmd_EncodeDate(f,e,a)}}function TokCmd_Uncaptured(a){if(a.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}return GetUncaptured(a.aObject)}function TokCmd_EncodeDialogXML(a){var b;if(a){b=TokCmd_RefListToIDlist(a)}return Cmd_DialogInstanceData(undefined,b)}function TokCmd_DBcall(d,b,h,f,a){var g={};var e=replayStack.PopReplay(d.aID,false,g);if(e==REPLAYPOP_HANDLED){if(!g.ok&&a){hardError(g.error);return}return g}else{if(e==REPLAYPOP_CURRENT){ServerCall(d.aID,"method=DB&dbid="+b+"&sql="+escape(h)+"&retarr="+(f?"1":"0")+"&pauseid="+d.aID);return false}else{hardError("Unknown replay pop return ["+e+"]");return}}}function TokCmd_Phone(a,d,b){return Cmd_Phone(a,d,-1,b)}function TokCmd_PhoneFeature(a,b){return Cmd_PhoneFeature(a,b,-1)}function TokCmd_SetDialogInstanceData(b,a){return Cmd_SetDialogInstanceData(b,a)}function TokCmd_DoBayes(a){if(!a){throw OBJECT_TYPE_ERR}if(a.aType!=OBJECTREF_OBJECT){throw OBJECT_TYPE_ERR}if(a.aObject.aType!=TYPE_LIST){throw OBJECT_TYPE_ERR}var b=a.aObject;b.runBayes()}function TokCmd_GetBookmark(){return urlParams.site+"?bm="+escape(replayStack.Serialize())+urlParams.toString(true)}function TokCmd_GetDays(a){if(typeof a!="object"){return 0}return a.getTime()/86400000}function TokCmd_ArrayMin(a,d){if(d>a.dim1){d=a.dim1}var e=null;for(var f=0;f<d;f++){var b=a.GetValue(f+1);if((e===null)||(b<e)){e=b}}return e}function TokCmd_ArrayMax(a,d){if(d>a.dim1){d=a.dim1}var e=null;for(var f=0;f<d;f++){var b=a.GetValue(f+1);if((e===null)||(b>e)){e=b}}return e}function TokCmd_ArrayAvg(a,d){if(d>a.dim1){d=a.dim1}var b=0;for(var e=0;e<d;e++){b+=a.GetValue(e+1)}return e>0?b/e:null}function TokCmd_ArrayLen(a){return a.dim1}function _dbg(a){lastErr=a}var XRdocClassifier={stop_words:["a","about","above","above","across","after","afterwards","again","against","all","almost","alone","along","already","also","although","always","am","among","amongst","amoungst","amount","an","and","another","any","anyhow","anyone","anything","anyway","anywhere","are","around","as","at","back","be","became","because","become","becomes","becoming","been","before","beforehand","behind","being","below","beside","besides","between","beyond","bill","both","bottom","but","by","call","can","cannot","cant","co","con","could","couldnt","cry","de","describe","detail","do","done","down","due","during","each","eg","eight","either","eleven","else","elsewhere","empty","enough","etc","even","ever","every","everyone","everything","everywhere","except","few","fifteen","fify","fill","find","fire","first","five","for","former","formerly","forty","found","four","from","front","full","further","get","give","go","had","has","hasnt","have","he","hence","her","here","hereafter","hereby","herein","hereupon","hers","herself","him","himself","his","how","however","hundred","ie","if","in","inc","indeed","interest","into","is","it","its","itself","keep","last","latter","latterly","least","less","ltd","made","many","may","me","meanwhile","might","mill","mine","more","moreover","most","mostly","move","much","must","my","myself","name","namely","neither","never","nevertheless","next","nine","no","nobody","none","noone","nor","not","nothing","now","nowhere","of","off","often","on","once","one","only","onto","or","other","others","otherwise","our","ours","ourselves","out","over","own","part","per","perhaps","please","put","rather","re","same","see","seem","seemed","seeming","seems","serious","several","she","should","show","side","since","sincere","six","sixty","so","some","somehow","someone","something","sometime","sometimes","somewhere","still","such","system","take","ten","than","that","the","their","them","themselves","then","thence","there","thereafter","thereby","therefore","therein","thereupon","these","they","thickv","thin","third","this","those","though","three","through","throughout","thru","thus","to","together","too","top","toward","towards","twelve","twenty","two","un","under","until","up","upon","us","very","via","was","we","well","were","what","whatever","when","whence","whenever","where","whereafter","whereas","whereby","wherein","whereupon","wherever","whether","which","while","whither","who","whoever","whole","whom","whose","why","will","with","within","without","would","yet","you","your","yours","yourself","yourselves","the"],_stemmer:function(){var h={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},e={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},j="[^aeiou]",l="[aeiouy]",a=j+"[^aeiouy]*",g=l+"[aeiou]*",f="^("+a+")?"+g+a,b="^("+a+")?"+g+a+"("+g+")?$",d="^("+a+")?"+g+a+g+a,k="^("+a+")?"+l;return function(t){var n,v,u,x,q,p,o,m=t;if(t.length<3){return t}u=t.substr(0,1);if(u=="y"){t=u.toUpperCase()+t.substr(1)}x=/^(.+?)(ss|i)es$/;q=/^(.+?)([^s])s$/;if(x.test(t)){t=t.replace(x,"$1$2")}else{if(q.test(t)){t=t.replace(q,"$1$2")}}x=/^(.+?)eed$/;q=/^(.+?)(ed|ing)$/;if(x.test(t)){var r=x.exec(t);x=new RegExp(f);if(x.test(r[1])){x=/.$/;t=t.replace(x,"")}}else{if(q.test(t)){var r=q.exec(t);n=r[1];q=new RegExp(k);if(q.test(n)){t=n;q=/(at|bl|iz)$/;p=new RegExp("([^aeiouylsz])\\1$");o=new RegExp("^"+a+l+"[^aeiouwxy]$");if(q.test(t)){t=t+"e"}else{if(p.test(t)){x=/.$/;t=t.replace(x,"")}else{if(o.test(t)){t=t+"e"}}}}}}x=new RegExp("^(.*"+l+".*)y$");if(x.test(t)){var r=x.exec(t);n=r[1];t=n+"i"}x=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/;if(x.test(t)){var r=x.exec(t);n=r[1];v=r[2];x=new RegExp(f);if(x.test(n)){t=n+h[v]}}x=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/;if(x.test(t)){var r=x.exec(t);n=r[1];v=r[2];x=new RegExp(f);if(x.test(n)){t=n+e[v]}}x=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/;q=/^(.+?)(s|t)(ion)$/;if(x.test(t)){var r=x.exec(t);n=r[1];x=new RegExp(d);if(x.test(n)){t=n}}else{if(q.test(t)){var r=q.exec(t);n=r[1]+r[2];q=new RegExp(d);if(q.test(n)){t=n}}}x=/^(.+?)e$/;if(x.test(t)){var r=x.exec(t);n=r[1];x=new RegExp(d);q=new RegExp(b);p=new RegExp("^"+a+l+"[^aeiouwxy]$");if(x.test(n)||(q.test(n)&&!(p.test(n)))){t=n}}x=/ll$/;q=new RegExp(d);if(x.test(t)&&q.test(t)){x=/.$/;t=t.replace(x,"")}if(u=="y"){t=u.toLowerCase()+t.substr(1)}return t}},_stem:null,stem:function(a){if(!this._stem){this._stem=this._stemmer()}return this._stem(a)},_addDocument:function(b,e,d){var a={words:this._getWordArray(e),word_frequencies:[],data:d};b.documents.push(a)},_computAllWordFrequencies:function(b){b.words=[];for(var d=0;d<b.documents.length;d++){var a=b.documents[d];a.word_frequencies=[]}for(var d=0;d<b.documents.length;d++){var a=b.documents[d];for(var e=0;e<a.words.length;e++){var f=a.words[e];this._computeWordFrequenciesWithWord(b,f,d)}}},_computeWordFrequenciesWithWord:function(e,h,d){for(var f=0;f<e.documents.length;f++){var b=e.documents[f];var a=(f==d?1:0);var g=this._arrayBinaryGetObjectWithName(b.word_frequencies,h);if(!g){g={name:h,count:a};this._arrayBinaryInsertObject(b.word_frequencies,g)}else{g.count+=a}if(a==1&&g.count==1){var j=this._arrayBinaryGetObjectWithName(e.words,g.name);if(!j){j={name:g.name,appearance_count:a};this._arrayBinaryInsertObject(e.words,j)}else{j.appearance_count+=a}}}},_computeTfIdfValues:function(b){for(var d=0;d<b.documents.length;d++){var a=b.documents[d];for(var f=0;f<a.word_frequencies.length;f++){var e=a.word_frequencies[f];var g=this._arrayBinaryGetObjectWithName(b.words,e.name);e.tf=e.count/a.words.length;e.idf=Math.log10(a.word_frequencies.length/g.appearance_count);e.tf_idf=e.idf==0?0:e.tf/e.idf}}},_computeCosineAngles:function(b){var e=b.documents[b.documents.length-1];for(var d=0;d<b.documents.length;d++){var a=b.documents[d];a.cosine_angle=this._getCosineAngle(e.word_frequencies,a.word_frequencies)}},_getOutputData:function(d,f){var a=[];for(var e=0;e<d.documents.length-1;e++){var b=d.documents[e];a.push({data:b.data,angle:b.cosine_angle})}a.sort(function(h,g){return h.angle-g.angle});a=a.slice(0,Math.min(a.length,f));return a},_dotProduct:function(e,d,f){var h=0;for(var g=0;g<Math.min(e.length,d.length);g++){h+=e[g][f]*d[g][f]}return h},_norm:function(b,d){var f=0;for(var e=0;e<b.length;e++){f+=Math.pow(b[e][d],2)}f=Math.sqrt(f);return f},_getCosineAngle:function(e,d){var g=0;var f=this._dotProduct(e,d,"tf_idf");var j=this._norm(e,"tf_idf")*this._norm(d,"tf_idf");if(j!=0){g=f/j}if(g>1){g=1}else{if(g<-1){g=-1}}var h=Math.acos(g);return h},_getWordArray:function(a){var f=a.toLowerCase().match(/\b[a-z0-9_]+\b/g);if(f){for(var b=0;b<f.length;b++){var e=f[b];if(e.length<3){f.splice(b,1);b--;continue}for(var d=0;d<this.stop_words.length;d++){if(e==this.stop_words[d]){f.splice(b,1);b--;break}}}}return f},_arrayBinaryGetObjectWithName:function(d,b){var a=this._arrayBinaryFindAObjectWithName(d,b,true);if(a!=-1){return d[a]}else{return null}},_arrayBinaryFindAObjectWithName:function(j,a,g){if(j.length>0){var l=a.length;var f=a.toLowerCase();var b=0;var e=j.length-1;while(b<=e){var h=Math.floor(b+(e-b)/2);var d=j[h];var k=d.name;if(!g){k=k.substring(0,l)}if(k==a){return h}else{if(d.name.toLowerCase()<f){b=h+1}else{e=h-1}}}}return -1},_arrayBinaryInsertObject:function(j,g){if(j.length>0){var a=g.name;var k=a.length;var f=a.toLowerCase();var b=0;var e=j.length-1;while(b<=e){var h=Math.floor(b+(e-b)/2);var d=j[h];if(d.name.toLowerCase()<f){b=h+1}else{e=h-1}}j.splice(b,0,g)}else{j.push(g)}},classify:function(a,b,g){if(g===undefined){g=10}var f=a.slice();f.push({text:b,data:null});var d={documents:[],words:[]};for(var e=0;e<f.length;e++){this._addDocument(d,f[e].text,f[e].data)}this._computAllWordFrequencies(d);this._computeTfIdfValues(d);this._computeCosineAngles(d);return this._getOutputData(d,g)}};var _hb={a:42,u:"../../\u0068\u0065a\u0072\u0074b\u0065\u0061\u0074.\u0070h\u0070",id:0,su:function(a){var b=this;if(this.a==42){a()}else{$.ajax({url:this.u,data:{m:1},type:"POST",dataType:"json",success:function(e){if(e.result!="ok"){b.woops(e.message)}else{b.id=e.id;a()}},error:function(f,d,g){b.woops(g)}})}},nx:function(a){var b=this;if(this.a==42){a()}else{$.ajax({url:this.u,data:{m:2,id:b.id},type:"POST",dataType:"json",success:function(e){if(e.result=="drop"){b.id=0;b.woops(e.message)}else{if(e.result!="ok"){b.woops(e.message)}else{a()}}},error:function(f,d,g){b.woops(g)}})}},ed:function(a){var b=this;if(this.a==42){this.id=0;if($.isFunction(a)){a()}}else{$.ajax({url:this.u,data:{m:3,id:b.id},type:"POST",dataType:"json",success:function(e){b.id=0;if($.isFunction(a)){a()}}})}},woops:function(a){ShowModal(a,"Communication Error")}};var xpertrule={version:"0.1",init_func:null,refresh_func:null,nodejs_callback_fn:null,previousAnswerCaptionRender:null,isLive:true,inStartup:false,xrProcObj:{aID:9876},_hintprops:["back();","capturedObjects();","chat(settings);","decodeData(inputStr);","encodeData(extraObjectIDs, includeCaptured, encodeType);","disableUI([cssProperties]);","enableUI();","exit(showConfirmation);","findObject(name or ID)","flashMessage(message[, duration]);","getValuesToObject(objectIDs);","initialize(callbackFn);","instances(objectName);","lineOfReasoning();","message(content, title, buttonText);","messageJSON(objectOrString);","ok();","pause(passbackString);","phone(phoneFeature, params);","phoneFeature(method);","refresh(callbackFn);","restart();","restartPos();","runMode()","setValuesWithObject(valueObject);","terminate(errorMessageStr);","tfidf_classify(documentArray, testDocument, maxResults);","urlFetch(url, postData);"],reset:function(){this.init_func=null;this.refresh_func=null},startup:function(a){return XR_Startup(a.aDiv,a)},message:function(d,b,a){if(!this.isLive){return}if(typeof d!="string"){d+=""}if(b){d+="_|_"+b;if(a){d+="_|_"+a}}Cmd_Debug(this.xrProcObj,d,b,null,false)},messageJSON:function(b){if($.isPlainObject(b)){b=JSON.stringify(b,null,4)}else{if(typeof b=="string"){try{b=JSON.parse(b);b=JSON.stringify(b,null,4)}catch(a){b="Bad JSON string ["+b+"]"}}else{b="Bad type ["+(typeof b)+"] passed to messageJSON"}}if(typeof chat_mode=="string"){b=b.replace(/\n/g,"<br>");b=b.replace(/\s/g,"&nbsp;")}this.message(b)},flashMessage:function(b,a){TokCmd_Message(b,a)},ok:function(){if(!this.isLive){return}if(!currentDlg){return}currentDlg.ok(false,false)},back:function(){if(!this.isLive){return}if(!currentDlg){return}currentDlg.back()},exit:function(a){if(!this.isLive){return}if(replayStack.PopReplay(ADHOC_DIALOG_PSEUDOID)==REPLAYPOP_CURRENT){if(a&&appSettings.showCloseConfirm){var b=getTranslation("close_confirmation_text","Close Application?");if(b.length>0){ShowModal(b,appSettings.title,{showCancelBtn:true},function(){replayStack.Add(ADHOC_DIALOG_PSEUDOID,REPLAY_EXIT);Go()},function(){replayStack.Add(ADHOC_DIALOG_PSEUDOID,REPLAY_OK);Go()});throw new inferenceIssue(PASSBACK_WAIT)}}replayStack.Add(ADHOC_DIALOG_PSEUDOID,REPLAY_EXIT);throw new inferenceIssue(PASSBACK_LOOP)}},macro:function(a,b){if(!this.isLive){return}if(!currentDlg){return}var d=_dgobn(a);if(!d){throw"Unknown procedure ["+a+"]"}currentDlg.macro(d.aID,b)},initialize:function(a){this.init_func=a},pageLoaded:function(){if(this.init_func){this.init_func()}},refresh:function(a){if(a){this.refresh_func=a}else{if(!this.isLive){return}Go()}},doRefresh:function(){if(this.refresh_func){this.refresh_func()}},onRender:function(a){if(!this.isLive){return}if(!currentDlg){return}htmlDialogCallBacks.add(currentDlg.aID,a,"onrender")},onPopulate:function(a){if(!this.isLive){return}if(!currentDlg){return}htmlDialogCallBacks.add(currentDlg.aID,a,"onpopulate")},val:function(d,b,a){if(!this.isLive){return}if(this.inStartup){currentConditionalObj=0}else{if(!currentDlg){currentConditionalObj={aID:ADHOC_DIALOG_PSEUDOID}}else{currentConditionalObj=dictionary.GetObject(currentDlg.aID)}}if(b==undefined){return GetValue(d)}else{SetValue(d,b,a);return this}},"continue":function(){if(!this.isLive){return}if(currentDlg){currentConditionalObj=dictionary.GetObject(currentDlg.aID)}replayStack.Add(currentConditionalObj,REPLAY_OK);Go()},instances:function(e){if(!this.isLive){return}var b=_dgobn(e);if(!b){return null}if((b.aType!=TYPE_LIST)&&(b.aType!=TYPE_BOOLEAN)){return null}if(!b.Load(b)){return null}var a=[];for(var d=0;d<b.aValues.length;d++){a.push(b.aValues[d].aName)}return a},run:function(b){if(!this.isLive){return}var a=_dgobn(b);if(a){BtnClk("mac|"+a.aID)}},runMode:function(){switch(Cmd_RunMode()){case 7:return"APP";case 9:return"NODEJS_TEST";case 8:return"NODEJS";case 5:return"BROWSER_TEST";case 6:return"BROWSER";case 10:return"CHAT_BROWSER";case 11:return"CHAT_SERVER";default:return"UNKNOWN"}},pause:function(a){Cmd_Pause({aID:ADHOC_DIALOG_PSEUDOID},a)},chat:function(a){this.pause(JSON.stringify(a))},encodeData:function(f,d,e){if(!e){e="XML"}var b=[];if($.isArray(f)){for(var j=0;j<f.length;j++){if(typeof f[j]=="object"){b.push(f[j].aID)}else{if(typeof f[j]=="number"){b.push(f[j])}else{if(typeof f[j]=="string"){var h=_dgobn(f[j]);if(h){b.push(h.aID)}}}}}}if(d){b.push(-1)}if(e=="XML"){return Cmd_EncodeData(b,true,"",true)}else{var g=this.getValuesToObject(b);return JSON.stringify(g)}},decodeData:function(f){if(f.substr(0,1)=="{"){try{var d=$.parseJSON(f);this.setValuesWithObject(d);return true}catch(b){return false}}else{var a=Cmd_DecodeDataXML(f,-1,0);if(typeof a!="string"){a=true}return a}},capturedObjects:function(){return $.extend(true,[],capturedAtts)},urlFetch:function(d,a){var b=Cmd_URLfetch({aID:ADHOC_DIALOG_PSEUDOID},d,undefined,undefined,a);return b.data},setValuesWithObject:function(b){if($.isPlainObject(b)){for(var d in b){var f=_dgobn(d,true,false);if(f){var a=b[d];if($.isPlainObject(a)&&f.flatProps){for(var e in a){if(e=="_value"){f.val(a[e])}else{if(f.flatProps.hasOwnProperty(e)){f.flatProps[e]=a[e]}}}}else{f.val(a)}}}}},getValuesToObject:function(g){var f={};var e;var a;var j;var k;if(!$.isArray(g)||(g.length===0)){g=capturedAtts}else{e=$.inArray(-1,g);if(e>=0){g.splice(e,1);for(e=0;e<capturedAtts.length;e++){if($.inArray(capturedAtts[e],g)==-1){g.push(capturedAtts[e])}}}}for(e=0;e<g.length;e++){j=null;a=_dgo(g[e]);if(a){switch(a.aType){case TYPE_LIST:case TYPE_BOOLEAN:j={_value:a.val()};for(k=0;k<a.aValueProps.general._xmlexport.length;k++){var h=a.GetValueProp(a.aValueProps.general._xmlexport[k],-1);j[a.aValueProps.general._xmlexport[k]]=(h!=null?h:"")}break;case TYPE_NUMERIC:j={_value:a.val()};break;case TYPE_DATE:var b=a.val();j={_value:strftime("yyyymmdd",b.getDate(),b.getMonth(),b.getFullYear())};break;case TYPE_TEXT:j={_value:a.val()};break;case TYPE_VARIABLE:var d;if($.isArray(a.data)){d=a.data.slice(1);if(a.dim2>1){for(k=1;k<=a.dim1;k++){d[k-1].splice(0,1)}}}else{d=a.val()}j={_value:d};break}if(a.aType!=TYPE_VARIABLE&&$.isPlainObject(j)){for(k=0;k<a.flatProps._xmlexport.length;k++){j[a.flatProps._xmlexport[k]]=a.flatProps[a.flatProps._xmlexport[k]]}}}if(j){f[a.aName]=j}}return f},phone:function(b,a){if(!$.isArray(a)){hardError("Array of strings expected as second parameter")}return Cmd_Phone({aID:ADHOC_DIALOG_PSEUDOID},b,-1,a)},phoneFeature:function(a){return Cmd_PhoneFeature({aID:ADHOC_DIALOG_PSEUDOID},a,-1)},findObject:function(a){return dictionary.findObject(a)},lineOfReasoning:function(){return lineOfReasoning},clear:function(){dictionary.ClearAll()},$ui_disable_shim:null,disableUI:function(a){if(!this.$ui_disable_shim){this.$ui_disable_shim=$("<div></div>").attr("id","xrkb_ui_disable").attr("tabindex","1").addClass("xrui-uidisable-shim").appendTo("body")}if(a){this.$ui_disable_shim.css(a)}this.$ui_disable_shim.show().focus()},enableUI:function(){if(this.$ui_disable_shim){this.$ui_disable_shim.hide()}},svrPlugin:function(d,b){var e={};var a=replayStack.PopReplay(ADHOC_DIALOG_PSEUDOID,false,e);if(a==REPLAYPOP_HANDLED){return e}else{if(a==REPLAYPOP_CURRENT){var f=function(g){replayStack.Add(ADHOC_DIALOG_PSEUDOID,REPLAY_OBJRETURN,undefined,undefined,g);replayStack.Add(ADHOC_DIALOG_PSEUDOID,REPLAY_OK);Go()};$.ajax({url:isEditor&&$.isPlainObject(xrkb)?"objects/"+xrkb.appID+"/svrplugins/process.php":"xrkb/svrplugins/process.php",type:"POST",cache:false,data:{plugin:d,msg:JSON.stringify(b)},dataType:"json",success:function(g){f(g)},error:function(h,g){f({ok:false,error:h.responseText})},timeout:10000});throw new inferenceIssue(PASSBACK_WAIT)}else{hardError("Unknown replay pop return ["+a+"]");return}}},engineVersion:function(){return getVersionAsString()},kbVersion:function(){var a={version:appSettings.hasOwnProperty("version")?appSettings.version:"",build:appSettings.hasOwnProperty("build")?appSettings.build:""};return JSON.stringify(a)},webAuthorVersion:function(){if(xrkb&&xrkb.hasOwnProperty("version")){return xrkb.version}return""},terminate:function(a){hardError(a)},restart:function(){return Cmd_Restart(undefined,true)},restartPos:function(){return Cmd_RestartPos(this.xrProcObj)},once:function(b,g,a){var e={};var f=replayStack.PopReplay(0,false,e);if(f==REPLAYPOP_HANDLED){if($.isFunction(g)){g(e.val)}}else{if(f==REPLAYPOP_CURRENT){if(!$.isFunction(b)){hardError("You must pass a function to once");return}var d=b();if(d){replayStack.Add(0,REPLAY_OBJRETURN,0,0,{val:d})}replayStack.Add(0,REPLAY_CRITICALDONE);if(!a){throw new inferenceIssue(PASSBACK_LOOP)}else{replayStack.replayPos=replayStack.aReplay.length}}else{hardError("Unknown replay pop return ["+f+"]");return}}},_setupNodeCallback:function(a){this.nodejs_callback_fn=a},nodeCallback:function(a){if(!$.isFunction(this.nodejs_callback_fn)){hardError("node.js callback function not sent into GoXML");return}return this.nodejs_callback_fn(a)},translate:function(a){return getTranslation(a,a)},tfidf_classify:function(b,a,d){return XRdocClassifier.classify(b,a,d)}};xpertrule.optimization={settings:{direction:"minimize",nGenerations:100,nIndividuals:100,initialSeed:false,pCrossover:0.3,pMutation:0.3,adaptationStart:0,pAdaptation:0.3,nAdaptationCycles:5,hillClimb:false,timeout:0},chromosomes:[{type:"nonsequenced",sumConstraint:100,genes:[{attribute:null},{value:0,minimum:0,maximum:100,decs:0}]},{type:"sequenced",nGenes:5,array:null},{type:"picklist",nGenes:5,range:10,array:null}],costFn:null,generationStart:null,generationEnd:null,MAXDOUBLE:1000000000,individuals:[],infoObj:{generationNo:0,individualNo:0,settings:null,chromosomes:null},_applySettings:function(a){if((a.settings.direction!="minimize")&&(a.settings.direction!="maximize")){throw"unknown settings.direction ["+a.direction+"]"}if(a.settings.nGenerations<1){throw"must specify at least 1 generation in settings.nGenerations"}if(a.settings.nIndividuals<2){throw"must specify at least 2 individuals in settings.nIndividuals"}this.settings=$.extend(true,this.settings,a.settings);if(!$.isArray(a.chromosomes)||(a.chromosomes.length==0)){throw"must specify a chromosome array with at least 1 chromosome"}var h,f,d;for(h=0;h<a.chromosomes.length;h++){if(!$.isPlainObject(a.chromosomes[h])){throw"must specify an object for chromsome no"+h}switch(a.chromosomes[h].type){case"nonsequenced":if(!$.isArray(a.chromosomes[h].genes)||(a.chromosomes[h].genes.length<1)){throw"must specify a gene array with at lease 1 gene for chromsome no"+h}for(f=0;f<a.chromosomes[h].genes.length;f++){if(a.chromosomes[h].genes[f].hasOwnProperty("value")){if(!a.chromosomes[h].genes[f].hasOwnProperty("decs")){a.chromosomes[h].genes[f].decs=0}if(!a.chromosomes[h].genes[f].hasOwnProperty("minimum")){throw"must specify a minimum value for chromsome no"+h+", gene no"+f}if(!a.chromosomes[h].genes[f].hasOwnProperty("maximum")){throw"must specify a maximum value for chromsome no"+h+", gene no"+f}if(a.chromosomes[h].genes[f].minimum>a.chromosomes[h].genes[f].maximum){throw"minimum gene value must be less than or equal to maximum for chromsome no"+h+", gene no"+f}}else{if(!a.chromosomes[h].genes[f].attribute||(a.chromosomes[h].genes[f].attribute.aType!=TYPE_NUMERIC)){throw"must specify a numeric attribute for chromsome no"+h+", gene no"+f}if(!a.chromosomes[h].genes[f].hasOwnProperty("decs")){a.chromosomes[h].genes[f].decs=a.chromosomes[h].genes[f].attribute.aDecPlaces}if(!a.chromosomes[h].genes[f].hasOwnProperty("minimum")){a.chromosomes[h].genes[f].minimum=a.chromosomes[h].genes[f].attribute.flatProps.minvalue}if(!a.chromosomes[h].genes[f].hasOwnProperty("maximum")){a.chromosomes[h].genes[f].maximum=a.chromosomes[h].genes[f].attribute.flatProps.maxvalue}if(a.chromosomes[h].genes[f].minimum>a.chromosomes[h].genes[f].maximum){throw"minimum gene value must be less than or equal to maximum for gene ["+a.chromosomes[h].genes[f].attribute.aName+"] in chromsome no"+h}}}if(a.chromosomes[h].hasOwnProperty("sumConstraint")){var e=0;var b=0;for(f=0;f<a.chromosomes[h].genes.length;f++){e+=a.chromosomes[h].genes[f].minimum;b+=a.chromosomes[h].genes[f].maximum}if(e>a.chromosomes[h].sumConstraint){throw"minimum sum (of gene minimum values) > sum constraint for chromosome no"+h}if(b<a.chromosomes[h].sumConstraint){throw"maximum sum (of gene maximum values) < sum constraint for chromosome no"+h}}break;case"picklist":if(typeof a.chromosomes[h].range!="number"){throw"must specify range for chromsome no"+h}if(a.chromosomes[h].range<a.chromosomes[h].nGenes){throw"range for picklist chromosome no"+h+" must be >= nGenes"}case"sequenced":if(typeof a.chromosomes[h].nGenes!="number"){throw"must specify nGenes for chromsome no"+h}if(a.chromosomes[h].nGenes<=0){throw"nGenes must be >= 0 for chromsome no"+h}if(!a.chromosomes[h].array||(a.chromosomes[h].array.aType!=TYPE_VARIABLE)||(a.chromosomes[h].array.varType!=VARTYPE_NUM)){throw"must specify a 1 dimentional numeric array for chromsome no"+h}if(a.chromosomes[h].array.dim2!=1){throw"must specify a 1 dimentional numeric array for chromsome no"+h}break;default:throw"bad type ["+a.chromosomes[h].type+"] from chromsome no"+h}}this.chromosomes=a.chromosomes;if(!$.isFunction(a.costFn)){throw"settings.costFn function not defined"}this.costFn=a.costFn;this.infoObj.settings=this.settings;this.infoObj.chromosomes=a.chromosomes;if($.isFunction(a.generationStart)){this.generationStart=a.generationStart}if($.isFunction(a.generationEnd)){this.generationEnd=a.generationEnd}},_createIndividual:function(){var f={cost:this.settings.direction=="minimize"?this.MAXDOUBLE:-this.MAXDOUBLE,genes:[]};for(var e=0;e<this.chromosomes.length;e++){var a=this.chromosomes[e];var d;switch(a.type){case"nonsequenced":d=this.chromosomes[e].genes.length;break;case"sequenced":case"picklist":d=this.chromosomes[e].nGenes;break}for(var b=0;b<d;b++){f.genes.push({gFloat:0,gWord:0})}}return f},_randomPopulate:function(){var k,d,a,h,j,f,b,o;d=0;for(k=0;k<this.chromosomes.length;k++){a=this.chromosomes[k];a.geneIndex=d;switch(a.type){case"nonsequenced":d+=this.chromosomes[k].genes.length;break;case"sequenced":case"picklist":d+=this.chromosomes[k].nGenes;break}}this.individuals=[];for(f=0;f<this.settings.nIndividuals;f++){this.individuals.push(this._createIndividual())}for(k=0;k<this.chromosomes.length;k++){a=this.chromosomes[k];switch(a.type){case"nonsequenced":for(d=0;d<a.genes.length;d++){h=a.genes[d];j=a.geneIndex+d;var m;if(h.minimum>=h.maximum){m=0}else{m=h.maximum-h.minimum}var e=this._roundMult[h.decs];var l=Math.round(m*e)+1;for(f=0;f<this.individuals.length;f++){if(m==0){o=h.minimum}else{if(f==0&&this.settings.initialSeed&&h.attribute&&h.attribute.isFull()){o=h.attribute.val();if((o<h.minimum)||(o>h.maximum)){throw"initialSeed value of ["+o+"] for ["+h.attribute.aName+"] exceeds allowed range"}}else{if(f==0&&this.settings.initialSeed&&h.hasOwnProperty("value")){o=h.value;if((o<h.minimum)||(o>h.maximum)){throw"initialSeed value of ["+o+"] for chromo ["+k+"] gene ["+d+"] exceeds allowed range"}}else{o=h.minimum+(Math.floor(Math.random()*l)/e)}}}this.individuals[f].genes[j].gFloat=o}}break;case"sequenced":for(f=0;f<this.individuals.length;f++){for(d=0;d<a.nGenes;d++){this.individuals[f].genes[a.geneIndex+d].gFloat=0}for(d=0;d<a.nGenes;d++){do{j=Math.floor(Math.random()*a.nGenes)}while(this.individuals[f].genes[a.geneIndex+j].gFloat!=0);this.individuals[f].genes[a.geneIndex+j].gFloat=d+1}}break;case"picklist":for(f=0;f<this.individuals.length;f++){for(d=0;d<a.nGenes;d++){do{b=Math.floor(Math.random()*a.range)+1;for(j=0;j<d;j++){if(this.individuals[f].genes[a.geneIndex+j].gFloat==b){break}}}while(j<d);this.individuals[f].genes[a.geneIndex+d].gFloat=b}}break}}},_populateKB:function(b){var j,h,a,f;for(j=0;j<this.chromosomes.length;j++){var d=this.chromosomes[j];switch(d.type){case"nonsequenced":for(h=0;h<d.genes.length;h++){var e=d.genes[h];a=d.geneIndex+h;f=b.genes[a].gFloat;if(e.hasOwnProperty("value")){e.value=f}else{e.attribute.val(f)}}break;case"sequenced":case"picklist":for(h=0;h<d.nGenes;h++){a=d.geneIndex+h;f=b.genes[a].gFloat;d.array.data[h+1]=f}break}}},_copyIndividual:function(d,a){a.cost=d.cost;for(var b=0;b<d.genes.length;b++){a.genes[b].gWord=d.genes[b].gWord;a.genes[b].gFloat=d.genes[b].gFloat}},_doCostFn:function(a,e,b){this._populateKB(a);this.infoObj.generationNo=e?e:0;this.infoObj.individualNo=b?b:0;var d=this.costFn(this.infoObj);if((typeof d!="number")||isNaN(d)||!isFinite(d)){throw"The cost function returned ["+d+"] but it should be a number"}return d},_doNormalF2W:function(b,a,e){if(a<=0){a=1}var d=e.gFloat;d=(d-b)/(a>0?a:1);e.gWord=Math.floor(d*65535)},_doStraightF2W:function(a){a.gWord=Math.round(a.gFloat)},_convertFloatToWord:function(b){var h,f,d,a;for(h=0;h<this.chromosomes.length;h++){d=this.chromosomes[h];switch(d.type){case"nonsequenced":for(f=0;f<d.genes.length;f++){var e=d.genes[f];a=d.geneIndex+f;if(b){this._doNormalF2W(e.minimum,e.maximum-e.minimum,b.genes[a])}else{for(i=0;i<this.individuals.length;i++){this._doNormalF2W(e.minimum,e.maximum-e.minimum,this.individuals[i].genes[a])}}}break;case"sequenced":case"picklist":for(f=0;f<d.nGenes;f++){a=d.geneIndex+f;if(b){this._doStraightF2W(b.genes[a])}else{for(i=0;i<this.individuals.length;i++){this._doStraightF2W(this.individuals[i].genes[a])}}}break}}},_roundMult:[1,10,100,1000,10000,100000,1000000,10000000,100000000,1000000000,10000000000,100000000000,1000000000000,10000000000000,100000000000000,1000000000000000],_roundValue:function(e,f){var d=e*this._roundMult[f];var b=d<0;d=Math.abs(d)+(1/this._roundMult[f+3]);n2=Math.floor(d);n3=d-n2;if(n3>0.5){n2+=1}var a=n2/this._roundMult[f];if(b){a=-a}return a},_doNormalW2F:function(b,a,d,f){var e;if(a<=0){e=b}else{e=(f.gWord&65535)/65535;e=(e*a)+b}f.gFloat=this._roundValue(e,d)},_doStraightW2F:function(a){a.gFloat=a.gWord},_convertWordToFloat:function(b){var h,f,d,a;for(h=0;h<this.chromosomes.length;h++){d=this.chromosomes[h];switch(d.type){case"nonsequenced":for(f=0;f<d.genes.length;f++){var e=d.genes[f];a=d.geneIndex+f;if(b){this._doNormalW2F(e.minimum,e.maximum-e.minimum,e.decs,b.genes[a])}else{for(i=0;i<this.individuals.length;i++){this._doNormalW2F(e.minimum,e.maximum-e.minimum,e.decs,this.individuals[i].genes[a])}}}break;case"sequenced":case"picklist":for(f=0;f<d.nGenes;f++){a=d.geneIndex+f;if(b){this._doStraightW2F(b.genes[a])}else{for(i=0;i<this.individuals.length;i++){this._doStraightW2F(this.individuals[i].genes[a])}}}break}}},_fixSumConstraintForChromosome:function(l,b,n){var j=1e-7;var d=0;var f=0;var m,k;for(m=0;m<l.genes.length;m++){k=l.genes[m];d+=k.minimum;f+=k.maximum}var e=l.genes.length-1;var h;do{h=false;var o=0;for(m=0;m<l.genes.length;m++){o+=b.genes[l.geneIndex+m].gFloat}if(Math.abs(o-n)>j){var a=b.genes[l.geneIndex+e].gFloat;a-=o-n;if(a<l.genes[e].minimum){a=l.genes[e].minimum}else{if(a>l.genes[e].maximum){a=l.genes[e].maximum}}b.genes[l.geneIndex+e].gFloat=a;e--;h=true}}while(h&&(e>=0))},_handleSumConstraints:function(){for(var d=0;d<this.chromosomes.length;d++){var a=this.chromosomes[d];if((a.type=="nonsequenced")&&a.hasOwnProperty("sumConstraint")){for(var b=0;b<this.individuals.length;b++){this._fixSumConstraintForChromosome(a,this.individuals[b],a.sumConstraint)}}}},_adaptationChange:function(a,b,f,e){var d;switch(b.type){case"nonsequenced":if(!b.hasOwnProperty("sumConstraint")){d=Math.floor(Math.random()*Math.floor(65536/10))+1;if(Math.random()<=0.5){d=(d^65535)+1}a.genes[b.geneIndex+f].gWord+=d;this._convertWordToFloat(a)}else{d=Math.floor(Math.random()*Math.floor(65536/10))+1;if(Math.random()<=0.5){d=(d^65535)+1}a.genes[b.geneIndex+f].gWord=a.genes[b.geneIndex+f].gWord+d;a.genes[b.geneIndex+e].gWord=a.genes[b.geneIndex+e].gWord-d;this._convertWordToFloat(a);this._fixSumConstraintForChromosome(b,a,b.sumConstraint)}break;case"sequenced":case"picklist":if(Math.random()<0.8){d=Math.floor(Math.random()*2);e=(f+d)%b.nGenes}d=a.genes[b.geneIndex+f].gWord;a.genes[b.geneIndex+f].gWord=a.genes[b.geneIndex+e].gWord;a.genes[b.geneIndex+e].gWord=d;this._convertWordToFloat(a);break}},_doAdaptation:function(a,h){if(this.settings.nAdaptationCycles>0){if(Math.random()<this.settings.pAdaptation){this._convertFloatToWord(a);var f=this._createIndividual();for(var e=0;e<this.settings.nAdaptationCycles;e++){this._copyIndividual(a,f);var j=Math.floor(Math.random()*this.chromosomes.length);var b;switch(this.chromosomes[j].type){case"nonsequenced":b=this.chromosomes[j].genes.length;break;case"sequenced":case"picklist":b=this.chromosomes[j].nGenes;break}var g=Math.floor(Math.random()*b);var d;do{d=Math.floor(Math.random()*b)}while((g==d)&&(b>1));this._adaptationChange(f,this.chromosomes[j],g,d);f.cost=this._doCostFn(f,h);if(((this.settings.direction=="minimize")&&(f.cost<a.cost))||((this.settings.direction=="maximize")&&(f.cost>a.cost))){this._copyIndividual(f,a)}}}}},_makeRouletteWheel:function(){var f=[];var k;var a=this.individuals[0].cost;var b=a;var j=a;var d=a;var e=0;for(k=1;k<this.individuals.length;k++){a=this.individuals[k].cost;if(a<b){b=a}if(a>j){j=a}if(((this.settings.direction=="minimize")&&(a<d))||((this.settings.direction=="maximize")&&(a>d))){d=a;e=k}}var l=0;var m=j-b;if(m==0){m=1;b=b-0.5}var h=0;for(k=0;k<this.individuals.length;k++){a=(this.individuals[k].cost-b)/m;if(this.settings.direction=="minimize"){a=1-a}gr=2;if(gr<1){gr=1}a=1+(a*(gr-1));l=l+a;f.push({aPosition:l,aValue:a});h+=a}var g=h/this.individuals.length;for(k=0;k<this.individuals.length;k++){f[k].mustSelect=Math.floor(f[k].aValue/g)}return{positions:f,bestIndividual:e}},_pickParent:function(a){var e=Math.floor(Math.random()*a.length);var d=e;do{if(a[d].mustSelect>0){a[d].mustSelect--;return d}d++;if(d>=a.length){d=0}}while(d!=e);var b=Math.floor(Math.random()*a[a.length-1].aPosition);for(e=0;e<a.length;e++){if(b<a[e].aPosition){return e}}throw"Cannot pick value from roulette wheel (beyond max)"},_normalMate2:function(h,a,o,l){var j,n,m,k;if(Math.random()<this.settings.pCrossover){n=Math.floor(Math.random()*((h.genes.length)*16));m=Math.floor(Math.random()*((h.genes.length)*16));if(n>m){j=n;n=m;m=j}k=0;for(gc=h.genes.length-1;gc>=0;gc--){var g=h.geneIndex+gc;var e=a.genes[g].gWord;var d=o.genes[g].gWord;var b=0;var f=32768;for(j=0;j<=15;j++){if((k<n)||(k>=m)){b=b|(e&f)}else{b=b|(d&f)}if(Math.random()<this.settings.pMutation){b=b^f}f=f>>1;k++}l.genes[g].gWord=b}}else{this._copyIndividual(a,l)}},_sequencedMate:function(e,a,n,h){var g;var k=[];for(g=0;g<e.nGenes;g++){if(Math.random()<this.settings.pCrossover){k.push(false)}else{k.push(true)}}var l=[];for(g=0;g<e.nGenes;g++){l.push(false)}for(g=0;g<e.nGenes;g++){var f=e.geneIndex+g;if(k[g]){l[a.genes[f].gWord]=true}}var d=e.geneIndex;for(g=0;g<e.nGenes;g++){var f=e.geneIndex+g;if(k[g]){h.genes[f].gWord=a.genes[f].gWord}else{while(l[n.genes[d].gWord]){d++}h.genes[f].gWord=n.genes[d].gWord;l[n.genes[d].gWord]=true}}if(e.nGenes>1){var m,j,b;for(g=e.nGenes-1;g>=0;g--){if(Math.random()<this.settings.pMutation){m=Math.floor(Math.random()*e.nGenes);do{j=Math.floor(Math.random()*e.nGenes)}while(m==j);b=h.genes[e.geneIndex+m].gWord;h.genes[e.geneIndex+m].gWord=h.genes[e.geneIndex+j].gWord;h.genes[e.geneIndex+j].gWord=b}}}},_geneBoundMate:function(d,f,e,g){var b,a;for(var h=0;h<d.nGenes;h++){b=d.geneIndex+h;if(Math.random()<this.settings.pCrossover){a=e.genes[b].gWord}else{a=f.genes[b].gWord}if(Math.random()<this.settings.pMutation){a=Math.floor(Math.random()*d.range)+1}g.genes[b].gWord=a}},_fixDuplicates:function(a,d){var g,f,e;var b=[];for(g=0;g<a.range;g++){b.push(false)}for(g=0;g<a.nGenes;g++){f=d.genes[a.geneIndex+g];e=f.gWord;if(!b[e-1]){b[e-1]=true}else{f.broke=true}}for(g=0;g<a.nGenes;g++){f=d.genes[a.geneIndex+g];if(f.broke){e=f.gWord;do{e++;if(e>a.range){e=1}}while(b[e-1]&&(e!=f.gWord));if(e==f.gWord){throw"error repairing picklist gene"}b[e-1]=true;f.gWord=e;delete f.broke}}},_optimize:function(b){this._convertFloatToWord();var f=$.extend(true,[],this.individuals);var a=this._makeRouletteWheel();this._copyIndividual(this.individuals[a.bestIndividual],f[0]);var e,d,h,g;for(h=1;h<this.individuals.length;h++){if(h%2==1){e=this._pickParent(a.positions);d=this._pickParent(a.positions)}else{g=e;e=d;d=g}for(g=0;g<this.chromosomes.length;g++){switch(this.chromosomes[g].type){case"nonsequenced":this._normalMate2(this.chromosomes[g],this.individuals[e],this.individuals[d],f[h]);break;case"sequenced":this._sequencedMate(this.chromosomes[g],this.individuals[e],this.individuals[d],f[h]);break;case"picklist":this._geneBoundMate(this.chromosomes[g],this.individuals[e],this.individuals[d],f[h]);this._fixDuplicates(this.chromosomes[g],f[h]);break}}}this.individuals=f;for(h=1;h<this.individuals.length;h++){this.individuals[h].cost=this.settings.direction=="minimize"?this.MAXDOUBLE:-this.MAXDOUBLE}this._convertWordToFloat();this._handleSumConstraints()},_hillClimber:function(){var b=1e-7;var d=this._findBestIndividual();var u=1000;do{var k,e,B,m,f;do{k=-1;B=0;e=-1;m=0;f=d.cost;for(var C=0;C<this.chromosomes.length;C++){var x=this.chromosomes[C];switch(x.type){case"nonsequenced":for(var n=0;n<x.genes.length;n++){var y=x.genes[n];var A=x.geneIndex+n;var D=(1/Math.pow(10,y.decs))*u;var r;var l=x.hasOwnProperty("sumConstraint");if(l){r=x.genes.length}else{r=1}for(var h=n;h<r;h++){if(!l||(h!=n)){var p=this.individuals[d.indi].genes[A].gFloat;var E;var q=-1;var t=0;if(l){E=x.genes[h];q=x.geneIndex+h;var w=(1/Math.pow(10,E.decs))*u;if(w>D){D=w}t=this.individuals[d.indi].genes[q].gFloat}var j,a,z;if(((p-D)>=y.minimum)&&(!l||(t+D<=E.maximum))){j=p-D;this.individuals[d.indi].genes[A].gFloat=j;if(l){a=t+D;this.individuals[d.indi].genes[q].gFloat=a}else{a=0}z=this._doCostFn(this.individuals[d.indi]);if(((z<f)&&(this.settings.direction=="minimize"))||((z>f)&&(this.settings.direction=="maximize"))){f=z;k=A;B=j;e=q;m=a}}if(((p+D)<=y.maximum)&&(!l||(t-D>=E.minimum))){j=p+D;this.individuals[d.indi].genes[A].gFloat=j;if(l){a=t-D;this.individuals[d.indi].genes[q].gFloat=a}else{a=0}z=this._doCostFn(this.individuals[d.indi]);if(((z<f)&&(this.settings.direction=="minimize"))||((z>f)&&(this.settings.direction=="maximize"))){f=z;k=A;B=j;e=q;m=a}}this.individuals[d.indi].genes[A].gFloat=p;if(l){this.individuals[d.indi].genes[q].gFloat=t}}}}break}}if(k!=-1){this.individuals[d.indi].genes[k].gFloat=B;d.cost=f;if(l){this.individuals[d.indi].genes[e].gFloat=m}}}while(k!=-1);u=Math.floor(u/10)}while(u!=0)},_findBestIndividual:function(){var b=0;var a=this.individuals[0].cost;for(var e=1;e<this.individuals.length;e++){var d=this.individuals[e].cost;if((d>-this.MAXDOUBLE)&&(d<this.MAXDOUBLE)){if(((this.settings.direction=="minimize")&&(d<a))||((this.settings.direction=="maximize")&&(d>a))){a=d;b=e}}}return{indi:b,cost:a}},_populateBestIndividual:function(){var a=this._findBestIndividual();this._doCostFn(this.individuals[a.indi]);return{individual:this.individuals[a.indi],cost:a.cost}},_debugGeneration:function(e){var h,f,a;if(e){var b="";for(h=0;h<this.chromosomes.length;h++){switch(this.chromosomes[h].type){case"nonsequenced":for(f=0;f<this.chromosomes[h].genes.length;f++){b+=(b.length>0?",":"")+this.chromosomes[h].genes[f].attribute.aName+"(min),"+this.chromosomes[h].genes[f].attribute.aName+"(max),"+this.chromosomes[h].genes[f].attribute.aName+"(avg)"}break}}console.log(b)}for(h=0;h<this.chromosomes.length;h++){switch(this.chromosomes[h].type){case"nonsequenced":for(f=0;f<this.chromosomes[h].genes.length;f++){this.chromosomes[h].genes[f].debug={min:1000000,max:-1000000,avg:0}}break}}for(a=0;a<this.individuals.length;a++){for(h=0;h<this.chromosomes.length;h++){switch(this.chromosomes[h].type){case"nonsequenced":for(f=0;f<this.chromosomes[h].genes.length;f++){var d=this.individuals[a].genes[this.chromosomes[h].geneIndex+f].gFloat;if(d<this.chromosomes[h].genes[f].debug.min){this.chromosomes[h].genes[f].debug.min=d}if(d>this.chromosomes[h].genes[f].debug.max){this.chromosomes[h].genes[f].debug.max=d}this.chromosomes[h].genes[f].debug.avg+=d}break}}}var b="";for(h=0;h<this.chromosomes.length;h++){switch(this.chromosomes[h].type){case"nonsequenced":for(f=0;f<this.chromosomes[h].genes.length;f++){this.chromosomes[h].genes[f].debug.avg=this.chromosomes[h].genes[f].debug.avg/this.individuals.length;b+=(b.length>0?",":"")+this.chromosomes[h].genes[f].debug.min+","+this.chromosomes[h].genes[f].debug.max+","+this.chromosomes[h].genes[f].debug.avg}break}}console.log(b)},run:function(d){var b=this;var a;b._applySettings(d);b._randomPopulate();b._handleSumConstraints();replayStack.CriticalSection(function(j){var n;var h=new Date();var e=false;for(var l=0;l<b.settings.nGenerations;l++){var m=l+1;if($.isFunction(b.generationStart)){b.generationStart(m)}for(var k=l==0?0:1;k<b.individuals.length;k++){b.individuals[k].cost=b._doCostFn(b.individuals[k],m,k+1);if((b.settings.adaptationStart!=0)&&(m>=b.settings.adaptationStart)){b._doAdaptation(b.individuals[k],m)}if(b.settings.timeout){var f=new Date();e=b.settings.timeout&&(f.getTime()-h.getTime()>=b.settings.timeout*1000);if(e){break}}}if((l<b.settings.nGenerations-1)&&!e){b._optimize()}else{if(b.settings.hillClimb){b._hillClimber()}n=b._populateBestIndividual()}if($.isFunction(b.generationEnd)){b.generationEnd(m,b.individuals[0].cost)}if(e){break}}j.CriticalDone(n)},function(e){a=e.cost;b._doCostFn(e.individual)});return a}};
var aData = {"appSettings":{"title":"FS Demo Sep 17","bgColor":"#FFFFFF","startObject":"~118","staticItems":[],"varTemplate":0,"dateFormat":"dd/mm/yyyy","decSeparator":".","noStyleProps":false,"showCloseConfirm":true,"layout":"fluid","developer":true,"language":"","finalURL":"http://www.directxpert.com/","treatBoolsAsList":false,"maxNumPrecis":false,"startObjectID":118,"author":"rboyd@xpertrule.com","appicon":false,"description":"","batchMode":false,"customcss":"custom.css","dmSettings":{"intermediateStats":false,"shading":false,"expert":false,"showexpected":false},"tags":"demo","ver":33,"raggedLevels":true,"treeDescriptions":false,"showBaseClasses":true,"allowInduction":false,"treeWrapChars":15,"treeProcChars":15,"emptyLeaf":"Empty","build":248,"ruleDescriptions":false,"editor_version":"2.0.0","noEncrypt":true,"chatMode":true,"maxwidth":600,"chat_incl":"chatjs.js","nodejs_incl":"nodejs.js","static_resources":["fs_demo.css"],"save_version":5,"explView":"exview_objs","maxCompressedVals":6,"treeProcLines":3,"smallScriptTreeFont":false,"visible_tools":["xrQuestion","xrTreeScript","xrCalculation","xrReport","xrRPA","sentimentDetection","imageOCR","imageFaceRecognition","entityLink","languageDetection"],"chat_settings":{"voice":true,"include_exit":false,"footer":"<a href=\"http://www.xpertrule.com\" target=\"_blank\">Powered by XpertRule</a>","allow_print":true,"menu":[]},"selectedObj":132,"r_ver":33,"showMapAtts":true,"showMapProcs":false,"showMapSrcs":false},"aDictionary":[{"aID":1,"aName":"Text_Attribute","aType":10,"objInfo":{"ver":5,"r_ver":5},"flatProps":{"uid":121636096,"description":"","length":0,"_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","inputmask":"","isenabled":true,"ispassword":false,"isvisible":true,"multiline":false,"showontreedialog":true,"tieddialog":23,"isselected":"Above","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":""},"tree":{"version":1,"examples":null,"policyRules":null},"events":{"OnCapture":""},"_classPrivs":{"tabs":{"events":true},"hidflatprops":[],"customflatprops":[{"name":"extrainfo","descr":"Extra information to show with the More button"},{"name":"spokendescr","descr":"Optional spoken description"}],"editStruct":true,"editMaintenance":true},"aLength":0},{"aID":2,"aName":"Boolean_Annuity_Advisor","aType":4,"objInfo":{"ver":10,"lastTab":"events","r_ver":10},"flatProps":{"uid":524288256,"description":"","_default":true,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":""},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"uid":524288257,"aID":1,"aName":"Yes","vDescription":"","idx":0,"synonyms":""},{"uid":524288258,"aID":2,"aName":"No","vDescription":"","idx":1,"synonyms":""}],"values":{"values":[{"uid":524288257,"aID":1,"aName":"Yes","vDescription":"","idx":0,"valid":true,"aText":"Yes","evalid":0,"synonyms":""},{"uid":524288258,"aID":2,"aName":"No","vDescription":"","idx":1,"valid":true,"aText":"No","evalid":0,"synonyms":""}],"props":{"general":{"descriptionprop":"Value","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"aID":1,"aName":"vDescription","realName":"vDescription","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"name":"","aDescription":"Comma delimited synonyms list"}]}},"events":{"OnCapture":""},"_classPrivs":{"tabs":{"vals":true,"events":true},"hidflatprops":[],"customflatprops":[{"name":"extrainfo","descr":"Extra information to show with the More button"},{"name":"spokendescr","descr":"Optional spoken description"}],"editStruct":true,"editMaintenance":true}},{"aID":3,"aName":"Control_Tree","aType":1,"objInfo":{"ver":1,"r_ver":1},"flatProps":{"uid":524288512,"description":"","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"knowledgesource":""},"tree":{"version":1,"examples":null,"policyRules":null,"tree":{"aID":2,"aType":1,"aOutcome":-999999}},"aValues":[{"uid":524288513,"aID":1,"aName":"Done","idx":0,"selected":false,"visible":true}],"values":{"values":[{"uid":524288513,"aID":1,"aName":"Done","idx":0,"id":1,"selected":false,"valid":true,"aText":"Done","evalid":0,"visible":true}],"props":{"general":{"descriptionprop":"aName","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Outcome","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false}]}},"isMultiSel":false},{"aID":5,"aName":"List_Attribute","aType":1,"objInfo":{"ver":5,"lastTab":"events","r_ver":5},"flatProps":{"uid":524289024,"description":"","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":""},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[],"values":{"values":[],"props":{"general":{"descriptionprop":"synonyms","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"aDescription":"Comma delimited synonyms list","aID":1,"aName":"synonyms","aType":"str","display":-1,"ishtml":false,"realName":"synonyms","width":80}]}},"events":{"OnCapture":""},"_classPrivs":{"tabs":{"vals":true,"events":true},"hidflatprops":[],"customflatprops":[{"name":"extrainfo","descr":"Extra information to show with the More button"},{"name":"spokendescr","descr":"Optional spoken description"}],"editStruct":true,"editMaintenance":true},"isMultiSel":false},{"aID":6,"aName":"Numeric_Attribute","aType":2,"objInfo":{"ver":7,"lastTab":"events","r_ver":7},"flatProps":{"uid":524289280,"description":"","_default":0,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":""},"tree":{"version":1,"examples":null,"policyRules":null},"events":{"OnCapture":""},"_classPrivs":{"tabs":{"events":true},"hidflatprops":["showontreedialog","grouppreviousanswers","tieddialog","selectionmode"],"customflatprops":[{"name":"extrainfo","descr":"Extra information to show with the More button"},{"name":"spokendescr","descr":"Optional spoken description"}],"editStruct":true,"editMaintenance":true},"aDecPlaces":0},{"aID":7,"aName":"Annuity Advisor Array","aType":13,"objInfo":{"allowed":[-8,-12],"ver":5,"style":"","opened":false,"r_ver":5}},{"aID":10,"aName":"Annuity Advisor Attributes","aType":13,"objInfo":{"allowed":[2,5,6,1],"ver":3,"style":"","allowall":true,"opened":false,"r_ver":3}},{"aID":11,"aName":"Logic","aType":13,"objInfo":{"allowed":[90,3,-12],"ver":6,"opened":false,"style":"background-color: #ababd6","r_ver":6}},{"aID":12,"aName":"Annuity Advisor Tables","aType":13,"objInfo":{"allowed":[-8,2,3,-7,5,6,-5,-12],"ver":7,"style":"","allowall":true,"opened":false,"r_ver":7}},{"aID":14,"aName":"Age_Last_Birthday","aType":2,"objInfo":{"cat":10,"ver":6,"lastTab":"props","r_ver":6},"flatProps":{"uid":524291072,"description":"How old were you last birthday?","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":74,"minvalue":55,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"This advice is intended for people aged between 55 and 74","spokendescr":"How old were you last birthday?","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null},"events":{},"aDecPlaces":0},{"aID":16,"aName":"Smoke","aType":4,"objInfo":{"cat":10,"ver":7,"lastTab":"vprops","r_ver":7},"flatProps":{"uid":524291584,"description":"Do you smoke?","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"extrainfo":"","spokendescr":"Do you smoke?","knowledgesource":"","pid":2},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"uid":524291585,"aID":1,"aName":"Yes","vDescription":"You may qualify for a higher annuity rate because you smoke","idx":0,"undefined":"i do,a little,like a chimney"},{"uid":524291586,"aID":2,"aName":"No","vDescription":"","idx":1,"undefined":"i don't,i do not,not anymore"}],"values":{"values":[{"uid":524291585,"aID":1,"aName":"Yes","vDescription":"You may qualify for a higher annuity rate because you smoke","idx":0,"valid":true,"aText":"Yes","evalid":0,"undefined":"i do,a little,like a chimney"},{"uid":524291586,"aID":2,"aName":"No","vDescription":"","idx":1,"valid":true,"aText":"No","evalid":0,"undefined":"i don't,i do not,not anymore"}],"props":{"general":{"descriptionprop":"Value","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":1,"width":80,"ishtml":false},{"aID":1,"aName":"vDescription","realName":"vDescription","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"name":"","aDescription":"Comma delimited synonyms list","display":0}]}}},{"aID":17,"aName":"Ill_Health","aType":4,"objInfo":{"cat":10,"ver":2,"r_ver":2},"flatProps":{"uid":524292096,"description":"Are you now, or have you in the past suffered from ill-health?","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"extrainfo":"","spokendescr":"Are you now, or have you in the past suffered from ill-health?","knowledgesource":"","pid":2},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"uid":524292097,"aID":1,"aName":"Yes","vDescription":"You may qualify for a higher annuity rate because of your medical history","idx":0,"undefined":""},{"uid":524292098,"aID":2,"aName":"No","vDescription":"","idx":1,"undefined":""}],"values":{"values":[{"uid":524292097,"aID":1,"aName":"Yes","vDescription":"You may qualify for a higher annuity rate because of your medical history","idx":0,"valid":true,"aText":"Yes","evalid":0,"undefined":""},{"uid":524292098,"aID":2,"aName":"No","vDescription":"","idx":1,"valid":true,"aText":"No","evalid":0,"undefined":""}],"props":{"general":{"descriptionprop":"Value","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"aID":1,"aName":"vDescription","realName":"vDescription","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"name":"","aDescription":"Comma delimited synonyms list"}]}}},{"aID":18,"aName":"Retirement_Fund_Size","aType":2,"objInfo":{"cat":10,"ver":4,"r_ver":4},"flatProps":{"uid":524292352,"description":"What is the total size of your retirement fund?","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":":&pound;","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"What is the total size of your retirement fund?","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null},"aDecPlaces":0},{"aID":19,"aName":"Draw_Lump_Sum","aType":4,"objInfo":{"cat":10,"ver":11,"lastTab":"vprops","r_ver":11},"flatProps":{"uid":524292608,"description":"Do you want to draw a tax-free lump sum from your pension scheme?","_default":"","defaultmode":"","isdynamic":true,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"extrainfo":"The maximum lump sum is usually 25% of your fund, so yours would be &pound;{Cash_Lump_Sum}","spokendescr":"Do you want to draw a tax-free lump sum from your pension scheme?","knowledgesource":"","pid":2},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"uid":524292609,"aID":1,"aName":"Yes","vDescription":"Your annuity will be bought after your lump sum has been deducted from your pension fund","idx":0,"undefined":""},{"uid":524292610,"aID":2,"aName":"No","vDescription":"Your annuity will be bought with your full pension fund and you will receive no tax-free lump sum","idx":1,"undefined":""}],"values":{"values":[{"uid":524292609,"aID":1,"aName":"Yes","vDescription":"Your annuity will be bought after your lump sum has been deducted from your pension fund","idx":0,"valid":true,"aText":"Yes","evalid":0,"undefined":""},{"uid":524292610,"aID":2,"aName":"No","vDescription":"Your annuity will be bought with your full pension fund and you will receive no tax-free lump sum","idx":1,"valid":true,"aText":"No","evalid":0,"undefined":""}],"props":{"general":{"descriptionprop":"Value","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":1,"width":80,"ishtml":false},{"aID":1,"aName":"vDescription","realName":"vDescription","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"name":"","aDescription":"Comma delimited synonyms list"}]}}},{"aID":20,"aName":"Partner_Pension_Income","aType":4,"objInfo":{"cat":10,"ver":12,"lastTab":"props","r_ver":12},"flatProps":{"uid":524292864,"description":"On your death, do you want to provide a continuing income for your partner?","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"extrainfo":"Your current choice of annuity is calculated to be &pound;{Indicative_Annual_Income[1]} a year<br /><br />If you choose this option then your annuity would be reduced to &pound;{Indicative_Annual_Income[2]}","spokendescr":"On your death, do you want to provide a continuing income for your partner?","knowledgesource":"","pid":2},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"uid":524292865,"aID":1,"aName":"Yes","vDescription":"You should consider a joint life annuity that will pay an income throughout your joint lifetime","idx":0,"undefined":""},{"uid":524292866,"aID":2,"aName":"No","vDescription":"You should consider a single life annuity that will pay an income throughout your life","idx":1,"undefined":""}],"values":{"values":[{"uid":524292865,"aID":1,"aName":"Yes","vDescription":"You should consider a joint life annuity that will pay an income throughout your joint lifetime","idx":0,"valid":true,"aText":"Yes","evalid":0,"undefined":""},{"uid":524292866,"aID":2,"aName":"No","vDescription":"You should consider a single life annuity that will pay an income throughout your life","idx":1,"valid":true,"aText":"No","evalid":0,"undefined":""}],"props":{"general":{"descriptionprop":"Value","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":1,"width":80,"ishtml":false},{"aID":1,"aName":"vDescription","realName":"vDescription","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"name":"","aDescription":"Comma delimited synonyms list"}]}}},{"aID":21,"aName":"Minimum_Term_Annuity","aType":4,"objInfo":{"cat":10,"ver":8,"lastTab":"props","r_ver":8},"flatProps":{"uid":524293120,"description":"Would you want your annuity payments to be paid for a minimum term, regardless of how long you live?","_default":"","defaultmode":"","isdynamic":true,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"extrainfo":"Your current choice of annuity is calculated to be &pound;{Indicative_Annual_Income[2]} a year<br /><br />If you choose this option then, depending on your age and the purchase price, your annuity may be reduced to &pound;{Indicative_Annual_Income[3]}","spokendescr":"","knowledgesource":"","pid":2},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"uid":524293121,"aID":1,"aName":"Yes","vDescription":"Your annuity will pay an income for a minimum of five years","idx":0,"undefined":""},{"uid":524293122,"aID":2,"aName":"No","vDescription":"Your annuity income will end on your death","idx":1,"undefined":""}],"values":{"values":[{"uid":524293121,"aID":1,"aName":"Yes","vDescription":"Your annuity will pay an income for a minimum of five years","idx":0,"valid":true,"aText":"Yes","evalid":0,"undefined":""},{"uid":524293122,"aID":2,"aName":"No","vDescription":"Your annuity income will end on your death","idx":1,"valid":true,"aText":"No","evalid":0,"undefined":""}],"props":{"general":{"descriptionprop":"Value","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":1,"width":80,"ishtml":false},{"aID":1,"aName":"vDescription","realName":"vDescription","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"name":"","aDescription":"Comma delimited synonyms list"}]}}},{"aID":22,"aName":"Inflation_Protection","aType":4,"objInfo":{"cat":10,"ver":9,"lastTab":"vprops","r_ver":9},"flatProps":{"uid":524293376,"description":"Do you want your annuity payments to have full protection against inflation?","_default":"","defaultmode":"","isdynamic":true,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"extrainfo":"Your current choice of annuity is calculated to be &pound;{Indicative_Annual_Income[3]} a year<br /><br />If you choose this option then your annuity would be reduced to &pound;{Indicative_Annual_Income[4]}","spokendescr":"","knowledgesource":"","pid":2},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"uid":524293377,"aID":1,"aName":"Yes","vDescription":"Your annuity will pay an income that rises in line with the Retail Prices Index","idx":0,"undefined":""},{"uid":524293378,"aID":2,"aName":"No","vDescription":"Your annuity will not pay an income that rises income will the Retail Prices Index","idx":1,"undefined":""}],"values":{"values":[{"uid":524293377,"aID":1,"aName":"Yes","vDescription":"Your annuity will pay an income that rises in line with the Retail Prices Index","idx":0,"valid":true,"aText":"Yes","evalid":0,"undefined":""},{"uid":524293378,"aID":2,"aName":"No","vDescription":"Your annuity will not pay an income that rises income will the Retail Prices Index","idx":1,"valid":true,"aText":"No","evalid":0,"undefined":""}],"props":{"general":{"descriptionprop":"Value","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":1,"width":80,"ishtml":false},{"aID":1,"aName":"vDescription","realName":"vDescription","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"name":"","aDescription":"Comma delimited synonyms list"}]}}},{"aID":23,"aName":"Annuity_Income_Logic","aType":1,"objInfo":{"cat":11,"ver":12,"r_ver":12},"flatProps":{"uid":524293888,"description":"","_default":"","defaultmode":"","isdynamic":true,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"knowledgesource":"Expert knowledge transcribed by RDB","pid":3},"tree":{"version":1,"examples":null,"policyRules":null,"tree":{"aID":711,"aType":5,"aFunction":"/*XRF{\"lines\":[{\"cmd\":\"let\",\"targetID\":75,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"func\",\"func\":\"round\",\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":18},{\"type\":\"op\",\"operator\":\"*\"},{\"type\":\"num\",\"value\":0.25}]}]}]}}]}*/\n_dgo(75).val(Math.round(_dgo(18).val()*0.25));\n","aSubTree":{"aID":766,"aType":2,"aAttribute":19,"aBranches":[{"aValues":[1],"aSubTree":{"aID":768,"aType":7,"aJump":772},"aID":816},{"aValues":[2],"aSubTree":{"aID":770,"aType":5,"aFunction":"/*XRF{\"lines\":[{\"cmd\":\"let\",\"targetID\":75,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"num\",\"value\":0}]}}]}*/\n_dgo(75).val(0);\n","aSubTree":{"aID":772,"aType":4,"aSubTree":{"aID":842,"aType":5,"aFunction":"/*XRF{\"lines\":[{\"cmd\":\"let\",\"targetID\":89,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":79},{\"type\":\"op\",\"operator\":\"+\"},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":80},{\"type\":\"op\",\"operator\":\"*\"},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":14},{\"type\":\"op\",\"operator\":\"-\"},{\"type\":\"num\",\"value\":55}]}]}]},{\"type\":\"op\",\"operator\":\"*\"},{\"type\":\"num\",\"value\":0.01}]}},{\"cmd\":\"let\",\"targetID\":31,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"func\",\"func\":\"round\",\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":18},{\"type\":\"op\",\"operator\":\"-\"},{\"type\":\"obj\",\"aID\":75}]},{\"type\":\"op\",\"operator\":\"*\"},{\"type\":\"num\",\"value\":0.001},{\"type\":\"op\",\"operator\":\"*\"},{\"type\":\"obj\",\"aID\":61}]}]}]},\"dim1\":{\"type\":\"list\",\"items\":[{\"type\":\"num\",\"value\":1}]}},{\"cmd\":\"let\",\"targetID\":31,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"func\",\"func\":\"round\",\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":31,\"dim1\":{\"type\":\"list\",\"items\":[{\"type\":\"num\",\"value\":1}]}},{\"type\":\"op\",\"operator\":\"*\"},{\"type\":\"obj\",\"aID\":89}]}]}]},\"dim1\":{\"type\":\"list\",\"items\":[{\"type\":\"num\",\"value\":2}]}}]}*/\n_dgo(89).val((_dgo(79).val()+(_dgo(80).val()*(_dgo(14).val()-55)))*0.01);\n_dgo(31).SetValue(Math.round((_dgo(18).val()-_dgo(75).val())*0.001*_dgo(61).val()),1,1);\n_dgo(31).SetValue(Math.round(_dgo(31).GetValue(1,1)*_dgo(89).val()),2,1);\n","aSubTree":{"aID":776,"aType":2,"aAttribute":20,"aBranches":[{"aValues":[1],"aSubTree":{"aID":778,"aType":7,"aJump":782},"aID":818},{"aValues":[2],"aSubTree":{"aID":780,"aType":5,"aFunction":"/*XRF{\"lines\":[{\"cmd\":\"let\",\"targetID\":31,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":31,\"dim1\":{\"type\":\"list\",\"items\":[{\"type\":\"num\",\"value\":1}]}}]},\"dim1\":{\"type\":\"list\",\"items\":[{\"type\":\"num\",\"value\":2}]}}]}*/\n_dgo(31).SetValue(_dgo(31).GetValue(1,1),2,1);\n","aSubTree":{"aID":782,"aType":4,"aSubTree":{"aID":843,"aType":5,"aFunction":"/*XRF{\"lines\":[{\"cmd\":\"let\",\"targetID\":86,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":87},{\"type\":\"op\",\"operator\":\"-\"},{\"type\":\"obj\",\"aID\":85}]},{\"type\":\"op\",\"operator\":\"/\"},{\"type\":\"num\",\"value\":19}]}},{\"cmd\":\"let\",\"targetID\":91,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":85},{\"type\":\"op\",\"operator\":\"+\"},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":86},{\"type\":\"op\",\"operator\":\"*\"},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":14},{\"type\":\"op\",\"operator\":\"-\"},{\"type\":\"num\",\"value\":55}]}]}]},{\"type\":\"op\",\"operator\":\"*\"},{\"type\":\"num\",\"value\":0.01}]}},{\"cmd\":\"let\",\"targetID\":31,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"func\",\"func\":\"round\",\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":31,\"dim1\":{\"type\":\"list\",\"items\":[{\"type\":\"num\",\"value\":2}]}},{\"type\":\"op\",\"operator\":\"*\"},{\"type\":\"obj\",\"aID\":91}]}]},{\"type\":\"op\",\"operator\":\"-\"},{\"type\":\"num\",\"value\":1}]},\"dim1\":{\"type\":\"list\",\"items\":[{\"type\":\"num\",\"value\":3}]}}]}*/\n_dgo(86).val((_dgo(87).val()-_dgo(85).val())/19);\n_dgo(91).val((_dgo(85).val()+(_dgo(86).val()*(_dgo(14).val()-55)))*0.01);\n_dgo(31).SetValue(Math.round(_dgo(31).GetValue(2,1)*_dgo(91).val())-1,3,1);\n","aSubTree":{"aID":786,"aType":2,"aAttribute":21,"aBranches":[{"aValues":[1],"aSubTree":{"aID":788,"aType":7,"aJump":792},"aID":820},{"aValues":[2],"aSubTree":{"aID":790,"aType":5,"aFunction":"/*XRF{\"lines\":[{\"cmd\":\"let\",\"targetID\":31,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":31,\"dim1\":{\"type\":\"list\",\"items\":[{\"type\":\"num\",\"value\":2}]}}]},\"dim1\":{\"type\":\"list\",\"items\":[{\"type\":\"num\",\"value\":3}]}}]}*/\n_dgo(31).SetValue(_dgo(31).GetValue(2,1),3,1);\n","aSubTree":{"aID":792,"aType":4,"aSubTree":{"aID":844,"aType":5,"aFunction":"/*XRF{\"lines\":[{\"cmd\":\"let\",\"targetID\":74,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":82},{\"type\":\"op\",\"operator\":\"+\"},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":83},{\"type\":\"op\",\"operator\":\"*\"},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":14},{\"type\":\"op\",\"operator\":\"-\"},{\"type\":\"num\",\"value\":55}]}]}]},{\"type\":\"op\",\"operator\":\"*\"},{\"type\":\"num\",\"value\":0.01}]}},{\"cmd\":\"let\",\"targetID\":31,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"func\",\"func\":\"round\",\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":31,\"dim1\":{\"type\":\"list\",\"items\":[{\"type\":\"num\",\"value\":3}]}},{\"type\":\"op\",\"operator\":\"*\"},{\"type\":\"obj\",\"aID\":74}]}]}]},\"dim1\":{\"type\":\"list\",\"items\":[{\"type\":\"num\",\"value\":4}]}}]}*/\n_dgo(74).val((_dgo(82).val()+(_dgo(83).val()*(_dgo(14).val()-55)))*0.01);\n_dgo(31).SetValue(Math.round(_dgo(31).GetValue(3,1)*_dgo(74).val()),4,1);\n","aSubTree":{"aID":796,"aType":2,"aAttribute":22,"aBranches":[{"aValues":[1],"aSubTree":{"aID":798,"aType":7,"aJump":836},"aID":822},{"aValues":[2],"aSubTree":{"aID":845,"aType":5,"aFunction":"/*XRF{\"lines\":[{\"cmd\":\"let\",\"targetID\":92,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":62},{\"type\":\"op\",\"operator\":\"+\"},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":88},{\"type\":\"op\",\"operator\":\"*\"},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":14},{\"type\":\"op\",\"operator\":\"-\"},{\"type\":\"num\",\"value\":55}]}]}]},{\"type\":\"op\",\"operator\":\"*\"},{\"type\":\"num\",\"value\":0.01}]}},{\"cmd\":\"let\",\"targetID\":31,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"func\",\"func\":\"round\",\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":31,\"dim1\":{\"type\":\"list\",\"items\":[{\"type\":\"num\",\"value\":3}]}},{\"type\":\"op\",\"operator\":\"*\"},{\"type\":\"obj\",\"aID\":92}]}]}]},\"dim1\":{\"type\":\"list\",\"items\":[{\"type\":\"num\",\"value\":4}]}}]}*/\n_dgo(92).val((_dgo(62).val()+(_dgo(88).val()*(_dgo(14).val()-55)))*0.01);\n_dgo(31).SetValue(Math.round(_dgo(31).GetValue(3,1)*_dgo(92).val()),4,1);\n","aSubTree":{"aID":802,"aType":2,"aAttribute":42,"aBranches":[{"aValues":[1],"aSubTree":{"aID":804,"aType":7,"aJump":808},"aID":824},{"aValues":[2],"aSubTree":{"aID":806,"aType":5,"aFunction":"/*XRF{\"lines\":[{\"cmd\":\"let\",\"targetID\":31,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":31,\"dim1\":{\"type\":\"list\",\"items\":[{\"type\":\"num\",\"value\":3}]}}]},\"dim1\":{\"type\":\"list\",\"items\":[{\"type\":\"num\",\"value\":4}]}}]}*/\n_dgo(31).SetValue(_dgo(31).GetValue(3,1),4,1);\n","aSubTree":{"aID":808,"aType":4,"aSubTree":{"aID":836,"aType":4,"aSubTree":{"aID":810,"aType":3,"aAttribute":48,"aSubTree":{"aID":838,"aType":5,"aOutcome":1,"aFunction":"/*XRF{\"lines\":[{\"cmd\":\"let\",\"targetID\":101,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":31,\"dim1\":{\"type\":\"list\",\"items\":[{\"type\":\"num\",\"value\":4}]}}]}}]}*/\n_dgo(101).val(_dgo(31).GetValue(4,1));\n","aSubTree":{"aID":814,"aType":1,"aOutcome":1}}}}}},"aID":825}]}},"aID":823}]}}}},"aID":821}]}}}},"aID":819}]}}}},"aID":817}]}}},"aValues":[{"uid":524293889,"aID":1,"aName":"Done","idx":0,"selected":false,"visible":true}],"values":{"values":[{"uid":524293889,"aID":1,"aName":"Done","idx":0,"id":1,"selected":false,"valid":true,"aText":"Done","evalid":0,"visible":true}],"props":{"general":{"descriptionprop":"Outcome","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Outcome","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false}]}},"isMultiSel":false},{"aID":31,"aName":"Indicative_Annual_Income","aType":8,"objInfo":{"cat":7,"ver":1,"r_ver":1},"varType":1,"aDecPlacesOrLength":0,"dim1":10,"dim2":1,"initData":[0,0,0,0,0,0,0,0,0,0,0]},{"aID":42,"aName":"Increase_Payments","aType":4,"objInfo":{"cat":10,"ver":9,"lastTab":"vprops","r_ver":9},"flatProps":{"uid":524301056,"description":"Do you want your annuity payments to increase by 3% a year?","_default":"","defaultmode":"","isdynamic":true,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"extrainfo":"Your current choice of annuity is calculated to be &pound;{Indicative_Annual_Income[3]} a year<br /><br />If you choose this option then your annuity would be reduced to &pound;{Indicative_Annual_Income[4]}","spokendescr":"","knowledgesource":"","pid":2},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"uid":524301057,"aID":1,"aName":"Yes","vDescription":"Your annuity payment is set to increase by 3% a year","idx":0,"undefined":""},{"uid":524301058,"aID":2,"aName":"No","vDescription":"Your annuity payment will not increase","idx":1,"undefined":""}],"values":{"values":[{"uid":524301057,"aID":1,"aName":"Yes","vDescription":"Your annuity payment is set to increase by 3% a year","idx":0,"valid":true,"aText":"Yes","evalid":0,"undefined":""},{"uid":524301058,"aID":2,"aName":"No","vDescription":"Your annuity payment will not increase","idx":1,"valid":true,"aText":"No","evalid":0,"undefined":""}],"props":{"general":{"descriptionprop":"Value","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":1,"width":80,"ishtml":false},{"aID":1,"aName":"vDescription","realName":"vDescription","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"name":"","aDescription":"Comma delimited synonyms list","display":0}]}}},{"aID":48,"aName":"Annuity_Partner_Text","aType":1,"objInfo":{"cat":11,"ver":5,"r_ver":5},"flatProps":{"uid":524302848,"description":"","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"knowledgesource":"","pid":3},"tree":{"version":1,"examples":null,"policyRules":null,"tree":{"aID":41,"aType":2,"aAttribute":20,"aBranches":[{"aID":42,"aValues":[1],"aSubTree":{"aID":34,"aType":5,"aFunction":"/*XRF{\"lines\":[{\"cmd\":\"let\",\"targetID\":73,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"You should consider a joint life annuity that will pay an income throughout your joint lifetime.\"}]}}]}*/\n_dgo(73).val(\"You should consider a joint life annuity that will pay an income throughout your joint lifetime.\");\n","aSubTree":{"aID":53,"aType":2,"aAttribute":93,"aBranches":[{"aID":54,"aValues":[1],"aSubTree":{"aID":25,"aType":5,"aFunction":"/*XRF{\"lines\":[{\"cmd\":\"let\",\"targetID\":73,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":73},{\"type\":\"op\",\"operator\":\"+\"},{\"type\":\"str\",\"value\":\" Your wife/partner is assumed to be three years younger than you\"}]}}]}*/\n_dgo(73).val(_dgo(73).val()+\" Your wife/partner is assumed to be three years younger than you\");\n","aSubTree":{"aID":27,"aType":1,"aOutcome":1}}},{"aID":55,"aValues":[2],"aSubTree":{"aID":57,"aType":5,"aFunction":"/*XRF{\"lines\":[{\"cmd\":\"let\",\"targetID\":73,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":73},{\"type\":\"op\",\"operator\":\"+\"},{\"type\":\"str\",\"value\":\" Your husband/partner is assumed to be three years older than you\"}]}}]}*/\n_dgo(73).val(_dgo(73).val()+\" Your husband/partner is assumed to be three years older than you\");\n","aSubTree":{"aID":58,"aType":1,"aOutcome":1}}}]}}},{"aID":43,"aValues":[2],"aSubTree":{"aID":45,"aType":5,"aFunction":"/*XRF{\"lines\":[{\"cmd\":\"let\",\"targetID\":73,\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"You should consider a single life annuity that will pay an income throughout your life\"}]}}]}*/\n_dgo(73).val(\"You should consider a single life annuity that will pay an income throughout your life\");\n","aSubTree":{"aID":51,"aType":1,"aOutcome":1}}}]}},"aValues":[{"uid":524302849,"aID":1,"aName":"Done","idx":0,"selected":false,"visible":true}],"values":{"values":[{"uid":524302849,"aID":1,"aName":"Done","idx":0,"id":1,"selected":false,"valid":true,"aText":"Done","evalid":0,"visible":true}],"props":{"general":{"descriptionprop":"aName","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Outcome","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false}]}},"isMultiSel":false},{"aID":53,"aName":"Annuity_Logic","aType":1,"objInfo":{"cat":11,"ver":13,"r_ver":13},"flatProps":{"uid":524304384,"description":"","_default":"","defaultmode":"","isdynamic":true,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"knowledgesource":"","pid":3},"tree":{"version":1,"examples":null,"policyRules":null,"tree":{"aID":70,"aType":3,"aAttribute":102,"aSubTree":{"aID":66,"aType":3,"aAttribute":23,"aSubTree":{"aID":68,"aType":1,"aOutcome":1}}}},"aValues":[{"uid":524304385,"aID":1,"aName":"Done","idx":0,"selected":false,"visible":true}],"values":{"values":[{"uid":524304385,"aID":1,"aName":"Done","idx":0,"id":1,"selected":false,"valid":true,"aText":"Done","evalid":0,"visible":true}],"props":{"general":{"descriptionprop":"aName","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Outcome","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false}]}},"isMultiSel":false},{"aID":61,"aName":"Age_Adjusted","aType":2,"objInfo":{"cat":12,"ver":2,"lastTab":"events","r_ver":2},"flatProps":{"uid":524289280,"description":"","_default":"","defaultmode":"","isdynamic":true,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":{"atts":[93,14],"cases":[[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":55},{"aID":61,"aType":5,"value":53}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":56},{"aID":61,"aType":5,"value":54}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":57},{"aID":61,"aType":5,"value":55}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":58},{"aID":61,"aType":5,"value":56}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":59},{"aID":61,"aType":5,"value":57}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":60},{"aID":61,"aType":5,"value":59}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":61},{"aID":61,"aType":5,"value":60}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":62},{"aID":61,"aType":5,"value":61}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":63},{"aID":61,"aType":5,"value":63}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":64},{"aID":61,"aType":5,"value":65}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":65},{"aID":61,"aType":5,"value":67}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":66},{"aID":61,"aType":5,"value":69}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":67},{"aID":61,"aType":5,"value":71}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":68},{"aID":61,"aType":5,"value":73}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":69},{"aID":61,"aType":5,"value":75}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":70},{"aID":61,"aType":5,"value":78}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":71},{"aID":61,"aType":5,"value":81}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":72},{"aID":61,"aType":5,"value":84}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":73},{"aID":61,"aType":5,"value":88}],[{"aID":93,"aType":1,"values":[1]},{"aID":14,"aType":2,"aComparitor":"=","value":74},{"aID":61,"aType":5,"value":91}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":55},{"aID":61,"aType":5,"value":51}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":56},{"aID":61,"aType":5,"value":51}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":57},{"aID":61,"aType":5,"value":52}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":58},{"aID":61,"aType":5,"value":53}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":59},{"aID":61,"aType":5,"value":54}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":60},{"aID":61,"aType":5,"value":55}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":61},{"aID":61,"aType":5,"value":56}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":62},{"aID":61,"aType":5,"value":58}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":63},{"aID":61,"aType":5,"value":59}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":64},{"aID":61,"aType":5,"value":60}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":65},{"aID":61,"aType":5,"value":62}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":66},{"aID":61,"aType":5,"value":63}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":67},{"aID":61,"aType":5,"value":65}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":68},{"aID":61,"aType":5,"value":66}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":69},{"aID":61,"aType":5,"value":68}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":70},{"aID":61,"aType":5,"value":70}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":71},{"aID":61,"aType":5,"value":73}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":72},{"aID":61,"aType":5,"value":75}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":73},{"aID":61,"aType":5,"value":78}],[{"aID":93,"aType":1,"values":[2]},{"aID":14,"aType":2,"aComparitor":"=","value":74},{"aID":61,"aType":5,"value":80}]]},"policyRules":null},"events":{},"aDecPlaces":0},{"aID":62,"aName":"Esc_3pc_25","aType":2,"objInfo":{"cat":10,"ver":1,"r_ver":1},"flatProps":{"uid":524289280,"description":"","_default":0,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aDecPlaces":1},{"aID":73,"aName":"Partner_Note","aType":10,"objInfo":{"cat":10,"ver":1,"r_ver":1},"flatProps":{"uid":121636096,"description":"","length":0,"_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","inputmask":"","isenabled":true,"ispassword":false,"isvisible":true,"multiline":false,"showontreedialog":true,"tieddialog":23,"isselected":"Above","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":1},"tree":{"version":1,"examples":null,"policyRules":null},"aLength":0},{"aID":74,"aName":"RPI","aType":2,"objInfo":{"cat":10,"ver":1,"r_ver":1},"flatProps":{"uid":524289280,"description":"","_default":0,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null},"aDecPlaces":2},{"aID":75,"aName":"Cash_Lump_Sum","aType":2,"objInfo":{"cat":10,"ver":2,"r_ver":2},"flatProps":{"uid":524289280,"description":"Do you want to draw a tax-free lump sum from your pension scheme?","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":":&pound;","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null},"aDecPlaces":0},{"aID":76,"aName":"Esc_3pc_description","aType":10,"objInfo":{"cat":10,"ver":1,"r_ver":1},"flatProps":{"uid":121636096,"description":"","length":0,"_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","inputmask":"","isenabled":true,"ispassword":false,"isvisible":true,"multiline":false,"showontreedialog":true,"tieddialog":23,"isselected":"Above","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":1},"tree":{"version":1,"examples":null,"policyRules":null},"aLength":0},{"aID":79,"aName":"Survivor_Pension_25","aType":2,"objInfo":{"cat":10,"ver":1,"r_ver":1},"flatProps":{"uid":524289280,"description":"","_default":0,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null},"aDecPlaces":1},{"aID":80,"aName":"Survivor_Pension_26","aType":2,"objInfo":{"cat":10,"ver":1,"r_ver":1},"flatProps":{"uid":524289280,"description":"","_default":0,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null},"aDecPlaces":3},{"aID":81,"aName":"Survivor_Pension_27","aType":2,"objInfo":{"cat":10,"ver":1,"r_ver":1},"flatProps":{"uid":524289280,"description":"","_default":0,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null},"aDecPlaces":1},{"aID":82,"aName":"RPI_25","aType":2,"objInfo":{"cat":10,"ver":1,"r_ver":1},"flatProps":{"uid":524289280,"description":"","_default":0,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null},"aDecPlaces":1},{"aID":83,"aName":"RPI_26","aType":2,"objInfo":{"cat":10,"ver":1,"r_ver":1},"flatProps":{"uid":524289280,"description":"","_default":0,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null},"aDecPlaces":2},{"aID":84,"aName":"RPI_27","aType":2,"objInfo":{"cat":10,"ver":1,"r_ver":1},"flatProps":{"uid":524289280,"description":"","_default":0,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null},"aDecPlaces":1},{"aID":85,"aName":"Guarantee_25","aType":2,"objInfo":{"cat":10,"ver":1,"r_ver":1},"flatProps":{"uid":524289280,"description":"","_default":0,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aDecPlaces":2},{"aID":86,"aName":"Guarantee_26","aType":2,"objInfo":{"cat":10,"ver":1,"r_ver":1},"flatProps":{"uid":524289280,"description":"","_default":0,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null},"aDecPlaces":5},{"aID":87,"aName":"Guarantee_27","aType":2,"objInfo":{"cat":10,"ver":1,"r_ver":1},"flatProps":{"uid":524289280,"description":"","_default":0,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null},"aDecPlaces":2},{"aID":88,"aName":"Esc_3pc_26","aType":2,"objInfo":{"cat":10,"ver":1,"r_ver":1},"flatProps":{"uid":524289280,"description":"","_default":0,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aDecPlaces":2},{"aID":89,"aName":"Survivor_Pension","aType":2,"objInfo":{"cat":10,"ver":1,"r_ver":1},"flatProps":{"uid":524289280,"description":"","_default":0,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null},"aDecPlaces":3},{"aID":90,"aName":"Boolean_Object","aType":4,"objInfo":{"ver":9,"lastTab":"events","r_ver":9},"flatProps":{"uid":524288256,"description":"","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","catalogstyle":"background-color: #dd7","knowledgesource":""},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"synonyms":""}],"values":{"values":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"valid":true,"aText":"Yes","evalid":0,"synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"valid":true,"aText":"No","evalid":0,"synonyms":""}],"props":{"general":{"descriptionprop":"Value","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false}]}},"events":{"OnCapture":""},"_classPrivs":{"tabs":{"vals":true,"events":true},"hidflatprops":[],"customflatprops":[{"name":"extrainfo","descr":"Extra information to show with the More button"},{"name":"spokendescr","descr":"Optional spoken description"}],"editStruct":true,"editMaintenance":true}},{"aID":91,"aName":"Guarantee","aType":2,"objInfo":{"cat":10,"ver":1,"r_ver":1},"flatProps":{"uid":524289280,"description":"","_default":0,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null},"aDecPlaces":2},{"aID":92,"aName":"Esc_3pc","aType":2,"objInfo":{"cat":10,"ver":1,"r_ver":1},"flatProps":{"uid":524289280,"description":"","_default":0,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null},"aDecPlaces":0},{"aID":93,"aName":"Gender_Lookup","aType":1,"objInfo":{"cat":12,"ver":9,"lastTab":"props","r_ver":9},"flatProps":{"uid":524291328,"description":"Are you male or female?","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Lookup","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"extrainfo":"","spokendescr":"Are you male or female?","knowledgesource":"","pid":5},"tree":{"version":1,"examples":{"atts":[79,80,81,85,87,62,88,82,83,84],"cases":[[{"aID":79,"aType":2,"aComparitor":"=","value":89.3},{"aID":80,"aType":2,"aComparitor":"=","value":-0.637},{"aID":81,"aType":2,"aComparitor":"=","value":77.2},{"aID":85,"aType":2,"aComparitor":"=","value":99.78},{"aID":87,"aType":2,"aComparitor":"=","value":99.01},{"aID":62,"aType":2,"aComparitor":"=","value":63.7},{"aID":88,"aType":2,"aComparitor":"=","value":0.75},{"aID":82,"aType":2,"aComparitor":"=","value":52.1},{"aID":83,"aType":2,"aComparitor":"=","value":0.96},{"aID":84,"aType":2,"aComparitor":"=","value":70.3},{"aID":93,"aType":4,"values":[1]}],[{"aID":79,"aType":2,"aComparitor":"=","value":93.3},{"aID":80,"aType":2,"aComparitor":"=","value":-0.174},{"aID":81,"aType":2,"aComparitor":"=","value":90},{"aID":85,"aType":2,"aComparitor":"=","value":100},{"aID":87,"aType":2,"aComparitor":"=","value":99.39},{"aID":62,"aType":2,"aComparitor":"=","value":62.7},{"aID":88,"aType":2,"aComparitor":"=","value":0.72},{"aID":82,"aType":2,"aComparitor":"=","value":51},{"aID":83,"aType":2,"aComparitor":"=","value":0.91},{"aID":84,"aType":2,"aComparitor":"=","value":68.3},{"aID":93,"aType":4,"values":[2]}]]},"policyRules":null,"tree":null},"aValues":[{"uid":524291329,"aID":1,"aName":"Male","Survivor_Pension_25":89.3,"Survivor_Pension_26":-0.637,"Survivor_Pension_27":77.2,"Guarantee_25":99.78,"Guarantee_26":0,"Guarantee_27":99.01,"Esc_3pc_25":63.7,"Esc_3pc_26":0.75,"RPI_25":52.1,"RPI_26":0.96,"RPI_27":70.3,"idx":0,"selected":false,"visible":true,"synonyms":"male,man,boy,mr,mail,sir,son"},{"uid":524291330,"aID":2,"aName":"Female","Survivor_Pension_25":93.3,"Survivor_Pension_26":-0.174,"Survivor_Pension_27":90,"Guarantee_25":100,"Guarantee_26":0,"Guarantee_27":99.39,"Esc_3pc_25":62.7,"Esc_3pc_26":0.72,"RPI_25":51,"RPI_26":0.91,"RPI_27":68.3,"idx":1,"selected":false,"visible":true,"synonyms":"female,woman,girl,mrs,miss,daughter"}],"values":{"values":[{"uid":524291329,"aID":1,"aName":"Male","Survivor_Pension_25":89.3,"Survivor_Pension_26":-0.637,"Survivor_Pension_27":77.2,"Guarantee_25":99.78,"Guarantee_26":0,"Guarantee_27":99.01,"Esc_3pc_25":63.7,"Esc_3pc_26":0.75,"RPI_25":52.1,"RPI_26":0.96,"RPI_27":70.3,"idx":0,"id":1,"selected":false,"valid":true,"aText":"Male","evalid":0,"visible":true,"synonyms":"male,man,boy,mr,mail,sir,son"},{"uid":524291330,"aID":2,"aName":"Female","Survivor_Pension_25":93.3,"Survivor_Pension_26":-0.174,"Survivor_Pension_27":90,"Guarantee_25":100,"Guarantee_26":0,"Guarantee_27":99.39,"Esc_3pc_25":62.7,"Esc_3pc_26":0.72,"RPI_25":51,"RPI_26":0.91,"RPI_27":68.3,"idx":1,"id":2,"selected":false,"valid":true,"aText":"Female","evalid":0,"visible":true,"synonyms":"female,woman,girl,mrs,miss,daughter"}],"props":{"general":{"descriptionprop":"Value","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":1,"width":80,"ishtml":false},{"aDescription":"Comma delimited synonyms list","aID":1,"aName":"synonyms","aType":"str","display":0,"ishtml":false,"realName":"synonyms","width":80}]}},"isMultiSel":false},{"aID":101,"aName":"Annuity","aType":2,"objInfo":{"cat":10,"ver":2,"r_ver":2},"flatProps":{"uid":524289280,"description":"","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":":&pound;","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null},"aDecPlaces":0},{"aID":102,"aName":"Annuity_Basic_Capture","aType":1,"objInfo":{"ver":11,"cat":11,"r_ver":11},"flatProps":{"uid":524288512,"description":"","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"knowledgesource":"","pid":3},"tree":{"version":1,"examples":null,"policyRules":null,"tree":{"aID":4,"aType":3,"aAttribute":14,"aSubTree":{"aID":8,"aType":3,"aAttribute":93,"aSubTree":{"aID":16,"aType":3,"aAttribute":61,"aSubTree":{"aID":10,"aType":3,"aAttribute":16,"aSubTree":{"aID":12,"aType":3,"aAttribute":17,"aSubTree":{"aID":14,"aType":3,"aAttribute":18,"aSubTree":{"aID":2,"aType":1,"aOutcome":1}}}}}}}},"aValues":[{"uid":524288513,"aID":1,"aName":"Done","idx":0,"selected":false,"visible":true}],"values":{"values":[{"uid":524288513,"aID":1,"aName":"Done","idx":0,"id":1,"selected":false,"valid":true,"aText":"Done","evalid":0,"visible":true}],"props":{"general":{"descriptionprop":"Outcome","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Outcome","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false}]}},"events":{},"isMultiSel":false},{"aID":103,"aName":"Trust Advisor Attributes","aType":13,"objInfo":{"allowed":[106,5,6,1],"ver":4,"opened":false,"style":"","allowall":true,"r_ver":4}},{"aID":106,"aName":"Boolean_Trust_Advisor","aType":4,"objInfo":{"ver":12,"r_ver":12},"flatProps":{"uid":524288256,"description":"","_default":true,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":[],"expandeddescription":"","extrainfo":"","spokendescr":"","catalogstyle":"","knowledgesource":""},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"synonyms":""}],"values":{"values":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"valid":true,"aText":"Yes","evalid":0,"synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"valid":true,"aText":"No","evalid":0,"synonyms":""}],"props":{"general":{"descriptionprop":"synonyms","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"name":"","aDescription":"Comma delimited synonyms list"},{"aDescription":"Comma delimited synonyms list","aID":1,"aName":"synonyms","aType":"str","display":-1,"ishtml":false,"realName":"synonyms","width":80}]}},"events":{"OnCapture":""},"_classPrivs":{"tabs":{"vals":true,"events":true},"hidflatprops":[],"customflatprops":[{"name":"extrainfo","descr":"Extra information to show with the More button"},{"name":"spokendescr","descr":"Optional spoken description"}],"editStruct":true,"editMaintenance":true}},{"aID":107,"aName":"Domiciled","aType":4,"objInfo":{"ver":12,"cat":103,"lastTab":"props","r_ver":12},"flatProps":{"uid":524288256,"description":"Are you UK domiciled for Inheritance Tax purposes?","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":[],"expandeddescription":"The trust selector is based on the assumption that an investor is mainly interested in determining the most suitable solution for estate planning with new or existing investments.<br /><br />Reducing inheritance tax (IHT) will be an important part of the planning process and liability will vary according to where the individual is domiciled. This is therefore the first question to ask any investor contemplating estate planning with investments.","extrainfo":"The trust selector is based on the assumption that an investor (you) is mainly interested in determining the most suitable solution for estate planning with new or existing investments<br /><br />Reducing inheritance tax (IHT) will be an important part of the planning process and liability will vary according to where the individual is domiciled. This is therefore the first question to ask any investor contemplating estate planning with investments","spokendescr":"Are you UK domiciled for Inheritance Tax purposes?","catalogstyle":"background-color: #dd7","knowledgesource":"","pid":106},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"undefined":"","synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"undefined":"","synonyms":""}],"values":{"values":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"valid":true,"aText":"Yes","evalid":0,"undefined":"","synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"valid":true,"aText":"No","evalid":0,"undefined":"","synonyms":""}],"props":{"general":{"descriptionprop":"synonyms","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"name":"","aDescription":"Comma delimited synonyms list"},{"aDescription":"","aID":1,"aName":"synonyms","aType":"str","display":-1,"ishtml":false,"realName":"synonyms","width":80}]}},"events":{},"_classPrivs":{"tabs":{"vals":true,"events":true},"hidflatprops":[],"customflatprops":[],"editStruct":true,"editMaintenance":true}},{"aID":108,"aName":"Access","aType":4,"objInfo":{"ver":8,"cat":103,"r_ver":8},"flatProps":{"uid":524288256,"description":"Do you need access to the investment?","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":[],"expandeddescription":"The 'access' referred to is any kind of access to the investment for personal use, e.g. income or capital, in part or whole, regularly or irregularly.","extrainfo":"The &#39;access&#39; referred to is any kind of access to the investment for personal use, e.g. income or capital, in part or whole, regularly or irregularly","spokendescr":"Do you need access to the investment","catalogstyle":"background-color: #dd7","knowledgesource":"","pid":106},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"undefined":"","synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"undefined":"","synonyms":""}],"values":{"values":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"valid":true,"aText":"Yes","evalid":0,"undefined":"","synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"valid":true,"aText":"No","evalid":0,"undefined":"","synonyms":""}],"props":{"general":{"descriptionprop":"synonyms","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"name":"","aDescription":"Comma delimited synonyms list"},{"aDescription":"","aID":1,"aName":"synonyms","aType":"str","display":-1,"ishtml":false,"realName":"synonyms","width":80}]}},"events":{},"_classPrivs":{"tabs":{"vals":true,"events":true},"hidflatprops":[],"customflatprops":[],"editStruct":true,"editMaintenance":true}},{"aID":109,"aName":"Immediate_transfer","aType":4,"objInfo":{"ver":7,"cat":103,"r_ver":7},"flatProps":{"uid":524288256,"description":"Do you want to make an immediate transfer of value for IHT but restrict access to periodic payments from the investment gifted?","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":[],"expandeddescription":"","extrainfo":"","spokendescr":"Do you want to make an immediate transfer of value for IHT but restrict access to periodic payments from the investment gifted","catalogstyle":"background-color: #dd7","knowledgesource":"","pid":106},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"undefined":"","synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"undefined":"","synonyms":""}],"values":{"values":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"valid":true,"aText":"Yes","evalid":0,"undefined":"","synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"valid":true,"aText":"No","evalid":0,"undefined":"","synonyms":""}],"props":{"general":{"descriptionprop":"synonyms","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"name":"","aDescription":"Comma delimited synonyms list"},{"aDescription":"","aID":1,"aName":"synonyms","aType":"str","display":-1,"ishtml":false,"realName":"synonyms","width":80}]}},"events":{},"_classPrivs":{"tabs":{"vals":true,"events":true},"hidflatprops":[],"customflatprops":[],"editStruct":true,"editMaintenance":true}},{"aID":110,"aName":"Uncond_entitlement","aType":4,"objInfo":{"ver":7,"cat":103,"r_ver":7},"flatProps":{"uid":524288256,"description":"Do you want the beneficiaries to have an unconditional entitlement to the investment?","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":[],"expandeddescription":"The gift contemplated here is one that will be subject to no conditions and under which neither the donees nor their shares of benefit can be changed.","extrainfo":"The gift contemplated here is one that will be subject to no conditions and under which neither the donees nor their shares of benefit can be changed","spokendescr":"Do you want the beneficiaries to have an unconditional entitlement to the investment","catalogstyle":"background-color: #dd7","knowledgesource":"","pid":106},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"undefined":"","synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"undefined":"","synonyms":""}],"values":{"values":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"valid":true,"aText":"Yes","evalid":0,"undefined":"","synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"valid":true,"aText":"No","evalid":0,"undefined":"","synonyms":""}],"props":{"general":{"descriptionprop":"synonyms","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"name":"","aDescription":"Comma delimited synonyms list"},{"aDescription":"","aID":1,"aName":"synonyms","aType":"str","display":-1,"ishtml":false,"realName":"synonyms","width":80}]}},"events":{},"_classPrivs":{"tabs":{"vals":true,"events":true},"hidflatprops":[],"customflatprops":[],"editStruct":true,"editMaintenance":true}},{"aID":111,"aName":"Annual_access","aType":4,"objInfo":{"ver":7,"cat":103,"r_ver":7},"flatProps":{"uid":524288256,"description":"Are you happy to limit this access to an amount equal to the capital originally invested?","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":[],"expandeddescription":"Under a loan trust, the investor establishes a discretionary trust (excluding the investor from all benefit) and this is followed by a substantial loan of cash to the trustees. Note that a loan of existing investments cannot be made<br /><br />The trustees invest the loan monies into a Nucleus Onshore Bond. Offshore Bond or General account within the Nucleus wrap. The investor is entitled to repayment of the loan on demand but cannot otherwise benefit under the trust. The growth on the investment will be outside the investor&rsquo;s estate but the value of the outstanding loan will remain in the estate of the investor. It is expected that as the investor takes repayments of the loan from time to time and spends the money, their estate will gradually reduce for IHT purposes. Neither the gift with reservation nor the pre-owned assets tax rules will apply in this case","extrainfo":"Under a loan trust, the investor establishes a discretionary trust (excluding the investor from all benefit) and this is followed by a substantial loan of cash to the trustees. Note that a loan of existing investments cannot be made<br /><br />The trustees invest the loan monies into a Nucleus Onshore Bond. Offshore Bond or General account within the Nucleus wrap. The investor is entitled to repayment of the loan on demand but cannot otherwise benefit under the trust. The growth on the investment will be outside the investor&rsquo;s estate but the value of the outstanding loan will remain in the estate of the investor. It is expected that as the investor takes repayments of the loan from time to time and spends the money, their estate will gradually reduce for IHT purposes. Neither the gift with reservation nor the pre-owned assets tax rules will apply in this case","spokendescr":"Are you happy to limit this access to an amount equal to the capital originally invested","catalogstyle":"background-color: #dd7","knowledgesource":"","pid":106},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"undefined":"","synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"undefined":"","synonyms":""}],"values":{"values":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"valid":true,"aText":"Yes","evalid":0,"undefined":"","synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"valid":true,"aText":"No","evalid":0,"undefined":"","synonyms":""}],"props":{"general":{"descriptionprop":"synonyms","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"name":"","aDescription":"Comma delimited synonyms list"},{"aDescription":"","aID":1,"aName":"synonyms","aType":"str","display":-1,"ishtml":false,"realName":"synonyms","width":80}]}},"events":{},"_classPrivs":{"tabs":{"vals":true,"events":true},"hidflatprops":[],"customflatprops":[],"editStruct":true,"editMaintenance":true}},{"aID":112,"aName":"Under18","aType":4,"objInfo":{"ver":7,"cat":103,"r_ver":7},"flatProps":{"uid":524288256,"description":"Are the beneficiaries under the age of 18?","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":[],"expandeddescription":"An individual under the age of 18 (or 16 in Scotland) cannot hold or deal with the investment. An unconditional gift to such an individual should therefore be made subject to a bare gift trust. The bare gift trust can be used with a General account as well as Offshore and Onshore Bonds.","extrainfo":"An individual under the age of 18 (or 16 in Scotland) cannot hold or deal with the investment. An unconditional gift to such an individual should therefore be made subject to a bare gift trust. The bare gift trust can be used with a General account as well as Offshore and Onshore Bonds","spokendescr":"Are the beneficiaries under the age of 18","catalogstyle":"background-color: #dd7","knowledgesource":"","pid":106},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"undefined":"","synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"undefined":"","synonyms":""}],"values":{"values":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"valid":true,"aText":"Yes","evalid":0,"undefined":"","synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"valid":true,"aText":"No","evalid":0,"undefined":"","synonyms":""}],"props":{"general":{"descriptionprop":"synonyms","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"name":"","aDescription":"Comma delimited synonyms list"},{"aDescription":"","aID":1,"aName":"synonyms","aType":"str","display":-1,"ishtml":false,"realName":"synonyms","width":80}]}},"events":{},"_classPrivs":{"tabs":{"vals":true,"events":true},"hidflatprops":[],"customflatprops":[],"editStruct":true,"editMaintenance":true}},{"aID":113,"aName":"Income_only","aType":4,"objInfo":{"ver":7,"cat":103,"r_ver":7},"flatProps":{"uid":524288256,"description":"Do you want the beneficiary to be entitled to the income but not the capital value of the investments?","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":[],"expandeddescription":"Whether a beneficiary under a trust is entitled to the trust income will usually dictate the income tax treatment of the trust in question. Income tax liabilities as well as trust administration are usually less onerous if a beneficiary is entitled to the trust income. If the only investment to be used in the planning is to be a Nucleus Onshore or Offshore Bond (non-income producing investments) or where the investor is certain that the investments in the Nucleus General account will never produce a distributable income, the answer to this question should be no.","extrainfo":"Whether a beneficiary under a trust is entitled to the trust income will usually dictate the income tax treatment of the trust in question. Income tax liabilities as well as trust administration are usually less onerous if a beneficiary is entitled to the trust income. If the only investment to be used in the planning is to be a Nucleus Onshore or Offshore Bond (non-income producing investments) or where the investor is certain that the investments in the Nucleus General account will never produce a distributable income, the answer to this question should be no","spokendescr":"Do you want the beneficiary to be entitled to the income but not the capital value of the investments","catalogstyle":"background-color: #dd7","knowledgesource":"","pid":106},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"undefined":"","synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"undefined":"","synonyms":""}],"values":{"values":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"valid":true,"aText":"Yes","evalid":0,"undefined":"","synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"valid":true,"aText":"No","evalid":0,"undefined":"","synonyms":""}],"props":{"general":{"descriptionprop":"synonyms","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"name":"","aDescription":"Comma delimited synonyms list"},{"aDescription":"","aID":1,"aName":"synonyms","aType":"str","display":-1,"ishtml":false,"realName":"synonyms","width":80}]}},"events":{},"_classPrivs":{"tabs":{"vals":true,"events":true},"hidflatprops":[],"customflatprops":[],"editStruct":true,"editMaintenance":true}},{"aID":114,"aName":"Lifetime_gift","aType":4,"objInfo":{"ver":9,"cat":103,"r_ver":9},"flatProps":{"uid":524288256,"description":"Would you consider making a lifetime gift of your investment, or the growth in its value, to someone other than their spouse in order to reduce IHT?","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":[],"expandeddescription":"This question is aimed at determining whether the investor wishes to consider planning that will result in them not having complete ownership of and access to the investment, i.e. whether they would be willing to make a gift of the investment or even the growth on it to reduce IHT.","extrainfo":"This question is aimed at determining whether an investor wishes to consider planning that will result in them not having complete ownership of and access to the investment, i.e. whether they would be willing to make a gift of the investment or even the growth on it to reduce IHT","spokendescr":"Would you consider making a lifetime gift of your investment, or the growth in its value, to someone other than their spouse in order to reduce IHT","catalogstyle":"background-color: #dd7","knowledgesource":"","pid":106},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"undefined":"","synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"undefined":"","synonyms":""}],"values":{"values":[{"uid":524288257,"aID":1,"aName":"Yes","idx":0,"valid":true,"aText":"Yes","evalid":0,"undefined":"","synonyms":""},{"uid":524288258,"aID":2,"aName":"No","idx":1,"valid":true,"aText":"No","evalid":0,"undefined":"","synonyms":""}],"props":{"general":{"descriptionprop":"synonyms","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"name":"","aDescription":"Comma delimited synonyms list"},{"aDescription":"","aID":1,"aName":"synonyms","aType":"str","display":-1,"ishtml":false,"realName":"synonyms","width":80}]}},"events":{},"_classPrivs":{"tabs":{"vals":true,"events":true},"hidflatprops":[],"customflatprops":[],"editStruct":true,"editMaintenance":true}},{"aID":118,"aName":"Main_Flow","aType":1,"objInfo":{"ver":35,"cat":11,"r_ver":35},"flatProps":{"uid":524288512,"description":"","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"knowledgesource":"Custom flow for this application","pid":3},"tree":{"version":1,"examples":null,"policyRules":null,"tree":{"aID":97,"aType":5,"aFunction":"/*XRF{\"lines\":[{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":142,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"Welcome to our Financial Services Demo\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"Welcome to our Financial Services Demo\"}]}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":142,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"Please note all figures quoted are indicative only and do not represent an actual proposal\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"\"}]}]}}]}*/\n_dgo(142).run(\"Welcome to our Financial Services Demo\", \"Welcome to our Financial Services Demo\");\n_dgo(142).run(\"Please note all figures quoted are indicative only and do not represent an actual proposal\", \"\");\n","aSubTree":{"aID":58,"aType":2,"aAttribute":141,"aBranches":[{"aID":59,"aValues":[1],"aSubTree":{"aID":65,"aType":3,"aAttribute":53,"aSubTree":{"aID":66,"aType":3,"aAttribute":126,"aSubTree":{"aID":71,"aType":4,"aOutcome":1,"aSubTree":{"aID":83,"aType":2,"aAttribute":143,"aBranches":[{"aID":85,"aValues":[2],"aSubTree":{"aID":87,"aType":3,"aOutcome":1,"aAttribute":130,"aSubTree":{"aID":88,"aType":2,"aOutcome":1,"aAttribute":133,"aBranches":[{"aID":89,"aSubTree":{"aID":90,"aType":5,"aFunction":"/*XRF{\"lines\":[{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":142,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"Thank you for your feedback, we're happy you found our advice helpful\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"That is great to hear\"}]}]}}]}*/\n_dgo(142).run(\"Thank you for your feedback, we're happy you found our advice helpful\", \"That is great to hear\");\n","aSubTree":{"aID":99,"aType":4,"aOutcome":1,"aSubTree":{"aID":91,"aType":1,"aOutcome":1}}},"aThreshold":0.5,"aComparitor":">="},{"aID":92,"aSubTree":{"aID":93,"aType":5,"aFunction":"/*XRF{\"lines\":[{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":142,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"Sorry to hear that we didn't meet your expectations\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"Sorry to hear that we didn't meet your expectations\"}]}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":142,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"A member of our team will be in touch shortly to understand your exact requirements\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"\"}]}]}}]}*/\n_dgo(142).run(\"Sorry to hear that we didn't meet your expectations\", \"Sorry to hear that we didn't meet your expectations\");\n_dgo(142).run(\"A member of our team will be in touch shortly to understand your exact requirements\", \"\");\n","aSubTree":{"aID":94,"aType":7,"aJump":99}},"aThreshold":0.5,"aComparitor":"<"}]}}},{"aID":84,"aValues":[1],"aSubTree":{"aType":1,"aID":95,"aOutcome":1}}]}}}}},{"aID":60,"aValues":[2],"aSubTree":{"aID":62,"aType":3,"aAttribute":140,"aSubTree":{"aID":63,"aType":3,"aAttribute":129,"aSubTree":{"aID":64,"aType":7,"aJump":71}}}}]}}},"aValues":[{"uid":524288513,"aID":1,"aName":"Done","idx":0,"selected":false,"visible":true}],"values":{"values":[{"uid":524288513,"aID":1,"aName":"Done","idx":0,"id":1,"selected":false,"valid":true,"aText":"Done","evalid":0,"visible":true}],"props":{"general":{"descriptionprop":"Outcome","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Outcome","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false}]}},"events":{},"isMultiSel":false},{"aID":122,"aName":"Utility Scripts","aType":13,"objInfo":{"allowed":[],"allowall":true,"ver":7,"style":"background-color: #abd6b0","opened":false,"r_ver":7}},{"aID":123,"aName":"ReportInitialize","aType":5,"objInfo":{"cat":122,"isWizzard":false,"ver":4,"procType":"js","r_ver":4},"aCode":"var cmdObj = _dgo(123);if (typeof report_array != \"object\") {\n  report_array = [];\n} else {\n  report_array.splice(0, report_array.length);\n}\n"},{"aID":124,"aName":"ReportAddLine","aType":5,"objInfo":{"cat":122,"isWizzard":false,"ver":4,"procType":"js","r_ver":4},"aCode":"var cmdObj = _dgo(124);// formula: ReportAddLine (labelText:text, lineType: text, lineObject:obj), 2\nvar labelText = params[0];\nvar lineType = params[1];\nvar lineObject = params[2];\nreport_array.push({txt: labelText, ltype: lineType, obj: lineObject});\n"},{"aID":125,"aName":"ReportDisplay","aType":5,"objInfo":{"cat":122,"isWizzard":false,"ver":7,"procType":"js","r_ver":7},"aCode":"var cmdObj = _dgo(125);var s = \"\";\nfor (var c = 0; c < report_array.length; c++) {\n  var l = report_array[c];\n  // embedded variables\n  if (l.txt.indexOf(\"{\") >= 0) {\n    l.txt = LabelDecode(l.txt, null, true);\n  }\n  s += \"<div class='fs-\" + l.ltype + \"'>\";\n  if (!l.obj) {\n    // just a line\n    s += l.txt;\n  } else {\n    var v;\n    if (l.obj.aType == TYPE_BOOLEAN) {\n      v = l.obj.GetValueAsString(); // bools as text\n    } else {\n      v = l.obj.val();\n    }\n    if (l.obj.props.units) {\n      if (l.obj.props.units.substr(0, 1) == \":\") {\n        v = l.obj.props.units.substr(1) + v;\n      } else {\n      \tv += l.obj.props.units;\n      }\n    }\n    s += l.txt + \"<div class='fs-\" + l.ltype + \"-value'>\" + v + \"</div>\";\n  }\n  s += \"</div>\";\n}\n//\nvar msg = {\n  isHTML: true,\n  includeBubble: true,\n  css: {\n    \"background-color\": \"rgb(42, 100, 180)\",\n    color: \"rgb(220,220,220)\",\n    \"font-size\": \"30px\",\n    \"opacity\": 1\n  },\n  contents: s,\n  speak: \"See screen for report\",\n  autoContinue: true\n};\nxpertrule.pause(JSON.stringify(msg));\n"},{"aID":126,"aName":"Annuity_Report","aType":5,"objInfo":{"cat":138,"isWizzard":false,"ver":41,"procType":"xr","r_ver":41},"aCode":"var cmdObj = _dgo(126);/*XRF{\"lines\":[{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":123,\"params\":[]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"Please find below an audit of your session together with your calculated annuity figure:\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"header\"}]},{\"type\":\"null\"}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"Age last birthday:\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"body\",\"byRef\":true}]},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":14,\"byRef\":true}]}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"Sex:\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"body\",\"byRef\":true}]},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":93,\"byRef\":true}]}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"Smoke:\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"body\",\"byRef\":true}]},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":16,\"byRef\":true}]}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"{Smoke.vDescription}\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"comment\"}]},{\"type\":\"null\"}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"Suffered ill-health:\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"body\",\"byRef\":true}]},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":17,\"byRef\":true}]}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"{Ill_Health.vDescription}\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"comment\"}]},{\"type\":\"null\"}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"Retirement Fund Size:\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"body\",\"byRef\":true}]},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":18,\"byRef\":true}]}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"Cash Lump Sum:\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"body\",\"byRef\":true}]},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":75,\"byRef\":true}]}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"{Draw_Lump_Sum.vDescription}\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"comment\"}]},{\"type\":\"null\"}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"Partner Income:\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"body\",\"byRef\":true}]},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":20,\"byRef\":true}]}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"{Partner_Note}\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"comment\"}]},{\"type\":\"list\",\"items\":[]}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"Minimum Term Annuity:\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"body\",\"byRef\":true}]},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":21,\"byRef\":true}]}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"{Minimum_Term_Annuity.vDescription}\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"comment\"}]},{\"type\":\"null\"}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"Inflation Protection:\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"body\",\"byRef\":true}]},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":22,\"byRef\":true}]}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"{Inflation_Protection.vDescription}\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"comment\"}]},{\"type\":\"null\"}]}},{\"cmd\":\"if\",\"expr\":{\"type\":\"list\",\"items\":[{\"type\":\"comp\",\"operator\":\"==\",\"lhs\":{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":22,\"byRef\":false}]},\"rhs\":{\"type\":\"list\",\"items\":[{\"type\":\"lval\",\"aID\":22,\"vID\":2}]}}]},\"trueLines\":[{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"Payment Escalation\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"body\",\"byRef\":true}]},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":42,\"byRef\":true}]}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"{Increase_Payments.vDescription}\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"comment\"}]},{\"type\":\"null\"}]}}],\"elseIfs\":[]},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"Your choice of annuity is calculated to be:\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"footer\",\"byRef\":true}]},{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":101,\"byRef\":true}]}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":125,\"params\":[]}}]}*/\n_dgo(123).run();\n_dgo(124).run(\"Please find below an audit of your session together with your calculated annuity figure:\", \"header\", null);\n_dgo(124).run(\"Age last birthday:\", \"body\", _dgo(14));\n_dgo(124).run(\"Sex:\", \"body\", _dgo(93));\n_dgo(124).run(\"Smoke:\", \"body\", _dgo(16));\n_dgo(124).run(\"{Smoke.vDescription}\", \"comment\", null);\n_dgo(124).run(\"Suffered ill-health:\", \"body\", _dgo(17));\n_dgo(124).run(\"{Ill_Health.vDescription}\", \"comment\", null);\n_dgo(124).run(\"Retirement Fund Size:\", \"body\", _dgo(18));\n_dgo(124).run(\"Cash Lump Sum:\", \"body\", _dgo(75));\n_dgo(124).run(\"{Draw_Lump_Sum.vDescription}\", \"comment\", null);\n_dgo(124).run(\"Partner Income:\", \"body\", _dgo(20));\n_dgo(124).run(\"{Partner_Note}\", \"comment\", );\n_dgo(124).run(\"Minimum Term Annuity:\", \"body\", _dgo(21));\n_dgo(124).run(\"{Minimum_Term_Annuity.vDescription}\", \"comment\", null);\n_dgo(124).run(\"Inflation Protection:\", \"body\", _dgo(22));\n_dgo(124).run(\"{Inflation_Protection.vDescription}\", \"comment\", null);\nif (_dgo(22).val()==false) {\n_dgo(124).run(\"Payment Escalation\", \"body\", _dgo(42));\n_dgo(124).run(\"{Increase_Payments.vDescription}\", \"comment\", null);\n}\n_dgo(124).run(\"Your choice of annuity is calculated to be:\", \"footer\", _dgo(101));\n_dgo(125).run();\n"},{"aID":127,"aName":"After Service","aType":13,"objInfo":{"allowed":[],"allowall":true,"ver":3,"style":"","opened":false,"r_ver":3}},{"aID":129,"aName":"Trust_Report","aType":5,"objInfo":{"cat":138,"isWizzard":false,"ver":25,"procType":"xr","r_ver":25},"aCode":"var cmdObj = _dgo(129);/*XRF{\"lines\":[{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":123,\"params\":[]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"We advise the following:\"}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"header\"}]},{\"type\":\"list\",\"items\":[]}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":124,\"params\":[{\"type\":\"list\",\"items\":[{\"type\":\"obj\",\"aID\":140}]},{\"type\":\"list\",\"items\":[{\"type\":\"str\",\"value\":\"header\"}]},{\"type\":\"list\",\"items\":[]}]}},{\"cmd\":\"do\",\"expr\":{\"type\":\"func\",\"func\":125,\"params\":[]}}]}*/\n_dgo(123).run();\n_dgo(124).run(\"We advise the following:\", \"header\", );\n_dgo(124).run(_dgo(140).val(), \"header\", );\n_dgo(125).run();\n"},{"aID":130,"aName":"Feedback","aType":10,"objInfo":{"ver":7,"cat":127,"r_ver":7},"flatProps":{"uid":121636096,"description":"This concludes your consultation. In your own words please tell us what you thought of the advice you received today.....","length":0,"_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","inputmask":"","isenabled":true,"ispassword":false,"isvisible":true,"multiline":false,"showontreedialog":false,"tieddialog":0,"isselected":"Above","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":1},"tree":{"version":1,"examples":null,"policyRules":null},"events":{},"_classPrivs":{"tabs":{"events":true},"hidflatprops":[],"customflatprops":[{"name":"extrainfo","descr":"Extra information to show with the More button"},{"name":"spokendescr","descr":"Optional spoken description"}],"editStruct":true,"editMaintenance":true},"aLength":0},{"aID":131,"aName":"CognitiveService","aType":13,"objInfo":{"allowed":[],"allowall":true,"ver":2,"opened":true,"r_ver":2}},{"aID":132,"aName":"lib_msSentiment","aType":5,"objInfo":{"cat":131,"isWizzard":false,"ver":8,"procType":"js","r_ver":8},"aCode":"var cmdObj = _dgo(132);var settings = params[0];\n\n/* settings is something like...\n{\n  subscriptionKey: \"key\",\n  inputText: \"\"\n}\n*/\n\nvar aResult = {};\n\nreplayStack.CriticalSection(\n  function(rs){\n    var host = \"westeurope.api.cognitive.microsoft.com\";\n    var path = \"/text/analytics/v2.0/sentiment\";\n\n    function performImageProcessing() {\n      var body_obj = {\n        documents: [\n          {\n            id: \"0\",\n            text: settings.inputText\n          }\n        ]\n      };\n      var body_text = JSON.stringify(body_obj);\n\n      var request = https.request({\n        host: host,\n        path: path,\n        method: \"POST\",\n        port: 443,\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Ocp-Apim-Subscription-Key\": settings.subscriptionKey,\n          \"Content-Length\": Buffer.byteLength(body_text)\n        }\n      });\n\n      request.write(body_text);\n      request.end();\n\n      request.on(\"error\", function(err) {\n\n        rs.CriticalDone({ok: false, error: err});   // error, continue inference\n      });\n\n      request.on('response', function (response) {\n        response.setEncoding('utf8');\n\n        var res = \"\";\n\n        response.on('data', function (chunk) {\n          res += chunk.toString();\n        });\n\n        response.on('end', function () {          \n          rs.CriticalDone({ok: true, msg: JSON.parse(res)});\n        });\n      });\n    }\n\n    performImageProcessing();\n  }, function(data){\n    aResult = data;\n  }\n);\n\n// ========================================================\n// ========================================================\n// Sentiment functions\nfunction findSentiment(documents){\n\tif(documents && documents.length > 0){\n    \treturn documents[0].score;\n  \t}\n    return -1;\n}\n\n// ========================================================\n// ========================================================\n// Main routine\nvar sentiment = -1;\n\nif (!aResult.ok) {\n    xpertrule.message(aResult.error);\n} else {\n  \tvar msg = aResult.msg;\n   \tsentiment = findSentiment(msg.documents);\n    if (sentiment == -1) {\n      xpertrule.message(JSON.stringify(msg));\n    }\n}\n\nreturn sentiment;\n"},{"aID":133,"aName":"Feedback_Sentiment","aType":2,"objInfo":{"ver":16,"lastTab":"events","cat":131,"r_ver":16},"flatProps":{"uid":524289280,"description":"","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null},"events":{"OnCapture":"self.val(_dgo(132).run({\n    \"subscriptionKey\": \"90bb6d30beee4f8e8ed63ae9c6dd2135\",\n    \"inputText\": _dgo(130).val()\n}));\n"},"_classPrivs":{"tabs":{"events":true},"hidflatprops":[],"customflatprops":[{"name":"extrainfo","descr":"Extra information to show with the More button"},{"name":"spokendescr","descr":"Optional spoken description"}],"editStruct":true,"editMaintenance":true},"aDecPlaces":1},{"aID":134,"aName":"RPA","aType":5,"objInfo":{"cat":122,"isWizzard":false,"ver":18,"procType":"js","r_ver":18},"aCode":"var cmdObj = _dgo(134);var rpaInput = {\n  method: \"db_update\",\n  input: {\n    user: \"online\",\n    data: xpertrule.encodeData([_dgo(133),_dgo(141),_dgo(101),_dgo(140)], true, \"JSON\")\n  }\n};\nvar rpaOutput = {\n  ok: false,\n  output: {\n    ok: null,\n    error: null\n  }\n};\n\nvar rpaHostName = \"rpa.xpertrule.com\";\nreplayStack.CriticalSection(\n  function(rs){\n    var data = JSON.stringify(rpaInput);\n    var options = {\n      host: rpaHostName,\n      port: \"8188\",\n      path: \"/run\",\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json; charset=utf-8\",\n        \"Content-Length\": data.length\n      }\n    };\n    var req = http.request(options, function(res) {\n      var result = \"\";\n      res.setEncoding(\"utf8\");\n      res.on(\"data\", function(chunk) {\n        result += chunk;\n      });\n      res.on(\"end\", function() {\n        rs.CriticalDone(result);\n      });\n    });\n    req.write(data);\n    req.end();\n  }, function(result) {\n    rpaOutput = result;\n  }\n);\n// The rpaOutput object is now populated with the result of the call\n"},{"aID":138,"aName":"Reporting Scripts","aType":13,"objInfo":{"allowed":[],"allowall":true,"ver":4,"opened":false,"style":"","r_ver":4}},{"aID":140,"aName":"Trust_Selector_Logic","aType":1,"objInfo":{"ver":14,"cat":11,"r_ver":14},"flatProps":{"uid":524288512,"description":"","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"knowledgesource":"","pid":3},"tree":{"version":1,"examples":{"atts":[107,114,108,109,111,110,112,113],"cases":[[{"aID":107,"aType":1,"values":[1]},{"aID":114,"aType":1,"values":[1]},{"aID":108,"aType":1,"values":[1]},{"aID":109,"aType":1,"values":[1]},{"aID":111,"aType":0},{"aID":110,"aType":0},{"aID":112,"aType":0},{"aID":113,"aType":0},{"aType":4,"values":[3],"tag":"Leaf 1"}],[{"aID":107,"aType":1,"values":[1]},{"aID":114,"aType":1,"values":[1]},{"aID":108,"aType":1,"values":[1]},{"aID":109,"aType":1,"values":[2]},{"aID":111,"aType":1,"values":[1]},{"aID":110,"aType":0},{"aID":112,"aType":0},{"aID":113,"aType":0},{"aType":4,"values":[4],"tag":"Leaf 2"}],[{"aID":107,"aType":1,"values":[1]},{"aID":114,"aType":1,"values":[1]},{"aID":108,"aType":1,"values":[1]},{"aID":109,"aType":1,"values":[2]},{"aID":111,"aType":1,"values":[2]},{"aID":110,"aType":0},{"aID":112,"aType":0},{"aID":113,"aType":0},{"aType":4,"values":[2],"tag":"Leaf 3"}],[{"aID":107,"aType":1,"values":[1]},{"aID":114,"aType":1,"values":[1]},{"aID":108,"aType":1,"values":[2]},{"aID":109,"aType":0},{"aID":111,"aType":0},{"aID":110,"aType":1,"values":[1]},{"aID":112,"aType":1,"values":[1]},{"aID":113,"aType":0},{"aType":4,"values":[5],"tag":"Leaf 4"}],[{"aID":107,"aType":1,"values":[1]},{"aID":114,"aType":1,"values":[1]},{"aID":108,"aType":1,"values":[2]},{"aID":109,"aType":0},{"aID":111,"aType":0},{"aID":110,"aType":1,"values":[1]},{"aID":112,"aType":1,"values":[2]},{"aID":113,"aType":0},{"aType":4,"values":[6],"tag":"Leaf 5"}],[{"aID":107,"aType":1,"values":[1]},{"aID":114,"aType":1,"values":[1]},{"aID":108,"aType":1,"values":[2]},{"aID":109,"aType":0},{"aID":111,"aType":0},{"aID":110,"aType":1,"values":[2]},{"aID":112,"aType":0},{"aID":113,"aType":1,"values":[1]},{"aType":4,"values":[7],"tag":"Leaf 6"}],[{"aID":107,"aType":1,"values":[1]},{"aID":114,"aType":1,"values":[1]},{"aID":108,"aType":1,"values":[2]},{"aID":109,"aType":0},{"aID":111,"aType":0},{"aID":110,"aType":1,"values":[2]},{"aID":112,"aType":0},{"aID":113,"aType":1,"values":[2]},{"aType":4,"values":[8],"tag":"Leaf 7"}],[{"aID":107,"aType":1,"values":[1]},{"aID":114,"aType":1,"values":[2]},{"aID":108,"aType":0},{"aID":109,"aType":0},{"aID":111,"aType":0},{"aID":110,"aType":0},{"aID":112,"aType":0},{"aID":113,"aType":0},{"aType":4,"values":[2],"tag":"Leaf 8"}],[{"aID":107,"aType":1,"values":[2]},{"aID":114,"aType":0},{"aID":108,"aType":0},{"aID":109,"aType":0},{"aID":111,"aType":0},{"aID":110,"aType":0},{"aID":112,"aType":0},{"aID":113,"aType":0},{"aType":4,"values":[1],"tag":"Leaf 9"}]]},"policyRules":null,"tree":{"aType":2,"aAttribute":107,"aBranches":[{"aValues":[1],"aSubTree":{"aType":2,"aAttribute":114,"aBranches":[{"aValues":[1],"aSubTree":{"aType":2,"aAttribute":108,"aBranches":[{"aValues":[1],"aSubTree":{"aType":2,"aAttribute":109,"aBranches":[{"aValues":[1],"aSubTree":{"aType":1,"aFreq":1,"aOutcome":3,"aID":10},"aID":9},{"aValues":[2],"aSubTree":{"aType":2,"aAttribute":111,"aBranches":[{"aValues":[1],"aSubTree":{"aType":1,"aFreq":1,"aOutcome":4,"aID":14},"aID":13},{"aValues":[2],"aSubTree":{"aType":1,"aFreq":1,"aOutcome":2,"aID":16},"aID":15}],"aID":12},"aID":11}],"aID":8},"aID":7},{"aValues":[2],"aSubTree":{"aType":2,"aAttribute":110,"aBranches":[{"aValues":[1],"aSubTree":{"aType":2,"aAttribute":112,"aBranches":[{"aValues":[1],"aSubTree":{"aType":1,"aFreq":1,"aOutcome":5,"aID":22},"aID":21},{"aValues":[2],"aSubTree":{"aType":1,"aFreq":1,"aOutcome":6,"aID":24},"aID":23}],"aID":20},"aID":19},{"aValues":[2],"aSubTree":{"aType":2,"aAttribute":113,"aBranches":[{"aValues":[1],"aSubTree":{"aType":1,"aFreq":1,"aOutcome":7,"aID":28},"aID":27},{"aValues":[2],"aSubTree":{"aType":1,"aFreq":1,"aOutcome":8,"aID":30},"aID":29}],"aID":26},"aID":25}],"aID":18},"aID":17}],"aID":6},"aID":5},{"aValues":[2],"aSubTree":{"aType":1,"aFreq":1,"aOutcome":2,"aID":32},"aID":31}],"aID":4},"aID":3},{"aValues":[2],"aSubTree":{"aType":1,"aFreq":1,"aOutcome":1,"aID":34},"aID":33}],"aID":2}},"aValues":[{"uid":524288513,"aID":1,"aName":"A trust is unlikely to be appropriate","idx":0,"selected":false,"visible":true},{"aID":2,"aName":"Lifetime planning does not seem appropriate for you, further guidance should be obtained.","selected":false,"uid":0,"visible":true,"idx":1},{"aID":3,"aName":"A Discounted Gift Trust may be appropriate","selected":false,"uid":0,"visible":true,"idx":2},{"aID":4,"aName":"A Loan Trust may be appropriate.","selected":false,"uid":0,"visible":true,"idx":3},{"aID":5,"aName":"A Bare Gift Trust may be appropriate.","selected":false,"uid":0,"visible":true,"idx":4},{"aID":6,"aName":"No trust is necessary. An outright gift may be appropriate, further guidance should be obtained.","selected":false,"uid":0,"visible":true,"idx":5},{"aID":7,"aName":"A Flexible Interest In Posession Trust may be appropriate.","selected":false,"uid":0,"visible":true,"idx":6},{"aID":8,"aName":"A Discretionary Gift Trust may be appropriate.","selected":false,"uid":0,"visible":true,"idx":7}],"values":{"values":[{"uid":524288513,"aID":1,"aName":"A trust is unlikely to be appropriate","idx":0,"id":1,"selected":false,"valid":true,"aText":"A trust is unlikely to be appropriate","evalid":0,"visible":true},{"id":2,"aID":2,"aName":"Lifetime planning does not seem appropriate for you, further guidance should be obtained.","aText":"Lifetime planning does not seem appropriate for you, further guidance should be obtained.","evalid":0,"selected":false,"uid":0,"valid":true,"visible":true,"idx":1},{"id":3,"aID":3,"aName":"A Discounted Gift Trust may be appropriate","aText":"A Discounted Gift Trust may be appropriate","evalid":0,"selected":false,"uid":0,"valid":true,"visible":true,"idx":2},{"id":4,"aID":4,"aName":"A Loan Trust may be appropriate.","aText":"A Loan Trust may be appropriate.","evalid":0,"selected":false,"uid":0,"valid":true,"visible":true,"idx":3},{"id":5,"aID":5,"aName":"A Bare Gift Trust may be appropriate.","aText":"A Bare Gift Trust may be appropriate.","evalid":0,"selected":false,"uid":0,"valid":true,"visible":true,"idx":4},{"id":6,"aID":6,"aName":"No trust is necessary. An outright gift may be appropriate, further guidance should be obtained.","aText":"No trust is necessary. An outright gift may be appropriate, further guidance should be obtained.","evalid":0,"selected":false,"uid":0,"valid":true,"visible":true,"idx":5},{"id":7,"aID":7,"aName":"A Flexible Interest In Posession Trust may be appropriate.","aText":"A Flexible Interest In Posession Trust may be appropriate.","evalid":0,"selected":false,"uid":0,"valid":true,"visible":true,"idx":6},{"id":8,"aID":8,"aName":"A Discretionary Gift Trust may be appropriate.","aText":"A Discretionary Gift Trust may be appropriate.","evalid":0,"selected":false,"uid":0,"valid":true,"visible":true,"idx":7}],"props":{"general":{"descriptionprop":"Outcome","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Outcome","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false}]}},"events":{},"isMultiSel":false},{"aID":141,"aName":"Financial_Service","aType":1,"objInfo":{"ver":10,"lastTab":"vprops","cat":127,"r_ver":10},"flatProps":{"uid":524289024,"description":"What can I advise you on today?","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":5},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"aID":1,"aName":"Annuity Advice","selected":false,"uid":0,"visible":true,"synonyms":"annuity,retirement,retirement account,pension,grant,payment,support,subsidy,premium","idx":0},{"aID":2,"aName":"Trust Advice","selected":false,"uid":0,"visible":true,"synonyms":"trust,trust fund,fund,endowment","idx":1}],"values":{"values":[{"id":1,"aID":1,"aName":"Annuity Advice","aText":"Annuity Advice","evalid":0,"selected":false,"uid":0,"valid":true,"visible":true,"synonyms":"annuity,retirement,retirement account,pension,grant,payment,support,subsidy,premium","idx":0},{"id":2,"aID":2,"aName":"Trust Advice","aText":"Trust Advice","evalid":0,"selected":false,"uid":0,"valid":true,"visible":true,"synonyms":"trust,trust fund,fund,endowment","idx":1}],"props":{"general":{"descriptionprop":"Value","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":1,"width":80,"ishtml":false},{"aDescription":"Comma delimited synonyms list","aID":1,"aName":"synonyms","aType":"str","display":0,"ishtml":false,"realName":"synonyms","width":80}]}},"events":{},"_classPrivs":{"tabs":{"vals":true,"events":true},"hidflatprops":[],"customflatprops":[{"name":"extrainfo","descr":"Extra information to show with the More button"},{"name":"spokendescr","descr":"Optional spoken description"}],"editStruct":true,"editMaintenance":true},"isMultiSel":false},{"aID":142,"aName":"RichMessage","aType":5,"objInfo":{"cat":122,"isWizzard":false,"ver":8,"procType":"js","r_ver":8},"aCode":"var cmdObj = _dgo(142);// formula: RichMessage (displayText:text, spokenText: text), 2\nvar displayText = params[0];\nvar spokenText = params[1];\n/*\n * Display a rich HTML message with alternate spoken text\n */\n\nxpertrule.chat({\n  includeBubble: true,\n  css: {\n    \"background-color\": \"rgb(42, 100, 180)\",\n    \"color\": \"rgb(220,220,220)\",\n    \"font-size\": \"20px\",\n    \"opacity\": 1\n  },\n  speak: spokenText ,\n  contents: displayText\n});\n"},{"aID":143,"aName":"Deploy_Location","aType":1,"objInfo":{"ver":4,"lastTab":"events","cat":127,"r_ver":4},"flatProps":{"uid":524289024,"description":"","_default":"","defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"allowdeselect":true,"allowinvalid":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"reversepreviousanswers":false,"showinvalid":true,"showontreedialog":true,"sortdirection":"Descending","sortinvalid":true,"sortproperty":"","tieddialog":0,"isselected":"Knowledge","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":5},"tree":{"version":1,"examples":null,"policyRules":null,"tree":null},"aValues":[{"aID":1,"aName":"browser","selected":false,"uid":0,"visible":true,"synonyms":"","idx":0},{"aID":2,"aName":"server","selected":false,"uid":0,"visible":true,"synonyms":"","idx":1}],"values":{"values":[{"id":1,"aID":1,"aName":"browser","aText":"browser","evalid":0,"selected":false,"uid":0,"valid":true,"visible":true,"synonyms":"","idx":0},{"id":2,"aID":2,"aName":"server","aText":"server","evalid":0,"selected":false,"uid":0,"valid":true,"visible":true,"synonyms":"","idx":1}],"props":{"general":{"descriptionprop":"synonyms","_xmlexport":[],"_hierexport":[]},"list":[{"aID":-2,"aName":"aName","realName":"Value","aDescription":"","aType":"str","display":0,"width":80,"ishtml":false},{"aDescription":"Comma delimited synonyms list","aID":1,"aName":"synonyms","aType":"str","display":-1,"ishtml":false,"realName":"synonyms","width":80}]}},"events":{"OnCapture":"self.val(typeof chat_mode == \"string\" ? chat_mode : \"server\");"},"_classPrivs":{"tabs":{"vals":true,"events":true},"hidflatprops":[],"customflatprops":[{"name":"extrainfo","descr":"Extra information to show with the More button"},{"name":"spokendescr","descr":"Optional spoken description"}],"editStruct":true,"editMaintenance":true},"isMultiSel":false},{"aID":146,"aName":"Number_Of_Dependants","aType":2,"objInfo":{"ver":2,"lastTab":"events","cat":10,"r_ver":2},"flatProps":{"uid":524289280,"description":"The number of dependants","_default":0,"defaultmode":"","isdynamic":false,"selectionmode":"Decision","allowblank":false,"grouppreviousanswers":"","helptext":"","isenabled":true,"isvisible":true,"maxvalue":0,"minvalue":0,"reversepreviousanswers":false,"showontreedialog":true,"tieddialog":0,"units":"","isselected":"Yes","_xmlexport":["uid"],"extrainfo":"","spokendescr":"","knowledgesource":"","pid":6},"tree":{"version":1,"examples":null,"policyRules":null},"events":{},"_classPrivs":{"tabs":{"events":true},"hidflatprops":["showontreedialog","grouppreviousanswers","tieddialog","selectionmode"],"customflatprops":[{"name":"extrainfo","descr":"Extra information to show with the More button"},{"name":"spokendescr","descr":"Optional spoken description"}],"editStruct":true,"editMaintenance":true},"aDecPlaces":0}]};
var appSettings = aData.appSettings;
dictionary.populateFromObject(aData.aDictionary);
function Cmd_Prog(b,a){var d=replayStack.PopReplay(b.aID);if(d===REPLAYPOP_HANDLED){return}else{if(d==REPLAYPOP_CURRENT){progexec(a,function(g,e,f){replayStack.Add(b.aID,REPLAY_OK);Go()});throw new inferenceIssue(PASSBACK_WAIT)}else{hardError("Unknown replay pop return ["+d+"]");return}}}var cmd_filelist={list:[],last_id:0,add:function(b,a){var d={handle:++this.last_id,aMode:b,aData:a};this.list.push(d);return d},find:function(a){for(var b=0;b<this.list.length;b++){if(this.list[b].handle==a){return this.list[b]}}return null},del:function(a){for(var b=0;b<this.list.length;b++){if(this.list[b].handle==a){this.list.splice(b,1);break}}}};function Cmd_FOpen(e,a,d){var j={fHandle:0};var g=replayStack.PopReplay(e.aID,false,j);if(g==REPLAYPOP_CURRENT){if(!file_sys.existsSync(a)){hardError("File does not exist ["+a+"]");return}var b;if(d==1){b={pos:0,lines:file_sys.readFileSync(a).toString().split("\n")}}else{b=file_sys.openSync(a,d==2?"w":"a")}var h=cmd_filelist.add(d,b);j.fHandle=h.handle;replayStack.Add(e.aID,REPLAY_OBJRETURN,0,0,j);replayStack.Add(e.aID,REPLAY_OK);throw new inferenceIssue(PASSBACK_LOOP)}else{if(g!=REPLAYPOP_HANDLED){hardError("Unknown replay pop return ["+g+"]");return}}return j.fHandle}function Cmd_FClose(a,e){var b=replayStack.PopReplay(a.aID);if(b==REPLAYPOP_CURRENT){var d=cmd_filelist.find(e);if(!d){hardError("Unknown file handle ["+e+"]");return}if(d.aMode!=1){file_sys.closeSync(d.aData)}cmd_filelist.del(e);replayStack.Add(a.aID,REPLAY_OK);throw new inferenceIssue(PASSBACK_LOOP)}else{if(b!=REPLAYPOP_HANDLED){hardError("Unknown replay pop return ["+b+"]");return}}}function Cmd_FRead(h,e,d){var k={eof:false};var a=replayStack.PopReplay(h.aID,false,k);if(a==REPLAYPOP_CURRENT){var g=cmd_filelist.find(e);if(!g){hardError("Unknown file handle ["+e+"]");return}if(g.aMode!=1){hardError("File not open for reading ["+e+"]");return}k.eof=(g.aData.pos>=g.aData.lines.length);if(!k.eof){var m=g.aData.lines[g.aData.pos];g.aData.pos++;if(d.length==1){replayStack.Add(h.aID,REPLAY_SET,d[0],m)}else{m=m.split(/[,\t]/);var l;for(var j=0;j<d.length;j++){var b=dictionary.GetObject(d[j]);if(j<m.length){l=m[j];if((b.aType==TYPE_NUMERIC)||((b.aType==TYPE_VARIABLE)&&(b.varType==VARTYPE_NUM))){l=parseFloat(l)}else{if(b.aType==TYPE_DATE){l=Cmd_StrToDate(l)}}}else{l=PSEUDO_VALUE_EMPTY}replayStack.Add(h.aID,REPLAY_SET,d[j],l)}}}replayStack.Add(h.aID,REPLAY_OBJRETURN,0,0,k);replayStack.Add(h.aID,REPLAY_OK);throw new inferenceIssue(PASSBACK_LOOP)}else{if(a!=REPLAYPOP_HANDLED){hardError("Unknown replay pop return ["+a+"]");return}}return k.eof?1:0}function Cmd_nodeURLfetch(k,b,o,a,h){var e,j,f,g;e=b.indexOf("//");if(e<0){j="http:"}else{j=b.substr(0,e).toLowerCase();b=b.substr(e+2)}var m=urlfetch_http;if(j=="http:"){f=80}else{if(j=="https:"){f=443;m=urlfetch_https}else{hardError("Unknown protocol ["+j+"]");return}}e=b.indexOf("/");if(e<0){g="/"}else{g=b.substr(e);b=b.substr(0,e);console.log(b)}e=b.indexOf(":");if(e>=0){f=parseInt(b.substr(e+1),10);b=b.substr(0,e)}var n="GET";if(h){n="POST"}var q={host:b,port:f,path:g,method:n};if(h){q.headers={"Content-Type":"application/x-www-form-urlencoded","Content-Length":h.length}}var d=function(t,p){if(o){var r=dictionary.GetObjectByName(o);if(r){replayStack.Add(k.aID,REPLAY_SET,r.aID,t)}if(a!=""){r=dictionary.GetObjectByName(a);if(r){replayStack.Add(k.aID,REPLAY_SET,r.aID,p==200?1:2)}}}else{replayStack.Add(k.aID,REPLAY_OBJRETURN,undefined,undefined,{data:t,success:p==200})}replayStack.Add(k.aID,REPLAY_OK);Go()};var l=m.request(q,function(p){if(p.statusCode!=200){d(p.statusCode.toString(),p.statusCode)}else{p.setEncoding("utf8");var r="";p.on("data",function(t){r+=t});p.on("end",function(){d(r,p.statusCode)})}});if(h){l.write(h+"\n")}l.on("error",function(p){d(SimpleObjectToString(p),404)}).end();throw new inferenceIssue(PASSBACK_WAIT,k.aID)}xpertrule.node={modules:{items:[],add:function(b){niceName=b;var g=niceName.lastIndexOf(".");if(g>=0){niceName=niceName.substr(0,g)}g=niceName.lastIndexOf("/");if(g>=0){niceName=niceName.substr(g+1)}if(this.find(niceName)!=null){return}try{var a=require(b);var d={name:niceName,exports:a};this.items.push(d)}catch(f){console.log("Error loading module ["+b+"]");console.log(f)}},find:function(a){for(var b=0;b<this.items.length;b++){if(this.items[b].name==a){return this.items[b].exports}}return null},run:function(d,f,b){var a=xpertrule.node.modules.find(d);if(!a){hardError("Unknown node module ["+d+"]");return}var g={};var e=replayStack.PopReplay(0,false,g);if(e==REPLAYPOP_CURRENT){a[f](b,function(h){replayStack.Add(0,REPLAY_OBJRETURN,0,0,{aResult:h});replayStack.Add(0,REPLAY_OK);Go()});throw new inferenceIssue(PASSBACK_WAIT)}else{return g.aResult}}},getKBnames:function(){try{var b=__dirname.substr(__dirname.lastIndexOf(path.sep)+1);var m=b+path.sep+"user.json";if(!fs.existsSync(m)){throw"company information has not been found for this application. Cannot retrieve additional applications because of this!"}var j=[];var h=fs.readFileSync(m,"utf8");h=JSON.parse(h);var k=fs.readdirSync(".");for(var l=0;l<k.length;l++){var n=k[l];if(n.indexOf("_")==-1){continue}var f=fs.statSync(n);if(f.isDirectory()){m=n+path.sep+"user.json";if(fs.existsSync(m)){var a=fs.readFileSync(m,"utf8");a=JSON.parse(a);if(a.company==h.company){j.push({name:a.name,folder:n})}}}}return j}catch(g){return g.toString()}},chain:function(h,d,a){var b=this;var e;replayStack.CriticalSection(function(p){var n=b.getKBnames();if(!$.isArray(n)){p.CriticalDone({state:"ERROR:Error retrieving application list ["+n+"]"});return}var t,l,m,u;var k=null;for(t=0;t<n.length;t++){if(n[t].name==h){k=n[t].folder;break}}if(!k){p.CriticalDone({state:"ERROR:Unknown application name ["+h+"]"});return}try{m=require("../"+k+"/xpertrule.js")}catch(q){p.CriticalDone({state:"ERROR:Error loading knowledge base ["+h+"]"});return}var j={inputs:[],outputs:[]};var r=m.app();for(t=0;t<r.inputs.length;t++){if($.isFunction(d)){u=d(r.inputs[t],m);if(u!==null){j.inputs.push({name:r.inputs[t],value:u})}}else{l=_dgobn(r.inputs[t]);if(l){j.inputs.push({name:l.aName,value:l.val()})}}}for(t=0;t<r.outputs.length;t++){if($.isFunction(a)){j.outputs.push({name:r.outputs[t]})}else{l=_dgobn(r.outputs[t]);if(l){j.outputs.push({name:l.aName})}}}j.startup=true;m.goxml(j,function(o){delete o.sessionReplayStack;delete o.currentUI;p.CriticalDone(o)},{callbackFn:null})},function(j){e=j});if(e.state!="END"){return e}for(var g=0;g<e.outputs.length;g++){if($.isFunction(a)){a(e.outputs[g].name,e.outputs[g].value)}else{var f=_dgobn(e.outputs[g].name);f.val(e.outputs[g].value)}}return true}};function _buildObjData(d){var a={id:d.aID,val:PSEUDO_VALUE_EMPTY};switch(d.aType){case TYPE_VARIABLE:a.val=d.val();break;case TYPE_PROCEDURE:a=null;break;default:switch(d.aType){case TYPE_LIST:case TYPE_BOOLEAN:var b=d.GetAllInValidValues();if(b&&b.length>0){a.inv=b}break}if(d.isFull()){a.val=d.GetValue()}}return a}function _expandEmbedded(aText,expandEmbedded){if(aText==""||aText==undefined){return""}if(aText=="''"){return""}if(aText.substr(0,1)=="'"){aText=eval(aText)}if(!appSettings.enginePath){aText=LabelDecode(aText,null,expandEmbedded)}return(aText)}function _buildPropList(e,a,d,b,h){var f=function(o,m){if(m){var l=/dictionary\.GetObject\((.*?)\)/g;var k=l.exec(m);var n="";if(d){n=b?b.aName:""}else{if(h){n=h+"."+(b?b.id:0)}else{n=b?b.aName:""}}if(k){var j={cntrl:n,prop:o,val:_expandEmbedded(m)};a.push(j)}}};var g;if(!b){f("caption",e.caption);f("bkgndimage",e.bkgndimage);for(g=0;g<e.controls.length;g++){_buildPropList(e,a,d,e.controls[g],h)}}else{if(b.hasOwnProperty("caption")){f("caption",b.caption)}if(b.hasOwnProperty("imagepath")){f("imagepath",b.imagepath)}if(b.hasOwnProperty("tabsheets")){for(g=0;g<b.tabsheets.length;g++){_buildPropList(e,a,d,b.tabsheets[g],b.aName)}}if(b.hasOwnProperty("controls")){for(g=0;g<b.controls.length;g++){_buildPropList(e,a,d,b.controls[g],h)}}}}function _retrieveApp(b){var a={};if($.isPlainObject(b)&&b.hasOwnProperty("object")){var d=typeof b.object=="number"?_dgo(b.object):_dgobn(b.object);if(!d){a={error:"Unknown object: "+b.object}}else{a={item:$.extend(true,{},d)};delete a.item.aText;delete a.item.flatProps;delete a.item.loaded;delete a.item.loadedFlatProps;delete a.item.staticData;delete a.item.promptFor;delete a.item.isDataFull;delete a.item.instancePtr;delete a.item.encounteredOnHierarchy;delete a.item.treeDialog;delete a.item.treeDialogHidden;delete a.item.treeDialogInitialStates;delete a.item.constraintDomain;delete a.item._hintprops;delete a.item.loadedValues;delete a.item.currentValueID;delete a.item.currentValue;delete a.item.nValues;delete a.item.aValueProps;delete a.item.valid;delete a.item.evalid;delete a.item.ovalid;delete a.item.events;delete a.item._classPrivs;delete a.item.loadedDefinition;delete a.item.aObjectList;delete a.item.aEmbeddedList;delete a.item.aPropList;delete a.item.aBoolCheckBoxList;delete a.item.isSubDialog;delete a.item.currentTiedObj;delete a.item.dialogUI;delete a.item.dirty;if($.isArray(a.item.aValues)){for(var e=0;e<a.item.aValues.length;e++){delete a.item.aValues[e].idx;delete a.item.aValues[e].id;delete a.item.aValues[e].selected;delete a.item.aValues[e].valid;delete a.item.aValues[e].evalid;delete a.item.aValues[e].visible}}if($.isPlainObject(a.item.props)){if(typeof a.item.props.description=="string"){a.item.props.description=d.GetDescription(false)}if(typeof a.item.props.extrainfo=="string"){a.item.props.extrainfo=_expandEmbedded(a.item.props.extrainfo,true)}}}}else{a={inputs:[],outputs:[],dictionary:[]};var e,d;for(e=0;e<dictionary.aDictionary.length;e++){a.dictionary.push(dictionary.aDictionary[e].aName)}if($.isPlainObject(appSettings.dataset_msg)){if($.isArray(appSettings.dataset_msg.inputs)){for(e=0;e<appSettings.dataset_msg.inputs.length;e++){d=_dgo(appSettings.dataset_msg.inputs[e]);if(d){a.inputs.push(d.aName)}}}if($.isArray(appSettings.dataset_msg.outputs)){for(e=0;e<appSettings.dataset_msg.outputs.length;e++){d=_dgo(appSettings.dataset_msg.outputs[e]);if(d){a.outputs.push(d.aName)}}}}}return a}function _goXML(f,j,e){var l="legacy";if(f.hasOwnProperty("format")){l=f.format.toLowerCase()}var g={state:""};switch(l){case"legacy":g.errors=[];g.outputs=[];g.sessionReplayStack=null;break;case"properties":break;default:g.state="ERROR";g.description="Unknown message format : "+l;j(g);return}if(e){if(e.jsAjax){jsAjax=true}if(e.callbackFn&&$.isFunction(e.callbackFn)){xpertrule._setupNodeCallback(e.callbackFn)}}var k=function(q){var r,u,B,t,x,A,F;switch(q.aState){case PASSBACK_PAUSE:if(jsAjax){g={state:"OBJECT",name:q.aValue};r=_dgo(q.aValue);if(r){A=null;g.data=[];switch(r.aType){case TYPE_REPORT:x=r.GetObjList();for(B=0;B<x.length;B++){u=dictionary.GetObject(x[B]);if(u){A=_buildObjData(u);if(A){g.data.push(A)}}}break;default:A=_buildObjData(r);if(A){g.data.push(A)}break}}}else{if(typeof q.aValue=="object"){g.state="PAUSE";g.data=q.aValue}else{r=_dgo(q.aValue);if(r&&r.aType==TYPE_REPORT){F={contents:r.GetText(false),isHTML:true,includeBubble:true};if($.isPlainObject(r.aProps)&&r.aProps.spoken){F.speak=_expandEmbedded(r.aProps.spoken,true)}if($.isPlainObject(r.aProps)&&r.aProps.css){u={};var y=r.aProps.css.split(";");for(B=0;B<y.length;B++){var w=y[B].split(":",2);if(w.length==2){u[w[0].trim()]=w[1].trim()}}F.css=u}F=JSON.stringify(F);switch(l){case"legacy":g.state="PAUSE:"+F;break;case"properties":g.state="PAUSE";g.message=F;break}}else{switch(l){case"legacy":F="CAPTURE:";if(r){F+=r.aName;if(r.hitCount){F+=":"+r.hitCount}}else{F+=q.aValue}g.state=F;break;case"properties":g.state="CAPTURE";if(r){g.name=r.aName}else{g.name=q.aValue}break}}}}break;case PASSBACK_ERROR:g.state="ERROR";g.description=q.aValue.toString();break;case PASSBACK_END:g.state="END";if(f.outputs){for(B=0;B<f.outputs.length;B++){t=f.outputs[B].name;r=dictionary.findObject(t);if(!r){if(l=="legacy"){g.errors.push({name:t})}}else{switch(l){case"legacy":u={name:t,value:r.val()};for(var m in f.outputs[B]){if((m!="name")){if(!r.hasOwnProperty("flatProps")){g.errors.push({description:"read prop: Unknown property ["+t+"."+m+"]"})}else{if(!r.flatProps.hasOwnProperty(m)){g.errors.push({description:"read prop: Unknown property ["+t+"."+m+"]"})}else{u[m]=r.prop(m)}}}}g.outputs.push(u);break;case"properties":g[t]=r.val();break}}}}else{if($.isPlainObject(appSettings.dataset_msg)&&$.isArray(appSettings.dataset_msg.outputs)){for(B=0;B<appSettings.dataset_msg.outputs.length;B++){r=_dgo(appSettings.dataset_msg.outputs[B]);if(r){switch(l){case"legacy":g.outputs.push({name:r.aName,value:r.val()});break;case"properties":g[r.aName]=r.val();break}}}}}break;case PASSBACK_DEBUG:if(jsAjax){g={state:"DEBUG",name:q.aValue,message:q.aExtra}}else{switch(l){case"legacy":g.state="DEBUG:"+q.aExtra;break;case"properties":g.state="DEBUG";g.message=q.aExtra;break}}break;case PASSBACK_PAUSECMD:switch(l){case"legacy":g.state="PAUSE:"+q.aValue;break;case"properties":g.state="PAUSE";g.message=q.aValue;break}break;case PASSBACK_DIALOG:var z=((typeof q.aExtra=="object")?q.aExtra:{});var C=z.hasOwnProperty("tiedObj")?z.tiedObj:null;if(jsAjax){g={state:"DIALOG",name:q.aValue,tied:C?C.aID:0,data:[],props:[]};x=[];var E=[];if(q.aValue=="tree_dialog"&&q.aExtra){g.def=q.aExtra.def;x=q.aExtra.usedIDs;_buildPropList(g.def,E,true);g.props=E}var D;r=dictionary.GetObjectByName(q.aValue);if(r&&r.aType==TYPE_DIALOG){if(r.aObjectList){for(B=0;B<r.aObjectList.length;B++){x.push(r.aObjectList[B])}}if(C){if($.inArray(C.aID,x)==-1){x.push(C.aID)}}E=[];_buildPropList(r.aDefinition,E,false);g.props=E}for(B=0;B<x.length;B++){u=dictionary.GetObject(x[B]);if(u){A=_buildObjData(u);if(A){g.data.push(A)}}}}else{switch(l){case"legacy":g.state="DIALOG:"+q.aValue+(C?":"+C.aName:"");break;case"properties":g.state="DIALOG";g.name=q.aValue;if(C){g.tied=C.aName}break}}break;default:console.log("Unsupported Inference Stop ("+q.aState+")");g.state=false}if(g.state){if(l=="legacy"){g.currentUI=replayStack.replayPassedUIs;g.sessionReplayStack=replayStack}j(g)}};if(!f.startup&&(l=="legacy")&&(typeof f.options=="object")){if(f.options.action=="RESTART"){f.startup=true}}if(f.chatmode){chat_mode=f.chatmode}if(f.utterance){utterance=f.utterance}if(!f.startup&&(l=="legacy")){replayStack=new ReplayStack();autoRun=false;XR_Startup(undefined,{nodejs:true,startCallback:null,callback:k});for(var b in f.sessionReplayStack){replayStack[b]=f.sessionReplayStack[b]}if(f.replayStack){for(var h=0;h<f.replayStack.length;h++){var a=f.replayStack[h];replayStack.Add(a.pauseID,a.aOperation,a.aObjectID,a.aValue,a.aExtra)}}if(typeof f.options=="object"){if(f.options.action=="BACK"){replayStack.simpleBack()}if(f.options.action=="SET"){if(f.options.hasOwnProperty("objectName")){var d=_dgobn(f.options.objectName);if(!d){throw new inferenceIssue(PASSBACK_ERROR,"Unknown object in input message ["+f.options.objectName+"]")}f.options.objectID=d.aID}replayStack.Add(f.options.objectID,REPLAY_SET,f.options.objectID,f.options.objectVal);replayStack.Add(f.options.objectID,REPLAY_OK)}if(f.options.action=="OK"){replayStack.Add(-1,REPLAY_OK)}}Go()}else{replayStack=new ReplayStack();g.sessionReplayStack=replayStack;autoRun=true;XR_Startup(undefined,{nodejs:true,startCallback:function(m){var r,u;switch(l){case"legacy":if(f.inputs){for(var t=0;t<f.inputs.length;t++){u=f.inputs[t].name;r=_dgobn(u);if(!r){g.errors.push({description:"Unknown object ["+u+"] passed in input message"})}else{m.val(r,f.inputs[t].value,true);for(var q in f.inputs[t]){if((q!="name")&&(q!="value")){if(!$.isPlainObject(r.flatProps)){g.errors.push({description:"Cannot set property of non-object ["+u+"."+q+"] passed in input message"})}else{if(!r.flatProps.hasOwnProperty(q)){g.errors.push({description:"Unknown property ["+u+"."+q+"] passed in input message"})}else{replayStack.Add(0,REPLAY_SETPROP,r.aID,f.inputs[t][q],q)}}}}}}}break;case"properties":for(var u in f){if(u!="format"){r=_dgobn(u);if(r){m.val(r,f[u],true)}}}break}},callback:k})}}function _populate(a){appSettings=a.appSettings;dictionary.populateFromObject(a.aDictionary)};